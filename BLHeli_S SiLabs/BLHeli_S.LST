AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE     1


MACRO ASSEMBLER AX51 V3.12.0.0
OBJECT MODULE PLACED IN Output\S_H_90_REV16_68.OBJ
ASSEMBLER INVOKED BY: C:\SiliconLabs\SimplicityStudio\v3\developer\toolchains\keil_8051\9.53\BIN\AX51.exe BLHeli_S.asm D
                      EFINE(ESCNO=19) DEFINE(MCU_48MHZ=1) DEFINE(FETON_DELAY=90) OBJECT(Output\S_H_90_REV16_68.OBJ) DEBU
                      G MACRO NOMOD51 COND SYMBOLS PAGEWIDTH(120) PAGELENGTH(65) 

LOC    OBJ             LINE     SOURCE

                          1     $nomod51 
                          2     ;**** **** **** **** ****
                          3     ;
                          4     ; BLHeli program for controlling brushless motors in multirotors
                          5     ;
                          6     ; Copyright 2011, 2012 Steffen Skaug
                          7     ; This program is distributed under the terms of the GNU General Public License
                          8     ;
                          9     ; This file is part of BLHeli.
                         10     ;
                         11     ; BLHeli is free software: you can redistribute it and/or modify
                         12     ; it under the terms of the GNU General Public License as published by
                         13     ; the Free Software Foundation, either version 3 of the License, or
                         14     ; (at your option) any later version.
                         15     ;
                         16     ; BLHeli is distributed in the hope that it will be useful,
                         17     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                         18     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                         19     ; GNU General Public License for more details.
                         20     ;
                         21     ; You should have received a copy of the GNU General Public License
                         22     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                         23     ;
                         24     ;**** **** **** **** ****
                         25     ;
                         26     ; This software was initially designed for use with Eflite mCP X, but is now adapted to 
                               copters/planes in general
                         27     ;
                         28     ; The software was inspired by and started from from Bernard Konze's BLMC: http://home.v
                               ersanet.de/~bkonze/blc_6a/blc_6a.htm
                         29     ; And also Simon Kirby's TGY: https://github.com/sim-/tgy
                         30     ;
                         31     ; This file is best viewed with tab width set to 5
                         32     ;
                         33     ; The code is designed for multirotor applications, running damped light mode
                         34     ;
                         35     ; The input signal can be Normal (1-2ms), OneShot125 (125-250us), OneShot42 (41.7-83.3us
                               ) or Multishot (5-25us) at rates as high as allowed by the format.
                         36     ; Three Dshot signal rates are also supported, Dshot150, Dshot300 and Dshot600. A 48MHz 
                               MCU is required for Dshot600.
                         37     ; The code autodetects normal, OneShot125, Oneshot42, Multishot or Dshot.
                         38     ;
                         39     ; The first lines of the software must be modified according to the chosen environment:
                         40     ; ESCNO EQU "ESC"
                         41     ; MCU_48MHZ EQU "N"
                         42     ; FETON_DELAY EQU "N"
                         43     ; 
                         44     ;**** **** **** **** ****
                         45     ; Revision history:
                         46     ; - Rev16.0 Started. Built upon rev 14.5 of base code
                         47     ;           Using hardware pwm for very smooth throttle response, silent running and sup
                               port of very high rpms
                         48     ;           Implemented reverse bidirectional mode
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE     2

                         49     ;           Implemented separate throttle gains fwd and rev in bidirectional mode
                         50     ;           Implemented support for Oneshot42 and Multishot
                         51     ; - Rev16.1 Made low rpm power limiting programmable through the startup power parameter
                         52     ; - Rev16.2 Fixed bug that prevented temperature protection
                         53     ;           Improved robustness to very high input signal rates
                         54     ;           Beeps can be turned off by programming beep strength to 1
                         55     ;           Throttle cal difference is checked to be above required minimum before stori
                               ng. Throttle cal max is not stored until successful min throttle cal
                         56     ; - Rev16.3 Implemented programmable temperature protection
                         57     ;           Improved protection of bootloader and generally reduced risk of flash corrup
                               tion
                         58     ;           Some small changes for improved sync hold
                         59     ; - Rev16.4 Fixed bug where bootloader operation could be blocked by a defective "eeprom
                               " signature
                         60     ; - Rev16.5 Added support for DShot150, DShot300 and DShot600
                         61     ; -Rev16.51 (cturn) Customized Default Values
                         62     ;                               selectedable startup tones, via the 'Beeper Volume' sett
                               ing
                         63     ;                               custom beacon tone, should be easier to hear & not heat 
                               up motors.
                         64     ; -Rev16.52 Fix for 32khz Multishot Calibration bug (redacted) 
                         65     ; -Rev16.53 Added signal type identification via signal and arming tones.
                         66     ; - Rev16.6 Fixed signal detection issue of multishot at 32kHz
                         67     ;           Improved bidirectional mode for high input signal rates
                         68     ;
                         69     ;
                         70     ;**** **** **** **** ****
                         71     ; Minimum 8K Bytes of In-System Self-Programmable Flash
                         72     ; Minimum 512 Bytes Internal SRAM
                         73     ;
                         74     ;**** **** **** **** ****
                         75     ; Master clock is internal 24MHz oscillator (or 48MHz, for which the times below are hal
                               ved)
                         76     ; Although 24/48 are used in the code, the exact clock frequencies are 24.5MHz or 49.0 M
                               Hz
                         77     ; Timer 0 (41.67ns counts) always counts up and is used for
                         78     ; - RC pulse measurement
                         79     ; Timer 1 (41.67ns counts) always counts up and is used for
                         80     ; - DShot frame sync detection
                         81     ; Timer 2 (500ns counts) always counts up and is used for
                         82     ; - RC pulse timeout counts and commutation times
                         83     ; Timer 3 (500ns counts) always counts up and is used for
                         84     ; - Commutation timeouts
                         85     ; PCA0 (41.67ns counts) always counts up and is used for
                         86     ; - Hardware PWM generation
                         87     ;
                         88     ;**** **** **** **** ****
                         89     ; Interrupt handling
                         90     ; The C8051 does not disable interrupts when entering an interrupt routine.
                         91     ; Also some interrupt flags need to be cleared by software
                         92     ; The code disables interrupts in some interrupt routines
                         93     ; - Interrupts are disabled during beeps, to avoid audible interference from interrupts
                         94     ;
                         95     ;**** **** **** **** ****
                         96     ; Motor control:
                         97     ; - Brushless motor control with 6 states for each electrical 360 degrees
                         98     ; - An advance timing of 0deg has zero cross 30deg after one commutation and 30deg befor
                               e the next
                         99     ; - Timing advance in this implementation is set to 15deg nominally
                        100     ; - Motor pwm is always damped light (aka complementary pwm, regenerative braking)
                        101     ; Motor sequence starting from zero crossing:
                        102     ; - Timer wait: Wt_Comm                 15deg   ; Time to wait from zero cross to actual
                                commutation
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE     3

                        103     ; - Timer wait: Wt_Advance              15deg   ; Time to wait for timing advance. Nomin
                               al commutation point is after this
                        104     ; - Timer wait: Wt_Zc_Scan              7.5deg  ; Time to wait before looking for zero c
                               ross
                        105     ; - Scan for zero cross                 22.5deg ; Nominal, with some motor variations
                        106     ;
                        107     ; Motor startup:
                        108     ; There is a startup phase and an initial run phase, before normal bemf commutation run 
                               begins.
                        109     ;
                        110     ;**** **** **** **** ****
                        111     ; List of enumerated supported ESCs
 0001                   112     A_                      EQU 1   ; X  X  RC X  MC MB MA CC    X  X  Cc Cp Bc Bp Ac Ap
 0002                   113     B_                      EQU 2   ; X  X  RC X  MC MB MA CC    X  X  Ap Ac Bp Bc Cp Cc
 0003                   114     C_                      EQU 3   ; Ac Ap MC MB MA CC X  RC    X  X  X  X  Cc Cp Bc Bp
 0004                   115     D_                      EQU 4   ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap    
                               Com fets inverted
 0005                   116     E_                      EQU 5   ; L1 L0 RC X  MC MB MA CC    X  L2 Cc Cp Bc Bp Ac Ap    
                               A with LEDs
 0006                   117     F_                      EQU 6   ; X  X  RC X  MA MB MC CC    X  X  Cc Cp Bc Bp Ac Ap
 0007                   118     G_                      EQU 7   ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap    
                               Like D, but noninverted com fets
 0008                   119     H_                      EQU 8   ; RC X  X  X  MA MB CC MC    X  Ap Bp Cp X  Ac Bc Cc
 0009                   120     I_                      EQU 9   ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
 000A                   121     J_                      EQU 10  ; L2 L1 L0 RC CC MB MC MA    X  X  Cc Bc Ac Cp Bp Ap    
                               LEDs
 000B                   122     K_                      EQU 11  ; X  X  MC X  MB CC MA RC    X  X  Ap Bp Cp Cc Bc Ac    
                               Com fets inverted
 000C                   123     L_                      EQU 12  ; X  X  RC X  CC MA MB MC    X  X  Ac Bc Cc Ap Bp Cp
 000D                   124     M_                      EQU 13  ; MA MC CC MB RC L0 X  X     X  Cc Bc Ac Cp Bp Ap X     
                               Inverted LED
 000E                   125     N_                      EQU 14  ; X  X  RC X  MC MB MA CC    X  X  Cp Cc Bp Bc Ap Ac
 000F                   126     O_                      EQU 15  ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap    
                               Like D, but low side pwm and 1S flag set.
 0010                   127     P_                      EQU 16  ; X  X  RC MA CC MB MC X     X  Cc Bc Ac Cp Bp Ap X     
                                       
 0011                   128     Q_                      EQU 17  ; Cp Bp Ap L1 L0 X  RC X     X  MA MB MC CC Cc Bc Ac
 0012                   129     R_                      EQU 18  ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
                        130     
                        131     ;**** **** **** **** ****
                        132     ; Select the port mapping to use (or unselect all for use with external batch compile fi
                               le)
                        133     ;ESCNO EQU A_
                        134     ;ESCNO EQU B_
                        135     ;ESCNO EQU C_
                        136     ;ESCNO EQU D_
                        137     ;ESCNO EQU E_
                        138     ;ESCNO EQU F_
                        139     ;ESCNO EQU G_
                        140     ;ESCNO EQU H_
                        141     ;ESCNO EQU I_
                        142     ;ESCNO EQU J_
                        143     ;ESCNO EQU K_
                        144     ;ESCNO EQU L_
                        145     ;ESCNO EQU M_
                        146     ;ESCNO EQU N_
                        147     ;ESCNO EQU O_
                        148     ;ESCNO EQU P_
                        149     ;ESCNO EQU Q_
                        150     ;ESCNO EQU R_
                        151     
                        152     ;**** **** **** **** ****
                        153     ; Select the MCU type (or unselect for use with external batch compile file)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE     4

                        154     ;MCU_48MHZ EQU  1
                        155     
                        156     ;**** **** **** **** ****
                        157     ; Select the fet deadtime (or unselect for use with external batch compile file)
                        158     ;FETON_DELAY EQU 10     ; 20.4ns per step
                        159     
                        160     
                        161     ;**** **** **** **** ****
                        162     ; ESC selection statements
                        163     IF 19 == A_
                                ;$include (A.inc) ; Select pinout A
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "A"
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE     5

                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE     6

                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE     7

                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE     8

                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE     9

                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    10

                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    11

                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    12

                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    13

                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    14

                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    15

                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    16

                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    17

                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#A_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#A_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#A_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#A_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#A_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#A_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#A_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#A_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#A_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#A_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#A_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#A_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#A_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#A_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#A_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#A_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#A_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#A_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#A_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#A_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#A_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#A_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    18

                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    19

                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    20

                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    21

                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    22

                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    23

                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    24

                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    25

                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       1475     
                       1476     IF 19 == B_
                                ;$include (B.inc) ; Select pinout B
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "B". Equals "A", but with A and C fets swapped and pwm and co
                               m fets swapped
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Ap Ac Bp Bc Cp Cc
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    26

                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    27

                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    28

                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    29

                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    30

                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    31

                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    32

                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    33

                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    34

                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    35

                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    36

                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    37

                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    38

                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#B_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#B_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#B_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#B_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#B_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#B_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#B_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#B_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#B_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#B_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#B_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#B_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#B_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#B_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#B_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#B_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#B_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#B_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#B_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#B_H_50#        "
                    +1          ELSEIF 90 == 70
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    39

                    +1          Eep_ESC_Layout:         DB      "#B_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#B_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    40

                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    41

                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0POL, #00h                           ; Pwm noninverted
                    +1          ELSE
                    +1                  mov     PCA0POL, #01h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    42

                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          ApwmFET         EQU     5       ;o
                    +1          AcomFET         EQU     4       ;o
                    +1          BpwmFET         EQU     3       ;o
                    +1          BcomFET         EQU     2       ;o
                    +1          CpwmFET         EQU     1       ;o
                    +1          CcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    43

                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    44

                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #1Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #37h
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    45

                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    46

                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       2793     
                       2794     IF 19 == C_
                                ;$include (C.inc) ; Select pinout C
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    47

                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "C"
                    +1          ; Ac Ap MC MB MA CC X  RC    X  X  X  X  Cc Cp Bc Bp
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    48

                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    49

                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    50

                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    51

                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    52

                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    53

                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    54

                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    55

                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    56

                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    57

                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    58

                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    59

                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#C_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#C_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#C_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#C_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#C_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#C_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#C_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#C_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#C_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#C_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#C_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    60

                    +1          Eep_ESC_Layout:         DB      "#C_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#C_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#C_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#C_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#C_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#C_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#C_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#C_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#C_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#C_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#C_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     0               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          AcomFET         EQU     7       ;o
                    +1          ApwmFET         EQU     6       ;o
                    +1          Mux_C           EQU     5       ;i
                    +1          Mux_B           EQU     4       ;i
                    +1          Mux_A           EQU     3       ;i
                    +1          Comp_Com                EQU     2       ;i
                    +1          ;                       EQU     1       ;i
                    +1          Rcp_In          EQU     0       ;i
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    61

                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     NOT((1 SHL ApwmFET)+(1 SHL AcomFET))
                    +1          P0_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL AcomFET)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    62

                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    63

                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    64

                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          ;                       EQU     5       ;i
                    +1          ;                       EQU     4       ;i
                    +1          CcomFET         EQU     3       ;o
                    +1          CpwmFET         EQU     2       ;o
                    +1          BcomFET         EQU     1       ;o
                    +1          BpwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     0Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P0.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P0.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.ApwmFET
                    +1          ELSE
                    +1                  clr     P0.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P0.AcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    65

                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P0.ApwmFET
                    +1          ENDIF
                    +1                  setb    P0.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P0.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P0.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P0.AcomFET
                    +1                  mov     P0SKIP, #0BFh
                    +1                  mov     P1SKIP, #0Fh
                    +1          ELSE
                    +1                  mov     P0SKIP, #03Fh
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #0Eh
                    +1          ELSE
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #0Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #0Bh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    66

                    +1          ELSE
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #03h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #32h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #42h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #52h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    67

                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       4113     
                       4114     IF 19 == D_
                                ;$include (D.inc) ; Select pinout D
                    +1          ;**** **** **** **** ****
                    +1          ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    68

                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "D". Com fets are active low for H/L_N driver and EN_N/PWM dr
                               iver
                    +1          ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    69

                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    70

                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    71

                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    72

                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    73

                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    74

                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    75

                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    76

                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    77

                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    78

                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    79

                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    80

                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#D_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#D_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#D_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#D_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#D_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#D_L_25#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    81

                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#D_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#D_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#D_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#D_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#D_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#D_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#D_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#D_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#D_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#D_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#D_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#D_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#D_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#D_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#D_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#D_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    82

                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_B           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    83

                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    84

                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #00h                           ; Damping noninverted, pwm nonin
                               verted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    85

                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    86

                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    87

                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    88

                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    89

                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       5426     
                       5427     IF 19 == E_
                                ;$include (E.inc) ; Select pinout E
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "E". Equals "A", but with LED control. And with HIP2103/4 dri
                               ver initialization
                    +1          ; L1 L0 RC X  MC MB MA CC    X  L2 Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    90

                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    91

                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    92

                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    93

                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    94

                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    95

                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    96

                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    97

                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    98

                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE    99

                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   100

                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   101

                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   102

                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#E_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#E_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#E_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#E_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#E_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#E_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#E_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#E_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#E_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#E_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#E_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#E_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#E_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#E_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#E_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#E_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#E_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#E_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#E_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#E_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#E_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#E_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   103

                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          LED_1           EQU     7       ;o
                    +1          LED_0           EQU     6       ;o
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     NOT((1 SHL LED_0)+(1 SHL LED_1))
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   104

                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   105

                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   106

                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          LED_2           EQU     6       ;o
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)+(1 SHL LED_2)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)+(1 SHL LED_2)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   107

                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   108

                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #7Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #7Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #7Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #73h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #6Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #4Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   109

                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1                  All_pwmFETs_off ; For unlocking of HIP2103/4 driver circuits
                    +1                  call wait100ms
                    +1                  AcomFET_on
                    +1                  BcomFET_on
                    +1                  CcomFET_on
                    +1                  call wait1ms
                    +1                  All_comFETs_off
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   110

                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1                  clr     P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1                  setb    P0.LED_1
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1                  clr     P0.LED_1
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1                  setb    P1.LED_2
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1                  clr     P1.LED_2
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       6752     
                       6753     IF 19 == F_
                                ;$include (F.inc) ; Select pinout F
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   111

                    +1          ; Hardware definition file "F". Equals "A", but with Mux_A and Mux_C swapped
                    +1          ; X  X  RC X  MA MB MC CC    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   112

                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   113

                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   114

                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   115

                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   116

                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   117

                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   118

                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   119

                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   120

                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   121

                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   122

                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   123

                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#F_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#F_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#F_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#F_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#F_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#F_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#F_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#F_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#F_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#F_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#F_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#F_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#F_H_05#        "
                    +1          ELSEIF 90 == 10
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   124

                    +1          Eep_ESC_Layout:         DB      "#F_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#F_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#F_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#F_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#F_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#F_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#F_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#F_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#F_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_A           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   125

                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   126

                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   127

                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   128

                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   129

                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   130

                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   131

                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       8065     
                       8066     IF 19 == G_
                                ;$include (G.inc) ; Select pinout G
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   132

                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "G"
                    +1          ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   133

                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   134

                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   135

                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   136

                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   137

                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   138

                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   139

                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   140

                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   141

                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   142

                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   143

                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   144

                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#G_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#G_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#G_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#G_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#G_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#G_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#G_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#G_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#G_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#G_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#G_L_90#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   145

                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#G_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#G_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#G_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#G_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#G_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#G_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#G_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#G_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#G_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#G_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#G_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   146

                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_B           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   147

                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   148

                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   149

                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   150

                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   151

                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   152

                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       9378     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   153

                       9379     IF 19 == H_
                                ;$include (H.inc) ; Select pinout H
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "H". 
                    +1          ; RC X  X  X  MA MB CC MC    X  Ap Bp Cp X  Ac Bc Cc 
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   154

                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   155

                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   156

                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   157

                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   158

                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   159

                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   160

                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   161

                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   162

                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   163

                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   164

                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   165

                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#H_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#H_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#H_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#H_L_15#        "
                    +1          ELSEIF 90 == 20
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   166

                    +1          Eep_ESC_Layout:         DB      "#H_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#H_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#H_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#H_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#H_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#H_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#H_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#H_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#H_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#H_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#H_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#H_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#H_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#H_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#H_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#H_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#H_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#H_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   167

                                               
                    +1          RTX_PIN                         EQU     7               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          Rcp_In          EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          ;                       EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_A           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Comp_Com                EQU     1       ;i
                    +1          Mux_C           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   168

                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   169

                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0POL, #00h                           ; Pwm noninverted
                    +1          ELSE
                    +1                  mov     PCA0POL, #01h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   170

                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ApwmFET         EQU     6       ;o
                    +1          BpwmFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          ;                       EQU     3       ;i
                    +1          AcomFET         EQU     2       ;o 
                    +1          BcomFET         EQU     1       ;o
                    +1          CcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   171

                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   172

                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #5Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #5Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #6Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #6Eh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #31h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #21h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #01h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   173

                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   174

                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      10696     
                      10697     IF 19 == I_
                                ;$include (I.inc) ; Select pinout I
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "I"
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   175

                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   176

                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   177

                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   178

                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   179

                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   180

                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   181

                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   182

                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   183

                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   184

                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   185

                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   186

                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   187

                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#I_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#I_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#I_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#I_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#I_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#I_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#I_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#I_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#I_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#I_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#I_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#I_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#I_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#I_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#I_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#I_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#I_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#I_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#I_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#I_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#I_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#I_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   188

                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   189

                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   190

                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   191

                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          AcomFET         EQU     5       ;o
                    +1          BcomFET         EQU     4       ;o
                    +1          CcomFET         EQU     3       ;o
                    +1          ApwmFET         EQU     2       ;o
                    +1          BpwmFET         EQU     1       ;o
                    +1          CpwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   192

                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   193

                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #36h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   194

                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   195

                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      12008     
                      12009     IF 19 == J_
                                ;$include (J.inc) ; Select pinout J
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "J"
                    +1          ; L2 L1 L0 RC CC MB MC MA    X  X  Cc Bc Ac Cp Bp Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   196

                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   197

                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   198

                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   199

                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   200

                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   201

                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   202

                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   203

                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   204

                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   205

                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   206

                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   207

                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   208

                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#J_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#J_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#J_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#J_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#J_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#J_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#J_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#J_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#J_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#J_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#J_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#J_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#J_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#J_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#J_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#J_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#J_H_25#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   209

                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#J_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#J_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#J_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#J_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#J_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     4               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          LED_2           EQU     7       ;o
                    +1          LED_1           EQU     6       ;o
                    +1          LED_0           EQU     5       ;o
                    +1          Rcp_In          EQU     4       ;i
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_A           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)+(1 SHL LED_2)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   210

                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   211

                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   212

                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          BcomFET         EQU     4       ;o
                    +1          AcomFET         EQU     3       ;o
                    +1          CpwmFET         EQU     2       ;o
                    +1          BpwmFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   213

                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   214

                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #36h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   215

                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   216

                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  clr     P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1                  clr     P0.LED_1
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1                  setb    P0.LED_1
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1                  clr     P0.LED_2
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1                  setb    P0.LED_2
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      13326     
                      13327     IF 19 == K_
                                ;$include (K.inc) ; Select pinout K
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   217

                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "K". Com fets are active low for H/L_N driver and EN_N/PWM dr
                               iver
                    +1          ; X  X  MC X  MB CC MA RC    X  X  Ap Bp Cp Cc Bc Ac    Com fets inverted
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   218

                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   219

                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   220

                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   221

                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   222

                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   223

                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   224

                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   225

                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   226

                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   227

                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   228

                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   229

                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#K_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#K_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#K_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#K_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#K_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#K_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#K_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#K_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#K_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#K_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#K_L_90#        "
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   230

                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#K_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#K_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#K_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#K_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#K_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#K_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#K_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#K_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#K_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#K_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#K_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     0               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   231

                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Mux_C           EQU     5       ;i
                    +1          ;                       EQU     4       ;i
                    +1          Mux_B           EQU     3       ;i
                    +1          Comp_Com                EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Rcp_In          EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   232

                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   233

                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #00h                           ; Damping noninverted, pwm nonin
                               verted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   234

                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          ApwmFET         EQU     5       ;o
                    +1          BpwmFET         EQU     4       ;o
                    +1          CpwmFET         EQU     3       ;o
                    +1          CcomFET         EQU     2       ;o
                    +1          BcomFET         EQU     1       ;o
                    +1          AcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   235

                    +1          ELSE
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1                  mov     P1SKIP, #1Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Eh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   236

                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1                  mov     P1SKIP, #37h
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #12h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #32h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #52h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   237

                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      14640     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   238

                      14641     IF 19 == L_
                                ;$include (L.inc) ; Select pinout L
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "L"
                    +1          ; X  X  RC X  CC MA MB MC    X  X  Ac Bc Cc Ap Bp Cp
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   239

                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   240

                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   241

                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   242

                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   243

                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   244

                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   245

                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   246

                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   247

                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   248

                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   249

                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   250

                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#L_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#L_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#L_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#L_L_15#        "
                    +1          ELSEIF 90 == 20
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   251

                    +1          Eep_ESC_Layout:         DB      "#L_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#L_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#L_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#L_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#L_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#L_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#L_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#L_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#L_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#L_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#L_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#L_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#L_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#L_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#L_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#L_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#L_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#L_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   252

                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_B           EQU     1       ;i
                    +1          Mux_C           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   253

                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   254

                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   255

                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          AcomFET         EQU     5       ;o
                    +1          BcomFET         EQU     4       ;o
                    +1          CcomFET         EQU     3       ;o
                    +1          ApwmFET         EQU     2       ;o
                    +1          BpwmFET         EQU     1       ;o
                    +1          CpwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   256

                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   257

                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #36h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   258

                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   259

                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      15952     
                      15953     IF 19 == M_
                                ;$include (M.inc) ; Select pinout M
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "M".
                    +1          ; MA MC CC MB RC L0 X  X     X  Cc Bc Ac Cp Bp Ap X     
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   260

                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   261

                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   262

                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   263

                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   264

                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   265

                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   266

                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   267

                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   268

                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   269

                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   270

                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   271

                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   272

                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#M_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#M_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#M_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#M_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#M_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#M_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#M_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#M_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#M_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#M_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#M_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#M_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#M_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#M_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#M_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#M_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#M_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#M_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#M_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#M_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#M_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#M_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   273

                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     3               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          Mux_A           EQU     7       ;i
                    +1          Mux_C           EQU     6       ;i
                    +1          Comp_Com        EQU     5       ;i
                    +1          Mux_B           EQU     4       ;i
                    +1          Rcp_In          EQU     3       ;i
                    +1          LED_0           EQU     2       ;i
                    +1          ;                       EQU     1       ;i
                    +1          ;                       EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     NOT(1 SHL LED_0)
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   274

                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   275

                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   276

                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          CcomFET         EQU     6       ;o
                    +1          BcomFET         EQU     5       ;o
                    +1          AcomFET         EQU     4       ;o
                    +1          CpwmFET         EQU     3       ;i
                    +1          BpwmFET         EQU     2       ;o 
                    +1          ApwmFET         EQU     1       ;o
                    +1          ;                       EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   277

                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   278

                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #7Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #6Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #7Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #5Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #77h
                    +1          ELSE
                    +1                  mov     P1SKIP, #37h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #75h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #45h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #65h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   279

                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   280

                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1               clr        P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      17269     
                      17270     IF 19 == N_
                                ;$include (N.inc) ; Select pinout N
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "N"
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Cp Cc Bp Bc Ap Ac
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   281

                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   282

                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   283

                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   284

                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   285

                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   286

                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   287

                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   288

                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   289

                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   290

                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   291

                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   292

                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   293

                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#N_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#N_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#N_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#N_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#N_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#N_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#N_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#N_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#N_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#N_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#N_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#N_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#N_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#N_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#N_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#N_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#N_H_25#        "
                    +1          ELSEIF 90 == 30
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   294

                    +1          Eep_ESC_Layout:         DB      "#N_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#N_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#N_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#N_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#N_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   295

                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   296

                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0POL, #00h                           ; Pwm noninverted
                    +1          ELSE
                    +1                  mov     PCA0POL, #01h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   297

                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CpwmFET         EQU     5       ;o
                    +1          CcomFET         EQU     4       ;o
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   298

                    +1          BpwmFET         EQU     3       ;o
                    +1          BcomFET         EQU     2       ;o
                    +1          ApwmFET         EQU     1       ;o
                    +1          AcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   299

                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #37h
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #1Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   300

                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   301

                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      18587     
                      18588     IF 19 == O_
                                ;$include (O.inc) ; Select pinout O
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   302

                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "O". Com fets are active low for H/L_N driver and EN_N/PWM dr
                               iver. Low side pwm and 1S flag set
                    +1          ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   303

                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   304

                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   305

                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   306

                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   307

                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   308

                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   309

                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   310

                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   311

                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   312

                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   313

                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   314

                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#O_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#O_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#O_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#O_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#O_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#O_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#O_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#O_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#O_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#O_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#O_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   315

                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#O_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#O_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#O_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#O_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#O_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#O_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#O_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#O_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#O_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#O_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#O_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   316

                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_B           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   317

                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   318

                    +1                  mov     PCA0POL, #00h                           ; Damping noninverted, pwm nonin
                               verted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   319

                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.CcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   320

                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   321

                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1                  cpl A
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   322

                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      19901     
                      19902     IF 19 == P_
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   323

                                ;$include (P.inc) ; Select pinout P
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "P".
                    +1          ; X  X  RC MA CC MB MC X     X  Cc Bc Ac Cp Bp Ap X    
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   324

                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   325

                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   326

                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   327

                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   328

                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   329

                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   330

                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   331

                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   332

                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   333

                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   334

                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   335

                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#P_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#P_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#P_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#P_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#P_L_20#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   336

                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#P_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#P_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#P_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#P_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#P_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#P_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#P_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#P_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#P_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#P_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#P_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#P_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#P_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#P_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#P_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#P_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#P_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   337

                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          Mux_A           EQU     4       ;i
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          ;                       EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   338

                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   339

                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   340

                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          CcomFET         EQU     6       ;o
                    +1          BcomFET         EQU     5       ;o
                    +1          AcomFET         EQU     4       ;o
                    +1          CpwmFET         EQU     3       ;i
                    +1          BpwmFET         EQU     2       ;o 
                    +1          ApwmFET         EQU     1       ;o
                    +1          ;                       EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   341

                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   342

                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #7Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #6Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #7Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #5Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #77h
                    +1          ELSE
                    +1                  mov     P1SKIP, #37h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #43h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   343

                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   344

                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      21216     
                      21217     IF 19 == Q_
                                ;$include (Q.inc) ; Select pinout Q
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "Q"
                    +1          ; Cp Bp Ap L1 L0 X  RC X     X  MA MB MC CC Cc Bc Ac
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   345

                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   346

                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   347

                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   348

                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   349

                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   350

                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   351

                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   352

                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   353

                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   354

                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   355

                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   356

                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   357

                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#Q_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#Q_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#Q_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#Q_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#Q_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#Q_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#Q_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#Q_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#Q_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#Q_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#Q_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#Q_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#Q_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#Q_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#Q_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#Q_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#Q_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#Q_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#Q_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#Q_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#Q_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#Q_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   358

                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     1               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          CpwmFET         EQU     7       ;o
                    +1          BpwmFET         EQU     6       ;o
                    +1          ApwmFET         EQU     5       ;o
                    +1          LED_1           EQU     4       ;i
                    +1          LED_0           EQU     3       ;i
                    +1          ;                       EQU     2       ;i
                    +1          Rcp_In          EQU     1       ;i
                    +1          ;                       EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     0FFh
                    +1          P0_INIT         EQU     (1 SHL Rcp_In)
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)+(1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 S
                               HL CpwmFET)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   359

                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   360

                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   361

                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          Mux_A           EQU     6       ;i
                    +1          Mux_B           EQU     5       ;i
                    +1          Mux_C           EQU     4       ;i
                    +1          Comp_Com                EQU     3       ;o
                    +1          CcomFET         EQU     2       ;o
                    +1          BcomFET         EQU     1       ;o
                    +1          AcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     07h
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P0.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.ApwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   362

                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P0.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P0.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.ApwmFET
                    +1                  clr     P0.BpwmFET
                    +1                  clr     P0.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P0.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P0.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P0.CpwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   363

                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P0SKIP, #0DFh
                    +1                  mov     P1SKIP, #07h
                    +1          ELSE
                    +1                  mov     P0SKIP, #0DFh
                    +1                  mov     P1SKIP, #06h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P0SKIP, #0BFh
                    +1                  mov     P1SKIP, #07h
                    +1          ELSE
                    +1                  mov     P0SKIP, #0BFh
                    +1                  mov     P1SKIP, #05h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P0SKIP, #07Fh
                    +1                  mov     P1SKIP, #07h
                    +1          ELSE
                    +1                  mov     P0SKIP, #07Fh
                    +1                  mov     P1SKIP, #03h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #07h
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP1MX, #63h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP1MX, #53h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP1MX, #43h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP1CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   364

                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP1CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP1MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   365

                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1                  clr     P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1                  setb    P0.LED_1
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1                  clr     P0.LED_1
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      22540     
                      22541     IF 19 == R_
                                ;$include (R.inc) ; Select pinout R
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   366

                    +1          ; Hardware definition file "R".
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   367

                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   368

                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   369

                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   370

                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   371

                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   372

                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   373

                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   374

                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   375

                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   376

                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   377

                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   378

                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#R_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#R_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#R_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#R_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#R_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#R_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#R_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#R_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#R_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#R_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#R_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#R_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#R_H_05#        "
                    +1          ELSEIF 90 == 10
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   379

                    +1          Eep_ESC_Layout:         DB      "#R_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#R_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#R_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#R_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#R_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#R_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#R_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#R_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#R_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   380

                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   381

                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   382

                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   383

                    +1          AcomFET         EQU     5       ;o
                    +1          BcomFET         EQU     4       ;o
                    +1          CcomFET         EQU     3       ;o
                    +1          ApwmFET         EQU     2       ;o
                    +1          BpwmFET         EQU     1       ;o
                    +1          CpwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   384

                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #36h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   385

                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   386

                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      23852     
                      23853     
                      23854     ;**** **** **** **** ****
                      23855     ; Programming defaults
                      23856     ;
 0005                 23857     DEFAULT_PGM_STARTUP_PWR                                 EQU 5   ; 1=0.031 2=0.047 3=0.06
                               3 4=0.094 5=0.125 6=0.188       7=0.25  8=0.38  9=0.50  10=0.75 11=1.00 12=1.25 13=1.50
 0003                 23858     DEFAULT_PGM_COMM_TIMING                         EQU 3   ; 1=Low                 2=Medium
                               Low     3=Medium                4=MediumHigh    5=High
 0003                 23859     DEFAULT_PGM_DEMAG_COMP                          EQU 3   ; 1=Disabled    2=Low           
                               3=High
 0001                 23860     DEFAULT_PGM_DIRECTION                           EQU 1   ; 1=Normal      2=Reversed      
                               3=Bidir         4=Bidir rev
 005B                 23861     DEFAULT_PGM_BEEP_STRENGTH                       EQU 91  ; Beep strength
 0050                 23862     DEFAULT_PGM_BEACON_STRENGTH                     EQU 80  ; Beacon strength
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   387

 0003                 23863     DEFAULT_PGM_BEACON_DELAY                                EQU 3   ; 1=1m          2=2m    
                                               3=5m                    4=10m           5=Infinite
                      23864     
                      23865     ; COMMON
 0001                 23866     DEFAULT_PGM_ENABLE_TX_PROGRAM           EQU 1   ; 1=Enabled     0=Disabled
 000A                 23867     DEFAULT_PGM_MIN_THROTTLE                                EQU 10  ; 4*10+1000=1040
 00F0                 23868     DEFAULT_PGM_MAX_THROTTLE                                EQU 240 ; 4*240+1000=1960
 007D                 23869     DEFAULT_PGM_CENTER_THROTTLE                     EQU 125 ; 4*125+1000=1500 (used in bidir
                               ectional mode)
 0006                 23870     DEFAULT_PGM_ENABLE_TEMP_PROT                    EQU 6   ; 0=Disabled    1=80C   2=90C   
                               3=100C  4=110C  5=120C  6=130C  7=140C
 0001                 23871     DEFAULT_PGM_ENABLE_POWER_PROT           EQU 1   ; 1=Enabled     0=Disabled
 0001                 23872     DEFAULT_PGM_BRAKE_ON_STOP                       EQU 1   ; 1=Enabled     0=Disabled
 0001                 23873     DEFAULT_PGM_LED_CONTROL                         EQU 1   ; Byte for LED control. 2bits pe
                               r LED, 0=Off, 1=On
                      23874     
                      23875     ;**** **** **** **** ****
                      23876     ; Temporary register definitions
  REG                 23877     Temp1           EQU     R0
  REG                 23878     Temp2           EQU     R1
  REG                 23879     Temp3           EQU     R2
  REG                 23880     Temp4           EQU     R3
  REG                 23881     Temp5           EQU     R4
  REG                 23882     Temp6           EQU     R5
  REG                 23883     Temp7           EQU     R6
  REG                 23884     Temp8           EQU     R7
                      23885     
                      23886     ;**** **** **** **** ****
                      23887     ; Register definitions
000020                23888     DSEG AT 20h                                     ; Variables segment 
                      23889     
000020                23890     Bit_Access:                             DS      1               ; MUST BE AT THIS ADDRES
                               S. Variable at bit accessible address (for non interrupt routines)
000021                23891     Bit_Access_Int:                 DS      1               ; Variable at bit accessible add
                               ress (for interrupts)
                      23892     
000022                23893     Rcp_Outside_Range_Cnt:          DS      1               ; RC pulse outside range counter
                                (incrementing) 
000023                23894     Rcp_Timeout_Cntd:                       DS      1               ; RC pulse timeout count
                               er (decrementing) 
                      23895     
                      23896     
000024                23897     Flags0:                                 DS      1       ; State flags. Reset upon init_s
                               tart
 0000                 23898     T3_PENDING                              EQU     0               ; Timer 3 pending flag
 0001                 23899     DEMAG_DETECTED                          EQU     1               ; Set when excessive dem
                               ag time is detected
 0002                 23900     DEMAG_CUT_POWER                 EQU     2               ; Set when demag compensation cu
                               ts power
 0003                 23901     COMP_TIMED_OUT                          EQU     3               ; Set when comparator re
                               ading timed out
                      23902     ;                                               EQU     4
                      23903     ;                                               EQU     5       
                      23904     ;                                               EQU     6       
                      23905     ;                                               EQU     7       
                      23906     
                      23907     
000025                23908     Flags1:                                 DS      1       ; State flags. Reset upon init_s
                               tart 
 0000                 23909     STARTUP_PHASE                           EQU     0               ; Set when in startup ph
                               ase
 0001                 23910     INITIAL_RUN_PHASE                       EQU     1               ; Set when in initial ru
                               n phase, before synchronized run is achieved
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   388

 0002                 23911     MOTOR_STARTED                           EQU     2               ; Set when motor is star
                               ted
 0003                 23912     DIR_CHANGE_BRAKE                        EQU     3               ; Set when braking befor
                               e direction change
 0004                 23913     HIGH_RPM                                        EQU     4               ; Set when motor
                                rpm is high (Comm_Period4x_H less than 2)
                      23914     ;                                               EQU     5
                      23915     ;                                               EQU     6       
                      23916     ;                                               EQU     7       
                      23917     
000026                23918     Flags2:                                 DS      1               ; State flags. NOT reset
                                upon init_start
 0000                 23919     RCP_UPDATED                             EQU     0               ; New RC pulse length va
                               lue available
 0001                 23920     RCP_ONESHOT125                          EQU     1               ; RC pulse input is OneS
                               hot125 (125-250us)
 0002                 23921     RCP_ONESHOT42                           EQU     2               ; RC pulse input is OneS
                               hot42 (41.67-83us)
 0003                 23922     RCP_MULTISHOT                           EQU     3               ; RC pulse input is Mult
                               ishot (5-25us)
 0004                 23923     RCP_DSHOT                                       EQU     4               ; RC pulse input
                                is digital shot
 0005                 23924     RCP_DIR_REV                             EQU     5               ; RC pulse direction in 
                               bidirectional mode
 0006                 23925     RCP_FULL_RANGE                          EQU     6               ; When set full input si
                               gnal range is used (1000-2000us) and stored calibration values are ignored
                      23926     ;                                               EQU     7       
                      23927     
000027                23928     Flags3:                                 DS      1                       ; State flags. N
                               OT reset upon init_start
 0000                 23929     PGM_DIR_REV                     EQU     0               ; Programmed direction. 0=normal
                               , 1=reversed
 0001                 23930     PGM_BIDIR_REV           EQU     1               ; Programmed bidirectional direction. 0=
                               normal, 1=reversed
 0002                 23931     PGM_BIDIR                               EQU     2               ; Programmed bidirection
                               al operation. 0=normal, 1=bidirectional
 0003                 23932     FET_SWAP                                EQU     3               ; Flipped on/off during 
                               Beep Routine.           
 0004                 23933     TONE_WAVE                               EQU     4                       
 0005                 23934     TONE_DIR                                EQU     5                       
 0006                 23935     CZ_TONES                                EQU     6       
 0007                 23936     MUTE                                            EQU     7       
                      23937     
                      23938     
                      23939     ;**** **** **** **** ****
                      23940     ; RAM definitions
000030                23941     DSEG AT 30h                                             ; Ram data segment, direct addre
                               ssing
000030                23942     Initial_Arm:                            DS      1               ; Variable that is set d
                               uring the first arm sequence after power on
                      23943     
000031                23944     Min_Throttle_L:                 DS      1               ; Minimum throttle scaled (lo by
                               te)
000032                23945     Min_Throttle_H:                 DS      1               ; Minimum throttle scaled (hi by
                               te)
000033                23946     Center_Throttle_L:                      DS      1               ; Center throttle scaled
                                (lo byte)
000034                23947     Center_Throttle_H:                      DS      1               ; Center throttle scaled
                                (hi byte)
000035                23948     Max_Throttle_L:                 DS      1               ; Maximum throttle scaled (lo by
                               te)
000036                23949     Max_Throttle_H:                 DS      1               ; Maximum throttle scaled (hi by
                               te)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   389

                      23950     
000037                23951     Power_On_Wait_Cnt_L:            DS      1               ; Power on wait counter (lo byte
                               )
000038                23952     Power_On_Wait_Cnt_H:            DS      1               ; Power on wait counter (hi byte
                               )
                      23953     
000039                23954     Startup_Cnt:                            DS      1               ; Startup phase commutat
                               ions counter (incrementing)
00003A                23955     Startup_Zc_Timeout_Cntd:                DS      1               ; Startup zero cross tim
                               eout counter (decrementing)
00003B                23956     Initial_Run_Rot_Cntd:           DS      1               ; Initial run rotations counter 
                               (decrementing)
00003C                23957     Stall_Cnt:                              DS      1               ; Counts start/run attem
                               pts that resulted in stall. Reset upon a proper stop
00003D                23958     Demag_Detected_Metric:          DS      1               ; Metric used to gauge demag eve
                               nt frequency
00003E                23959     Demag_Pwr_Off_Thresh:           DS      1               ; Metric threshold above which p
                               ower is cut
00003F                23960     Low_Rpm_Pwr_Slope:                      DS      1               ; Sets the slope of powe
                               r increase for low rpms
                      23961     
000040                23962     Timer0_X:                                       DS      1               ; Timer 0 extend
                               ed byte
000041                23963     Timer2_X:                                       DS      1               ; Timer 2 extend
                               ed byte
000042                23964     Prev_Comm_L:                            DS      1               ; Previous commutation t
                               imer 3 timestamp (lo byte)
000043                23965     Prev_Comm_H:                            DS      1               ; Previous commutation t
                               imer 3 timestamp (hi byte)
000044                23966     Prev_Comm_X:                            DS      1               ; Previous commutation t
                               imer 3 timestamp (ext byte)
000045                23967     Prev_Prev_Comm_L:                       DS      1               ; Pre-previous commutati
                               on timer 3 timestamp (lo byte)
000046                23968     Prev_Prev_Comm_H:                       DS      1               ; Pre-previous commutati
                               on timer 3 timestamp (hi byte)
000047                23969     Comm_Period4x_L:                        DS      1               ; Timer 3 counts between
                                the last 4 commutations (lo byte)
000048                23970     Comm_Period4x_H:                        DS      1               ; Timer 3 counts between
                                the last 4 commutations (hi byte)
000049                23971     Comparator_Read_Cnt:            DS      1               ; Number of comparator reads don
                               e
                      23972     
00004A                23973     Wt_Adv_Start_L:                 DS      1               ; Timer 3 start point for commut
                               ation advance timing (lo byte)
00004B                23974     Wt_Adv_Start_H:                 DS      1               ; Timer 3 start point for commut
                               ation advance timing (hi byte)
00004C                23975     Wt_Zc_Scan_Start_L:                     DS      1               ; Timer 3 start point fr
                               om commutation to zero cross scan (lo byte)
00004D                23976     Wt_Zc_Scan_Start_H:                     DS      1               ; Timer 3 start point fr
                               om commutation to zero cross scan (hi byte)
00004E                23977     Wt_Zc_Tout_Start_L:                     DS      1               ; Timer 3 start point fo
                               r zero cross scan timeout (lo byte)
00004F                23978     Wt_Zc_Tout_Start_H:                     DS      1               ; Timer 3 start point fo
                               r zero cross scan timeout (hi byte)
000050                23979     Wt_Comm_Start_L:                        DS      1               ; Timer 3 start point fr
                               om zero cross to commutation (lo byte)
000051                23980     Wt_Comm_Start_H:                        DS      1               ; Timer 3 start point fr
                               om zero cross to commutation (hi byte)
                      23981     
000052                23982     New_Rcp:                                        DS      1               ; New RC pulse v
                               alue in pca counts
000053                23983     Rcp_Stop_Cnt:                           DS      1               ; Counter for RC pulses 
                               below stop value
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   390

                      23984     
000054                23985     Power_Pwm_Reg_L:                        DS      1               ; Power pwm register set
                               ting (lo byte)
000055                23986     Power_Pwm_Reg_H:                        DS      1               ; Power pwm register set
                               ting (hi byte). 0x3F is minimum power
000056                23987     Damp_Pwm_Reg_L:                 DS      1               ; Damping pwm register setting (
                               lo byte)
000057                23988     Damp_Pwm_Reg_H:                 DS      1               ; Damping pwm register setting (
                               hi byte)
000058                23989     Current_Power_Pwm_Reg_H:                DS      1               ; Current power pwm regi
                               ster setting that is loaded in the PCA register (hi byte)
                      23990     
000059                23991     Pwm_Limit:                              DS      1               ; Maximum allowed pwm 
00005A                23992     Pwm_Limit_By_Rpm:                       DS      1               ; Maximum allowed pwm fo
                               r low or high rpms
00005B                23993     Pwm_Limit_Beg:                          DS      1               ; Initial pwm limit
                      23994     
00005C                23995     Adc_Conversion_Cnt:                     DS      1               ; Adc conversion counter
                      23996     
00005D                23997     Current_Average_Temp:           DS      1               ; Current average temperature (l
                               o byte ADC reading, assuming hi byte is 1)
                      23998     
00005E                23999     Throttle_Gain:                          DS      1               ; Gain to be applied to 
                               RCP value
00005F                24000     Throttle_Gain_M:                        DS      1               ; Gain to be applied to 
                               RCP value (multiplier 0=1x, 1=2x, 2=4x etc))
000060                24001     Throttle_Gain_BD_Rev:           DS      1               ; Gain to be applied to RCP valu
                               e for reverse direction in bidirectional mode
000061                24002     Throttle_Gain_BD_Rev_M:         DS      1               ; Gain to be applied to RCP valu
                               e for reverse direction in bidirectional mode (multiplier 0=1x, 1=2x, 2=4x etc)
000062                24003     Beep_Strength:                          DS      1               ; Strength of beeps
                      24004     
000063                24005     Skip_T2_Int:                            DS      1               ; Set for 48MHz MCUs whe
                               n timer 2 interrupt shall be ignored
000064                24006     Clock_Set_At_48MHz:                     DS      1               ; Variable set if 48MHz 
                               MCUs run at 48MHz
                      24007     
000065                24008     Flash_Key_1:                            DS      1               ; Flash key one
000066                24009     Flash_Key_2:                            DS      1               ; Flash key two
                      24010     
000067                24011     Temp_Prot_Limit:                        DS      1               ; Temperature protection
                                limit
                      24012     
000068                24013     DShot_Pwm_Thr:                          DS      1               ; DShot pulse width thre
                               shold value
000069                24014     DShot_Timer_Preset:                     DS      1               ; DShot timer preset for
                                frame sync detection
00006A                24015     DShot_Frame_Start_L:            DS      1               ; DShot frame start timestamp (l
                               o byte)
00006B                24016     DShot_Frame_Start_H:            DS      1               ; DShot frame start timestamp (h
                               i byte)
00006C                24017     DShot_Frame_Length_Thr:         DS      1               ; DShot frame length criteria (i
                               n units of 4 timer 2 ticks)
                      24018     
                      24019     ; Indirect addressing data segment. The variables below must be in this sequence
000080                24020     ISEG AT 080h                                    
000080                24021     _Pgm_Gov_P_Gain:                        DS      1               ; Programmed governor P 
                               gain
000081                24022     _Pgm_Gov_I_Gain:                        DS      1               ; Programmed governor I 
                               gain
000082                24023     _Pgm_Gov_Mode:                          DS      1               ; Programmed governor mo
                               de
000083                24024     _Pgm_Low_Voltage_Lim:           DS      1               ; Programmed low voltage limit
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   391

000084                24025     _Pgm_Motor_Gain:                        DS      1               ; Programmed motor gain
000085                24026     _Pgm_Motor_Idle:                        DS      1               ; Programmed motor idle 
                               speed
000086                24027     Pgm_Startup_Pwr:                        DS      1               ; Programmed startup pow
                               er
000087                24028     _Pgm_Pwm_Freq:                          DS      1               ; Programmed pwm frequen
                               cy
000088                24029     Pgm_Direction:                          DS      1               ; Programmed rotation di
                               rection
000089                24030     Pgm_Input_Pol:                          DS      1               ; Programmed input pwm p
                               olarity
00008A                24031     Initialized_L_Dummy:            DS      1               ; Place holder
00008B                24032     Initialized_H_Dummy:            DS      1               ; Place holder
00008C                24033     Pgm_Enable_TX_Program:          DS      1               ; Programmed enable/disable valu
                               e for TX programming
00008D                24034     _Pgm_Main_Rearm_Start:          DS      1               ; Programmed enable/disable re-a
                               rming main every start 
00008E                24035     _Pgm_Gov_Setup_Target:          DS      1               ; Programmed main governor setup
                                target
00008F                24036     _Pgm_Startup_Rpm:                       DS      1               ; Programmed startup rpm
                                (unused - place holder)
000090                24037     _Pgm_Startup_Accel:                     DS      1               ; Programmed startup acc
                               eleration (unused - place holder)
000091                24038     _Pgm_Volt_Comp:                 DS      1               ; Place holder
000092                24039     Pgm_Comm_Timing:                        DS      1               ; Programmed commutation
                                timing
000093                24040     _Pgm_Damping_Force:                     DS      1               ; Programmed damping for
                               ce (unused - place holder)
000094                24041     _Pgm_Gov_Range:                 DS      1               ; Programmed governor range
000095                24042     _Pgm_Startup_Method:            DS      1               ; Programmed startup method (unu
                               sed - place holder)
000096                24043     Pgm_Min_Throttle:                       DS      1               ; Programmed throttle mi
                               nimum
000097                24044     Pgm_Max_Throttle:                       DS      1               ; Programmed throttle ma
                               ximum
000098                24045     Pgm_Beep_Strength:                      DS      1               ; Programmed beep streng
                               th
000099                24046     Pgm_Beacon_Strength:            DS      1               ; Programmed beacon strength
00009A                24047     Pgm_Beacon_Delay:                       DS      1               ; Programmed beacon dela
                               y
00009B                24048     _Pgm_Throttle_Rate:                     DS      1               ; Programmed throttle ra
                               te (unused - place holder)
00009C                24049     Pgm_Demag_Comp:                 DS      1               ; Programmed demag compensation
00009D                24050     _Pgm_BEC_Voltage_High:          DS      1               ; Programmed BEC voltage
00009E                24051     Pgm_Center_Throttle:            DS      1               ; Programmed throttle center (in
                                bidirectional mode)
00009F                24052     _Pgm_Main_Spoolup_Time:         DS      1               ; Programmed main spoolup time
0000A0                24053     Pgm_Enable_Temp_Prot:           DS      1               ; Programmed temperature protect
                               ion enable
0000A1                24054     Pgm_Enable_Power_Prot:          DS      1               ; Programmed low rpm power prote
                               ction enable
0000A2                24055     _Pgm_Enable_Pwm_Input:          DS      1               ; Programmed PWM input signal en
                               able
0000A3                24056     _Pgm_Pwm_Dither:                        DS      1               ; Programmed output PWM 
                               dither
0000A4                24057     Pgm_Brake_On_Stop:                      DS      1               ; Programmed braking whe
                               n throttle is zero
0000A5                24058     Pgm_LED_Control:                        DS      1               ; Programmed LED control
                      24059     
                      24060     ; The sequence of the variables below is no longer of importance
0000A6                24061     Pgm_Startup_Pwr_Decoded:                DS      1               ; Programmed startup pow
                               er decoded
                      24062     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   392

                      24063     
                      24064     ; Indirect addressing data segment
0000D0                24065     ISEG AT 0D0h                                    
0000D0                24066     Temp_Storage:                           DS      48              ; Temporary storage
                      24067     
                      24068     ;**** **** **** **** ****
001A00                24069     CSEG AT 1A00h            ; "Eeprom" segment
 0010                 24070     EEPROM_FW_MAIN_REVISION         EQU     16              ; Main revision of the firmware
 0044                 24071     EEPROM_FW_SUB_REVISION          EQU     68              ; Sub revision of the firmware
 0021                 24072     EEPROM_LAYOUT_REVISION          EQU     33              ; Revision of the EEPROM layout
                      24073     
001A00 10             24074     Eep_FW_Main_Revision:           DB      EEPROM_FW_MAIN_REVISION                 ; EEPROM
                                firmware main revision number
001A01 44             24075     Eep_FW_Sub_Revision:            DB      EEPROM_FW_SUB_REVISION                  ; EEPROM
                                firmware sub revision number
001A02 21             24076     Eep_Layout_Revision:            DB      EEPROM_LAYOUT_REVISION                  ; EEPROM
                                layout revision number
                      24077     
001A03 FF             24078     _Eep_Pgm_Gov_P_Gain:            DB      0FFh    
001A04 FF             24079     _Eep_Pgm_Gov_I_Gain:            DB      0FFh    
001A05 FF             24080     _Eep_Pgm_Gov_Mode:                      DB      0FFh    
001A06 FF             24081     _Eep_Pgm_Low_Voltage_Lim:       DB      0FFh                                            
                                       
001A07 FF             24082     _Eep_Pgm_Motor_Gain:            DB      0FFh    
001A08 FF             24083     _Eep_Pgm_Motor_Idle:            DB      0FFh                                            
001A09 05             24084     Eep_Pgm_Startup_Pwr:            DB      DEFAULT_PGM_STARTUP_PWR                 ; EEPROM
                                copy of programmed startup power
001A0A FF             24085     _Eep_Pgm_Pwm_Freq:                      DB      0FFh    
001A0B 01             24086     Eep_Pgm_Direction:                      DB      DEFAULT_PGM_DIRECTION                   
                               ; EEPROM copy of programmed rotation direction
001A0C FF             24087     _Eep_Pgm_Input_Pol:                     DB      0FFh
001A0D 55             24088     Eep_Initialized_L:                      DB      055h                                    
                                               ; EEPROM initialized signature low byte
001A0E AA             24089     Eep_Initialized_H:                      DB      0AAh                                    
                                               ; EEPROM initialized signature high byte
001A0F 01             24090     Eep_Enable_TX_Program:          DB      DEFAULT_PGM_ENABLE_TX_PROGRAM           ; EEPROM
                                TX programming enable
001A10 FF             24091     _Eep_Main_Rearm_Start:          DB      0FFh                                            
                                       
001A11 FF             24092     _Eep_Pgm_Gov_Setup_Target:      DB      0FFh                                            
                                       
001A12 FF             24093     _Eep_Pgm_Startup_Rpm:           DB      0FFh
001A13 FF             24094     _Eep_Pgm_Startup_Accel:         DB      0FFh
001A14 FF             24095     _Eep_Pgm_Volt_Comp:                     DB      0FFh    
001A15 03             24096     Eep_Pgm_Comm_Timing:            DB      DEFAULT_PGM_COMM_TIMING                 ; EEPROM
                                copy of programmed commutation timing
001A16 FF             24097     _Eep_Pgm_Damping_Force:         DB      0FFh
001A17 FF             24098     _Eep_Pgm_Gov_Range:                     DB      0FFh    
001A18 FF             24099     _Eep_Pgm_Startup_Method:                DB      0FFh
001A19 0A             24100     Eep_Pgm_Min_Throttle:           DB      DEFAULT_PGM_MIN_THROTTLE                        
                               ; EEPROM copy of programmed minimum throttle
001A1A F0             24101     Eep_Pgm_Max_Throttle:           DB      DEFAULT_PGM_MAX_THROTTLE                        
                               ; EEPROM copy of programmed minimum throttle
001A1B 5B             24102     Eep_Pgm_Beep_Strength:          DB      DEFAULT_PGM_BEEP_STRENGTH               ; EEPROM
                                copy of programmed beep strength
001A1C 50             24103     Eep_Pgm_Beacon_Strength:                DB      DEFAULT_PGM_BEACON_STRENGTH             
                               ; EEPROM copy of programmed beacon strength
001A1D 03             24104     Eep_Pgm_Beacon_Delay:           DB      DEFAULT_PGM_BEACON_DELAY                        
                               ; EEPROM copy of programmed beacon delay
001A1E FF             24105     _Eep_Pgm_Throttle_Rate:         DB      0FFh
001A1F 03             24106     Eep_Pgm_Demag_Comp:                     DB      DEFAULT_PGM_DEMAG_COMP                  
                               ; EEPROM copy of programmed demag compensation
001A20 FF             24107     _Eep_Pgm_BEC_Voltage_High:      DB      0FFh    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   393

001A21 7D             24108     Eep_Pgm_Center_Throttle:                DB      DEFAULT_PGM_CENTER_THROTTLE             
                               ; EEPROM copy of programmed center throttle
001A22 FF             24109     _Eep_Pgm_Main_Spoolup_Time:     DB      0FFh
001A23 06             24110     Eep_Pgm_Temp_Prot_Enable:       DB      DEFAULT_PGM_ENABLE_TEMP_PROT            ; EEPROM
                                copy of programmed temperature protection enable
001A24 01             24111     Eep_Pgm_Enable_Power_Prot:      DB      DEFAULT_PGM_ENABLE_POWER_PROT           ; EEPROM
                                copy of programmed low rpm power protection enable
001A25 FF             24112     _Eep_Pgm_Enable_Pwm_Input:      DB      0FFh    
001A26 FF             24113     _Eep_Pgm_Pwm_Dither:            DB      0FFh    
001A27 01             24114     Eep_Pgm_Brake_On_Stop:          DB      DEFAULT_PGM_BRAKE_ON_STOP               ; EEPROM
                                copy of programmed braking when throttle is zero
001A28 01             24115     Eep_Pgm_LED_Control:            DB      DEFAULT_PGM_LED_CONTROL                 ; EEPROM
                                copy of programmed LED control
                      24116     
001A29 FF             24117     Eep_Dummy:                              DB      0FFh                                    
                                               ; EEPROM address for safety reason
                      24118     
001A60                24119     CSEG AT 1A60h
001A60 31362E36       24120     Eep_Name:                                       DB      "16.68_Tones     "              
                                               ; Name tag (16 Bytes)
001A64 385F546F                 
001A68 6E657320                 
001A6C 20202020                 
                      24121     
                      24122     ;**** **** **** **** ****
                      24123     Interrupt_Table_Definition              ; SiLabs interrupts
*** ____________________________^
*** ERROR #A9 IN 24123 (BLHeli_S.asm, LINE 505): SYNTAX ERROR
000080                24124     CSEG AT 80h                     ; Code segment after interrupt vectors 
                      24125     
                      24126     ;**** **** **** **** ****
                      24127     
                      24128     ; Table definitions
000080 0406080C       24129     STARTUP_POWER_TABLE:    DB      04h, 06h, 08h, 0Ch, 10h, 18h, 20h, 30h, 40h, 60h, 80h, 0
                               A0h, 0C0h
000084 10182030                 
000088 406080A0                 
00008C C0                       
                      24130     
                      24131     
                      24132     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24133     ;
                      24134     ; Timer 0 interrupt routine
                      24135     ;
                      24136     ; No assumptions
                      24137     ;
                      24138     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24139     IF 1 == 1
00008D                24140     t0_int:
00008D 0500       F   24141             inc     Timer0_X
00008F 32             24142             reti
                      24143     ENDIF
                      24144     
                      24145     
                      24146     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24147     ;
                      24148     ; Timer 1 interrupt routine
                      24149     ;
                      24150     ; No assumptions
                      24151     ;
                      24152     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000090                24153     t1_int:
000090                24154             clr     IE_EA
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   394

*** ____________________________________________^
*** ERROR #A45 IN 24154 (BLHeli_S.asm, LINE 536): UNDEFINED SYMBOL
000092                24155             clr     IE_EX0                  ; Disable int0 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 24155 (BLHeli_S.asm, LINE 537): UNDEFINED SYMBOL
000094                24156             anl     EIE1, #0EFh             ; Disable pca interrupts
*** ____________________________________________^
*** ERROR #A45 IN 24156 (BLHeli_S.asm, LINE 538): UNDEFINED SYMBOL
000097                24157             clr     TCON_TR1                        ; Stop timer 1
*** ____________________________________________^
*** ERROR #A45 IN 24157 (BLHeli_S.asm, LINE 539): UNDEFINED SYMBOL
000099                24158             mov     TL1, DShot_Timer_Preset ; Reset sync timer
*** ____________________________________________^
*** ERROR #A45 IN 24158 (BLHeli_S.asm, LINE 540): UNDEFINED SYMBOL
00009C C0D0           24159             push    PSW
00009E D2D3           24160             setb    PSW.3                   ; Select register bank 1 for this interrupt
0000A0 C0E0           24161             push    ACC
0000A2 C0F0           24162             push    B                               ; Will be pop'ed by int0 exit
0000A4                24163             clr     TMR2CN0_TR2             ; Timer 2 disabled
*** ____________________________________________^
*** ERROR #A45 IN 24163 (BLHeli_S.asm, LINE 545): UNDEFINED SYMBOL
0000A6                24164             mov     Temp1, TMR2L            ; Read timer value
*** ___________________________________________________^
*** ERROR #A45 IN 24164 (BLHeli_S.asm, LINE 546): UNDEFINED SYMBOL
0000A8                24165             mov     Temp2, TMR2H
*** ___________________________________________________^
*** ERROR #A45 IN 24165 (BLHeli_S.asm, LINE 547): UNDEFINED SYMBOL
0000AA                24166             setb    TMR2CN0_TR2             ; Timer 2 enabled
*** ____________________________________________^
*** ERROR #A45 IN 24166 (BLHeli_S.asm, LINE 548): UNDEFINED SYMBOL
0000AC                24167             setb    IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 24167 (BLHeli_S.asm, LINE 549): UNDEFINED SYMBOL
                      24168             ; Reset timer 1
0000AE                24169             mov     TL0, #0
*** ____________________________________________^
*** ERROR #A45 IN 24169 (BLHeli_S.asm, LINE 551): UNDEFINED SYMBOL
                      24170             ; Check frame time length
0000B1 C3             24171             clr     C
0000B2 E8             24172             mov     A, Temp1
0000B3 9500       F   24173             subb    A, DShot_Frame_Start_L
0000B5 F8             24174             mov     Temp1, A
0000B6 E9             24175             mov     A, Temp2
0000B7 9500       F   24176             subb    A, DShot_Frame_Start_H
0000B9 F9             24177             mov     Temp2, A
                      24178             ; Divide by 2 (or 4 for 48MHz). Unit is then us
0000BA C3             24179             clr     C
0000BB E9             24180             mov     A, Temp2
0000BC 13             24181             rrc     A
0000BD F9             24182             mov     Temp2, A
0000BE E8             24183             mov     A, Temp1
0000BF 13             24184             rrc     A
0000C0 F8             24185             mov     Temp1, A
0000C1 E500       F   24186             mov     A, Clock_Set_At_48MHz
0000C3 6007           24187             jz      t1_int_frame_time_scaled
                      24188     
0000C5 C3             24189             clr     C
0000C6 E9             24190             mov     A, Temp2
0000C7 13             24191             rrc     A
0000C8 F9             24192             mov     Temp2, A
0000C9 E8             24193             mov     A, Temp1
0000CA 13             24194             rrc     A
0000CB F8             24195             mov     Temp1, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   395

                      24196     
0000CC                24197     t1_int_frame_time_scaled:
0000CC E9             24198             mov     A, Temp2
0000CD 7025           24199             jnz     t1_int_msb_fail ; Frame too long
0000CF E8             24200             mov     A, Temp1
0000D0 9500       F   24201             subb    A, DShot_Frame_Length_Thr
0000D2 4020           24202             jc      t1_int_msb_fail ; Frame too short
0000D4 9500       F   24203             subb    A, DShot_Frame_Length_Thr
0000D6 501C           24204             jnc     t1_int_msb_fail ; Frame too long
                      24205     
                      24206             ; Check that correct number of pulses is received
0000D8 E582           24207             mov     A, DPL                  ; Read current pointer
0000DA B41017         24208             cjne    A, #16, t1_int_msb_fail
                      24209     
                      24210             ; Decode transmitted data
0000DD 7C00           24211             mov     Temp5, #0                       ; Reset timestamp
0000DF 7B00           24212             mov     Temp4, #0                       ; High byte of receive buffer
0000E1 7A00           24213             mov     Temp3, #0                       ; Low byte of receive buffer
0000E3 7908           24214             mov     Temp2, #8                       ; Number of bits per byte
0000E5 900000         24215             mov     DPTR, #0                        ; Set pointer
0000E8 A800       F   24216             mov     Temp1, DShot_Pwm_Thr; DShot pulse width criteria
0000EA E500       F   24217             mov     A, Clock_Set_At_48MHz
0000EC 7004           24218             jnz     t1_int_decode
                      24219     
0000EE C3             24220             clr     C
0000EF E8             24221             mov     A, Temp1                        ; Scale pulse width criteria
0000F0 13             24222             rrc     A
0000F1 F8             24223             mov     Temp1, A
                      24224     
0000F2                24225     t1_int_decode:
0000F2 0100       F   24226             ajmp    t1_int_decode_msb
                      24227     
0000F4                24228     t1_int_msb_fail:
0000F4 900000         24229             mov     DPTR, #0                        ; Set pointer to start
0000F7                24230             setb    IE_EX0                  ; Enable int0 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 24230 (BLHeli_S.asm, LINE 612): UNDEFINED SYMBOL
0000F9                24231             setb    IE_EX1                  ; Enable int1 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 24231 (BLHeli_S.asm, LINE 613): UNDEFINED SYMBOL
0000FB 0100       F   24232             ajmp int0_int_outside_range
                      24233     
0000FD                24234     t1_int_decode_msb:
                      24235             ; Decode DShot data Msb. Use more code space to save time (by not usinng loop)
                      24236             Decode_DShot_2Msb
*** ____________________________________^
*** ERROR #A9 IN 24236 (BLHeli_S.asm, LINE 618): SYNTAX ERROR
                      24237             Decode_DShot_2Msb
*** ____________________________________^
*** ERROR #A9 IN 24237 (BLHeli_S.asm, LINE 619): SYNTAX ERROR
                      24238             Decode_DShot_2Msb
*** ____________________________________^
*** ERROR #A9 IN 24238 (BLHeli_S.asm, LINE 620): SYNTAX ERROR
                      24239             Decode_DShot_2Msb
*** ____________________________________^
*** ERROR #A9 IN 24239 (BLHeli_S.asm, LINE 621): SYNTAX ERROR
0000FD 0100       F   24240             ajmp    t1_int_decode_lsb
                      24241     
0000FF                24242     t1_int_lsb_fail:
0000FF 900000         24243             mov     DPTR, #0                        ; Set pointer to start
000102                24244             setb    IE_EX0                  ; Enable int0 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 24244 (BLHeli_S.asm, LINE 626): UNDEFINED SYMBOL
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   396

000104                24245             setb    IE_EX1                  ; Enable int1 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 24245 (BLHeli_S.asm, LINE 627): UNDEFINED SYMBOL
000106 0100       F   24246             ajmp int0_int_outside_range
                      24247     
000108                24248     t1_int_decode_lsb:
                      24249             ; Decode DShot data Lsb
                      24250             Decode_DShot_2Lsb
*** ____________________________________^
*** ERROR #A9 IN 24250 (BLHeli_S.asm, LINE 632): SYNTAX ERROR
                      24251             Decode_DShot_2Lsb
*** ____________________________________^
*** ERROR #A9 IN 24251 (BLHeli_S.asm, LINE 633): SYNTAX ERROR
                      24252             Decode_DShot_2Lsb
*** ____________________________________^
*** ERROR #A9 IN 24252 (BLHeli_S.asm, LINE 634): SYNTAX ERROR
                      24253             Decode_DShot_2Lsb
*** ____________________________________^
*** ERROR #A9 IN 24253 (BLHeli_S.asm, LINE 635): SYNTAX ERROR
                      24254             ; XOR check (in inverted data, which is ok)
000108 EB             24255             mov     A, Temp4
000109 C4             24256             swap    A
00010A 6B             24257             xrl     A, Temp4
00010B 6A             24258             xrl     A, Temp3
00010C 54F0           24259             anl     A, #0F0h
00010E F9             24260             mov     Temp2, A
00010F EA             24261             mov     A, Temp3
000110 C4             24262             swap    A
000111 54F0           24263             anl     A, #0F0h
000113 C3             24264             clr     C
000114 99             24265             subb    A, Temp2
000115 6009           24266             jz      t1_int_xor_ok           ; XOR check
                      24267     
000117 900000         24268             mov     DPTR, #0                        ; Set pointer to start
00011A                24269             setb    IE_EX0                  ; Enable int0 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 24269 (BLHeli_S.asm, LINE 651): UNDEFINED SYMBOL
00011C                24270             setb    IE_EX1                  ; Enable int1 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 24270 (BLHeli_S.asm, LINE 652): UNDEFINED SYMBOL
00011E 0100       F   24271             ajmp int0_int_outside_range
                      24272     
000120                24273     t1_int_xor_ok:
                      24274             ; Swap to be LSB aligned to 12 bits (and invert)
000120 EB             24275             mov     A, Temp4
000121 F4             24276             cpl     A
000122 C4             24277             swap A
000123 54F0           24278             anl     A, #0F0h                        ; Low nibble of high byte
000125 F9             24279             mov     Temp2, A
000126 EA             24280             mov     A, Temp3
000127 F4             24281             cpl     A
000128 C4             24282             swap    A
000129 540E           24283             anl     A, #0Eh                 ; High nibble of low byte (ignore lsb)
00012B 49             24284             orl     A, Temp2
00012C FA             24285             mov     Temp3, A
00012D EB             24286             mov     A, Temp4                        ; High nibble of high byte
00012E F4             24287             cpl     A
00012F C4             24288             swap A
000130 540F           24289             anl     A, #0Fh
000132 FB             24290             mov     Temp4, A
                      24291             ; Subtract 96 (still 12 bits)
000133 C3             24292             clr     C
000134 EA             24293             mov     A, Temp3
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   397

000135 9460           24294             subb    A, #96
000137 FA             24295             mov     Temp3, A
000138 EB             24296             mov     A, Temp4
000139 9400           24297             subb    A, #0
00013B FB             24298             mov     Temp4, A
00013C 5006           24299             jnc     ($+8)
                      24300     
00013E 7B00           24301             mov     Temp4, #0
000140 7A00           24302             mov     Temp3, #0
000142 7900           24303             mov     Temp2, #0
                      24304     
                      24305             ; Check for bidirectional operation (0=stop, 96-2095->fwd, 2096-4095->rev)
000144 300027         24306             jnb     Flags3.PGM_BIDIR, t1_int_not_bidir      ; If not bidirectional operation
                                - branch
                      24307     
                      24308             ; Subtract 2000 (still 12 bits)
000147 C3             24309             clr     C
000148 EA             24310             mov     A, Temp3
000149 94D0           24311             subb    A, #0D0h
00014B F8             24312             mov     Temp1, A
00014C EB             24313             mov     A, Temp4
00014D 9407           24314             subb    A, #07h
00014F F9             24315             mov     Temp2, A
000150 400B           24316             jc      t1_int_bidir_fwd                                ; If result is negative 
                               - branch
                      24317     
000152 E8             24318             mov     A, Temp1
000153 FA             24319             mov     Temp3, A
000154 E9             24320             mov     A, Temp2
000155 FB             24321             mov     Temp4, A
000156 200009         24322             jb      Flags2.RCP_DIR_REV, t1_int_bidir_rev_chk        ; If same direction - br
                               anch
                      24323     
000159 D200       F   24324             setb    Flags2.RCP_DIR_REV
00015B 0100       F   24325             ajmp    t1_int_bidir_rev_chk
                      24326     
00015D                24327     t1_int_bidir_fwd:
00015D 300002         24328             jnb     Flags2.RCP_DIR_REV, t1_int_bidir_rev_chk        ; If same direction - br
                               anch
                      24329     
000160 C200       F   24330             clr     Flags2.RCP_DIR_REV
                      24331     
000162                24332     t1_int_bidir_rev_chk:
000162 200002         24333             jb      Flags3.PGM_BIDIR_REV, ($+5)
                      24334     
000165 B200       F   24335             cpl     Flags2.RCP_DIR_REV
                      24336     
000167 C3             24337             clr     C                                                       ; Multiply throt
                               tle value by 2
000168 EA             24338             mov     A, Temp3
000169 33             24339             rlc     A
00016A FA             24340             mov     Temp3, A
00016B EB             24341             mov     A, Temp4
00016C 33             24342             rlc     A
00016D FB             24343             mov     Temp4, A
00016E                24344     t1_int_not_bidir:
                      24345             ; Generate 4/256
00016E EB             24346             mov     A, Temp4
00016F 2B             24347             add     A, Temp4
000170 3B             24348             addc    A, Temp4
000171 3B             24349             addc    A, Temp4
000172 F9             24350             mov     Temp2, A
                      24351             ; Align to 11 bits
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   398

000173 C3             24352             clr     C
000174 EB             24353             mov     A, Temp4
000175 13             24354             rrc     A
000176 FB             24355             mov     Temp4, A
000177 EA             24356             mov     A, Temp3
000178 13             24357             rrc     A
000179 FA             24358             mov     Temp3, A
                      24359             ; Scale from 2000 to 2048
00017A EA             24360             mov     A, Temp3
00017B 29             24361             add     A, Temp2        ; Holds 4/128
00017C FA             24362             mov     Temp3, A
00017D EB             24363             mov     A, Temp4
00017E 3400           24364             addc    A, #0
000180 FB             24365             mov     Temp4, A
000181 30E304         24366             jnb     ACC.3, ($+7)
                      24367     
000184 7AFF           24368             mov     Temp3, #0FFh
000186 7BFF           24369             mov     Temp4, #0FFh
                      24370     
                      24371             ; Boost pwm during direct start
000188 E500       F   24372             mov     A, Flags1
00018A 5403           24373             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
00018C 601B           24374             jz      t1_int_startup_boosted
                      24375     
00018E 200018         24376             jb      Flags1.MOTOR_STARTED, t1_int_startup_boosted    ; Do not boost when chan
                               ging direction in bidirectional mode
                      24377     
000191 E500       F   24378             mov     A, Pwm_Limit_Beg                                ; Set 25% of max startup
                                power as minimum power
000193 33             24379             rlc     A
000194 F9             24380             mov     Temp2, A
000195 EB             24381             mov     A, Temp4
000196 7007           24382             jnz     t1_int_startup_boost_stall
                      24383     
000198 C3             24384             clr     C
000199 E9             24385             mov     A, Temp2
00019A 9A             24386             subb    A, Temp3
00019B 4002           24387             jc      t1_int_startup_boost_stall
                      24388     
00019D E9             24389             mov     A, Temp2
00019E FA             24390             mov     Temp3, A
                      24391     
00019F                24392     t1_int_startup_boost_stall:
00019F E500       F   24393             mov     A, Stall_Cnt                                    ; Add an extra power boo
                               st during start
0001A1 C4             24394             swap    A
0001A2 33             24395             rlc     A
0001A3 2A             24396             add     A, Temp3
0001A4 FA             24397             mov     Temp3, A
0001A5 EB             24398             mov     A, Temp4
0001A6 3400           24399             addc    A, #0
0001A8 FB             24400             mov     Temp4, A
                      24401     
0001A9                24402     t1_int_startup_boosted:
                      24403             ; Set 8bit value
0001A9 C3             24404             clr     C
0001AA EA             24405             mov     A, Temp3
0001AB 33             24406             rlc     A
0001AC C4             24407             swap    A
0001AD 540F           24408             anl     A, #0Fh
0001AF F8             24409             mov     Temp1, A
0001B0 EB             24410             mov     A, Temp4
0001B1 33             24411             rlc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   399

0001B2 C4             24412             swap    A
0001B3 54F0           24413             anl     A, #0F0h
0001B5 48             24414             orl     A, Temp1
0001B6 F8             24415             mov     Temp1, A
0001B7 7005           24416             jnz     t1_int_zero_rcp_checked ; New_Rcp (Temp1) is only zero if all 11 bits ar
                               e zero
                      24417     
0001B9 EA             24418             mov     A, Temp3
0001BA 6002           24419             jz      t1_int_zero_rcp_checked
                      24420     
0001BC 7801           24421             mov     Temp1, #1
                      24422     
0001BE                24423     t1_int_zero_rcp_checked:
                      24424             ; Align to 10 bits for 24MHz MCU
                      24425     IF 1 == 0
                                        clr     C
                                        mov     A, Temp4
                                        rrc     A
                                        mov     Temp4, A
                                        mov     A, Temp3
                                        rrc     A
                                        mov     Temp3, A
                                ENDIF
0001BE 900000         24434             mov     DPTR, #0                                        ; Set pointer to start
0001C1                24435             setb    IE_EX0                                  ; Enable int0 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 24435 (BLHeli_S.asm, LINE 817): UNDEFINED SYMBOL
0001C3                24436             setb    IE_EX1                                  ; Enable int1 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 24436 (BLHeli_S.asm, LINE 818): UNDEFINED SYMBOL
                      24437             ; Decrement outside range counter
0001C5 E500       F   24438             mov     A, Rcp_Outside_Range_Cnt
0001C7 6002           24439             jz      ($+4)
                      24440     
0001C9 1500       F   24441             dec     Rcp_Outside_Range_Cnt
                      24442     
0001CB 0100       F   24443             ajmp    int0_int_pulse_ready
                      24444     
0001CD                24445     t1_int_frame_fail:
0001CD 900000         24446             mov     DPTR, #0                                        ; Set pointer to start
0001D0                24447             setb    IE_EX0                                  ; Enable int0 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 24447 (BLHeli_S.asm, LINE 829): UNDEFINED SYMBOL
0001D2                24448             setb    IE_EX1                                  ; Enable int1 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 24448 (BLHeli_S.asm, LINE 830): UNDEFINED SYMBOL
0001D4 0100       F   24449             ajmp int0_int_outside_range
                      24450     
                      24451     
                      24452     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24453     ;
                      24454     ; Timer 2 interrupt routine
                      24455     ;
                      24456     ; No assumptions
                      24457     ; Requirements: Temp variables can NOT be used since PSW.x is not set
                      24458     ;
                      24459     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0001D6                24460     t2_int: ; Happens every 32ms
0001D6 C0D0           24461             push    PSW                     ; Preserve registers through interrupt
0001D8 C0E0           24462             push    ACC
0001DA                24463             clr     TMR2CN0_TF2H                            ; Clear interrupt flag
*** ____________________________________________^
*** ERROR #A45 IN 24463 (BLHeli_S.asm, LINE 845): UNDEFINED SYMBOL
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   400

0001DC 0500       F   24464             inc     Timer2_X
                      24465     IF 1 == 1
0001DE E500       F   24466             mov     A, Clock_Set_At_48MHz
0001E0 6009           24467             jz      t2_int_start
                      24468     
                      24469             ; Check skip variable
0001E2 E500       F   24470             mov     A, Skip_T2_Int
0001E4 6005           24471             jz      t2_int_start                            ; Execute this interrupt
                      24472     
0001E6 750000     F   24473             mov     Skip_T2_Int, #0
0001E9 0100       F   24474             ajmp    t2_int_exit
                      24475     
0001EB                24476     t2_int_start:
0001EB 750001     F   24477             mov     Skip_T2_Int, #1                 ; Skip next interrupt
                      24478     ENDIF
                      24479             ; Update RC pulse timeout counter 
0001EE E500       F   24480             mov     A, Rcp_Timeout_Cntd     ; RC pulse timeout count zero?
0001F0 6002           24481             jz      ($+4)                                                           ; Yes - 
                               do not decrement
                      24482             
0001F2 1500       F   24483             dec     Rcp_Timeout_Cntd                ; No decrement          
                      24484             
                      24485             ; Check RC pulse against stop value
0001F4 C3             24486             clr     C
0001F5 E500       F   24487             mov     A, New_Rcp                                      ; Load new pulse value
0001F7 6005           24488             jz      t2_int_rcp_stop                 ; Check if pulse is below stop value
                      24489             
                      24490             ; RC pulse higher than stop value, reset stop counter
0001F9 750000     F   24491             mov     Rcp_Stop_Cnt, #0                ; Reset rcp stop counter
0001FC 0100       F   24492             ajmp    t2_int_exit
                      24493     
0001FE                24494     t2_int_rcp_stop:
                      24495             ; RC pulse less than stop value
0001FE E500       F   24496             mov     A, Rcp_Stop_Cnt                 ; Increment stop counter
000200 2401           24497             add     A, #1
000202 F500       F   24498             mov     Rcp_Stop_Cnt, A
000204 5003           24499             jnc     ($+5)                                                           ; Branch
                                if counter has not wrapped
                      24500     
000206 7500FF     F   24501             mov     Rcp_Stop_Cnt, #0FFh     ; Set stop counter to max
                      24502     
000209                24503     t2_int_exit:
000209 D0E0           24504             pop     ACC                                                                     
                               ; Restore preserved registers   
00020B D0D0           24505             pop     PSW
00020D 32             24506             reti
                      24507     
                      24508     
                      24509     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24510     ;
                      24511     ; Timer 3 interrupt routine
                      24512     ;
                      24513     ; No assumptions
                      24514     ; Requirements: Temp variables can NOT be used since PSW.x is not set
                      24515     ;               ACC can not be used, as it is not pushed to stack
                      24516     ;
                      24517     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00020E                24518     t3_int: ; Used for commutation timing
00020E                24519             clr     IE_EA                   ; Disable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 24519 (BLHeli_S.asm, LINE 901): UNDEFINED SYMBOL
000210                24520             anl     EIE1, #7Fh              ; Disable timer 3 interrupts
*** ____________________________________________^
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   401

*** ERROR #A45 IN 24520 (BLHeli_S.asm, LINE 902): UNDEFINED SYMBOL
000213                24521             mov     TMR3RLL, #0FAh          ; Set a short delay before next interrupt
*** ____________________________________________^
*** ERROR #A45 IN 24521 (BLHeli_S.asm, LINE 903): UNDEFINED SYMBOL
000216                24522             mov     TMR3RLH, #0FFh
*** ____________________________________________^
*** ERROR #A45 IN 24522 (BLHeli_S.asm, LINE 904): UNDEFINED SYMBOL
000219 C200       F   24523             clr     Flags0.T3_PENDING       ; Flag that timer has wrapped
00021B                24524             anl     TMR3CN0, #07Fh          ; Timer 3 interrupt flag cleared
*** ____________________________________________^
*** ERROR #A45 IN 24524 (BLHeli_S.asm, LINE 906): UNDEFINED SYMBOL
00021E                24525             setb    IE_EA                   ; Enable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 24525 (BLHeli_S.asm, LINE 907): UNDEFINED SYMBOL
000220 32             24526             reti
                      24527     
                      24528     
                      24529     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24530     ;
                      24531     ; Int0 interrupt routine
                      24532     ;
                      24533     ; No assumptions
                      24534     ;
                      24535     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000221                24536     int0_int:       ; Used for RC pulse timing
000221 C0E0           24537             push    ACC
000223                24538             mov     A, TL0                  ; Read pwm for DShot immediately
*** _______________________________________________^
*** ERROR #A45 IN 24538 (BLHeli_S.asm, LINE 920): UNDEFINED SYMBOL
                      24539             ; Test for DShot
000225 300008         24540             jnb     Flags2.RCP_DSHOT, int0_int_not_dshot
                      24541     
000228                24542             mov     TL1, DShot_Timer_Preset ; Reset sync timer
*** ____________________________________________^
*** ERROR #A45 IN 24542 (BLHeli_S.asm, LINE 924): UNDEFINED SYMBOL
00022B F0             24543             movx    @DPTR, A                        ; Store pwm
00022C A3             24544             inc     DPTR
00022D D0E0           24545             pop     ACC
00022F 32             24546             reti
                      24547     
                      24548             ; Not DShot
000230                24549     int0_int_not_dshot:
000230 D0E0           24550             pop     ACC
000232                24551             clr     IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 24551 (BLHeli_S.asm, LINE 933): UNDEFINED SYMBOL
000234                24552             anl     EIE1, #0EFh             ; Disable pca interrupts
*** ____________________________________________^
*** ERROR #A45 IN 24552 (BLHeli_S.asm, LINE 934): UNDEFINED SYMBOL
000237 C0D0           24553             push    PSW                             ; Preserve registers through interrupt
000239 C0E0           24554             push    ACC
00023B C0F0           24555             push    B
00023D D2D3           24556             setb    PSW.3                   ; Select register bank 1 for this interrupt 
00023F                24557             setb    IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 24557 (BLHeli_S.asm, LINE 939): UNDEFINED SYMBOL
                      24558             ; Get the counter values
                      24559             Get_Rcp_Capture_Values
*** ____________________________________^
*** ERROR #A9 IN 24559 (BLHeli_S.asm, LINE 941): SYNTAX ERROR
                      24560             ; Scale down to 10 bits (for 24MHz, and 11 bits for 48MHz)
000241 30001F         24561             jnb     Flags2.RCP_MULTISHOT, int0_int_fall_not_multishot
                      24562     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   402

                      24563             ; Multishot - Multiply by 2 and add 1/16 and 1/32
000244 E8             24564             mov     A, Temp1                ; Divide by 16
000245 C4             24565             swap A
000246 540F           24566             anl     A, #0Fh
000248 FA             24567             mov     Temp3, A
000249 E9             24568             mov     A, Temp2
00024A C4             24569             swap    A
00024B 54F0           24570             anl     A, #0F0h
00024D 4A             24571             orl     A, Temp3
00024E FA             24572             mov     Temp3, A
00024F C3             24573             clr     C                       ; Make divided by 32
000250 13             24574             rrc     A
000251 2A             24575             add     A, Temp3                ; Add 1/16 to 1/32
000252 FA             24576             mov     Temp3, A
000253 C3             24577             clr     C                       ; Multiply by 2
000254 E8             24578             mov     A, Temp1
000255 33             24579             rlc     A
000256 F8             24580             mov     Temp1, A
000257 E9             24581             mov     A, Temp2
000258 33             24582             rlc     A
000259 F9             24583             mov     Temp2, A
00025A E8             24584             mov     A, Temp1                ; Add 1/16 and 1/32
00025B 2A             24585             add     A, Temp3
00025C FA             24586             mov     Temp3, A
00025D E9             24587             mov     A, Temp2
                      24588     IF 1 == 0
                                        addc    A, #03h         ; Add to low end, to make signal look like 20-40us
                                ELSE
00025E 3406           24591             addc    A, #06h
                      24592     ENDIF
000260 FB             24593             mov     Temp4, A
000261 0100       F   24594             ajmp    int0_int_fall_gain_done
                      24595     
000263                24596     int0_int_fall_not_multishot:
000263 30000F         24597             jnb     Flags2.RCP_ONESHOT42, int0_int_fall_not_oneshot_42
                      24598     
                      24599             ; Oneshot42 - Add 2/256
000266 C3             24600             clr     C
000267 E8             24601             mov     A, Temp1
000268 33             24602             rlc     A
000269 E9             24603             mov     A, Temp2
00026A 33             24604             rlc     A
00026B FA             24605             mov     Temp3, A
00026C E8             24606             mov     A, Temp1
00026D 2A             24607             add     A, Temp3
00026E FA             24608             mov     Temp3, A
00026F E9             24609             mov     A, Temp2
000270 3400           24610             addc    A, #0
000272 FB             24611             mov     Temp4, A
000273 0100       F   24612             ajmp    int0_int_fall_gain_done
                      24613     
000275                24614     int0_int_fall_not_oneshot_42:
000275 300015         24615             jnb     Flags2.RCP_ONESHOT125, int0_int_fall_not_oneshot_125
                      24616     
                      24617             ; Oneshot125 - multiply by 86/256
000278 E8             24618             mov     A, Temp1                ; Multiply by 86 and divide by 256
000279 75F056         24619             mov     B, #56h
00027C A4             24620             mul     AB
00027D AAF0           24621             mov     Temp3, B
00027F E9             24622             mov     A, Temp2
000280 75F056         24623             mov     B, #56h
000283 A4             24624             mul     AB
000284 2A             24625             add     A, Temp3
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   403

000285 FA             24626             mov     Temp3, A
000286 C5F0           24627             xch     A, B
000288 3400           24628             addc    A, #0
00028A FB             24629             mov     Temp4, A
00028B 0100       F   24630             ajmp    int0_int_fall_gain_done
                      24631     
00028D                24632     int0_int_fall_not_oneshot_125:
                      24633             ; Regular signal - multiply by 43/1024
                      24634     IF 1 == 1
00028D C3             24635             clr     C
00028E EA             24636             mov     A, Temp3                ; Divide by 2
00028F 13             24637             rrc     A
000290 FA             24638             mov     Temp3, A
000291 E9             24639             mov     A, Temp2
000292 13             24640             rrc     A
000293 F9             24641             mov     Temp2, A
000294 E8             24642             mov     A, Temp1
000295 13             24643             rrc     A
000296 F8             24644             mov     Temp1, A
                      24645     ENDIF
000297 E8             24646             mov     A, Temp1                ; Multiply by 43 and divide by 1024
                      24647     IF 1 == 0
                                        mov     B, #2Bh
                                ELSE
000298 75F056         24650             mov     B, #56h         ; Multiply by 86
                      24651     ENDIF
00029B A4             24652             mul     AB
00029C AAF0           24653             mov     Temp3, B
00029E E9             24654             mov     A, Temp2
                      24655     IF 1 == 0
                                        mov     B, #2Bh
                                ELSE
00029F 75F056         24658             mov     B, #56h         ; Multiply by 86
                      24659     ENDIF
0002A2 A4             24660             mul     AB
0002A3 2A             24661             add     A, Temp3
0002A4 FA             24662             mov     Temp3, A
0002A5 C5F0           24663             xch     A, B
0002A7 3400           24664             addc    A, #0
0002A9 C3             24665             clr     C       
0002AA 13             24666             rrc     A                       ; Divide by 2 for total 512
0002AB FB             24667             mov     Temp4, A
0002AC EA             24668             mov     A, Temp3
0002AD 13             24669             rrc     A
0002AE FA             24670             mov     Temp3, A
0002AF C3             24671             clr     C
0002B0 EB             24672             mov     A, Temp4                ; Divide by 2 for total 1024
0002B1 13             24673             rrc     A                                               
0002B2 FB             24674             mov     Temp4, A
0002B3 EA             24675             mov     A, Temp3
0002B4 13             24676             rrc     A
0002B5 FA             24677             mov     Temp3, A
                      24678     
0002B6                24679     int0_int_fall_gain_done:
                      24680             ; Check if 2235us or above (in order to ignore false pulses)
0002B6 C3             24681             clr     C
0002B7 EB             24682             mov     A, Temp4                                                ; Is pulse 2235u
                               s or higher?
                      24683     IF 1 == 0
                                        subb A, #09h
                                ELSE
0002B8 9412           24686             subb A, #12h
                      24687     ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   404

0002BA 5009           24688             jnc     int0_int_outside_range                  ; Yes - ignore pulse
                      24689     
                      24690             ; Check if below 900us (in order to ignore false pulses)
0002BC C3             24691             clr     C
0002BD EA             24692             mov     A, Temp3
                      24693     IF 1 == 0
                                        subb A, #9Ah
                                ELSE
0002BE 9434           24696             subb A, #34h
                      24697     ENDIF
0002C0 EB             24698             mov     A, Temp4
                      24699     IF 1 == 0
                                        subb A, #03h
                                ELSE
0002C1 9407           24702             subb A, #07h
                      24703     ENDIF
0002C3 5016           24704             jnc     int0_int_check_full_range               ; No - proceed
                      24705     
0002C5                24706     int0_int_outside_range:
0002C5 0500       F   24707             inc     Rcp_Outside_Range_Cnt
0002C7 E500       F   24708             mov     A, Rcp_Outside_Range_Cnt
0002C9 7002           24709             jnz     ($+4)
                      24710     
0002CB 1500       F   24711             dec     Rcp_Outside_Range_Cnt
                      24712     
0002CD C3             24713             clr     C
0002CE E500       F   24714             mov     A, Rcp_Outside_Range_Cnt
0002D0 9432           24715             subb    A, #50                                          ; Allow a given number o
                               f outside pulses
0002D2 5002           24716             jnc     ($+4)
0002D4 0100       F   24717             ajmp    int0_int_set_timeout                    ; If outside limits - ignore fir
                               st pulses
                      24718     
0002D6 750000     F   24719             mov     New_Rcp, #0                                     ; Set pulse length to ze
                               ro
0002D9 0100       F   24720             ajmp    int0_int_exit                                   ; Exit without reseting 
                               timeout
                      24721     
0002DB                24722     int0_int_check_full_range:
                      24723             ; Decrement outside range counter
0002DB E500       F   24724             mov     A, Rcp_Outside_Range_Cnt
0002DD 6002           24725             jz      ($+4)
                      24726     
0002DF 1500       F   24727             dec     Rcp_Outside_Range_Cnt
                      24728     
                      24729             ; Calculate "1000us" plus throttle minimum
0002E1 300006         24730             jnb     Flags2.RCP_FULL_RANGE, int0_int_set_min ; Check if full range is chosen
                      24731     
0002E4 7C00           24732             mov     Temp5, #0                                               ; Set 1000us as 
                               default minimum
                      24733     IF 1 == 0
                                        mov     Temp6, #4
                                ELSE
0002E6 7D08           24736             mov     Temp6, #8
                      24737     ENDIF
0002E8 0100       F   24738             ajmp    int0_int_calculate
                      24739     
0002EA                24740     int0_int_set_min:
0002EA AC00       F   24741             mov     Temp5, Min_Throttle_L                   ; Min throttle value scaled
0002EC AD00       F   24742             mov     Temp6, Min_Throttle_H
0002EE 300004         24743             jnb     Flags3.PGM_BIDIR, ($+7)
                      24744     
0002F1 AC00       F   24745             mov     Temp5, Center_Throttle_L                        ; Center throttle value 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   405

                               scaled
0002F3 AD00       F   24746             mov     Temp6, Center_Throttle_H
                      24747     
0002F5                24748     int0_int_calculate:
0002F5 C3             24749             clr     C
0002F6 EA             24750             mov     A, Temp3                                                ; Subtract minim
                               um
0002F7 9C             24751             subb    A, Temp5
0002F8 FA             24752             mov     Temp3, A
0002F9 EB             24753             mov     A, Temp4                                        
0002FA 9D             24754             subb    A, Temp6
0002FB FB             24755             mov     Temp4, A
0002FC 9200       F   24756             mov     Bit_Access_Int.0, C
0002FE AE00       F   24757             mov     Temp7, Throttle_Gain                            ; Load Temp7/Temp8 with 
                               throttle gain
000300 AF00       F   24758             mov     Temp8, Throttle_Gain_M
000302 300042         24759             jnb     Flags3.PGM_BIDIR, int0_int_not_bidir    ; If not bidirectional operation
                                - branch
                      24760     
000305 5007           24761             jnc     int0_int_bidir_fwd                                      ; If result is p
                               ositive - branch
                      24762     
000307 200009         24763             jb      Flags2.RCP_DIR_REV, int0_int_bidir_rev_chk      ; If same direction - br
                               anch
                      24764     
00030A D200       F   24765             setb    Flags2.RCP_DIR_REV
00030C 0100       F   24766             ajmp    int0_int_bidir_rev_chk
                      24767     
00030E                24768     int0_int_bidir_fwd:
00030E 300002         24769             jnb     Flags2.RCP_DIR_REV, int0_int_bidir_rev_chk      ; If same direction - br
                               anch
                      24770     
000311 C200       F   24771             clr     Flags2.RCP_DIR_REV
                      24772     
000313                24773     int0_int_bidir_rev_chk:
000313 300004         24774             jnb     Flags2.RCP_DIR_REV, ($+7)
                      24775     
000316 AE00       F   24776             mov     Temp7, Throttle_Gain_BD_Rev             ; Load Temp7/Temp8 with throttle
                                gain for bidirectional reverse
000318 AF00       F   24777             mov     Temp8, Throttle_Gain_BD_Rev_M
                      24778     
00031A 200002         24779             jb      Flags3.PGM_BIDIR_REV, ($+5)
                      24780     
00031D B200       F   24781             cpl     Flags2.RCP_DIR_REV
                      24782     
00031F C3             24783             clr     C                                                       ; Multiply throt
                               tle value by 2
000320 EA             24784             mov     A, Temp3
000321 33             24785             rlc     A
000322 FA             24786             mov     Temp3, A
000323 EB             24787             mov     A, Temp4
000324 33             24788             rlc     A
000325 FB             24789             mov     Temp4, A
000326 A200       F   24790             mov     C, Bit_Access_Int.0
000328 500A           24791             jnc     int0_int_bidir_do_deadband              ; If result is positive - branch
                      24792     
00032A EA             24793             mov     A, Temp3                                                ; Change sign
00032B F4             24794             cpl     A
00032C 2401           24795             add     A, #1
00032E FA             24796             mov     Temp3, A
00032F EB             24797             mov     A, Temp4
000330 F4             24798             cpl     A
000331 3400           24799             addc    A, #0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   406

000333 FB             24800             mov     Temp4, A
                      24801     
000334                24802     int0_int_bidir_do_deadband:
000334 C3             24803             clr     C                                                       ; Subtract deadb
                               and
000335 EA             24804             mov     A, Temp3
                      24805     IF 1 == 0
                                        subb    A, #40
                                ELSE
000336 9450           24808             subb    A, #80
                      24809     ENDIF
000338 FA             24810             mov     Temp3, A
000339 EB             24811             mov     A, Temp4
00033A 9400           24812             subb    A, #0
00033C FB             24813             mov     Temp4, A
00033D 5014           24814             jnc     int0_int_do_throttle_gain
                      24815     
00033F 7800           24816             mov     Temp1, #0
000341 7A00           24817             mov     Temp3, #0
000343 7B00           24818             mov     Temp4, #0
000345 0100       F   24819             ajmp    int0_int_do_throttle_gain
                      24820     
000347                24821     int0_int_not_bidir:
000347 A200       F   24822             mov     C, Bit_Access_Int.0
000349 5008           24823             jnc     int0_int_do_throttle_gain               ; If result is positive - branch
                      24824     
00034B                24825     int0_int_unidir_neg:
00034B 7800           24826             mov     Temp1, #0                                               ; Yes - set to m
                               inimum
00034D 7A00           24827             mov     Temp3, #0
00034F 7B00           24828             mov     Temp4, #0
000351 0100       F   24829             ajmp    int0_int_pulse_ready
                      24830     
000353                24831     int0_int_do_throttle_gain:
                      24832             ; Boost pwm during direct start
000353 E500       F   24833             mov     A, Flags1
000355 5403           24834             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
000357 601B           24835             jz      int0_int_startup_boosted
                      24836     
000359 200018         24837             jb      Flags1.MOTOR_STARTED, int0_int_startup_boosted  ; Do not boost when chan
                               ging direction in bidirectional mode
                      24838     
00035C E500       F   24839             mov     A, Pwm_Limit_Beg                                ; Set 25% of max startup
                                power as minimum power
                      24840     IF 1 == 1
00035E 33             24841             rlc     A
                      24842     ENDIF
00035F F9             24843             mov     Temp2, A
000360 EB             24844             mov     A, Temp4
000361 7007           24845             jnz     int0_int_startup_boost_stall
                      24846     
000363 C3             24847             clr     C
000364 E9             24848             mov     A, Temp2
000365 9A             24849             subb    A, Temp3
000366 4002           24850             jc      int0_int_startup_boost_stall
                      24851     
000368 E9             24852             mov     A, Temp2
000369 FA             24853             mov     Temp3, A
                      24854     
00036A                24855     int0_int_startup_boost_stall:
00036A E500       F   24856             mov     A, Stall_Cnt                                    ; Add an extra power boo
                               st during start
00036C C4             24857             swap    A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   407

                      24858     IF 1 == 1
00036D 33             24859             rlc     A
                      24860     ENDIF
00036E 2A             24861             add     A, Temp3
00036F FA             24862             mov     Temp3, A
000370 EB             24863             mov     A, Temp4
000371 3400           24864             addc    A, #0
000373 FB             24865             mov     Temp4, A
                      24866     
000374                24867     int0_int_startup_boosted:
000374 EA             24868             mov     A, Temp3                                                ; Multiply throt
                               tle value by throttle gain
000375 8EF0           24869             mov     B, Temp7                                                ; Temp7 has Thro
                               ttle_Gain
000377 A4             24870             mul     AB
000378 F9             24871             mov     Temp2, A
000379 AAF0           24872             mov     Temp3, B
00037B EB             24873             mov     A, Temp4
00037C 8EF0           24874             mov     B, Temp7                                                ; Temp7 has Thro
                               ttle_Gain
00037E A4             24875             mul     AB
00037F 2A             24876             add     A, Temp3
000380 FA             24877             mov     Temp3, A
000381 C5F0           24878             xch     A, B
000383 3400           24879             addc    A, #0
000385 FB             24880             mov     Temp4, A
000386 C3             24881             clr     C                                                       ; Generate 8bit 
                               number
000387 EB             24882             mov     A, Temp4
000388 13             24883             rrc     A
000389 FD             24884             mov     Temp6, A
00038A EA             24885             mov     A, Temp3
00038B 13             24886             rrc     A
00038C F8             24887             mov     Temp1, A
                      24888     IF 1 == 1
00038D C3             24889             clr     C
00038E ED             24890             mov     A, Temp6
00038F 13             24891             rrc     A
000390 FD             24892             mov     Temp6, A
000391 E8             24893             mov     A, Temp1
000392 13             24894             rrc     A
000393 F8             24895             mov     Temp1, A
                      24896     ENDIF
000394 0F             24897             inc     Temp8                                           ; Temp8 has Throttle_Gai
                               n_M
000395                24898     int0_int_gain_loop:
000395 EF             24899             mov     A, Temp8
000396 14             24900             dec     A
000397 6004           24901             jz      int0_int_gain_rcp_done                  ; Skip one multiply by 2 of New_
                               Rcp
                      24902     
000399 C3             24903             clr     C
00039A E8             24904             mov     A, Temp1                                                ; Multiply New_R
                               cp by 2
00039B 33             24905             rlc     A
00039C F8             24906             mov     Temp1, A
                      24907     
00039D                24908     int0_int_gain_rcp_done:
00039D C3             24909             clr     C
00039E E9             24910             mov     A, Temp2                                                ; Multiply pwm b
                               y 2
00039F 33             24911             rlc     A
0003A0 EA             24912             mov     A, Temp3
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   408

0003A1 33             24913             rlc     A
0003A2 FA             24914             mov     Temp3, A
0003A3 EB             24915             mov     A, Temp4
0003A4 33             24916             rlc     A
0003A5 FB             24917             mov     Temp4, A
0003A6 DFED           24918             djnz    Temp8, int0_int_gain_loop
                      24919     
0003A8 EB             24920             mov     A, Temp4
                      24921     IF 1 == 0
                                        jnb     ACC.2, int0_int_pulse_ready             ; Check that RC pulse is within 
                               legal range
                                ELSE
0003A9 30E306         24924             jnb     ACC.3, int0_int_pulse_ready
                      24925     ENDIF
                      24926     
0003AC 78FF           24927             mov     Temp1, #0FFh
0003AE 7AFF           24928             mov     Temp3, #0FFh
                      24929     IF 1 == 0
                                        mov     Temp4, #3
                                ELSE
0003B0 7B07           24932             mov     Temp4, #7
                      24933     ENDIF
                      24934     
0003B2                24935     int0_int_pulse_ready:
0003B2 8800       F   24936             mov     New_Rcp, Temp1                                  ; Store new pulse length
0003B4 D200       F   24937             setb    Flags2.RCP_UPDATED              ; Set updated flag
                      24938             ; Check if zero
0003B6 E8             24939             mov     A, Temp1                                                                
                               ; Load new pulse value
                      24940             
0003B7 6003           24941             jz      ($+5)                                                                   
                                       ; Check if pulse is zero
                      24942             
0003B9 750000     F   24943             mov     Rcp_Stop_Cnt, #0                                ; Reset rcp stop counter
                      24944     
                      24945             ; Set pwm limit
0003BC C3             24946             clr     C
0003BD E500       F   24947             mov     A, Pwm_Limit                                    ; Limit to the smallest
0003BF FC             24948             mov     Temp5, A                                                ; Store limit in
                                Temp5
0003C0 9500       F   24949             subb    A, Pwm_Limit_By_Rpm
0003C2 4002           24950             jc      ($+4)
                      24951     
0003C4 AC00       F   24952             mov     Temp5, Pwm_Limit_By_Rpm                 
                      24953     
                      24954             ; Check against limit
0003C6 C3             24955             clr     C
0003C7 EC             24956             mov     A, Temp5
0003C8 9500       F   24957             subb    A, New_Rcp
0003CA 5008           24958             jnc     int0_int_set_pwm_registers
                      24959     
0003CC EC             24960             mov     A, Temp5                                                ; Multiply limit
                                by 4 (8 for 48MHz MCUs)
                      24961     IF 1 == 0
                                        mov     B, #4
                                ELSE
0003CD 75F008         24964             mov     B, #8
                      24965     ENDIF
0003D0 A4             24966             mul     AB
0003D1 FA             24967             mov     Temp3, A
0003D2 ABF0           24968             mov     Temp4, B
                      24969     
0003D4                24970     int0_int_set_pwm_registers:
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   409

0003D4 EA             24971             mov     A, Temp3
0003D5 F4             24972             cpl     A
0003D6 F8             24973             mov     Temp1, A
0003D7 EB             24974             mov     A, Temp4
0003D8 F4             24975             cpl     A
                      24976     IF 1 == 0
                                        anl     A, #3
                                ELSE
0003D9 5407           24979             anl     A, #7
                      24980     ENDIF
0003DB F9             24981             mov     Temp2, A
                      24982     IF 90 != 0
0003DC C3             24983             clr     C
0003DD E8             24984             mov     A, Temp1                                                ; Skew damping f
                               et timing
                      24985     IF 1 == 0
                                        subb    A, #90
                                ELSE
0003DE 94B4           24988             subb    A, #(90 SHL 1)
                      24989     ENDIF
0003E0 FA             24990             mov     Temp3, A
0003E1 E9             24991             mov     A, Temp2
0003E2 9400           24992             subb    A, #0   
0003E4 FB             24993             mov     Temp4, A
0003E5 5004           24994             jnc     int0_int_set_pwm_damp_set
                      24995     
0003E7 7A00           24996             mov     Temp3, #0
0003E9 7B00           24997             mov     Temp4, #0
                      24998     
0003EB                24999     int0_int_set_pwm_damp_set:
                      25000     ENDIF
0003EB 8800       F   25001             mov     Power_Pwm_Reg_L, Temp1
0003ED 8900       F   25002             mov     Power_Pwm_Reg_H, Temp2
                      25003     IF 90 != 0
0003EF 8A00       F   25004             mov     Damp_Pwm_Reg_L, Temp3
0003F1 8B00       F   25005             mov     Damp_Pwm_Reg_H, Temp4
                      25006     ENDIF
0003F3 75000A     F   25007             mov     Rcp_Timeout_Cntd, #10                   ; Set timeout count
                      25008     IF 90 != 0
0003F6 D0F0           25009             pop     B                                                       ; Restore preser
                               ved registers
0003F8 D0E0           25010             pop     ACC
0003FA D0D0           25011             pop     PSW
                      25012             Clear_COVF_Interrupt
*** ____________________________________^
*** ERROR #A9 IN 25012 (BLHeli_S.asm, LINE 1394): SYNTAX ERROR
                      25013             Enable_COVF_Interrupt                           ; Generate a pca interrupt
*** ____________________________________^
*** ERROR #A9 IN 25013 (BLHeli_S.asm, LINE 1395): SYNTAX ERROR
0003FC                25014             orl     EIE1, #10h                                      ; Enable pca interrupts
*** ____________________________________________^
*** ERROR #A45 IN 25014 (BLHeli_S.asm, LINE 1396): UNDEFINED SYMBOL
0003FF 32             25015             reti
                      25016     ELSE
                                        mov     A, Current_Power_Pwm_Reg_H
                                IF 1 == 0
                                        jnb     ACC.1, int0_int_set_pca_int_hi_pwm
                                ELSE
                                        jnb     ACC.2, int0_int_set_pca_int_hi_pwm
                                ENDIF
                                
                                        pop     B                                                       ; Restore preser
                               ved registers
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   410

                                        pop     ACC
                                        pop     PSW
                                        Clear_COVF_Interrupt
                                        Enable_COVF_Interrupt                           ; Generate a pca interrupt
                                        orl     EIE1, #10h                                      ; Enable pca interrupts
                                        reti
                                
                                int0_int_set_pca_int_hi_pwm:
                                        pop     B                                                       ; Restore preser
                               ved registers
                                        pop     ACC
                                        pop     PSW
                                        Clear_CCF_Interrupt
                                        Enable_CCF_Interrupt                            ; Generate pca interrupt
                                        orl     EIE1, #10h                                      ; Enable pca interrupts
                                        reti
                                ENDIF
                      25041     
000400                25042     int0_int_set_timeout:
000400 75000A     F   25043             mov     Rcp_Timeout_Cntd, #10                   ; Set timeout count
000403                25044     int0_int_exit:
000403 D0F0           25045             pop     B                                                       ; Restore preser
                               ved registers
000405 D0E0           25046             pop     ACC
000407 D0D0           25047             pop     PSW
000409                25048             orl     EIE1, #10h                                      ; Enable pca interrupts
*** ____________________________________________^
*** ERROR #A45 IN 25048 (BLHeli_S.asm, LINE 1430): UNDEFINED SYMBOL
00040C 32             25049             reti
                      25050     
                      25051     
                      25052     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25053     ;
                      25054     ; Int1 interrupt routine
                      25055     ;
                      25056     ; No assumptions
                      25057     ;
                      25058     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00040D                25059     int1_int:       ; Used for RC pulse timing
00040D                25060             clr     IE_EX1                  ; Disable int1 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 25060 (BLHeli_S.asm, LINE 1442): UNDEFINED SYMBOL
00040F                25061             setb    TCON_TR1                        ; Start timer 1
*** ____________________________________________^
*** ERROR #A45 IN 25061 (BLHeli_S.asm, LINE 1443): UNDEFINED SYMBOL
000411                25062             clr     TMR2CN0_TR2                             ; Timer 2 disabled
*** ____________________________________________^
*** ERROR #A45 IN 25062 (BLHeli_S.asm, LINE 1444): UNDEFINED SYMBOL
000413                25063             mov     DShot_Frame_Start_L, TMR2L      ; Read timer value
*** _________________________________________________________________^
*** ERROR #A45 IN 25063 (BLHeli_S.asm, LINE 1445): UNDEFINED SYMBOL
000416                25064             mov     DShot_Frame_Start_H, TMR2H
*** _________________________________________________________________^
*** ERROR #A45 IN 25064 (BLHeli_S.asm, LINE 1446): UNDEFINED SYMBOL
000419                25065             setb    TMR2CN0_TR2                             ; Timer 2 enabled
*** ____________________________________________^
*** ERROR #A45 IN 25065 (BLHeli_S.asm, LINE 1447): UNDEFINED SYMBOL
00041B 32             25066     reti
                      25067     
                      25068     
                      25069     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25070     ;
                      25071     ; PCA interrupt routine
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   411

                      25072     ;
                      25073     ; No assumptions
                      25074     ;
                      25075     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00041C                25076     pca_int:        ; Used for setting pwm registers
00041C                25077             clr     IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 25077 (BLHeli_S.asm, LINE 1459): UNDEFINED SYMBOL
00041E C0D0           25078             push    PSW                             ; Preserve registers through interrupt
000420 C0E0           25079             push    ACC
000422 D2D3           25080             setb    PSW.3                   ; Select register bank 1 for this interrupt
                      25081     
                      25082     IF 90 != 0                                      ; HI/LO enable style drivers
                      25083     
000424                25084             mov     Temp1, PCA0L                            ; Read low byte, to transfer hig
                               h byte to holding register
*** ___________________________________________________^
*** ERROR #A45 IN 25084 (BLHeli_S.asm, LINE 1466): UNDEFINED SYMBOL
000426 E500       F   25085             mov     A, Current_Power_Pwm_Reg_H
                      25086     IF 1 == 0
                                        jnb     ACC.1, pca_int_hi_pwm
                                ELSE
000428 30E20A         25089             jnb     ACC.2, pca_int_hi_pwm
                      25090     ENDIF
00042B                25091             mov     A, PCA0H
*** _______________________________________________^
*** ERROR #A45 IN 25091 (BLHeli_S.asm, LINE 1473): UNDEFINED SYMBOL
                      25092     IF 1 == 0
                                        jb      ACC.1, pca_int_exit                     ; Power below 50%, update pca in
                                the 0x00-0x0F range
                                        jb      ACC.0, pca_int_exit
                                ELSE
00042D 20E21A         25096             jb      ACC.2, pca_int_exit
000430 20E117         25097             jb      ACC.1, pca_int_exit
                      25098     ENDIF
000433 0100       F   25099             ajmp    pca_int_set_pwm
                      25100     
000435                25101     pca_int_hi_pwm:
000435                25102             mov     A, PCA0H
*** _______________________________________________^
*** ERROR #A45 IN 25102 (BLHeli_S.asm, LINE 1484): UNDEFINED SYMBOL
                      25103     IF 1 == 0
                                        jnb     ACC.1, pca_int_exit                     ; Power above 50%, update pca in
                                the 0x20-0x2F range
                                        jb      ACC.0, pca_int_exit
                                ELSE
000437 30E210         25107             jnb     ACC.2, pca_int_exit
00043A 20E10D         25108             jb      ACC.1, pca_int_exit
                      25109     ENDIF
                      25110     
00043D                25111     pca_int_set_pwm:
                      25112             Set_Power_Pwm_Regs
*** ____________________________________^
*** ERROR #A9 IN 25112 (BLHeli_S.asm, LINE 1494): SYNTAX ERROR
                      25113             Set_Damp_Pwm_Regs
*** ____________________________________^
*** ERROR #A9 IN 25113 (BLHeli_S.asm, LINE 1495): SYNTAX ERROR
00043D 850000     F   25114             mov     Current_Power_Pwm_Reg_H, Power_Pwm_Reg_H
                      25115             Disable_COVF_Interrupt
*** ____________________________________^
*** ERROR #A9 IN 25115 (BLHeli_S.asm, LINE 1497): SYNTAX ERROR
                      25116     
                      25117     ELSE                                                            ; EN/PWM style drivers
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   412

                                        Set_Power_Pwm_Regs
                                        mov     Current_Power_Pwm_Reg_H, Power_Pwm_Reg_H
                                        Disable_COVF_Interrupt
                                        Disable_CCF_Interrupt
                                
                                ENDIF
                      25124     
                      25125             ; Pwm updated, enable/disable interrupts
000440                25126             setb    IE_EX0                                  ; Enable int0 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 25126 (BLHeli_S.asm, LINE 1508): UNDEFINED SYMBOL
000442 300002         25127             jnb     Flags2.RCP_DSHOT, ($+5)
000445                25128             setb    IE_EX1                                  ; Enable int1 interrupts (DShot 
                               only)
*** ____________________________________________^
*** ERROR #A45 IN 25128 (BLHeli_S.asm, LINE 1510): UNDEFINED SYMBOL
000447                25129             anl     EIE1, #0EFh                             ; Disable pca interrupts
*** ____________________________________________^
*** ERROR #A45 IN 25129 (BLHeli_S.asm, LINE 1511): UNDEFINED SYMBOL
                      25130     
00044A                25131     pca_int_exit:
                      25132             Clear_COVF_Interrupt
*** ____________________________________^
*** ERROR #A9 IN 25132 (BLHeli_S.asm, LINE 1514): SYNTAX ERROR
                      25133     IF 90 == 0
                                        Clear_CCF_Interrupt
                                ENDIF
00044A D0E0           25136             pop     ACC                                             ; Restore preserved regi
                               sters
00044C D0D0           25137             pop     PSW
00044E                25138             setb    IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 25138 (BLHeli_S.asm, LINE 1520): UNDEFINED SYMBOL
000450 32             25139             reti
                      25140     
                      25141     
                      25142     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25143     ;
                      25144     ; Wait xms ~(x*4*250)  (Different entry points) 
                      25145     ;
                      25146     ; No assumptions
                      25147     ;
                      25148     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000451                25149     wait1ms:        
000451 7901           25150             mov     Temp2, #1
000453 8014           25151             jmp     waitxms_o
                      25152     
000455                25153     wait3ms:        
000455 7903           25154             mov     Temp2, #3
000457 8010           25155             jmp     waitxms_o
                      25156     
000459                25157     wait10ms:       
000459 790A           25158             mov     Temp2, #10
00045B 800C           25159             jmp     waitxms_o
                      25160     
00045D                25161     wait30ms:       
00045D 791E           25162             mov     Temp2, #30
00045F 8008           25163             jmp     waitxms_o
                      25164     
000461                25165     wait100ms:      
000461 7964           25166             mov     Temp2, #100
000463 8004           25167             jmp     waitxms_o
                      25168     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   413

000465                25169     wait200ms:      
000465 79C8           25170             mov     Temp2, #200
000467 8000           25171             jmp     waitxms_o
                      25172     
000469                25173     waitxms_o:      ; Outer loop
000469 7817           25174             mov     Temp1, #23
00046B                25175     waitxms_m:      ; Middle loop
00046B E4             25176             clr     A
00046C D5E0FD         25177             djnz    ACC, $  ; Inner loop (42.7us - 1024 cycles)
00046F D8FA           25178             djnz    Temp1, waitxms_m
000471 D9F6           25179             djnz    Temp2, waitxms_o
000473 22             25180             ret
                      25181     
                      25182     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25183     ;
                      25184     ; Set pwm limit low rpm
                      25185     ;
                      25186     ; No assumptions
                      25187     ;
                      25188     ; Sets power limit for low rpms and disables demag for low rpms
                      25189     ;
                      25190     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000474                25191     set_pwm_limit_low_rpm:
                      25192             ; Set pwm limit 
000474 78FF           25193             mov     Temp1, #0FFh                                    ; Default full power
000476 200028         25194             jb      Flags1.STARTUP_PHASE, set_pwm_limit_low_rpm_exit        ; Exit if startu
                               p phase set
                      25195     
000479 7900       F   25196             mov     Temp2, #Pgm_Enable_Power_Prot           ; Check if low RPM power protect
                               ion is enabled
00047B E7             25197             mov     A, @Temp2
00047C 6023           25198             jz      set_pwm_limit_low_rpm_exit              ; Exit if disabled
                      25199     
00047E E500       F   25200             mov     A, Comm_Period4x_H
000480 601F           25201             jz      set_pwm_limit_low_rpm_exit              ; Avoid divide by zero
                      25202     
000482 74FF           25203             mov     A, #255                                         ; Divide 255 by Comm_Per
                               iod4x_H
000484 8500F0     F   25204             mov     B, Comm_Period4x_H
000487 84             25205             div     AB
000488 8500F0     F   25206             mov     B, Low_Rpm_Pwr_Slope                    ; Multiply by slope
00048B 300003         25207             jnb     Flags1.INITIAL_RUN_PHASE, ($+6) ; More protection for initial run phase 
00048E 75F005         25208             mov     B, #5
000491 A4             25209             mul     AB
000492 F8             25210             mov     Temp1, A                                                ; Set new limit 
                                                       
000493 C5F0           25211             xch     A, B
000495 6002           25212             jz      ($+4)                                           ; Limit to max
                      25213             
000497 78FF           25214             mov     Temp1, #0FFh                            
                      25215     
000499 C3             25216             clr     C
00049A E8             25217             mov     A, Temp1                                                ; Limit to min
00049B 9500       F   25218             subb    A, Pwm_Limit_Beg
00049D 5002           25219             jnc     set_pwm_limit_low_rpm_exit
                      25220     
00049F A800       F   25221             mov     Temp1, Pwm_Limit_Beg
                      25222     
0004A1                25223     set_pwm_limit_low_rpm_exit:
0004A1 8800       F   25224             mov     Pwm_Limit_By_Rpm, Temp1                         
0004A3 22             25225             ret
                      25226             
                      25227     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   414

                      25228     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25229     ;
                      25230     ; Set pwm limit high rpm
                      25231     ;
                      25232     ; No assumptions
                      25233     ;
                      25234     ; Sets power limit for high rpms
                      25235     ;
                      25236     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0004A4                25237     set_pwm_limit_high_rpm:
                      25238     IF 1 == 1
0004A4 C3             25239             clr     C
0004A5 E500       F   25240             mov     A, Comm_Period4x_L
0004A7 94A0           25241             subb    A, #0A0h                                ; Limit Comm_Period to 160, whic
                               h is 500k erpm
0004A9 E500       F   25242             mov     A, Comm_Period4x_H
0004AB 9400           25243             subb    A, #00h
                      25244     ELSE
                                        clr     C
                                        mov     A, Comm_Period4x_L
                                        subb    A, #0E4h                                ; Limit Comm_Period to 228, whic
                               h is 350k erpm
                                        mov     A, Comm_Period4x_H
                                        subb    A, #00h
                                ENDIF
0004AD E500       F   25251             mov     A, Pwm_Limit_By_Rpm
0004AF 5003           25252             jnc     set_pwm_limit_high_rpm_inc_limit
                      25253             
0004B1 14             25254             dec     A
0004B2 0100       F   25255             ajmp    set_pwm_limit_high_rpm_store
                      25256             
0004B4                25257     set_pwm_limit_high_rpm_inc_limit:
0004B4 04             25258             inc     A
0004B5                25259     set_pwm_limit_high_rpm_store:
0004B5 6002           25260             jz      ($+4)
                      25261     
0004B7 F500       F   25262             mov     Pwm_Limit_By_Rpm, A
                      25263     
0004B9 22             25264             ret
                      25265     
                      25266     
                      25267     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25268     ;
                      25269     ; Start ADC conversion
                      25270     ;
                      25271     ; No assumptions
                      25272     ;
                      25273     ; Start conversion used for measuring power supply voltage
                      25274     ;
                      25275     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0004BA                25276     start_adc_conversion:
                      25277             ; Start adc
                      25278             Start_Adc 
*** ____________________________________^
*** ERROR #A9 IN 25278 (BLHeli_S.asm, LINE 1660): SYNTAX ERROR
0004BA 22             25279             ret
                      25280     
                      25281     
                      25282     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25283     ;
                      25284     ; Check temperature, power supply voltage and limit power
                      25285     ;
                      25286     ; No assumptions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   415

                      25287     ;
                      25288     ; Used to limit main motor power in order to maintain the required voltage
                      25289     ;
                      25290     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0004BB                25291     check_temp_voltage_and_limit_power:
0004BB 0500       F   25292             inc     Adc_Conversion_Cnt                      ; Increment conversion counter
0004BD C3             25293             clr     C
0004BE E500       F   25294             mov     A, Adc_Conversion_Cnt           ; Is conversion count equal to temp rate
                               ?
0004C0 9408           25295             subb    A, #8
0004C2 404F           25296             jc      check_voltage_start                     ; No - check voltage
                      25297     
                      25298             ; Wait for ADC conversion to complete
0004C4                25299             jnb     ADC0CN0_ADINT, check_temp_voltage_and_limit_power
*** ____________________________________________^
*** ERROR #A45 IN 25299 (BLHeli_S.asm, LINE 1681): UNDEFINED SYMBOL
                      25300             ; Read ADC result
                      25301             Read_Adc_Result
*** ____________________________________^
*** ERROR #A9 IN 25301 (BLHeli_S.asm, LINE 1683): SYNTAX ERROR
                      25302             ; Stop ADC
                      25303             Stop_Adc
*** ____________________________________^
*** ERROR #A9 IN 25303 (BLHeli_S.asm, LINE 1685): SYNTAX ERROR
                      25304     
0004C7 750000     F   25305             mov     Adc_Conversion_Cnt, #0          ; Yes - temperature check. Reset counter
0004CA E9             25306             mov     A, Temp2                                        ; Move ADC MSB to Temp3
0004CB FA             25307             mov     Temp3, A
0004CC 7900       F   25308             mov     Temp2, #Pgm_Enable_Temp_Prot    ; Is temp protection enabled?
0004CE E7             25309             mov     A, @Temp2
0004CF 6041           25310             jz      temp_check_exit                 ; No - branch
                      25311     
0004D1 EA             25312             mov     A, Temp3                                        ; Is temperature reading
                                below 256?
0004D2 7006           25313             jnz     temp_average_inc_dec            ; No - proceed
                      25314     
0004D4 E500       F   25315             mov     A, Current_Average_Temp         ; Yes -  decrement average
0004D6 6018           25316             jz      temp_average_updated            ; Already zero - no change
0004D8 800C           25317             jmp     temp_average_dec                        ; Decrement 
                      25318     
0004DA                25319     temp_average_inc_dec:
0004DA C3             25320             clr     C
0004DB E8             25321             mov     A, Temp1                                        ; Check if current tempe
                               rature is above or below average
0004DC 9500       F   25322             subb    A, Current_Average_Temp
0004DE 600E           25323             jz      temp_average_updated_load_acc   ; Equal - no change
                      25324     
0004E0 E500       F   25325             mov     A, Current_Average_Temp         ; Above - increment average
0004E2 5005           25326             jnc     temp_average_inc                                
                      25327     
0004E4 600A           25328             jz      temp_average_updated            ; Below - decrement average if average i
                               s not already zero
0004E6                25329     temp_average_dec:
0004E6 14             25330             dec     A                                               ; Decrement average
0004E7 8007           25331             jmp     temp_average_updated
                      25332     
0004E9                25333     temp_average_inc:
0004E9 04             25334             inc     A                                               ; Increment average
0004EA 60FA           25335             jz      temp_average_dec
0004EC 8002           25336             jmp     temp_average_updated
                      25337     
0004EE                25338     temp_average_updated_load_acc:
0004EE E500       F   25339             mov     A, Current_Average_Temp
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   416

0004F0                25340     temp_average_updated:
0004F0 F500       F   25341             mov     Current_Average_Temp, A
0004F2 C3             25342             clr     C
0004F3 9500       F   25343             subb    A, Temp_Prot_Limit                      ; Is temperature below first lim
                               it?
0004F5 401B           25344             jc      temp_check_exit                 ; Yes - exit
                      25345     
0004F7 7500C0     F   25346             mov  Pwm_Limit, #192                    ; No - limit pwm
                      25347     
0004FA C3             25348             clr     C
0004FB                25349             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below second limit
*** _________________________________________________^
*** ERROR #A45 IN 25349 (BLHeli_S.asm, LINE 1731): UNDEFINED SYMBOL
0004FD 4013           25350             jc      temp_check_exit                 ; Yes - exit
                      25351     
0004FF 750080     F   25352             mov  Pwm_Limit, #128                    ; No - limit pwm
                      25353     
000502 C3             25354             clr     C
000503                25355             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below third limit
*** _________________________________________________^
*** ERROR #A45 IN 25355 (BLHeli_S.asm, LINE 1737): UNDEFINED SYMBOL
000505 400B           25356             jc      temp_check_exit                 ; Yes - exit
                      25357     
000507 750040     F   25358             mov  Pwm_Limit, #64                             ; No - limit pwm
                      25359     
00050A C3             25360             clr     C
00050B                25361             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below final limit
*** _________________________________________________^
*** ERROR #A45 IN 25361 (BLHeli_S.asm, LINE 1743): UNDEFINED SYMBOL
00050D 4003           25362             jc      temp_check_exit                 ; Yes - exit
                      25363     
00050F 750000     F   25364             mov  Pwm_Limit, #0                              ; No - limit pwm
                      25365     
000512                25366     temp_check_exit:
000512 22             25367             ret
                      25368     
000513                25369     check_voltage_start:
                      25370             ; Increase pwm limit
000513 E500       F   25371             mov  A, Pwm_Limit
000515 2410           25372             add     A, #16                  
000517 5002           25373             jnc     ($+4)                                   ; If not max - branch
                      25374     
000519 74FF           25375             mov     A, #255
                      25376     
00051B F500       F   25377             mov     Pwm_Limit, A                            ; Increment limit 
00051D 22             25378             ret
                      25379     
                      25380     
                      25381     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25382     ;
                      25383     ; Set startup PWM routine
                      25384     ;
                      25385     ; Either the SETTLE_PHASE or the STEPPER_PHASE flag must be set
                      25386     ;
                      25387     ; Used for pwm control during startup
                      25388     ;
                      25389     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00051E                25390     set_startup_pwm:        
                      25391             ; Adjust startup power
00051E 7432           25392             mov     A, #50                                          ; Set power
000520 7900       F   25393             mov     Temp2, #Pgm_Startup_Pwr_Decoded
000522 87F0           25394             mov     B, @Temp2
000524 A4             25395             mul     AB
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   417

000525 C5F0           25396             xch     A, B
000527 A2F7           25397             mov     C, B.7                                          ; Multiply result by 2 (
                               unity gain is 128)
000529 33             25398             rlc     A
00052A F8             25399             mov     Temp1, A                                                ; Transfer to Te
                               mp1
00052B C3             25400             clr     C
00052C E8             25401             mov     A, Temp1                                                ; Check against 
                               limit
00052D 9500       F   25402             subb    A, Pwm_Limit    
00052F 4002           25403             jc      startup_pwm_set_pwm                             ; If pwm below limit - b
                               ranch
                      25404     
000531 A800       F   25405             mov     Temp1, Pwm_Limit                                ; Limit pwm
                      25406     
000533                25407     startup_pwm_set_pwm:
000533 8800       F   25408             mov     Pwm_Limit_Beg, Temp1                    ; Set initial pwm limit
000535 22             25409             ret
                      25410     
                      25411     
                      25412     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25413     ;
                      25414     ; Initialize timing routine
                      25415     ;
                      25416     ; No assumptions
                      25417     ;
                      25418     ; Part of initialization before motor start
                      25419     ;
                      25420     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000536                25421     initialize_timing: 
000536 750000     F   25422             mov     Comm_Period4x_L, #00h                           ; Set commutation period
                                registers
000539 7500F0     F   25423             mov     Comm_Period4x_H, #0F0h
00053C 22             25424             ret
                      25425     
                      25426     
                      25427     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25428     ;
                      25429     ; Calculate next commutation timing routine
                      25430     ;
                      25431     ; No assumptions
                      25432     ;
                      25433     ; Called immediately after each commutation
                      25434     ; Also sets up timer 3 to wait advance timing
                      25435     ; Two entry points are used
                      25436     ;
                      25437     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00053D                25438     calc_next_comm_timing:          ; Entry point for run phase
                      25439             ; Read commutation time
00053D                25440             clr     IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 25440 (BLHeli_S.asm, LINE 1822): UNDEFINED SYMBOL
00053F                25441             clr     TMR2CN0_TR2             ; Timer 2 disabled
*** ____________________________________________^
*** ERROR #A45 IN 25441 (BLHeli_S.asm, LINE 1823): UNDEFINED SYMBOL
000541                25442             mov     Temp1, TMR2L            ; Load timer value
*** ___________________________________________________^
*** ERROR #A45 IN 25442 (BLHeli_S.asm, LINE 1824): UNDEFINED SYMBOL
000543                25443             mov     Temp2, TMR2H    
*** ___________________________________________________^
*** ERROR #A45 IN 25443 (BLHeli_S.asm, LINE 1825): UNDEFINED SYMBOL
000545 AA00       F   25444             mov     Temp3, Timer2_X
000547                25445             jnb     TMR2CN0_TF2H, ($+4)     ; Check if interrupt is pending
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   418

*** ____________________________________________^
*** ERROR #A45 IN 25445 (BLHeli_S.asm, LINE 1827): UNDEFINED SYMBOL
00054A 0A             25446             inc     Temp3                   ; If it is pending, then timer has already wrapp
                               ed
00054B                25447             setb    TMR2CN0_TR2             ; Timer 2 enabled
*** ____________________________________________^
*** ERROR #A45 IN 25447 (BLHeli_S.asm, LINE 1829): UNDEFINED SYMBOL
00054D                25448             setb    IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 25448 (BLHeli_S.asm, LINE 1830): UNDEFINED SYMBOL
                      25449     IF 1 == 1
00054F C3             25450             clr     C
000550 EA             25451             mov     A, Temp3
000551 13             25452             rrc     A
000552 FA             25453             mov     Temp3, A
000553 E9             25454             mov     A, Temp2
000554 13             25455             rrc     A
000555 F9             25456             mov     Temp2, A
000556 E8             25457             mov     A, Temp1
000557 13             25458             rrc     A
000558 F8             25459             mov     Temp1, A
                      25460     ENDIF
                      25461             ; Calculate this commutation time
000559 AB00       F   25462             mov     Temp4, Prev_Comm_L
00055B AC00       F   25463             mov     Temp5, Prev_Comm_H
00055D 8800       F   25464             mov     Prev_Comm_L, Temp1              ; Store timestamp as previous commutatio
                               n
00055F 8900       F   25465             mov     Prev_Comm_H, Temp2
000561 C3             25466             clr     C
000562 E8             25467             mov     A, Temp1
000563 9B             25468             subb    A, Temp4                                ; Calculate the new commutation 
                               time
000564 F8             25469             mov     Temp1, A
000565 E9             25470             mov     A, Temp2
000566 9C             25471             subb    A, Temp5
000567 20000A         25472             jb      Flags1.STARTUP_PHASE, calc_next_comm_startup
                      25473     
                      25474     IF 1 == 1
00056A 547F           25475             anl     A, #7Fh
                      25476     ENDIF
00056C F9             25477             mov     Temp2, A
00056D 300002         25478             jnb     Flags1.HIGH_RPM, ($+5)  ; Branch if high rpm
000570 0100       F   25479             ajmp    calc_next_comm_timing_fast
                      25480     
000572 0100       F   25481             ajmp    calc_next_comm_normal
                      25482     
000574                25483     calc_next_comm_startup:
000574 AD00       F   25484             mov     Temp6, Prev_Comm_X
000576 8A00       F   25485             mov     Prev_Comm_X, Temp3              ; Store extended timestamp as previous c
                               ommutation
000578 F9             25486             mov     Temp2, A
000579 EA             25487             mov     A, Temp3
00057A 9D             25488             subb    A, Temp6                                ; Calculate the new extended com
                               mutation time
                      25489     IF 1 == 1
00057B 547F           25490             anl     A, #7Fh
                      25491     ENDIF
00057D FA             25492             mov     Temp3, A
00057E 6006           25493             jz      calc_next_comm_startup_no_X
                      25494     
000580 78FF           25495             mov     Temp1, #0FFh
000582 79FF           25496             mov     Temp2, #0FFh
000584 0100       F   25497             ajmp    calc_next_comm_startup_average
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   419

                      25498     
000586                25499     calc_next_comm_startup_no_X:
000586 AE00       F   25500             mov     Temp7, Prev_Prev_Comm_L
000588 AF00       F   25501             mov     Temp8, Prev_Prev_Comm_H
00058A 8B00       F   25502             mov     Prev_Prev_Comm_L, Temp4
00058C 8C00       F   25503             mov     Prev_Prev_Comm_H, Temp5
00058E A800       F   25504             mov     Temp1, Prev_Comm_L              ; Reload this commutation time  
000590 A900       F   25505             mov     Temp2, Prev_Comm_H
000592 C3             25506             clr     C
000593 E8             25507             mov     A, Temp1
000594 9E             25508             subb    A, Temp7                                ; Calculate the new commutation 
                               time based upon the two last commutations (to reduce sensitivity to offset)
000595 F8             25509             mov     Temp1, A
000596 E9             25510             mov     A, Temp2
000597 9F             25511             subb    A, Temp8
000598 F9             25512             mov     Temp2, A
                      25513     
000599                25514     calc_next_comm_startup_average:
000599 C3             25515             clr     C
00059A E500       F   25516             mov     A, Comm_Period4x_H              ; Average with previous and save
00059C 13             25517             rrc     A
00059D FB             25518             mov     Temp4, A
00059E E500       F   25519             mov     A, Comm_Period4x_L
0005A0 13             25520             rrc     A
0005A1 FA             25521             mov     Temp3, A
0005A2 E8             25522             mov     A, Temp1                        
0005A3 2A             25523             add     A, Temp3
0005A4 F500       F   25524             mov     Comm_Period4x_L, A
0005A6 E9             25525             mov     A, Temp2
0005A7 3B             25526             addc    A, Temp4
0005A8 F500       F   25527             mov     Comm_Period4x_H, A
0005AA 5006           25528             jnc     ($+8)
                      25529     
0005AC 7500FF     F   25530             mov     Comm_Period4x_L, #0FFh
0005AF 7500FF     F   25531             mov     Comm_Period4x_H, #0FFh
                      25532     
0005B2 0100       F   25533             ajmp    calc_new_wait_times_setup
                      25534     
0005B4                25535     calc_next_comm_normal:
                      25536             ; Calculate new commutation time 
0005B4 AA00       F   25537             mov     Temp3, Comm_Period4x_L  ; Comm_Period4x(-l-h) holds the time of 4 commut
                               ations
0005B6 AB00       F   25538             mov     Temp4, Comm_Period4x_H
0005B8 AC00       F   25539             mov     Temp5, Comm_Period4x_L  ; Copy variables
0005BA AD00       F   25540             mov     Temp6, Comm_Period4x_H
0005BC 7E04           25541             mov     Temp7, #4                               ; Divide Comm_Period4x 4 times a
                               s default
0005BE 7F02           25542             mov     Temp8, #2                               ; Divide new commutation time 2 
                               times as default
0005C0 C3             25543             clr     C
0005C1 EB             25544             mov     A, Temp4
0005C2 9404           25545             subb    A, #04h
0005C4 400D           25546             jc      calc_next_comm_avg_period_div
                      25547     
0005C6 1E             25548             dec     Temp7                           ; Reduce averaging time constant for low
                                speeds
0005C7 1F             25549             dec     Temp8
                      25550     
0005C8 C3             25551             clr     C
0005C9 EB             25552             mov     A, Temp4
0005CA 9408           25553             subb    A, #08h
0005CC 4005           25554             jc      calc_next_comm_avg_period_div
                      25555     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   420

0005CE 200002         25556             jb      Flags1.INITIAL_RUN_PHASE, calc_next_comm_avg_period_div ; Do not average
                                very fast during initial run
                      25557     
0005D1 1E             25558             dec     Temp7                           ; Reduce averaging time constant more fo
                               r even lower speeds
0005D2 1F             25559             dec     Temp8
                      25560     
0005D3                25561     calc_next_comm_avg_period_div:
0005D3 C3             25562             clr     C
0005D4 ED             25563             mov     A, Temp6                                        
0005D5 13             25564             rrc     A                                       ; Divide by 2
0005D6 FD             25565             mov     Temp6, A        
0005D7 EC             25566             mov     A, Temp5                                
0005D8 13             25567             rrc     A
0005D9 FC             25568             mov     Temp5, A
0005DA DEF7           25569             djnz    Temp7, calc_next_comm_avg_period_div
                      25570     
0005DC C3             25571             clr     C
0005DD EA             25572             mov     A, Temp3
0005DE 9C             25573             subb    A, Temp5                                ; Subtract a fraction
0005DF FA             25574             mov     Temp3, A
0005E0 EB             25575             mov     A, Temp4
0005E1 9D             25576             subb    A, Temp6
0005E2 FB             25577             mov     Temp4, A
0005E3 EF             25578             mov     A, Temp8                                ; Divide new time
0005E4 6009           25579             jz      calc_next_comm_new_period_div_done
                      25580     
0005E6                25581     calc_next_comm_new_period_div:
0005E6 C3             25582             clr     C
0005E7 E9             25583             mov     A, Temp2                                        
0005E8 13             25584             rrc     A                                       ; Divide by 2
0005E9 F9             25585             mov     Temp2, A        
0005EA E8             25586             mov     A, Temp1                                
0005EB 13             25587             rrc     A
0005EC F8             25588             mov     Temp1, A
0005ED DFF7           25589             djnz    Temp8, calc_next_comm_new_period_div
                      25590     
0005EF                25591     calc_next_comm_new_period_div_done:
0005EF EA             25592             mov     A, Temp3
0005F0 28             25593             add     A, Temp1                                ; Add the divided new time
0005F1 FA             25594             mov     Temp3, A
0005F2 EB             25595             mov     A, Temp4
0005F3 39             25596             addc    A, Temp2
0005F4 FB             25597             mov     Temp4, A
0005F5 8A00       F   25598             mov     Comm_Period4x_L, Temp3  ; Store Comm_Period4x_X
0005F7 8B00       F   25599             mov     Comm_Period4x_H, Temp4
0005F9 5006           25600             jnc     calc_new_wait_times_setup; If period larger than 0xffff - go to slow cas
                               e
                      25601     
0005FB 7BFF           25602             mov     Temp4, #0FFh
0005FD 8B00       F   25603             mov     Comm_Period4x_L, Temp4  ; Set commutation period registers to very slow 
                               timing (0xffff)
0005FF 8B00       F   25604             mov     Comm_Period4x_H, Temp4
                      25605     
000601                25606     calc_new_wait_times_setup:      
                      25607             ; Set high rpm bit (if above 156k erpm)
000601 C3             25608             clr     C
000602 EB             25609             mov     A, Temp4
000603 9402           25610             subb    A, #2
000605 5002           25611             jnc     ($+4)
                      25612     
000607 D200       F   25613             setb    Flags1.HIGH_RPM                 ; Set high rpm bit
                      25614             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   421

                      25615             ; Load programmed commutation timing
000609 300004         25616             jnb     Flags1.STARTUP_PHASE, calc_new_wait_per_startup_done    ; Set dedicated 
                               timing during startup
                      25617     
00060C 7F03           25618             mov     Temp8, #3
00060E 0100       F   25619             ajmp    calc_new_wait_per_demag_done
                      25620     
000610                25621     calc_new_wait_per_startup_done:
000610 7800       F   25622             mov     Temp1, #Pgm_Comm_Timing ; Load timing setting
000612 E6             25623             mov     A, @Temp1                               
000613 FF             25624             mov     Temp8, A                                ; Store in Temp8
000614 C3             25625             clr     C
000615 E500       F   25626             mov     A, Demag_Detected_Metric        ; Check demag metric
000617 9482           25627             subb    A, #130
000619 4011           25628             jc      calc_new_wait_per_demag_done
                      25629     
00061B 0F             25630             inc     Temp8                           ; Increase timing
                      25631     
00061C C3             25632             clr     C
00061D E500       F   25633             mov     A, Demag_Detected_Metric
00061F 94A0           25634             subb    A, #160
000621 4001           25635             jc      ($+3)
                      25636     
000623 0F             25637             inc     Temp8                           ; Increase timing again
                      25638     
000624 C3             25639             clr     C
000625 EF             25640             mov     A, Temp8                                ; Limit timing to max
000626 9406           25641             subb    A, #6
000628 4002           25642             jc      ($+4)
                      25643     
00062A 7F05           25644             mov     Temp8, #5                               ; Set timing to max
                      25645     
00062C                25646     calc_new_wait_per_demag_done:
                      25647             ; Set timing reduction
00062C 7E02           25648             mov     Temp7, #2
                      25649             ; Load current commutation timing
00062E E500       F   25650             mov     A, Comm_Period4x_H              ; Divide 4 times
000630 C4             25651             swap    A
000631 540F           25652             anl     A, #00Fh
000633 F9             25653             mov     Temp2, A
000634 E500       F   25654             mov     A, Comm_Period4x_H
000636 C4             25655             swap    A
000637 54F0           25656             anl     A, #0F0h
000639 F8             25657             mov     Temp1, A
00063A E500       F   25658             mov     A, Comm_Period4x_L
00063C C4             25659             swap    A
00063D 540F           25660             anl     A, #00Fh
00063F 28             25661             add     A, Temp1
000640 F8             25662             mov     Temp1, A
                      25663     
000641 C3             25664             clr     C
000642 E8             25665             mov     A, Temp1
000643 9E             25666             subb    A, Temp7
000644 FA             25667             mov     Temp3, A
000645 E9             25668             mov     A, Temp2                                
000646 9400           25669             subb    A, #0
000648 FB             25670             mov     Temp4, A
000649 4009           25671             jc      load_min_time                   ; Check that result is still positive
                      25672     
00064B C3             25673             clr     C
00064C EA             25674             mov     A, Temp3
00064D 9401           25675             subb    A, #1
00064F EB             25676             mov     A, Temp4                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   422

000650 9400           25677             subb    A, #0
000652 5004           25678             jnc     calc_new_wait_times_exit        ; Check that result is still above minum
                               um
                      25679     
000654                25680     load_min_time:
000654 7A01           25681             mov     Temp3, #1
000656 E4             25682             clr     A
000657 FB             25683             mov     Temp4, A 
                      25684     
000658                25685     calc_new_wait_times_exit:       
000658 020000     F   25686             ljmp    wait_advance_timing
                      25687     
                      25688     
                      25689     ; Fast calculation (Comm_Period4x_H less than 2)
00065B                25690     calc_next_comm_timing_fast:                     
                      25691             ; Calculate new commutation time
00065B AA00       F   25692             mov     Temp3, Comm_Period4x_L  ; Comm_Period4x(-l-h) holds the time of 4 commut
                               ations
00065D AB00       F   25693             mov     Temp4, Comm_Period4x_H
00065F EB             25694             mov     A, Temp4                                ; Divide by 2 4 times
000660 C4             25695             swap    A
000661 FE             25696             mov     Temp7, A
000662 EA             25697             mov     A, Temp3
000663 C4             25698             swap A
000664 540F           25699             anl     A, #0Fh
000666 4E             25700             orl     A, Temp7
000667 FC             25701             mov     Temp5, A
000668 C3             25702             clr     C
000669 EA             25703             mov     A, Temp3                                ; Subtract a fraction
00066A 9C             25704             subb    A, Temp5
00066B FA             25705             mov     Temp3, A
00066C EB             25706             mov     A, Temp4                                
00066D 9400           25707             subb    A, #0
00066F FB             25708             mov     Temp4, A
000670 C3             25709             clr     C
000671 E8             25710             mov     A, Temp1
000672 13             25711             rrc     A                                       ; Divide by 2 2 times
000673 C3             25712             clr     C
000674 13             25713             rrc     A
000675 F8             25714             mov     Temp1, A
000676 EA             25715             mov     A, Temp3                                ; Add the divided new time
000677 28             25716             add     A, Temp1
000678 FA             25717             mov     Temp3, A
000679 EB             25718             mov     A, Temp4
00067A 3400           25719             addc    A, #0
00067C FB             25720             mov     Temp4, A
00067D 8A00       F   25721             mov     Comm_Period4x_L, Temp3  ; Store Comm_Period4x_X
00067F 8B00       F   25722             mov     Comm_Period4x_H, Temp4
000681 C3             25723             clr     C
000682 EB             25724             mov     A, Temp4                                ; If erpm below 156k - go to nor
                               mal case
000683 9402           25725             subb    A, #2
000685 4002           25726             jc      ($+4)
                      25727     
000687 C200       F   25728             clr     Flags1.HIGH_RPM                 ; Clear high rpm bit
                      25729     
                      25730             ; Set timing reduction
000689 7802           25731             mov     Temp1, #2
00068B EB             25732             mov     A, Temp4                                ; Divide by 2 4 times
00068C C4             25733             swap    A
00068D FE             25734             mov     Temp7, A
00068E 7B00           25735             mov     Temp4, #0
000690 EA             25736             mov     A, Temp3
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   423

000691 C4             25737             swap A
000692 540F           25738             anl     A, #0Fh
000694 4E             25739             orl     A, Temp7
000695 FA             25740             mov     Temp3, A
000696 C3             25741             clr     C
000697 EA             25742             mov     A, Temp3
000698 98             25743             subb    A, Temp1
000699 FA             25744             mov     Temp3, A
00069A 4005           25745             jc      load_min_time_fast              ; Check that result is still positive
                      25746     
00069C C3             25747             clr     C
00069D 9401           25748             subb    A, #1
00069F 5002           25749             jnc     calc_new_wait_times_fast_done   ; Check that result is still above minum
                               um
                      25750     
0006A1                25751     load_min_time_fast:
0006A1 7A01           25752             mov     Temp3, #1
                      25753     
0006A3                25754     calc_new_wait_times_fast_done:  
0006A3 7800       F   25755             mov     Temp1, #Pgm_Comm_Timing ; Load timing setting
0006A5 E6             25756             mov     A, @Temp1                               
0006A6 FF             25757             mov     Temp8, A                                ; Store in Temp8
                      25758     
                      25759     
                      25760     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25761     ;
                      25762     ; Wait advance timing routine
                      25763     ;
                      25764     ; No assumptions
                      25765     ; NOTE: Be VERY careful if using temp registers. They are passed over this routine
                      25766     ;
                      25767     ; Waits for the advance timing to elapse and sets up the next zero cross wait
                      25768     ;
                      25769     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0006A7                25770     wait_advance_timing:    
0006A7 300002         25771             jnb     Flags0.T3_PENDING, ($+5)
0006AA 0100       F   25772             ajmp    wait_advance_timing
                      25773     
                      25774             ; Setup next wait time
0006AC                25775             mov     TMR3RLL, Wt_ZC_Tout_Start_L
*** ____________________________________________^
*** ERROR #A45 IN 25775 (BLHeli_S.asm, LINE 2157): UNDEFINED SYMBOL
0006AF                25776             mov     TMR3RLH, Wt_ZC_Tout_Start_H
*** ____________________________________________^
*** ERROR #A45 IN 25776 (BLHeli_S.asm, LINE 2158): UNDEFINED SYMBOL
0006B2 D200       F   25777             setb    Flags0.T3_PENDING
0006B4                25778             orl     EIE1, #80h      ; Enable timer 3 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 25778 (BLHeli_S.asm, LINE 2160): UNDEFINED SYMBOL
                      25779     
                      25780     
                      25781     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25782     ;
                      25783     ; Calculate new wait times routine
                      25784     ;
                      25785     ; No assumptions
                      25786     ;
                      25787     ; Calculates new wait times
                      25788     ;
                      25789     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0006B7                25790     calc_new_wait_times:    
0006B7 C3             25791             clr     C
0006B8 E4             25792             clr     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   424

0006B9 9A             25793             subb    A, Temp3                                ; Negate
0006BA F8             25794             mov     Temp1, A        
0006BB E4             25795             clr     A
0006BC 9B             25796             subb    A, Temp4                                
0006BD F9             25797             mov     Temp2, A        
                      25798     IF 1 == 1
0006BE C3             25799             clr     C
0006BF E8             25800             mov     A, Temp1                                ; Multiply by 2
0006C0 33             25801             rlc     A
0006C1 F8             25802             mov     Temp1, A
0006C2 E9             25803             mov     A, Temp2
0006C3 33             25804             rlc     A
0006C4 F9             25805             mov     Temp2, A
                      25806     ENDIF
0006C5 300003         25807             jnb     Flags1.HIGH_RPM, ($+6)  ; Branch if high rpm
0006C8 020000     F   25808             ljmp    calc_new_wait_times_fast
                      25809     
0006CB E8             25810             mov     A, Temp1                                ; Copy values
0006CC FA             25811             mov     Temp3, A
0006CD E9             25812             mov     A, Temp2
0006CE FB             25813             mov     Temp4, A
0006CF D3             25814             setb    C                                       ; Negative numbers - set carry
0006D0 E9             25815             mov     A, Temp2                                
0006D1 13             25816             rrc     A                                       ; Divide by 2
0006D2 FD             25817             mov     Temp6, A
0006D3 E8             25818             mov     A, Temp1
0006D4 13             25819             rrc     A
0006D5 FC             25820             mov     Temp5, A
0006D6 8800       F   25821             mov     Wt_Zc_Tout_Start_L, Temp1; Set 15deg time for zero cross scan timeout
0006D8 8900       F   25822             mov     Wt_Zc_Tout_Start_H, Temp2
0006DA C3             25823             clr     C
0006DB EF             25824             mov     A, Temp8                                ; (Temp8 has Pgm_Comm_Timing)
0006DC 9403           25825             subb    A, #3                           ; Is timing normal?
0006DE 6038           25826             jz      store_times_decrease    ; Yes - branch
                      25827     
0006E0 EF             25828             mov     A, Temp8                                
0006E1 20E00C         25829             jb      ACC.0, adjust_timing_two_steps  ; If an odd number - branch
                      25830     
0006E4 E8             25831             mov     A, Temp1                                ; Add 7.5deg and store in Temp1/
                               2
0006E5 2C             25832             add     A, Temp5
0006E6 F8             25833             mov     Temp1, A
0006E7 E9             25834             mov     A, Temp2
0006E8 3D             25835             addc    A, Temp6
0006E9 F9             25836             mov     Temp2, A
0006EA EC             25837             mov     A, Temp5                                ; Store 7.5deg in Temp3/4
0006EB FA             25838             mov     Temp3, A
0006EC ED             25839             mov     A, Temp6                        
0006ED FB             25840             mov     Temp4, A
0006EE 8013           25841             jmp     store_times_up_or_down
                      25842     
0006F0                25843     adjust_timing_two_steps:
0006F0 E8             25844             mov     A, Temp1                                ; Add 15deg and store in Temp1/2
0006F1 28             25845             add     A, Temp1
0006F2 F8             25846             mov     Temp1, A
0006F3 E9             25847             mov     A, Temp2
0006F4 39             25848             addc    A, Temp2
0006F5 F9             25849             mov     Temp2, A
0006F6 C3             25850             clr     C
0006F7 E8             25851             mov     A, Temp1
0006F8 2401           25852             add     A, #1
0006FA F8             25853             mov     Temp1, A
0006FB E9             25854             mov     A, Temp2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   425

0006FC 3400           25855             addc    A, #0
0006FE F9             25856             mov     Temp2, A
0006FF 7AFF           25857             mov     Temp3, #-1                              ; Store minimum time in Temp3/4
000701 7BFF           25858             mov     Temp4, #0FFh
                      25859     
000703                25860     store_times_up_or_down:
000703 C3             25861             clr     C
000704 EF             25862             mov     A, Temp8                                
000705 9403           25863             subb    A, #3                                   ; Is timing higher than normal?
000707 400F           25864             jc      store_times_decrease            ; No - branch
                      25865     
000709                25866     store_times_increase:
000709 8A00       F   25867             mov     Wt_Comm_Start_L, Temp3          ; Now commutation time (~60deg) divided 
                               by 4 (~15deg nominal)
00070B 8B00       F   25868             mov     Wt_Comm_Start_H, Temp4
00070D 8800       F   25869             mov     Wt_Adv_Start_L, Temp1           ; New commutation advance time (~15deg n
                               ominal)
00070F 8900       F   25870             mov     Wt_Adv_Start_H, Temp2
000711 8C00       F   25871             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan del
                               ay (7.5deg)
000713 8D00       F   25872             mov     Wt_Zc_Scan_Start_H, Temp6
000715 020000     F   25873             ljmp    wait_before_zc_scan
                      25874     
000718                25875     store_times_decrease:
000718 8800       F   25876             mov     Wt_Comm_Start_L, Temp1          ; Now commutation time (~60deg) divided 
                               by 4 (~15deg nominal)
00071A 8900       F   25877             mov     Wt_Comm_Start_H, Temp2
00071C 8A00       F   25878             mov     Wt_Adv_Start_L, Temp3           ; New commutation advance time (~15deg n
                               ominal)
00071E 8B00       F   25879             mov     Wt_Adv_Start_H, Temp4
000720 8C00       F   25880             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan del
                               ay (7.5deg)
000722 8D00       F   25881             mov     Wt_Zc_Scan_Start_H, Temp6
000724 300012         25882             jnb     Flags1.STARTUP_PHASE, store_times_exit
                      25883     
000727 7500F0     F   25884             mov     Wt_Comm_Start_L, #0F0h          ; Set very short delays for all but adva
                               nce time during startup, in order to widen zero cross capture range
00072A 7500FF     F   25885             mov     Wt_Comm_Start_H, #0FFh
00072D 7500F0     F   25886             mov     Wt_Zc_Scan_Start_L, #0F0h
000730 7500FF     F   25887             mov     Wt_Zc_Scan_Start_H, #0FFh
000733 7500F0     F   25888             mov     Wt_Zc_Tout_Start_L, #0F0h
000736 7500FF     F   25889             mov     Wt_Zc_Tout_Start_H, #0FFh
                      25890     
000739                25891     store_times_exit:
000739 020000     F   25892             ljmp    wait_before_zc_scan
                      25893     
                      25894     
00073C                25895     calc_new_wait_times_fast:       
00073C E8             25896             mov     A, Temp1                                ; Copy values
00073D FA             25897             mov     Temp3, A
00073E D3             25898             setb    C                                       ; Negative numbers - set carry
00073F E8             25899             mov     A, Temp1                                ; Divide by 2
000740 13             25900             rrc     A
000741 FC             25901             mov     Temp5, A
000742 8800       F   25902             mov     Wt_Zc_Tout_Start_L, Temp1; Set 15deg time for zero cross scan timeout
000744 C3             25903             clr     C
000745 EF             25904             mov     A, Temp8                                ; (Temp8 has Pgm_Comm_Timing)
000746 9403           25905             subb    A, #3                           ; Is timing normal?
000748 6021           25906             jz      store_times_decrease_fast; Yes - branch
                      25907     
00074A EF             25908             mov     A, Temp8                                
00074B 20E007         25909             jb      ACC.0, adjust_timing_two_steps_fast     ; If an odd number - branch
                      25910     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   426

00074E E8             25911             mov     A, Temp1                                ; Add 7.5deg and store in Temp1
00074F 2C             25912             add     A, Temp5
000750 F8             25913             mov     Temp1, A
000751 EC             25914             mov     A, Temp5                                ; Store 7.5deg in Temp3
000752 FA             25915             mov     Temp3, A
000753 0100       F   25916             ajmp    store_times_up_or_down_fast
                      25917     
000755                25918     adjust_timing_two_steps_fast:
000755 E8             25919             mov     A, Temp1                                ; Add 15deg and store in Temp1
000756 28             25920             add     A, Temp1
000757 2401           25921             add     A, #1
000759 F8             25922             mov     Temp1, A
00075A 7AFF           25923             mov     Temp3, #-1                      ; Store minimum time in Temp3
                      25924     
00075C                25925     store_times_up_or_down_fast:
00075C C3             25926             clr     C
00075D EF             25927             mov     A, Temp8                                
00075E 9403           25928             subb    A, #3                           ; Is timing higher than normal?
000760 4009           25929             jc      store_times_decrease_fast; No - branch
                      25930     
000762                25931     store_times_increase_fast:
000762 8A00       F   25932             mov     Wt_Comm_Start_L, Temp3          ; Now commutation time (~60deg) divided 
                               by 4 (~15deg nominal)
000764 8800       F   25933             mov     Wt_Adv_Start_L, Temp1           ; New commutation advance time (~15deg n
                               ominal)
000766 8C00       F   25934             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan del
                               ay (7.5deg)
000768 020000     F   25935             ljmp    wait_before_zc_scan
                      25936     
00076B                25937     store_times_decrease_fast:
00076B 8800       F   25938             mov     Wt_Comm_Start_L, Temp1          ; Now commutation time (~60deg) divided 
                               by 4 (~15deg nominal)
00076D 8A00       F   25939             mov     Wt_Adv_Start_L, Temp3           ; New commutation advance time (~15deg n
                               ominal)
00076F 8C00       F   25940             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan del
                               ay (7.5deg)
                      25941     
                      25942     
                      25943     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25944     ;
                      25945     ; Wait before zero cross scan routine
                      25946     ;
                      25947     ; No assumptions
                      25948     ;
                      25949     ; Waits for the zero cross scan wait time to elapse
                      25950     ; Also sets up timer 3 for the zero cross scan timeout time
                      25951     ;
                      25952     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000771                25953     wait_before_zc_scan:    
000771 300002         25954             jnb     Flags0.T3_PENDING, ($+5)
000774 0100       F   25955             ajmp    wait_before_zc_scan
                      25956     
000776 750002     F   25957             mov     Startup_Zc_Timeout_Cntd, #2
000779                25958     setup_zc_scan_timeout:
000779 D200       F   25959             setb    Flags0.T3_PENDING
00077B                25960             orl     EIE1, #80h                      ; Enable timer 3 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 25960 (BLHeli_S.asm, LINE 2342): UNDEFINED SYMBOL
00077E E500       F   25961             mov     A, Flags1
000780 5403           25962             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
000782 602D           25963             jz      wait_before_zc_scan_exit                
                      25964     
000784 A800       F   25965             mov     Temp1, Comm_Period4x_L  ; Set long timeout when starting
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   427

000786 A900       F   25966             mov     Temp2, Comm_Period4x_H
000788 C3             25967             clr     C
000789 E9             25968             mov     A, Temp2
00078A 13             25969             rrc     A
00078B F9             25970             mov     Temp2, A
00078C E8             25971             mov     A, Temp1
00078D 13             25972             rrc     A
00078E F8             25973             mov     Temp1, A
                      25974     IF 1 == 0
                                        clr     C
                                        mov     A, Temp2
                                        rrc     A
                                        mov     Temp2, A
                                        mov     A, Temp1
                                        rrc     A
                                        mov     Temp1, A
                                ENDIF
00078F 300004         25983             jnb     Flags1.STARTUP_PHASE, setup_zc_scan_timeout_startup_done
                      25984     
000792 E9             25985             mov     A, Temp2
000793 2440           25986             add     A, #40h                         ; Increase timeout somewhat to avoid fal
                               se wind up
000795 F9             25987             mov     Temp2, A
                      25988     
000796                25989     setup_zc_scan_timeout_startup_done:
000796                25990             clr     IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 25990 (BLHeli_S.asm, LINE 2372): UNDEFINED SYMBOL
000798                25991             anl     EIE1, #7Fh                      ; Disable timer 3 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 25991 (BLHeli_S.asm, LINE 2373): UNDEFINED SYMBOL
00079B                25992             mov     TMR3CN0, #00h                   ; Timer 3 disabled and interrupt flag cl
                               eared
*** ____________________________________________^
*** ERROR #A45 IN 25992 (BLHeli_S.asm, LINE 2374): UNDEFINED SYMBOL
00079E C3             25993             clr     C
00079F E4             25994             clr     A
0007A0 98             25995             subb    A, Temp1                                ; Set timeout
0007A1                25996             mov     TMR3L, A
*** ____________________________________________^
*** ERROR #A45 IN 25996 (BLHeli_S.asm, LINE 2378): UNDEFINED SYMBOL
0007A3 E4             25997             clr     A
0007A4 99             25998             subb    A, Temp2                
0007A5                25999             mov     TMR3H, A
*** ____________________________________________^
*** ERROR #A45 IN 25999 (BLHeli_S.asm, LINE 2381): UNDEFINED SYMBOL
0007A7                26000             mov     TMR3CN0, #04h                   ; Timer 3 enabled and interrupt flag cle
                               ared
*** ____________________________________________^
*** ERROR #A45 IN 26000 (BLHeli_S.asm, LINE 2382): UNDEFINED SYMBOL
0007AA D200       F   26001             setb    Flags0.T3_PENDING
0007AC                26002             orl     EIE1, #80h                      ; Enable timer 3 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 26002 (BLHeli_S.asm, LINE 2384): UNDEFINED SYMBOL
0007AF                26003             setb    IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 26003 (BLHeli_S.asm, LINE 2385): UNDEFINED SYMBOL
                      26004     
0007B1                26005     wait_before_zc_scan_exit:          
0007B1 22             26006             ret
                      26007     
                      26008     
                      26009     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   428

                      26010     ;
                      26011     ; Wait for comparator to go low/high routines
                      26012     ;
                      26013     ; No assumptions
                      26014     ;
                      26015     ; Waits for the zero cross scan wait time to elapse
                      26016     ; Then scans for comparator going low/high
                      26017     ;
                      26018     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0007B2                26019     wait_for_comp_out_low:
0007B2 D200       F   26020             setb    Flags0.DEMAG_DETECTED           ; Set demag detected flag as default
0007B4 750000     F   26021             mov     Comparator_Read_Cnt, #0         ; Reset number of comparator reads
0007B7 750000     F   26022             mov     Bit_Access, #00h                        ; Desired comparator output
0007BA 300003         26023             jnb     Flags1.DIR_CHANGE_BRAKE, ($+6)
0007BD 750040     F   26024             mov     Bit_Access, #40h                
0007C0 0100       F   26025             ajmp    wait_for_comp_out_start
                      26026     
0007C2                26027     wait_for_comp_out_high:
0007C2 D200       F   26028             setb    Flags0.DEMAG_DETECTED           ; Set demag detected flag as default
0007C4 750000     F   26029             mov     Comparator_Read_Cnt, #0         ; Reset number of comparator reads
0007C7 750040     F   26030             mov     Bit_Access, #40h                        ; Desired comparator output
0007CA 300003         26031             jnb     Flags1.DIR_CHANGE_BRAKE, ($+6)
0007CD 750000     F   26032             mov     Bit_Access, #00h                
                      26033     
0007D0                26034     wait_for_comp_out_start:
                      26035             ; Set number of comparator readings
0007D0 7801           26036             mov     Temp1, #1                                       ; Number of OK readings 
                               required
0007D2 7901           26037             mov     Temp2, #1                                       ; Max number of readings
                                required
0007D4 200020         26038             jb      Flags1.HIGH_RPM, comp_scale_samples     ; Branch if high rpm
                      26039     
0007D7 E500       F   26040             mov     A, Flags1                                       ; Clear demag detected f
                               lag if start phases
0007D9 5403           26041             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
0007DB 6002           26042             jz      ($+4)
                      26043                     
0007DD C200       F   26044             clr     Flags0.DEMAG_DETECTED
                      26045     
0007DF 7914           26046             mov     Temp2, #20                              ; Too low value (~<15) causes ro
                               ugh running at pwm harmonics. Too high a value (~>35) causes the RCT4215 630 to run rough on full throttle
0007E1 E500       F   26047             mov     A, Comm_Period4x_H                      ; Set number of readings higher 
                               for lower speeds
0007E3 C3             26048             clr     C
0007E4 13             26049             rrc     A
0007E5 7001           26050             jnz     ($+3)
0007E7 04             26051             inc     A
0007E8 F8             26052             mov     Temp1, A
0007E9 C3             26053             clr     C                                               
0007EA 9414           26054             subb    A, #20
0007EC 4002           26055             jc      ($+4)
                      26056     
0007EE 7814           26057             mov     Temp1, #20
                      26058             
0007F0 300004         26059             jnb     Flags1.STARTUP_PHASE, comp_scale_samples
                      26060     
0007F3 781B           26061             mov     Temp1, #27                              ; Set many samples during startu
                               p, approximately one pwm period
0007F5 791B           26062             mov     Temp2, #27
                      26063     
0007F7                26064     comp_scale_samples:
                      26065     IF 1 == 1
0007F7 C3             26066             clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   429

0007F8 E8             26067             mov     A, Temp1
0007F9 33             26068             rlc     A
0007FA F8             26069             mov     Temp1, A
0007FB C3             26070             clr     C
0007FC E9             26071             mov     A, Temp2
0007FD 33             26072             rlc     A
0007FE F9             26073             mov     Temp2, A
                      26074     ENDIF
0007FF                26075     comp_check_timeout:
0007FF 200011         26076             jb      Flags0.T3_PENDING, comp_check_timeout_not_timed_out             ; Has ze
                               ro cross scan timeout elapsed?
                      26077     
000802 E500       F   26078             mov     A, Comparator_Read_Cnt                  ; Check that comparator has been
                                read
000804 600D           26079             jz      comp_check_timeout_not_timed_out        ; If not read - branch
                      26080     
000806 300003         26081             jnb     Flags1.STARTUP_PHASE, comp_check_timeout_timeout_extended       ; Extend
                                timeout during startup
                      26082     
000809 D50004         26083             djnz    Startup_Zc_Timeout_Cntd, comp_check_timeout_extend_timeout
                      26084     
00080C                26085     comp_check_timeout_timeout_extended:
00080C D200       F   26086             setb    Flags0.COMP_TIMED_OUT
00080E 0100       F   26087             ajmp    setup_comm_wait
                      26088     
000810                26089     comp_check_timeout_extend_timeout:
000810 120000     F   26090             call    setup_zc_scan_timeout
000813                26091     comp_check_timeout_not_timed_out:
000813 0500       F   26092             inc     Comparator_Read_Cnt                     ; Increment comparator read coun
                               t
                      26093             Read_Comp_Out                                   ; Read comparator output
*** ____________________________________^
*** ERROR #A9 IN 26093 (BLHeli_S.asm, LINE 2475): SYNTAX ERROR
000815 5440           26094             anl     A, #40h
000817 B50002         26095             cjne    A, Bit_Access, comp_read_wrong
00081A 0100       F   26096             ajmp    comp_read_ok
                      26097             
00081C                26098     comp_read_wrong:
00081C 300009         26099             jnb     Flags1.STARTUP_PHASE, comp_read_wrong_not_startup
                      26100     
00081F 08             26101             inc     Temp1                                   ; Increment number of OK reading
                               s required
000820 C3             26102             clr     C
000821 E8             26103             mov     A, Temp1
000822 99             26104             subb    A, Temp2                                        ; If above initial requi
                               rement - do not increment further
000823 4001           26105             jc      ($+3)
000825 18             26106             dec     Temp1
                      26107     
000826 0100       F   26108             ajmp    comp_check_timeout                      ; Continue to look for good ones
                      26109     
000828                26110     comp_read_wrong_not_startup:
000828 20000A         26111             jb      Flags0.DEMAG_DETECTED, comp_read_wrong_extend_timeout
                      26112     
00082B 08             26113             inc     Temp1                                   ; Increment number of OK reading
                               s required
00082C C3             26114             clr     C
00082D E8             26115             mov     A, Temp1
00082E 99             26116             subb    A, Temp2                                        
00082F 4002           26117             jc      ($+4)
000831 0100       F   26118             ajmp    wait_for_comp_out_start         ; If above initial requirement - go back
                                and restart
                      26119     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   430

000833 0100       F   26120             ajmp    comp_check_timeout                      ; Otherwise - take another readi
                               ng
                      26121     
000835                26122     comp_read_wrong_extend_timeout:
000835 C200       F   26123             clr     Flags0.DEMAG_DETECTED           ; Clear demag detected flag
000837                26124             anl     EIE1, #7Fh                              ; Disable timer 3 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 26124 (BLHeli_S.asm, LINE 2506): UNDEFINED SYMBOL
00083A                26125             mov     TMR3CN0, #00h                           ; Timer 3 disabled and interrupt
                                flag cleared
*** ____________________________________________^
*** ERROR #A45 IN 26125 (BLHeli_S.asm, LINE 2507): UNDEFINED SYMBOL
00083D 300011         26126             jnb     Flags1.HIGH_RPM, comp_read_wrong_low_rpm        ; Branch if not high rpm
                      26127     
000840                26128             mov     TMR3L, #00h                             ; Set timeout to ~1ms
*** ____________________________________________^
*** ERROR #A45 IN 26128 (BLHeli_S.asm, LINE 2510): UNDEFINED SYMBOL
                      26129     IF 1 == 1
000843                26130             mov     TMR3H, #0F0h
*** ____________________________________________^
*** ERROR #A45 IN 26130 (BLHeli_S.asm, LINE 2512): UNDEFINED SYMBOL
                      26131     ELSE
                                        mov     TMR3H, #0F8h
                                ENDIF
000846                26134     comp_read_wrong_timeout_set:
000846                26135             mov     TMR3CN0, #04h                           ; Timer 3 enabled and interrupt 
                               flag cleared
*** ____________________________________________^
*** ERROR #A45 IN 26135 (BLHeli_S.asm, LINE 2517): UNDEFINED SYMBOL
000849 D200       F   26136             setb    Flags0.T3_PENDING
00084B                26137             orl     EIE1, #80h                              ; Enable timer 3 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 26137 (BLHeli_S.asm, LINE 2519): UNDEFINED SYMBOL
00084E 020000     F   26138             ljmp    wait_for_comp_out_start         ; If comparator output is not correct - 
                               go back and restart
                      26139     
000851                26140     comp_read_wrong_low_rpm:
000851 E500       F   26141             mov     A, Comm_Period4x_H                      ; Set timeout to ~4x comm period
                                4x value
000853 7EFF           26142             mov     Temp7, #0FFh                            ; Default to long
                      26143     IF 1 == 1
000855 C3             26144             clr     C
000856 33             26145             rlc     A
000857 4009           26146             jc      comp_read_wrong_load_timeout
                      26147     
                      26148     ENDIF
000859 C3             26149             clr     C
00085A 33             26150             rlc     A
00085B 4005           26151             jc      comp_read_wrong_load_timeout
                      26152     
00085D C3             26153             clr     C
00085E 33             26154             rlc     A
00085F 4001           26155             jc      comp_read_wrong_load_timeout
                      26156     
000861 FE             26157             mov     Temp7, A
                      26158     
000862                26159     comp_read_wrong_load_timeout:
000862 C3             26160             clr     C
000863 E4             26161             clr     A
000864 9E             26162             subb    A, Temp7
000865                26163             mov     TMR3L, #0
*** ____________________________________________^
*** ERROR #A45 IN 26163 (BLHeli_S.asm, LINE 2545): UNDEFINED SYMBOL
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   431

000868                26164             mov     TMR3H, A
*** ____________________________________________^
*** ERROR #A45 IN 26164 (BLHeli_S.asm, LINE 2546): UNDEFINED SYMBOL
00086A 0100       F   26165             ajmp    comp_read_wrong_timeout_set
                      26166     
00086C                26167     comp_read_ok:
00086C C3             26168             clr     C
00086D E500       F   26169             mov     A, Startup_Cnt                          ; Force a timeout for the first 
                               commutation
00086F 9401           26170             subb    A, #1
000871 5002           26171             jnc     ($+4)
000873 0100       F   26172             ajmp    wait_for_comp_out_start
                      26173     
000875 300002         26174             jnb     Flags0.DEMAG_DETECTED, ($+5)    ; Do not accept correct comparator outpu
                               t if it is demag
000878 0100       F   26175             ajmp    wait_for_comp_out_start
                      26176     
00087A D802           26177             djnz    Temp1, comp_read_ok_jmp         ; Decrement readings counter - repeat co
                               mparator reading if not zero
00087C 0100       F   26178             ajmp    ($+4)
                      26179     
00087E                26180     comp_read_ok_jmp:
00087E 0100       F   26181             ajmp    comp_check_timeout
                      26182     
000880 C200       F   26183             clr     Flags0.COMP_TIMED_OUT
                      26184     
                      26185     
                      26186     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26187     ;
                      26188     ; Setup commutation timing routine
                      26189     ;
                      26190     ; No assumptions
                      26191     ;
                      26192     ; Sets up and starts wait from commutation to zero cross
                      26193     ;
                      26194     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000882                26195     setup_comm_wait:
000882                26196             clr     IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 26196 (BLHeli_S.asm, LINE 2578): UNDEFINED SYMBOL
000884                26197             anl     EIE1, #7Fh              ; Disable timer 3 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 26197 (BLHeli_S.asm, LINE 2579): UNDEFINED SYMBOL
000887                26198             mov     TMR3CN0, #00h           ; Timer 3 disabled and interrupt flag cleared
*** ____________________________________________^
*** ERROR #A45 IN 26198 (BLHeli_S.asm, LINE 2580): UNDEFINED SYMBOL
00088A                26199             mov     TMR3L, Wt_Comm_Start_L
*** ____________________________________________^
*** ERROR #A45 IN 26199 (BLHeli_S.asm, LINE 2581): UNDEFINED SYMBOL
00088D                26200             mov     TMR3H, Wt_Comm_Start_H
*** ____________________________________________^
*** ERROR #A45 IN 26200 (BLHeli_S.asm, LINE 2582): UNDEFINED SYMBOL
000890                26201             mov     TMR3CN0, #04h           ; Timer 3 enabled and interrupt flag cleared
*** ____________________________________________^
*** ERROR #A45 IN 26201 (BLHeli_S.asm, LINE 2583): UNDEFINED SYMBOL
                      26202             ; Setup next wait time
000893                26203             mov     TMR3RLL, Wt_Adv_Start_L
*** ____________________________________________^
*** ERROR #A45 IN 26203 (BLHeli_S.asm, LINE 2585): UNDEFINED SYMBOL
000896                26204             mov     TMR3RLH, Wt_Adv_Start_H
*** ____________________________________________^
*** ERROR #A45 IN 26204 (BLHeli_S.asm, LINE 2586): UNDEFINED SYMBOL
000899 D200       F   26205             setb    Flags0.T3_PENDING
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   432

00089B                26206             orl     EIE1, #80h              ; Enable timer 3 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 26206 (BLHeli_S.asm, LINE 2588): UNDEFINED SYMBOL
00089E                26207             setb    IE_EA                   ; Enable interrupts again
*** ____________________________________________^
*** ERROR #A45 IN 26207 (BLHeli_S.asm, LINE 2589): UNDEFINED SYMBOL
                      26208     
                      26209     
                      26210     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26211     ;
                      26212     ; Evaluate comparator integrity
                      26213     ;
                      26214     ; No assumptions
                      26215     ;
                      26216     ; Checks comparator signal behaviour versus expected behaviour
                      26217     ;
                      26218     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0008A0                26219     evaluate_comparator_integrity:
0008A0 E500       F   26220             mov     A, Flags1
0008A2 5403           26221             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
0008A4 6007           26222             jz      eval_comp_check_timeout
                      26223     
0008A6 200002         26224             jb      Flags1.INITIAL_RUN_PHASE, ($+5) ; Do not increment beyond startup phase
0008A9 0500       F   26225             inc     Startup_Cnt                                     ; Increment counter
0008AB 8010           26226             jmp     eval_comp_exit
                      26227     
0008AD                26228     eval_comp_check_timeout:
0008AD 30000D         26229             jnb     Flags0.COMP_TIMED_OUT, eval_comp_exit   ; Has timeout elapsed?
0008B0 20000A         26230             jb      Flags1.DIR_CHANGE_BRAKE, eval_comp_exit ; Do not exit run mode if it is 
                               braking
0008B3 200007         26231             jb      Flags0.DEMAG_DETECTED, eval_comp_exit   ; Do not exit run mode if it is 
                               a demag situation
0008B6 1581           26232             dec     SP                                                              ; Routin
                               e exit without "ret" command
0008B8 1581           26233             dec     SP
0008BA 020000     F   26234             ljmp    run_to_wait_for_power_on_fail                   ; Yes - exit run mode
                      26235     
0008BD                26236     eval_comp_exit:
0008BD 22             26237             ret
                      26238     
                      26239     
                      26240     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26241     ;
                      26242     ; Wait for commutation routine
                      26243     ;
                      26244     ; No assumptions
                      26245     ;
                      26246     ; Waits from zero cross to commutation 
                      26247     ;
                      26248     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0008BE                26249     wait_for_comm: 
                      26250             ; Update demag metric
0008BE 7800           26251             mov     Temp1, #0
0008C0 300002         26252             jnb     Flags0.DEMAG_DETECTED, ($+5)
                      26253     
0008C3 7801           26254             mov     Temp1, #1
                      26255     
0008C5 E500       F   26256             mov     A, Demag_Detected_Metric        ; Sliding average of 8, 256 when demag a
                               nd 0 when not. Limited to minimum 120
0008C7 75F007         26257             mov     B, #7
0008CA A4             26258             mul     AB                                      ; Multiply by 7
0008CB F9             26259             mov     Temp2, A
0008CC E5F0           26260             mov     A, B                                    ; Add new value for current dema
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   433

                               g status
0008CE 28             26261             add     A, Temp1                                
0008CF F5F0           26262             mov     B, A
0008D1 E9             26263             mov     A, Temp2
0008D2 A2F0           26264             mov     C, B.0                          ; Divide by 8
0008D4 13             26265             rrc     A                                       
0008D5 A2F1           26266             mov     C, B.1
0008D7 13             26267             rrc     A
0008D8 A2F2           26268             mov     C, B.2
0008DA 13             26269             rrc     A
0008DB F500       F   26270             mov     Demag_Detected_Metric, A
0008DD C3             26271             clr     C
0008DE 9478           26272             subb    A, #120                         ; Limit to minimum 120
0008E0 5003           26273             jnc     ($+5)
                      26274     
0008E2 750078     F   26275             mov     Demag_Detected_Metric, #120
                      26276     
0008E5 C3             26277             clr     C
0008E6 E500       F   26278             mov     A, Demag_Detected_Metric        ; Check demag metric
0008E8 9500       F   26279             subb    A, Demag_Pwr_Off_Thresh
0008EA 4002           26280             jc      wait_for_comm_wait              ; Cut power if many consecutive demags. 
                               This will help retain sync during hard accelerations
                      26281     
0008EC D200       F   26282             setb    Flags0.DEMAG_CUT_POWER  ; Set demag power cut flag
                      26283             All_pwmFETs_off
*** ____________________________________^
*** ERROR #A9 IN 26283 (BLHeli_S.asm, LINE 2665): SYNTAX ERROR
                      26284             Set_Pwms_Off
*** ____________________________________^
*** ERROR #A9 IN 26284 (BLHeli_S.asm, LINE 2666): SYNTAX ERROR
                      26285     
0008EE                26286     wait_for_comm_wait:
0008EE 300002         26287             jnb Flags0.T3_PENDING, ($+5)                    
0008F1 0100       F   26288             ajmp    wait_for_comm_wait
                      26289     
                      26290             ; Setup next wait time
0008F3                26291             mov     TMR3RLL, Wt_Zc_Scan_Start_L
*** ____________________________________________^
*** ERROR #A45 IN 26291 (BLHeli_S.asm, LINE 2673): UNDEFINED SYMBOL
0008F6                26292             mov     TMR3RLH, Wt_Zc_Scan_Start_H
*** ____________________________________________^
*** ERROR #A45 IN 26292 (BLHeli_S.asm, LINE 2674): UNDEFINED SYMBOL
0008F9 D200       F   26293             setb    Flags0.T3_PENDING
0008FB                26294             orl     EIE1, #80h                      ; Enable timer 3 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 26294 (BLHeli_S.asm, LINE 2676): UNDEFINED SYMBOL
0008FE 22             26295             ret
                      26296     
                      26297     
                      26298     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26299     ;
                      26300     ; Commutation routines
                      26301     ;
                      26302     ; No assumptions
                      26303     ;
                      26304     ; Performs commutation switching 
                      26305     ;
                      26306     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26307     ; Comm phase 1 to comm phase 2
0008FF                26308     comm1comm2:     
                      26309             Set_RPM_Out
*** ____________________________________^
*** ERROR #A9 IN 26309 (BLHeli_S.asm, LINE 2691): SYNTAX ERROR
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   434

0008FF 200006         26310             jb      Flags3.PGM_DIR_REV, comm12_rev
                      26311     
000902                26312             clr     IE_EA                           ; Disable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 26312 (BLHeli_S.asm, LINE 2694): UNDEFINED SYMBOL
                      26313             BcomFET_off                             ; Turn off comfet
*** ____________________________________^
*** ERROR #A9 IN 26313 (BLHeli_S.asm, LINE 2695): SYNTAX ERROR
                      26314             AcomFET_on                              ; Turn on comfet
*** ____________________________________^
*** ERROR #A9 IN 26314 (BLHeli_S.asm, LINE 2696): SYNTAX ERROR
                      26315             Set_Pwm_C                                       ; To reapply power after a demag
                                cut
*** ____________________________________^
*** ERROR #A9 IN 26315 (BLHeli_S.asm, LINE 2697): SYNTAX ERROR
000904                26316             setb    IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 26316 (BLHeli_S.asm, LINE 2698): UNDEFINED SYMBOL
                      26317             Set_Comp_Phase_B                        ; Set comparator phase
*** ____________________________________^
*** ERROR #A9 IN 26317 (BLHeli_S.asm, LINE 2699): SYNTAX ERROR
000906 804F           26318             jmp     comm_exit
                      26319     
000908                26320     comm12_rev:     
000908                26321             clr     IE_EA                           ; Disable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 26321 (BLHeli_S.asm, LINE 2703): UNDEFINED SYMBOL
                      26322             BcomFET_off                             ; Turn off comfet
*** ____________________________________^
*** ERROR #A9 IN 26322 (BLHeli_S.asm, LINE 2704): SYNTAX ERROR
                      26323             CcomFET_on                              ; Turn on comfet (reverse)
*** ____________________________________^
*** ERROR #A9 IN 26323 (BLHeli_S.asm, LINE 2705): SYNTAX ERROR
                      26324             Set_Pwm_A                                       ; To reapply power after a demag
                                cut
*** ____________________________________^
*** ERROR #A9 IN 26324 (BLHeli_S.asm, LINE 2706): SYNTAX ERROR
00090A                26325             setb    IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 26325 (BLHeli_S.asm, LINE 2707): UNDEFINED SYMBOL
                      26326             Set_Comp_Phase_B                        ; Set comparator phase
*** ____________________________________^
*** ERROR #A9 IN 26326 (BLHeli_S.asm, LINE 2708): SYNTAX ERROR
00090C 8049           26327             jmp     comm_exit
                      26328     
                      26329     
                      26330     ; Comm phase 2 to comm phase 3
00090E                26331     comm2comm3:     
                      26332             Clear_RPM_Out
*** ____________________________________^
*** ERROR #A9 IN 26332 (BLHeli_S.asm, LINE 2714): SYNTAX ERROR
00090E 200006         26333             jb      Flags3.PGM_DIR_REV, comm23_rev
                      26334     
000911                26335             clr     IE_EA                           ; Disable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 26335 (BLHeli_S.asm, LINE 2717): UNDEFINED SYMBOL
                      26336             CpwmFET_off                             ; Turn off pwmfet
*** ____________________________________^
*** ERROR #A9 IN 26336 (BLHeli_S.asm, LINE 2718): SYNTAX ERROR
                      26337             Set_Pwm_B                                       ; To reapply power after a demag
                                cut
*** ____________________________________^
*** ERROR #A9 IN 26337 (BLHeli_S.asm, LINE 2719): SYNTAX ERROR
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   435

                      26338             AcomFET_on                              
*** ____________________________________^
*** ERROR #A9 IN 26338 (BLHeli_S.asm, LINE 2720): SYNTAX ERROR
000913                26339             setb    IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 26339 (BLHeli_S.asm, LINE 2721): UNDEFINED SYMBOL
                      26340             Set_Comp_Phase_C                        ; Set comparator phase
*** ____________________________________^
*** ERROR #A9 IN 26340 (BLHeli_S.asm, LINE 2722): SYNTAX ERROR
000915 0100       F   26341             ajmp    comm_exit
                      26342     
000917                26343     comm23_rev:
000917                26344             clr     IE_EA                           ; Disable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 26344 (BLHeli_S.asm, LINE 2726): UNDEFINED SYMBOL
                      26345             ApwmFET_off                             ; Turn off pwmfet (reverse)
*** ____________________________________^
*** ERROR #A9 IN 26345 (BLHeli_S.asm, LINE 2727): SYNTAX ERROR
                      26346             Set_Pwm_B                                       ; To reapply power after a demag
                                cut
*** ____________________________________^
*** ERROR #A9 IN 26346 (BLHeli_S.asm, LINE 2728): SYNTAX ERROR
                      26347             CcomFET_on                              
*** ____________________________________^
*** ERROR #A9 IN 26347 (BLHeli_S.asm, LINE 2729): SYNTAX ERROR
000919                26348             setb    IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 26348 (BLHeli_S.asm, LINE 2730): UNDEFINED SYMBOL
                      26349             Set_Comp_Phase_A                        ; Set comparator phase (reverse)
*** ____________________________________^
*** ERROR #A9 IN 26349 (BLHeli_S.asm, LINE 2731): SYNTAX ERROR
00091B 0100       F   26350             ajmp    comm_exit
                      26351     
                      26352     
                      26353     ; Comm phase 3 to comm phase 4
00091D                26354     comm3comm4:     
                      26355             Set_RPM_Out
*** ____________________________________^
*** ERROR #A9 IN 26355 (BLHeli_S.asm, LINE 2737): SYNTAX ERROR
00091D 200006         26356             jb      Flags3.PGM_DIR_REV, comm34_rev
                      26357     
000920                26358             clr     IE_EA                           ; Disable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 26358 (BLHeli_S.asm, LINE 2740): UNDEFINED SYMBOL
                      26359             AcomFET_off                             ; Turn off comfet
*** ____________________________________^
*** ERROR #A9 IN 26359 (BLHeli_S.asm, LINE 2741): SYNTAX ERROR
                      26360             CcomFET_on                              ; Turn on comfet
*** ____________________________________^
*** ERROR #A9 IN 26360 (BLHeli_S.asm, LINE 2742): SYNTAX ERROR
                      26361             Set_Pwm_B                                       ; To reapply power after a demag
                                cut
*** ____________________________________^
*** ERROR #A9 IN 26361 (BLHeli_S.asm, LINE 2743): SYNTAX ERROR
000922                26362             setb    IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 26362 (BLHeli_S.asm, LINE 2744): UNDEFINED SYMBOL
                      26363             Set_Comp_Phase_A                        ; Set comparator phase
*** ____________________________________^
*** ERROR #A9 IN 26363 (BLHeli_S.asm, LINE 2745): SYNTAX ERROR
000924 8031           26364             jmp     comm_exit
                      26365     
000926                26366     comm34_rev:     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   436

000926                26367             clr     IE_EA                           ; Disable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 26367 (BLHeli_S.asm, LINE 2749): UNDEFINED SYMBOL
                      26368             CcomFET_off                             ; Turn off comfet (reverse)
*** ____________________________________^
*** ERROR #A9 IN 26368 (BLHeli_S.asm, LINE 2750): SYNTAX ERROR
                      26369             AcomFET_on                              ; Turn on comfet (reverse)
*** ____________________________________^
*** ERROR #A9 IN 26369 (BLHeli_S.asm, LINE 2751): SYNTAX ERROR
                      26370             Set_Pwm_B                                       ; To reapply power after a demag
                                cut
*** ____________________________________^
*** ERROR #A9 IN 26370 (BLHeli_S.asm, LINE 2752): SYNTAX ERROR
000928                26371             setb    IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 26371 (BLHeli_S.asm, LINE 2753): UNDEFINED SYMBOL
                      26372             Set_Comp_Phase_C                        ; Set comparator phase (reverse)
*** ____________________________________^
*** ERROR #A9 IN 26372 (BLHeli_S.asm, LINE 2754): SYNTAX ERROR
00092A 802B           26373             jmp     comm_exit
                      26374     
                      26375     
                      26376     ; Comm phase 4 to comm phase 5
00092C                26377     comm4comm5:     
                      26378             Clear_RPM_Out
*** ____________________________________^
*** ERROR #A9 IN 26378 (BLHeli_S.asm, LINE 2760): SYNTAX ERROR
00092C 200006         26379             jb      Flags3.PGM_DIR_REV, comm45_rev
                      26380     
00092F                26381             clr     IE_EA                           ; Disable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 26381 (BLHeli_S.asm, LINE 2763): UNDEFINED SYMBOL
                      26382             BpwmFET_off                             ; Turn off pwmfet
*** ____________________________________^
*** ERROR #A9 IN 26382 (BLHeli_S.asm, LINE 2764): SYNTAX ERROR
                      26383             Set_Pwm_A
*** ____________________________________^
*** ERROR #A9 IN 26383 (BLHeli_S.asm, LINE 2765): SYNTAX ERROR
                      26384             CcomFET_on                              ; To reapply power after a demag cut
*** ____________________________________^
*** ERROR #A9 IN 26384 (BLHeli_S.asm, LINE 2766): SYNTAX ERROR
000931                26385             setb    IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 26385 (BLHeli_S.asm, LINE 2767): UNDEFINED SYMBOL
                      26386             Set_Comp_Phase_B                        ; Set comparator phase
*** ____________________________________^
*** ERROR #A9 IN 26386 (BLHeli_S.asm, LINE 2768): SYNTAX ERROR
000933 8022           26387             jmp     comm_exit
                      26388     
000935                26389     comm45_rev:
000935                26390             clr     IE_EA                           ; Disable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 26390 (BLHeli_S.asm, LINE 2772): UNDEFINED SYMBOL
                      26391             BpwmFET_off                             ; Turn off pwmfet
*** ____________________________________^
*** ERROR #A9 IN 26391 (BLHeli_S.asm, LINE 2773): SYNTAX ERROR
                      26392             Set_Pwm_C
*** ____________________________________^
*** ERROR #A9 IN 26392 (BLHeli_S.asm, LINE 2774): SYNTAX ERROR
                      26393             AcomFET_on                              ; To reapply power after a demag cut
*** ____________________________________^
*** ERROR #A9 IN 26393 (BLHeli_S.asm, LINE 2775): SYNTAX ERROR
000937                26394             setb    IE_EA
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   437

*** ____________________________________________^
*** ERROR #A45 IN 26394 (BLHeli_S.asm, LINE 2776): UNDEFINED SYMBOL
                      26395             Set_Comp_Phase_B                        ; Set comparator phase
*** ____________________________________^
*** ERROR #A9 IN 26395 (BLHeli_S.asm, LINE 2777): SYNTAX ERROR
000939 801C           26396             jmp     comm_exit
                      26397     
                      26398     
                      26399     ; Comm phase 5 to comm phase 6
00093B                26400     comm5comm6:     
                      26401             Set_RPM_Out
*** ____________________________________^
*** ERROR #A9 IN 26401 (BLHeli_S.asm, LINE 2783): SYNTAX ERROR
00093B 200006         26402             jb      Flags3.PGM_DIR_REV, comm56_rev
                      26403     
00093E                26404             clr     IE_EA                           ; Disable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 26404 (BLHeli_S.asm, LINE 2786): UNDEFINED SYMBOL
                      26405             CcomFET_off                             ; Turn off comfet
*** ____________________________________^
*** ERROR #A9 IN 26405 (BLHeli_S.asm, LINE 2787): SYNTAX ERROR
                      26406             BcomFET_on                              ; Turn on comfet
*** ____________________________________^
*** ERROR #A9 IN 26406 (BLHeli_S.asm, LINE 2788): SYNTAX ERROR
                      26407             Set_Pwm_A                                       ; To reapply power after a demag
                                cut
*** ____________________________________^
*** ERROR #A9 IN 26407 (BLHeli_S.asm, LINE 2789): SYNTAX ERROR
000940                26408             setb    IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 26408 (BLHeli_S.asm, LINE 2790): UNDEFINED SYMBOL
                      26409             Set_Comp_Phase_C                        ; Set comparator phase
*** ____________________________________^
*** ERROR #A9 IN 26409 (BLHeli_S.asm, LINE 2791): SYNTAX ERROR
000942 8013           26410             jmp     comm_exit
                      26411     
000944                26412     comm56_rev:
000944                26413             clr     IE_EA                           ; Disable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 26413 (BLHeli_S.asm, LINE 2795): UNDEFINED SYMBOL
                      26414             AcomFET_off                             ; Turn off comfet (reverse)
*** ____________________________________^
*** ERROR #A9 IN 26414 (BLHeli_S.asm, LINE 2796): SYNTAX ERROR
                      26415             BcomFET_on                              ; Turn on comfet
*** ____________________________________^
*** ERROR #A9 IN 26415 (BLHeli_S.asm, LINE 2797): SYNTAX ERROR
                      26416             Set_Pwm_C                                       ; To reapply power after a demag
                                cut
*** ____________________________________^
*** ERROR #A9 IN 26416 (BLHeli_S.asm, LINE 2798): SYNTAX ERROR
000946                26417             setb    IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 26417 (BLHeli_S.asm, LINE 2799): UNDEFINED SYMBOL
                      26418             Set_Comp_Phase_A                        ; Set comparator phase (reverse)
*** ____________________________________^
*** ERROR #A9 IN 26418 (BLHeli_S.asm, LINE 2800): SYNTAX ERROR
000948 800D           26419             jmp     comm_exit
                      26420     
                      26421     
                      26422     ; Comm phase 6 to comm phase 1
00094A                26423     comm6comm1:     
                      26424             Clear_RPM_Out
*** ____________________________________^
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   438

*** ERROR #A9 IN 26424 (BLHeli_S.asm, LINE 2806): SYNTAX ERROR
00094A 200006         26425             jb      Flags3.PGM_DIR_REV, comm61_rev
                      26426     
00094D                26427             clr     IE_EA                           ; Disable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 26427 (BLHeli_S.asm, LINE 2809): UNDEFINED SYMBOL
                      26428             ApwmFET_off                             ; Turn off pwmfet
*** ____________________________________^
*** ERROR #A9 IN 26428 (BLHeli_S.asm, LINE 2810): SYNTAX ERROR
                      26429             Set_Pwm_C
*** ____________________________________^
*** ERROR #A9 IN 26429 (BLHeli_S.asm, LINE 2811): SYNTAX ERROR
                      26430             BcomFET_on                              ; To reapply power after a demag cut
*** ____________________________________^
*** ERROR #A9 IN 26430 (BLHeli_S.asm, LINE 2812): SYNTAX ERROR
00094F                26431             setb    IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 26431 (BLHeli_S.asm, LINE 2813): UNDEFINED SYMBOL
                      26432             Set_Comp_Phase_A                        ; Set comparator phase
*** ____________________________________^
*** ERROR #A9 IN 26432 (BLHeli_S.asm, LINE 2814): SYNTAX ERROR
000951 8004           26433             jmp     comm_exit
                      26434     
000953                26435     comm61_rev:
000953                26436             clr     IE_EA                           ; Disable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 26436 (BLHeli_S.asm, LINE 2818): UNDEFINED SYMBOL
                      26437             CpwmFET_off                             ; Turn off pwmfet (reverse)
*** ____________________________________^
*** ERROR #A9 IN 26437 (BLHeli_S.asm, LINE 2819): SYNTAX ERROR
                      26438             Set_Pwm_A
*** ____________________________________^
*** ERROR #A9 IN 26438 (BLHeli_S.asm, LINE 2820): SYNTAX ERROR
                      26439             BcomFET_on                              ; To reapply power after a demag cut
*** ____________________________________^
*** ERROR #A9 IN 26439 (BLHeli_S.asm, LINE 2821): SYNTAX ERROR
000955                26440             setb    IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 26440 (BLHeli_S.asm, LINE 2822): UNDEFINED SYMBOL
                      26441             Set_Comp_Phase_C                        ; Set comparator phase (reverse)
*** ____________________________________^
*** ERROR #A9 IN 26441 (BLHeli_S.asm, LINE 2823): SYNTAX ERROR
                      26442     
000957                26443     comm_exit:
000957 C200       F   26444             clr     Flags0.DEMAG_CUT_POWER  ; Clear demag power cut flag
000959 22             26445             ret
                      26446     
                      26447     ;**** **** **** **** **** **** **** **** **** **** **** **** ****               
                      26448     ;               
                      26449     ; Beeper routines (4 different entry points)            
                      26450     ;               
                      26451     ; No assumptions                
                      26452     ;               
                      26453     ;**** **** **** **** **** **** **** **** **** **** **** **** ****               
00095A                26454     beep_f1:        ; Entry point 1, load beeper frequency 1 settings               
00095A 200056         26455             jb      Flags3.CZ_TONES, beep_cz1               
00095D 7A14           26456             mov     Temp3, #20      ; Off wait loop length          
00095F 7BC8           26457             mov     Temp4, #200     ; Number of beep pulses         
000961 8019           26458             jmp     beep
                      26459                             
000963                26460     beep_f2:        ; Entry point 2, load beeper frequency 2 settings               
000963 200057         26461             jb      Flags3.CZ_TONES, beep_cz2               
000966 7A10           26462             mov     Temp3, #16              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   439

000968 7B8C           26463             mov     Temp4, #140             
00096A 8010           26464             jmp     beep    
                      26465                     
00096C                26466     beep_f3:        ; Entry point 3, load beeper frequency 3 settings               
00096C 200058         26467             jb      Flags3.CZ_TONES, beep_cz3               
00096F 7A0D           26468             mov     Temp3, #13              
000971 7BB4           26469             mov     Temp4, #180             
000973 8007           26470             jmp     beep
                      26471                             
000975                26472     beep_f4:        ; Entry point 4, load beeper frequency 4 settings               
000975 200059         26473             jb      Flags3.CZ_TONES, beep_cz4               
000978 7A0B           26474             mov     Temp3, #11              
00097A 7BC8           26475             mov     Temp4, #200             
                      26476                             
00097C                26477     beep:           ; Beep loop start               
00097C 300001         26478             jnb     Flags3.MUTE, beep_start
00097F 22             26479             ret     
000980                26480     beep_start:             
000980 7902           26481             mov     Temp2, #2               
000982                26482     beep_onoff:             
000982 E4             26483             clr     A               
                      26484             BcomFET_off             ; BcomFET off           
*** ____________________________________^
*** ERROR #A9 IN 26484 (BLHeli_S.asm, LINE 2866): SYNTAX ERROR
000983 D5E0FD         26485             djnz    ACC, $          ; Allow some time after comfet is turned off            
                      26486             BpwmFET_on              ; BpwmFET on (in order to charge the driver of the BcomF
                               ET)             
*** ____________________________________^
*** ERROR #A9 IN 26486 (BLHeli_S.asm, LINE 2868): SYNTAX ERROR
000986 D5E0FD         26487             djnz    ACC, $          ; Let the pwmfet be turned on a while           
                      26488             BpwmFET_off             ; BpwmFET off again             
*** ____________________________________^
*** ERROR #A9 IN 26488 (BLHeli_S.asm, LINE 2870): SYNTAX ERROR
000989 D5E0FD         26489             djnz    ACC, $          ; Allow some time after pwmfet is turned off            
                      26490             BcomFET_on              ; BcomFET on            
*** ____________________________________^
*** ERROR #A9 IN 26490 (BLHeli_S.asm, LINE 2872): SYNTAX ERROR
00098C D5E0FD         26491             djnz    ACC, $          ; Allow some time after comfet is turned on             
                      26492             ; Turn on pwmfet                
00098F E9             26493             mov     A, Temp2                
000990 20E000         26494             jb      ACC.0, beep_apwmfet_on          
                      26495             ApwmFET_on              ; ApwmFET on            
*** ____________________________________^
*** ERROR #A9 IN 26495 (BLHeli_S.asm, LINE 2877): SYNTAX ERROR
000993                26496     beep_apwmfet_on:                
000993 30E000         26497             jnb     ACC.0, beep_cpwmfet_on          
                      26498             CpwmFET_on              ; CpwmFET on            
*** ____________________________________^
*** ERROR #A9 IN 26498 (BLHeli_S.asm, LINE 2880): SYNTAX ERROR
000996                26499     beep_cpwmfet_on:                
000996 E500       F   26500             mov     A, Beep_Strength                
000998 D5E0FD         26501             djnz    ACC, $                          
                      26502             ; Turn off pwmfet               
00099B E9             26503             mov     A, Temp2                
00099C 20E000         26504             jb      ACC.0, beep_apwmfet_off         
                      26505             ApwmFET_off             ; ApwmFET off           
*** ____________________________________^
*** ERROR #A9 IN 26505 (BLHeli_S.asm, LINE 2887): SYNTAX ERROR
00099F                26506     beep_apwmfet_off:               
00099F 30E000         26507             jnb     ACC.0, beep_cpwmfet_off         
                      26508             CpwmFET_off             ; CpwmFET off           
*** ____________________________________^
*** ERROR #A9 IN 26508 (BLHeli_S.asm, LINE 2890): SYNTAX ERROR
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   440

0009A2                26509     beep_cpwmfet_off:               
0009A2 7496           26510             mov     A, #150         ; 25s off             
0009A4 D5E0FD         26511             djnz    ACC, $                          
0009A7 D9D9           26512             djnz    Temp2, beep_onoff               
                      26513             ; Copy variable         
0009A9 EA             26514             mov     A, Temp3                
0009AA F8             26515             mov     Temp1, A                        
0009AB                26516     beep_off:               ; Fets off loop         
0009AB D5E0FD         26517             djnz    ACC, $          
0009AE D8FB           26518             djnz    Temp1,  beep_off                
0009B0 DBCE           26519             djnz    Temp4,  beep_start              
                      26520             BcomFET_off             ; BcomFET off           
*** ____________________________________^
*** ERROR #A9 IN 26520 (BLHeli_S.asm, LINE 2902): SYNTAX ERROR
0009B2 22             26521             ret             
                      26522     ;**** **** **** **** **** **** **** **** **** **** **** **** ****               
                      26523     ;               
                      26524     ; Tone Engine for Inc/Dec/Variable Tones                
                      26525     ;               
                      26526     ;**** **** **** **** **** **** **** **** **** **** **** **** ****               
0009B3                26527     beep_cz1:                               
0009B3 7A50           26528             mov     Temp3, #80              ; total tone play length                        
                                       
0009B5 7C50           26529             mov     Temp5, #80              ; number of delay loops to set starting frequenc
                               y, frequency will increase as count is decremented.                             
0009B7 7B05           26530             mov Temp4, #5                   ; number of times to repeat tone at each fequenc
                               y.                              
0009B9 7D14           26531             mov Temp6, #20                  ; size of base delay (highest frequency tone cei
                               ling)                                           
0009BB 8040           26532             jmp mute_check          
                      26533                                             
0009BD                26534     beep_cz2:                               
0009BD 7A32           26535             mov     Temp3, #50                              
0009BF 7C28           26536             mov     Temp5, #40                              
0009C1 7B14           26537             mov Temp4, #20                          
0009C3 7D28           26538             mov Temp6, #40                          
0009C5 8036           26539             jmp mute_check          
                      26540                                             
0009C7                26541     beep_cz3:                               
0009C7 7A3C           26542             mov     Temp3, #60                              
0009C9 7CB4           26543             mov     Temp5, #180                             
0009CB 7B04           26544             mov Temp4, #4                           
0009CD 7D0A           26545             mov Temp6, #10                                          
0009CF 802C           26546             jmp mute_check          
                      26547                             
0009D1                26548     beep_cz4:                               
0009D1 7A96           26549             mov     Temp3, #150                             
0009D3 7C32           26550             mov     Temp5, #50                              
0009D5 7B02           26551             mov Temp4, #2                           
0009D7 7D1E           26552             mov Temp6, #30                          
0009D9 8022           26553             jmp mute_check
                      26554                             
0009DB                26555     beep_beacon:            
0009DB 7A64           26556             mov Temp3, #100         ; number of itterations of the tone loop to run.        
                                                       
0009DD 7C28           26557             mov Temp5, #40          ; starting tone (in number of delay cycles) for decremen
                               ting delay (increasing frequency)               
0009DF 7B05           26558             mov Temp4, #5           ; number of times to repeat inner loop at each fequency 
                               before.                         
0009E1 7D0F           26559             mov Temp6, #15          ; base delay            
0009E3 8018           26560             jmp mute_check          
                      26561                             
0009E5                26562     startup_wave1:                          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   441

0009E5 7800       F   26563             mov     Temp1, #Pgm_Direction                                   
0009E7 E6             26564             mov     A, @Temp1                               
0009E8 14             26565             dec A                           
                      26566     ;       jnz startup_wave2                               
0009E9 D200       F   26567             setb Flags3.TONE_WAVE                           
0009EB 7AC8           26568             mov     Temp3, #200             ; number of itterations of the tone loop to run.
                                               
0009ED 7C32           26569             mov     Temp5, #50              ; starting tone (in number of delay cycles) for 
                               decrementing delay (increasing frequency)                               
0009EF 7B03           26570             mov Temp4, #3           ; number of times to repeat inner loop at each fequency 
                               before.                         
0009F1 7D3C           26571             mov Temp6, #60          ; base delay                            
0009F3 8008           26572             jmp mute_check          
                      26573                                             
0009F5                26574     startup_wave2:                          
0009F5 7AC8           26575             mov     Temp3, #200             ; number of itterations of the tone loop to run.
                                                               
0009F7 7C50           26576             mov     Temp5, #80              ; starting tone (in number of delay cycles) for 
                               decrementing delay (increasing frequency)                               
0009F9 7B05           26577             mov Temp4, #5           ; number of times to repeat inner loop at each fequency 
                               before.                         
0009FB 7D46           26578             mov Temp6, #70          ; base delay            
                      26579                             
0009FD                26580     mute_check:             
0009FD 300001         26581             jnb Flags3.MUTE, music_outer_loop               
000A00 22             26582             ret                     
                      26583                             
000A01                26584     music_outer_loop:                               
000A01 EB             26585             mov A, Temp4                            
000A02 F8             26586             mov Temp1, A                    ; load temp1 with temp4 value, work with temp1 p
                               reserve temp4.                          
000A03 300015         26587             jnb Flags3.TONE_WAVE, no_wave                           
000A06 200009         26588             jb Flags3.TONE_DIR, inc_tone                            
000A09 1C             26589             dec Temp5                               
000A0A EC             26590             mov A, Temp5                            
000A0B B40112         26591             cjne A, #1, music_inner_loop                            
000A0E B200       F   26592             cpl Flags3.TONE_DIR                             
000A10 800E           26593             jmp music_inner_loop                            
                      26594                                             
000A12                26595     inc_tone:                               
000A12 0C             26596             inc Temp5                               
000A13 EC             26597             mov A, Temp5                            
000A14 B43209         26598             cjne A, #50, music_inner_loop                           
000A17 B200       F   26599             cpl Flags3.TONE_DIR                             
000A19 8005           26600             jmp music_inner_loop                            
                      26601                                             
000A1B                26602     no_wave:                                        
000A1B 1C             26603             dec Temp5                               ; decrement frequency delay loop count  
                                                               
000A1C EC             26604             mov A, Temp5                            
000A1D 7001           26605             jnz music_inner_loop                            
000A1F 0C             26606             inc Temp5                               
                      26607                                             
000A20                26608     music_inner_loop:                               
000A20 EC             26609             Mov A, Temp5            ; push variables onto the stack to preserve them during 
                               fet on/off macro                                
000A21 C0E0           26610             Push ACC                                
000A23 E8             26611             Mov A, Temp1                            
000A24 C0E0           26612             Push ACC                                
000A26 ED             26613             Mov A, Temp6                            
000A27 C0E0           26614             Push ACC                                
                      26615                             
000A29 300007         26616             jnb Flags3.FET_SWAP, tone_BC                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   442

                      26617             BcomFET_on              ; BcomFET on                            
*** ____________________________________^
*** ERROR #A9 IN 26617 (BLHeli_S.asm, LINE 2999): SYNTAX ERROR
                      26618             ApwmFET_on              ; ApwmFET on                            
*** ____________________________________^
*** ERROR #A9 IN 26618 (BLHeli_S.asm, LINE 3000): SYNTAX ERROR
000A2C E500       F   26619             mov     A, Beep_Strength                                
000A2E D5E0FD         26620             djnz    ACC, $                                          
                      26621             ApwmFET_off             ; ApwmFET off                           
*** ____________________________________^
*** ERROR #A9 IN 26621 (BLHeli_S.asm, LINE 3003): SYNTAX ERROR
                      26622             BcomFET_off             ; BcomFET off                           
*** ____________________________________^
*** ERROR #A9 IN 26622 (BLHeli_S.asm, LINE 3004): SYNTAX ERROR
000A31 8005           26623             jmp tone_AB                                     
000A33                26624     tone_BC:                                        
                      26625             BcomFET_on              ; BcomFET on                            
*** ____________________________________^
*** ERROR #A9 IN 26625 (BLHeli_S.asm, LINE 3007): SYNTAX ERROR
                      26626             CpwmFET_on              ; CpwmFET on                            
*** ____________________________________^
*** ERROR #A9 IN 26626 (BLHeli_S.asm, LINE 3008): SYNTAX ERROR
000A33 E500       F   26627             mov     A, Beep_Strength                                
000A35 D5E0FD         26628             djnz    ACC, $                                          
                      26629             CpwmFET_off             ; CpwmFET off                           
*** ____________________________________^
*** ERROR #A9 IN 26629 (BLHeli_S.asm, LINE 3011): SYNTAX ERROR
                      26630             BcomFET_off             ; BcomFET off                           
*** ____________________________________^
*** ERROR #A9 IN 26630 (BLHeli_S.asm, LINE 3012): SYNTAX ERROR
000A38                26631     tone_AB:                                
000A38 B200       F   26632             cpl Flags3.FET_SWAP                                     
000A3A D0E0           26633             Pop ACC                         
000A3C FD             26634             mov Temp6, A                            
000A3D FE             26635             mov Temp7, A                            
000A3E D0E0           26636             Pop ACC                         ; pop variables off the stack, and restore them.
                                                               
000A40 F8             26637             Mov Temp1, A                            
000A41 D0E0           26638             Pop ACC                                                         
000A43 FC             26639             Mov Temp5, A                            
000A44 F9             26640             Mov Temp2, A            ; make copy of temp5 to work with.                      
                                       
                      26641                                                     ; run minimum delay loop to keep our ton
                               e within the frquency range we're after (~3khz-800hz ideally)                           
000A45                26642     music_base_delay:                               
000A45 7464           26643             mov     A, #100                                                                 
                               ;30us wait                              
000A47 D5E0FD         26644             djnz    ACC, $                                                                  
                               ; timing delay                          
000A4A DEF9           26645             djnz    Temp7, music_base_delay                         ; base delay loop run co
                               unt                             
000A4C                26646     music_variable_delay:                                                           ; changi
                               ng delay (adjust tone frequency)                                
000A4C 744B           26647             mov     A, #75                                                                  
                                       ; 17us wait                             
000A4E D5E0FD         26648             djnz    ACC, $                                          ; timing delay          
                                               
000A51 D9F9           26649             djnz    Temp2, music_variable_delay                     ; run this loop #Temp5 t
                               imes                            
000A53 2000CA         26650             jb              Flags3.FET_SWAP, music_inner_loop               
000A56 D8C8           26651             djnz    Temp1, music_inner_loop                                 ;               
000A58 DA01           26652             djnz    Temp3, dec_again                
000A5A 22             26653             ret             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   443

000A5B                26654     dec_again:                      
000A5B DAA4           26655             djnz    Temp3, music_outer_loop                             ; total length of to
                               ne                              
000A5D 22             26656             ret                                     
                      26657                             
                      26658     
                      26659     
                      26660     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26661     ;
                      26662     ; Switch power off routine
                      26663     ;
                      26664     ; No assumptions
                      26665     ;
                      26666     ; Switches all fets off 
                      26667     ;
                      26668     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000A5E                26669     switch_power_off:
                      26670             All_pwmFETs_Off         ; Turn off all pwm fets
*** ____________________________________^
*** ERROR #A9 IN 26670 (BLHeli_S.asm, LINE 3052): SYNTAX ERROR
                      26671             All_comFETs_Off         ; Turn off all commutation fets
*** ____________________________________^
*** ERROR #A9 IN 26671 (BLHeli_S.asm, LINE 3053): SYNTAX ERROR
                      26672             Set_Pwms_Off
*** ____________________________________^
*** ERROR #A9 IN 26672 (BLHeli_S.asm, LINE 3054): SYNTAX ERROR
000A5E 22             26673             ret                     
                      26674     
                      26675     
                      26676     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26677     ;
                      26678     ; Set default parameters
                      26679     ;
                      26680     ; No assumptions
                      26681     ;
                      26682     ; Sets default programming parameters
                      26683     ;
                      26684     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000A5F                26685     set_default_parameters:
000A5F 7800       F   26686             mov     Temp1, #_Pgm_Gov_P_Gain
000A61 76FF           26687             mov     @Temp1, #0FFh   ; Governor P gain
000A63 08             26688             inc     Temp1
000A64 76FF           26689             mov     @Temp1, #0FFh   ; Governor I gain
000A66 08             26690             inc     Temp1
000A67 76FF           26691             mov     @Temp1, #0FFh   ; Governor mode
000A69 08             26692             inc     Temp1
000A6A 76FF           26693             mov     @Temp1, #0FFh   ; Low voltage limit
000A6C 08             26694             inc     Temp1
000A6D 76FF           26695             mov     @Temp1, #0FFh   ; Multi gain
000A6F 08             26696             inc     Temp1
000A70 76FF           26697             mov     @Temp1, #0FFh   
000A72 08             26698             inc     Temp1
000A73 7605           26699             mov     @Temp1, #DEFAULT_PGM_STARTUP_PWR
000A75 08             26700             inc     Temp1
000A76 76FF           26701             mov     @Temp1, #0FFh   ; Pwm freq
000A78 08             26702             inc     Temp1
000A79 7601           26703             mov     @Temp1, #DEFAULT_PGM_DIRECTION
                      26704     
000A7B 7800       F   26705             mov     Temp1, #Pgm_Enable_TX_Program
000A7D 7601           26706             mov     @Temp1, #DEFAULT_PGM_ENABLE_TX_PROGRAM
000A7F 08             26707             inc     Temp1
000A80 76FF           26708             mov     @Temp1, #0FFh   ; Main rearm start
000A82 08             26709             inc     Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   444

000A83 76FF           26710             mov     @Temp1, #0FFh   ; Governor setup target
000A85 08             26711             inc     Temp1
000A86 76FF           26712             mov     @Temp1, #0FFh   ; Startup rpm   
000A88 08             26713             inc     Temp1
000A89 76FF           26714             mov     @Temp1, #0FFh   ; Startup accel
000A8B 08             26715             inc     Temp1
000A8C 76FF           26716             mov     @Temp1, #0FFh   ; Voltage comp
000A8E 08             26717             inc     Temp1
000A8F 7603           26718             mov     @Temp1, #DEFAULT_PGM_COMM_TIMING
000A91 08             26719             inc     Temp1
000A92 76FF           26720             mov     @Temp1, #0FFh   ; Damping force 
000A94 08             26721             inc     Temp1
000A95 76FF           26722             mov     @Temp1, #0FFh   ; Governor range
000A97 08             26723             inc     Temp1
000A98 76FF           26724             mov     @Temp1, #0FFh   ; Startup method        
000A9A 08             26725             inc     Temp1
000A9B 760A           26726             mov     @Temp1, #DEFAULT_PGM_MIN_THROTTLE
000A9D 08             26727             inc     Temp1
000A9E 76F0           26728             mov     @Temp1, #DEFAULT_PGM_MAX_THROTTLE
000AA0 08             26729             inc     Temp1
000AA1 765B           26730             mov     @Temp1, #DEFAULT_PGM_BEEP_STRENGTH
000AA3 08             26731             inc     Temp1
000AA4 7650           26732             mov     @Temp1, #DEFAULT_PGM_BEACON_STRENGTH
000AA6 08             26733             inc     Temp1
000AA7 7603           26734             mov     @Temp1, #DEFAULT_PGM_BEACON_DELAY
000AA9 08             26735             inc     Temp1
000AAA 76FF           26736             mov     @Temp1, #0FFh   ; Throttle rate 
000AAC 08             26737             inc     Temp1
000AAD 7603           26738             mov     @Temp1, #DEFAULT_PGM_DEMAG_COMP
000AAF 08             26739             inc     Temp1
000AB0 76FF           26740             mov     @Temp1, #0FFh   ; Bec voltage high
000AB2 08             26741             inc     Temp1
000AB3 767D           26742             mov     @Temp1, #DEFAULT_PGM_CENTER_THROTTLE
000AB5 08             26743             inc     Temp1
000AB6 76FF           26744             mov     @Temp1, #0FFh   
000AB8 08             26745             inc     Temp1
000AB9 7606           26746             mov     @Temp1, #DEFAULT_PGM_ENABLE_TEMP_PROT
000ABB 08             26747             inc     Temp1
000ABC 7601           26748             mov     @Temp1, #DEFAULT_PGM_ENABLE_POWER_PROT
000ABE 08             26749             inc     Temp1
000ABF 76FF           26750             mov     @Temp1, #0FFh   ; Enable pwm input
000AC1 08             26751             inc     Temp1
000AC2 76FF           26752             mov     @Temp1, #0FFh   ; Pwm dither
000AC4 08             26753             inc     Temp1
000AC5 7601           26754             mov     @Temp1, #DEFAULT_PGM_BRAKE_ON_STOP
000AC7 08             26755             inc     Temp1
000AC8 7601           26756             mov     @Temp1, #DEFAULT_PGM_LED_CONTROL
000ACA 22             26757             ret
                      26758     
                      26759     
                      26760     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26761     ;
                      26762     ; Scale throttle cal
                      26763     ;
                      26764     ; No assumptions
                      26765     ;
                      26766     ; Scales a throttle cal value
                      26767     ; Input is ACC, output is Temp2/Temp1
                      26768     ;
                      26769     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000ACB                26770     scale_throttle_cal:
000ACB FA             26771             mov     Temp3, A
000ACC 75F00C         26772             mov     B, #0Ch                 ; Calculate "3%" (for going from 1000us to numer
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   445

                               ical 1024)
000ACF A4             26773             mul     AB
000AD0 ABF0           26774             mov     Temp4, B
000AD2 EA             26775             mov     A, Temp3
000AD3 C3             26776             clr     C                               ; Shift to 9 bits
000AD4 33             26777             rlc     A
000AD5 F8             26778             mov     Temp1, A
000AD6 7401           26779             mov     A, #1
000AD8 33             26780             rlc     A
000AD9 F9             26781             mov     Temp2, A
000ADA E8             26782             mov     A, Temp1                        ; Shift to 10 bits
000ADB C3             26783             clr     C
000ADC 33             26784             rlc     A
000ADD F8             26785             mov     Temp1, A
000ADE E9             26786             mov     A, Temp2
000ADF 33             26787             rlc     A
000AE0 F9             26788             mov     Temp2, A
000AE1 E8             26789             mov     A, Temp1                        ; Add "3%"
000AE2 C3             26790             clr     C
000AE3 2B             26791             add     A, Temp4
000AE4 F8             26792             mov     Temp1, A
000AE5 E9             26793             mov     A, Temp2
000AE6 3400           26794             addc    A, #0
000AE8 F9             26795             mov     Temp2, A
                      26796     IF 1 == 1
000AE9 E8             26797             mov     A, Temp1                        ; Shift to 11 bits
000AEA C3             26798             clr     C
000AEB 33             26799             rlc     A
000AEC F8             26800             mov     Temp1, A
000AED E9             26801             mov     A, Temp2
000AEE 33             26802             rlc     A
000AEF F9             26803             mov     Temp2, A
                      26804     ENDIF
000AF0 22             26805     ret
                      26806     
                      26807     
                      26808     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26809     ;
                      26810     ; Decode settings
                      26811     ;
                      26812     ; No assumptions
                      26813     ;
                      26814     ; Decodes various settings
                      26815     ;
                      26816     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000AF1                26817     decode_settings:
                      26818             ; Load programmed direction
000AF1 7800       F   26819             mov     Temp1, #Pgm_Direction   
000AF3 E6             26820             mov     A, @Temp1                               
000AF4 C3             26821             clr     C
000AF5 9403           26822             subb    A, #3
000AF7 D200       F   26823             setb    Flags3.PGM_BIDIR
000AF9 5002           26824             jnc     ($+4)
                      26825     
000AFB C200       F   26826             clr     Flags3.PGM_BIDIR
                      26827     
000AFD C200       F   26828             clr     Flags3.PGM_DIR_REV
000AFF E6             26829             mov     A, @Temp1                               
000B00 30E102         26830             jnb     ACC.1, ($+5)
000B03 D200       F   26831             setb    Flags3.PGM_DIR_REV
000B05 A200       F   26832             mov     C, Flags3.PGM_DIR_REV
000B07 9200       F   26833             mov     Flags3.PGM_BIDIR_REV, C
                      26834             ; Decode startup power
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   446

000B09 7800       F   26835             mov     Temp1, #Pgm_Startup_Pwr         
000B0B E6             26836             mov     A, @Temp1                               
000B0C 14             26837             dec     A       
000B0D 900000     F   26838             mov     DPTR, #STARTUP_POWER_TABLE
000B10 93             26839             movc A, @A+DPTR 
000B11 7800       F   26840             mov     Temp1, #Pgm_Startup_Pwr_Decoded
000B13 F6             26841             mov     @Temp1, A       
                      26842             ; Decode low rpm power slope
000B14 7800       F   26843             mov     Temp1, #Pgm_Startup_Pwr
000B16 E6             26844             mov     A, @Temp1
000B17 F500       F   26845             mov     Low_Rpm_Pwr_Slope, A
000B19 C3             26846             clr     C
000B1A 9402           26847             subb    A, #2
000B1C 5003           26848             jnc     ($+5)
000B1E 750002     F   26849             mov     Low_Rpm_Pwr_Slope, #2
                      26850             ; Decode demag compensation
000B21 7800       F   26851             mov     Temp1, #Pgm_Demag_Comp          
000B23 E6             26852             mov     A, @Temp1                               
000B24 7500FF     F   26853             mov     Demag_Pwr_Off_Thresh, #255      ; Set default
                      26854     
000B27 B40203         26855             cjne    A, #2, decode_demag_high
                      26856     
000B2A 7500A0     F   26857             mov     Demag_Pwr_Off_Thresh, #160      ; Settings for demag comp low
                      26858     
000B2D                26859     decode_demag_high:
000B2D B40303         26860             cjne    A, #3, decode_demag_done
                      26861     
000B30 750082     F   26862             mov     Demag_Pwr_Off_Thresh, #130      ; Settings for demag comp high
                      26863     
000B33                26864     decode_demag_done:
                      26865             ; Decode temperature protection limit
000B33 7800       F   26866             mov     Temp1, #Pgm_Enable_Temp_Prot
000B35 E6             26867             mov     A, @Temp1
000B36 F8             26868             mov     Temp1, A
000B37 6006           26869             jz      decode_temp_done
                      26870     
000B39                26871             mov     A, #(TEMP_LIMIT-TEMP_LIMIT_STEP)
*** ____________________________________________________________^
*** ERROR #A45 IN 26871 (BLHeli_S.asm, LINE 3253): UNDEFINED SYMBOL
000B3B                26872     decode_temp_step:
000B3B                26873             add     A, #TEMP_LIMIT_STEP
*** ________________________________________________^
*** ERROR #A45 IN 26873 (BLHeli_S.asm, LINE 3255): UNDEFINED SYMBOL
000B3D D8FC           26874             djnz    Temp1, decode_temp_step
                      26875     
000B3F                26876     decode_temp_done:
000B3F F500       F   26877             mov     Temp_Prot_Limit, A
                      26878             ; Decode throttle cal
000B41 7800       F   26879             mov     Temp1, #Pgm_Min_Throttle                ; Throttle cal is in 4us units
000B43 E6             26880             mov     A, @Temp1
000B44 1100       F   26881             call    scale_throttle_cal
000B46 8800       F   26882             mov     Min_Throttle_L, Temp1
000B48 8900       F   26883             mov     Min_Throttle_H, Temp2
000B4A 7800       F   26884             mov     Temp1, #Pgm_Center_Throttle     ; Throttle cal is in 4us units
000B4C E6             26885             mov     A, @Temp1
000B4D 1100       F   26886             call    scale_throttle_cal
000B4F 8800       F   26887             mov     Center_Throttle_L, Temp1
000B51 8900       F   26888             mov     Center_Throttle_H, Temp2
000B53 7800       F   26889             mov     Temp1, #Pgm_Max_Throttle                ; Throttle cal is in 4us units
000B55 E6             26890             mov     A, @Temp1
000B56 1100       F   26891             call    scale_throttle_cal
000B58 8800       F   26892             mov     Max_Throttle_L, Temp1
000B5A 8900       F   26893             mov     Max_Throttle_H, Temp2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   447

000B5C 1100       F   26894             call    switch_power_off
000B5E 22             26895             ret
                      26896     
                      26897     
                      26898     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26899     ;
                      26900     ; Find throttle gains
                      26901     ;
                      26902     ; No assumptions
                      26903     ;
                      26904     ; Finds throttle gains for both directions in bidirectional mode
                      26905     ;
                      26906     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000B5F                26907     find_throttle_gains:
                      26908             ; Check if full range is chosen
000B5F 300011         26909             jnb     Flags2.RCP_FULL_RANGE, find_throttle_gains_normal
                      26910     
000B62 7A00           26911             mov     Temp3, #0               ; Min throttle
000B64 7B00           26912             mov     Temp4, #0
000B66 7CFF           26913             mov     Temp5, #255     ; Max throttle
000B68 7D00           26914             mov     Temp6, #0
000B6A 7E00           26915             mov     Temp7, #0               ; Deadband
000B6C 1100       F   26916             call    find_throttle_gain
000B6E 8B00       F   26917             mov     Throttle_Gain_M, Temp4
000B70 8A00       F   26918             mov     Throttle_Gain, Temp3
000B72 22             26919             ret
                      26920     
000B73                26921     find_throttle_gains_normal:
                      26922             ; Check if bidirectional operation
000B73 300022         26923             jnb     Flags3.PGM_BIDIR, find_throttle_gains_bidir_done
                      26924     
000B76 7800       F   26925             mov     Temp1, #Pgm_Min_Throttle
000B78 E6             26926             mov     A, @Temp1
000B79 FA             26927             mov     Temp3, A
000B7A 7B00           26928             mov     Temp4, #0
000B7C 7800       F   26929             mov     Temp1, #Pgm_Center_Throttle
000B7E E6             26930             mov     A, @Temp1
000B7F FC             26931             mov     Temp5, A
000B80 7D00           26932             mov     Temp6, #0
000B82 C3             26933             clr     C
000B83 EA             26934             mov     A, Temp3                        ; Scale gains in bidirectional
000B84 33             26935             rlc     A
000B85 FA             26936             mov     Temp3, A
000B86 EB             26937             mov     A, Temp4
000B87 33             26938             rlc     A
000B88 FB             26939             mov     Temp4, A
000B89 C3             26940             clr     C
000B8A EC             26941             mov     A, Temp5
000B8B 33             26942             rlc     A
000B8C FC             26943             mov     Temp5, A
000B8D ED             26944             mov     A, Temp6
000B8E 33             26945             rlc     A
000B8F FD             26946             mov     Temp6, A
000B90 7E0A           26947             mov     Temp7, #10              ; Compensate for deadband in bidirectional
000B92 1100       F   26948             call    find_throttle_gain
000B94 8B00       F   26949             mov     Throttle_Gain_BD_Rev_M, Temp4
000B96 8A00       F   26950             mov     Throttle_Gain_BD_Rev, Temp3
                      26951     
000B98                26952     find_throttle_gains_bidir_done:
000B98 7800       F   26953             mov     Temp1, #Pgm_Min_Throttle
000B9A 300002         26954             jnb     Flags3.PGM_BIDIR, ($+5)
                      26955     
000B9D 7800       F   26956             mov     Temp1, #Pgm_Center_Throttle
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   448

                      26957     
000B9F E6             26958             mov     A, @Temp1
000BA0 FA             26959             mov     Temp3, A
000BA1 7B00           26960             mov     Temp4, #0
000BA3 7800       F   26961             mov     Temp1, #Pgm_Max_Throttle
000BA5 E6             26962             mov     A, @Temp1
000BA6 FC             26963             mov     Temp5, A
000BA7 7D00           26964             mov     Temp6, #0
000BA9 7E00           26965             mov     Temp7, #0                       ; No deadband
000BAB 300010         26966             jnb     Flags3.PGM_BIDIR, find_throttle_gain_fwd
                      26967     
000BAE C3             26968             clr     C
000BAF EA             26969             mov     A, Temp3                        ; Scale gains in bidirectional
000BB0 33             26970             rlc     A
000BB1 FA             26971             mov     Temp3, A
000BB2 EB             26972             mov     A, Temp4
000BB3 33             26973             rlc     A
000BB4 FB             26974             mov     Temp4, A
000BB5 C3             26975             clr     C
000BB6 EC             26976             mov     A, Temp5
000BB7 33             26977             rlc     A
000BB8 FC             26978             mov     Temp5, A
000BB9 ED             26979             mov     A, Temp6
000BBA 33             26980             rlc     A
000BBB FD             26981             mov     Temp6, A
000BBC 7E0A           26982             mov     Temp7, #10              ; Compensate for deadband in bidirectional
                      26983     
000BBE                26984     find_throttle_gain_fwd:
000BBE 1100       F   26985             call    find_throttle_gain
000BC0 8B00       F   26986             mov     Throttle_Gain_M, Temp4
000BC2 8A00       F   26987             mov     Throttle_Gain, Temp3
000BC4 22             26988             ret
                      26989     
                      26990     
                      26991     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26992     ;
                      26993     ; Find throttle gain
                      26994     ;
                      26995     ; The difference between max and min throttle must be more than 140us (a Pgm_xxx_Throttl
                               e difference of 35)
                      26996     ; Temp4/3 holds min throttle, Temp6/5 holds max throttle, Temp7 holds deadband, Temp4/Te
                               mp3 gives resulting gain
                      26997     ;
                      26998     ; Finds throttle gain from throttle calibration values
                      26999     ;
                      27000     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000BC5                27001     find_throttle_gain:
                      27002             ; Subtract deadband from max
000BC5 C3             27003             clr     C
000BC6 EC             27004             mov     A, Temp5
000BC7 9E             27005             subb    A, Temp7
000BC8 FC             27006             mov     Temp5, A
000BC9 ED             27007             mov     A, Temp6
000BCA 9400           27008             subb    A, #0
000BCC FD             27009             mov     Temp6, A
                      27010             ; Calculate difference
000BCD C3             27011             clr     C
000BCE EC             27012             mov     A, Temp5
000BCF 9A             27013             subb    A, Temp3
000BD0 FC             27014             mov     Temp5, A
000BD1 ED             27015             mov     A, Temp6
000BD2 9B             27016             subb    A, Temp4
000BD3 FD             27017             mov     Temp6, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   449

                      27018             ; Check that difference is minimum 35
000BD4 C3             27019             clr     C
000BD5 EC             27020             mov     A, Temp5
000BD6 9423           27021             subb    A, #35
000BD8 ED             27022             mov     A, Temp6
000BD9 9400           27023             subb    A, #0
000BDB 5004           27024             jnc     ($+6)
                      27025     
000BDD 7C23           27026             mov     Temp5, #35
000BDF 7D00           27027             mov     Temp6, #0
                      27028     
                      27029             ; Check that difference is maximum 511
000BE1 C3             27030             clr     C
000BE2 EC             27031             mov     A, Temp5
000BE3 94FF           27032             subb    A, #255
000BE5 ED             27033             mov     A, Temp6
000BE6 9401           27034             subb    A, #1
000BE8 4004           27035             jc      ($+6)
                      27036     
000BEA 7CFF           27037             mov     Temp5, #255
000BEC 7D01           27038             mov     Temp6, #1
                      27039     
                      27040             ; Find gain
000BEE 7BFF           27041             mov     Temp4, #0FFh
000BF0                27042     find_throttle_gain_loop:
000BF0 0B             27043             inc     Temp4
000BF1 7A00           27044             mov     Temp3, #0
000BF3                27045     test_throttle_gain:
000BF3 0A             27046             inc     Temp3
000BF4 EA             27047             mov     A, Temp3
000BF5 7009           27048             jnz     test_throttle_gain_mult
                      27049     
000BF7 C3             27050             clr     C
000BF8 EC             27051             mov     A, Temp5                        ; Set multiplier x2 and range /2
000BF9 33             27052             rlc     A
000BFA FC             27053             mov     Temp5, A
000BFB ED             27054             mov     A, Temp6
000BFC 33             27055             rlc     A
000BFD FD             27056             mov     Temp6, A
000BFE 0100       F   27057             ajmp    find_throttle_gain_loop
                      27058     
000C00                27059     test_throttle_gain_mult:
000C00 EC             27060             mov     A, Temp5                        ; A has difference, B has gain
000C01 8AF0           27061             mov     B, Temp3
000C03 A4             27062             mul     AB
000C04 AEF0           27063             mov     Temp7, B
000C06 ED             27064             mov     A, Temp6
000C07 8AF0           27065             mov     B, Temp3
000C09 A4             27066             mul     AB
000C0A 2E             27067             add     A, Temp7
000C0B 947C           27068             subb    A, #124
000C0D 40E4           27069             jc      test_throttle_gain
                      27070     
000C0F EA             27071             mov     A, Temp3
000C10 F4             27072             cpl     A
000C11 60DD           27073             jz      find_throttle_gain_loop
                      27074     
000C13 22             27075             ret
                      27076     
                      27077     
                      27078     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27079     ;
                      27080     ; Average throttle 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   450

                      27081     ;
                      27082     ; Outputs result in Temp8
                      27083     ;
                      27084     ; Averages throttle calibration readings
                      27085     ;
                      27086     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000C14                27087     average_throttle:
000C14 D200       F   27088             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
000C16 1100       F   27089             call    find_throttle_gains     ; Set throttle gains
000C18 120000     F   27090             call wait30ms           
000C1B 120000     F   27091             call wait30ms
000C1E 7A00           27092             mov     Temp3, #0
000C20 7B00           27093             mov     Temp4, #0
000C22 7C10           27094             mov     Temp5, #16              ; Average 16 measurments
000C24                27095     average_throttle_meas:
000C24 120000     F   27096             call    wait3ms                 ; Wait for new RC pulse value
000C27 E500       F   27097             mov     A, New_Rcp              ; Get new RC pulse value
000C29 2A             27098             add     A, Temp3
000C2A FA             27099             mov     Temp3, A
000C2B 7400           27100             mov     A, #0
000C2D 3B             27101             addc A, Temp4
000C2E FB             27102             mov     Temp4, A
000C2F DCF3           27103             djnz    Temp5, average_throttle_meas
                      27104     
000C31 7C04           27105             mov     Temp5, #4                       ; Shift 4 times
000C33                27106     average_throttle_div:
000C33 C3             27107             clr     C
000C34 EB             27108             mov     A, Temp4                ; Shift right 
000C35 13             27109             rrc     A      
000C36 FB             27110             mov     Temp4, A   
000C37 EA             27111             mov     A, Temp3   
000C38 13             27112             rrc     A      
000C39 FA             27113             mov     Temp3, A   
000C3A DCF7           27114             djnz    Temp5, average_throttle_div
                      27115     
000C3C FF             27116             mov     Temp8, A                ; Copy to Temp8
000C3D EB             27117             mov     A, Temp4
000C3E 6002           27118             jz      ($+4)
                      27119     
000C40 7FFF           27120             mov     Temp8, #0FFh
                      27121     
000C42 C200       F   27122             clr     Flags2.RCP_FULL_RANGE
000C44 1100       F   27123             call    find_throttle_gains     ; Set throttle gains
000C46 22             27124             ret
                      27125     
                      27126     
                      27127     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27128     ;
                      27129     ; LED control
                      27130     ;
                      27131     ; No assumptions
                      27132     ;
                      27133     ; Controls LEDs
                      27134     ;
                      27135     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000C47                27136     led_control:
000C47 7800       F   27137             mov     Temp1, #Pgm_LED_Control
000C49 E6             27138             mov     A, @Temp1
000C4A F9             27139             mov     Temp2, A
000C4B 5403           27140             anl     A, #03h
                      27141             Set_LED_0
*** ____________________________________^
*** ERROR #A9 IN 27141 (BLHeli_S.asm, LINE 3523): SYNTAX ERROR
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   451

000C4D 7000           27142             jnz     led_0_done
                      27143             Clear_LED_0
*** ____________________________________^
*** ERROR #A9 IN 27143 (BLHeli_S.asm, LINE 3525): SYNTAX ERROR
000C4F                27144     led_0_done:
000C4F E9             27145             mov     A, Temp2
000C50 540C           27146             anl     A, #0Ch
                      27147             Set_LED_1
*** ____________________________________^
*** ERROR #A9 IN 27147 (BLHeli_S.asm, LINE 3529): SYNTAX ERROR
000C52 7000           27148             jnz     led_1_done
                      27149             Clear_LED_1
*** ____________________________________^
*** ERROR #A9 IN 27149 (BLHeli_S.asm, LINE 3531): SYNTAX ERROR
000C54                27150     led_1_done:
000C54 E9             27151             mov     A, Temp2
000C55 5430           27152             anl     A, #030h
                      27153             Set_LED_2
*** ____________________________________^
*** ERROR #A9 IN 27153 (BLHeli_S.asm, LINE 3535): SYNTAX ERROR
000C57 7000           27154             jnz     led_2_done
                      27155             Clear_LED_2
*** ____________________________________^
*** ERROR #A9 IN 27155 (BLHeli_S.asm, LINE 3537): SYNTAX ERROR
000C59                27156     led_2_done:
000C59 E9             27157             mov     A, Temp2
000C5A 54C0           27158             anl     A, #0C0h
                      27159             Set_LED_3
*** ____________________________________^
*** ERROR #A9 IN 27159 (BLHeli_S.asm, LINE 3541): SYNTAX ERROR
000C5C 7000           27160             jnz     led_3_done
                      27161             Clear_LED_3
*** ____________________________________^
*** ERROR #A9 IN 27161 (BLHeli_S.asm, LINE 3543): SYNTAX ERROR
000C5E                27162     led_3_done:
000C5E 22             27163             ret
                      27164     
                      27165     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27166     ;               
                      27167     ;               Music Routines          
                      27168     ;               
                      27169     ;**** **** **** **** **** **** **** **** **** **** **** **** ****               
000C5F                27170     music_a4:               
000C5F 7ADC           27171             mov     Temp3, #220 ;55         ;length of tone         
000C61 7B36           27172             mov Temp4, #54                  ;number of delay loop1 cycles (tone frequency)  
                                       
000C63 7C02           27173             mov Temp5, #2                   ;number of delay loop2 cycles (octave range?/lar
                               ge step?)               
000C65 0100       F   27174             jmp music
                      27175                             
000C67                27176     music_a4_custom:                
000C67 7A32           27177             mov     Temp3, #50 ;55  ;length of tone         
000C69 7B36           27178             mov Temp4, #54                  ;number of delay loop1 cycles (tone frequency)  
                                       
000C6B 7C02           27179             mov Temp5, #2                   ;number of delay loop2 cycles (octave range?/lar
                               ge step?)               
000C6D 0100       F   27180             jmp music
                      27181                             
000C6F                27182     music_gs4:              
000C6F 7A66           27183             mov     Temp3, #102 ;49                                 
000C71 7B5A           27184             mov Temp4, #90          
000C73 7C02           27185             mov Temp5, #2           
000C75 0100       F   27186             jmp music
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   452

                      27187                             
000C77                27188     music_as4:              
000C77 7A3A           27189             mov     Temp3, #58                              
000C79 7B1D           27190             mov Temp4, #29          
000C7B 7C02           27191             mov Temp5, #2           
000C7D 0100       F   27192             jmp music               
                      27193                             
000C7F                27194     music_b4:               
000C7F 7A3E           27195             mov     Temp3, #62                              
000C81 7B04           27196             mov Temp4, #4           
000C83 7C02           27197             mov Temp5, #2           
000C85 0100       F   27198             jmp music               
                      27199                             
000C87                27200     music_e4:               
000C87 7AA4           27201             mov     Temp3, #164 ;41                                 
000C89 7B06           27202             mov Temp4, #6           
000C8B 7C03           27203             mov Temp5, #3           
000C8D 0100       F   27204             jmp music               
                      27205             
000C8F                27206     music_dl:               
000C8F 7A46           27207             mov     Temp3, #70 ;41                          
000C91 7B55           27208             mov Temp4, #85          
000C93 7C03           27209             mov Temp5, #3           
000C95 0100       F   27210             jmp music               
                      27211                             
000C97                27212     music_f1:               
000C97 7ADE           27213             mov     Temp3, #222                                                             
                               ;length of tone         
000C99 7B6E           27214             mov Temp4, #110         
000C9B 7C02           27215             mov Temp5, #2                                                                   
                               ;one ms ;frequency of tone 1=500, 2=1000, 3=1500                
000C9D 0100       F   27216             jmp music               
                      27217                             
000C9F                27218     music_f2:               
000C9F 7A84           27219             mov     Temp3, #132                                                             
                               ;length of tone         
000CA1 7B2B           27220             mov Temp4, #43          
000CA3 7C03           27221             mov Temp5, #3                                                                   
                               ;one ms ;frequency of tone 1=500, 2=1000, 3=1500                
000CA5 0100       F   27222             jmp music               
                      27223                             
000CA7                27224     music_f3:               
000CA7 7A84           27225             mov     Temp3, #132                                                             
                               ;length of tone         
000CA9 7B1D           27226             mov Temp4, #29          
000CAB 7C02           27227             mov Temp5, #2                                                                   
                               ;one ms ;frequency of tone 1=500, 2=1000, 3=1500                
000CAD 0100       F   27228             jmp music               
                      27229                             
000CAF                27230     music_f4:               
000CAF 7A58           27231             mov     Temp3, #88 ;44                          
000CB1 7BAC           27232             mov Temp4, #172         
000CB3 7C02           27233             mov Temp5, #2           
000CB5 0100       F   27234             jmp music               
                      27235                             
000CB7                27236     music_e4n:              
000CB7 7A58           27237             mov     Temp3, #88 ;44                          
000CB9 7B14           27238             mov Temp4, #20          
000CBB 7C03           27239             mov Temp5, #3           
000CBD 0100       F   27240             jmp music               
                      27241                             
000CBF                27242     music_g4:               
000CBF 7A62           27243             mov     Temp3, #98 ;49                          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   453

000CC1 7B6E           27244             mov Temp4, #110         
000CC3 7C02           27245             mov Temp5, #2           
000CC5 0100       F   27246             jmp music               
                      27247                             
000CC7                27248     music_g4_custom:                
000CC7 7A2D           27249             mov     Temp3, #45 ;49                          
000CC9 7B6E           27250             mov Temp4, #110         
000CCB 7C02           27251             mov Temp5, #2           
000CCD 0100       F   27252             jmp music       
                      27253                             
000CCF                27254     music_fs4:              
000CCF 7A5E           27255             mov     Temp3, #94 ;49                          
000CD1 7B96           27256             mov Temp4, #150         
000CD3 7C02           27257             mov Temp5, #2           
000CD5 0100       F   27258             jmp music               
                      27259                             
000CD7                27260     music_c:                
000CD7 7A41           27261             mov     Temp3, #65                              
000CD9 7BB6           27262             mov Temp4, #182         
000CDB 7C01           27263             mov Temp5, #1           
000CDD 0100       F   27264             jmp music               
                      27265                             
000CDF                27266     music_csl:              
000CDF 7A46           27267             mov     Temp3, #70 ;41                          
000CE1 7B7D           27268             mov Temp4, #125         
000CE3 7C03           27269             mov Temp5, #3           
000CE5 0100       F   27270             jmp music       
                      27271                                     
000CE7                27272     music_cs:               
000CE7 7A45           27273             mov     Temp3, #69 ;41                          
000CE9 7B9B           27274             mov Temp4, #155         
000CEB 7C01           27275             mov Temp5, #1           
000CED 0100       F   27276             jmp music       
                      27277                                     
000CEF                27278     music_d:                
000CEF 7A49           27279             mov     Temp3, #73                              
000CF1 7B8C           27280             mov Temp4, #140         
000CF3 7C01           27281             mov Temp5, #1           
000CF5 8038           27282             jmp music               
000CF7                27283     music_d2:               
000CF7 7A92           27284             mov     Temp3, #146 ;73                                 
000CF9 7B8C           27285             mov Temp4, #140         
000CFB 7C01           27286             mov Temp5, #1           
000CFD 8030           27287             jmp music                       
                      27288             
000CFF                27289     music_ds:               
000CFF 7A4E           27290             mov     Temp3, #78                              
000D01 7B79           27291             mov Temp4, #121         
000D03 7C01           27292             mov Temp5, #1           
000D05 8028           27293             jmp music               
                      27294     
000D07                27295     music_e:                
000D07 7A52           27296             mov     Temp3, #82                              
000D09 7B67           27297             mov Temp4, #103         
000D0B 7C01           27298             mov Temp5, #1           
000D0D 8020           27299             jmp music               
                      27300     
000D0F                27301     music_e2:               
000D0F 7AA4           27302             mov     Temp3, #164                             
000D11 7B67           27303             mov Temp4, #103         
000D13 7C01           27304             mov Temp5, #1           
000D15 8018           27305             jmp music               
                      27306     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   454

000D17                27307     music_f:                
000D17 7A57           27308             mov     Temp3, #87                              
000D19 7B56           27309             mov Temp4, #86          
000D1B 7C01           27310             mov Temp5, #1           
000D1D 8010           27311             jmp music               
                      27312     
000D1F                27313     music_g:                
000D1F 7AC4           27314             mov     Temp3, #196 ;98                                 
000D21 7B37           27315             mov Temp4, #55          
000D23 7C01           27316             mov Temp5, #1
000D25 8008           27317             jmp music       
                      27318     
000D27                27319     music_g_custom:         
000D27 7A58           27320             mov     Temp3, #88 ;98                          
000D29 7B37           27321             mov Temp4, #55          
000D2B 7C01           27322             mov Temp5, #1
000D2D 8000           27323             jmp music
                      27324     
000D2F                27325     music:          
000D2F EC             27326             mov A, Temp5            
000D30 C0E0           27327             push ACC                
                      27328                             
                      27329             BcomFET_on                                                                      
                                       ; BcomFET on                            
*** ____________________________________^
*** ERROR #A9 IN 27329 (BLHeli_S.asm, LINE 3711): SYNTAX ERROR
                      27330             ApwmFET_on                                                                      
                                       ; ApwmFET on                            
*** ____________________________________^
*** ERROR #A9 IN 27330 (BLHeli_S.asm, LINE 3712): SYNTAX ERROR
000D32 E500       F   27331             mov     A, Beep_Strength                                
000D34 D5E0FD         27332             djnz    ACC, $                                          
                      27333             ApwmFET_off                                                                     
                                       ; ApwmFET off                           
*** ____________________________________^
*** ERROR #A9 IN 27333 (BLHeli_S.asm, LINE 3715): SYNTAX ERROR
                      27334             BcomFET_off                                                                     
                                       ; BcomFET off                           
*** ____________________________________^
*** ERROR #A9 IN 27334 (BLHeli_S.asm, LINE 3716): SYNTAX ERROR
000D37 D0E0           27335             pop ACC         
000D39 FC             27336             mov Temp5, A            
000D3A F9             27337             mov Temp2, A                                                                    
                               ; Make copy of Temp5 to work with (Temp2)               
000D3B EB             27338             mov A, Temp4            
000D3C FD             27339             mov Temp6, A            
000D3D                27340     music_O_loop:                                                                           
                               ; Outer loop            
000D3D 7817           27341             mov     Temp1, #23                                                              
                                       ; Number of times to repeat inner delay loop            
000D3F                27342     music_M_loop:                                                                           
                               ; Middle loop           
000D3F E4             27343             clr     A               
000D40 D5E0FD         27344             djnz    ACC, $                                                                  
                               ; Inner loop (42.7us - 1024 cycles)             
000D43 D8FA           27345             djnz    Temp1, music_M_loop             
000D45 D9F6           27346             djnz    Temp2, music_O_loop             
                      27347                             
000D47                27348     wait_150us:             
000D47 741E           27349             mov             A, #30                                                          
                                       ;5us wait               
000D49 D5E0FD         27350             djnz    ACC, $          
000D4C DDF9           27351             djnz    Temp6, wait_150us                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   455

000D4E DADF           27352             djnz    Temp3, music                                                    ; length
                                of tone                
                      27353             
000D50 22             27354     ret
                      27355     
000D51                27356     Protocol_ID:
                      27357             Clear_LED_0
*** ____________________________________^
*** ERROR #A9 IN 27357 (BLHeli_S.asm, LINE 3739): SYNTAX ERROR
000D51 120000     F   27358             call wait30ms
                      27359             Set_LED_1
*** ____________________________________^
*** ERROR #A9 IN 27359 (BLHeli_S.asm, LINE 3741): SYNTAX ERROR
000D54 7402           27360             mov A, #02
000D56 20000E         27361             jb      Flags2.RCP_ONESHOT125, IDbeep_loop
000D59 04             27362             inc A
000D5A 20000A         27363             jb      Flags2.RCP_ONESHOT42, IDbeep_loop
000D5D 04             27364             inc A
000D5E 200006         27365             jb      Flags2.RCP_MULTISHOT, IDbeep_loop
000D61 04             27366             inc A
000D62 200002         27367             jb      Flags2.RCP_DSHOT, IDbeep_loop
000D65 7401           27368             mov A, #01
                      27369             
000D67                27370     IDbeep_loop:
000D67 C0E0           27371             push ACC
000D69 1100       F   27372             call beep_f1
000D6B 120000     F   27373             call wait100ms
000D6E D0E0           27374             pop ACC
000D70 D5E0F4         27375             djnz    ACC, IDbeep_loop
000D73 22             27376     ret
                      27377     
000D74                27378     Arm_beep:
000D74 30001E         27379     jnb Flags2.RCP_DSHOT, Armed_Beep
000D77 E500       F   27380     mov     A, DShot_Frame_Length_Thr   ; 20=Dshot600 40=Dshot300 80=Dshot150
000D79 C3             27381     clr C
000D7A 941E           27382     subb A, #30
000D7C 400C           27383     jc ID_Dshot600
000D7E 941E           27384     subb A, #30
000D80 4002           27385     jc ID_Dshot300
000D82 8011           27386     jmp Armed_Beep
                      27387     
000D84                27388     ID_Dshot300:
000D84 1100       F   27389     call beep_f3
000D86 1100       F   27390     call beep_f3
000D88 800B           27391     jmp Armed_Beep
                      27392     
000D8A                27393     ID_Dshot600:
000D8A 1100       F   27394     call beep_f2
000D8C 1100       F   27395     call beep_f2
000D8E 120000     F   27396     call wait100ms
000D91 1100       F   27397     call beep_f3
000D93 1100       F   27398     call beep_f3
000D95                27399     Armed_Beep:
000D95 120000     F   27400     call wait100ms
000D98 1100       F   27401     call beep_f4
000D9A 1100       F   27402     call beep_f4
000D9C 22             27403     ret
                      27404     
                      27405     
                      27406     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27407     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27408     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27409     ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   456

                      27410     ; Main program start
                      27411     ;
                      27412     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27413     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27414     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27415     
000D9D                27416     pgm_start:
                      27417             ; Initialize flash keys to invalid values
000D9D 750000     F   27418             mov     Flash_Key_1, #0
000DA0 750000     F   27419             mov     Flash_Key_2, #0
                      27420             ; Disable the WDT.
000DA3                27421             mov     WDTCN, #0DEh            ; Disable watchdog
*** ____________________________________________^
*** ERROR #A45 IN 27421 (BLHeli_S.asm, LINE 3803): UNDEFINED SYMBOL
000DA6                27422             mov     WDTCN, #0ADh            
*** ____________________________________________^
*** ERROR #A45 IN 27422 (BLHeli_S.asm, LINE 3804): UNDEFINED SYMBOL
                      27423             ; Initialize stack
000DA9 7581C0         27424             mov     SP, #0c0h                       ; Stack = 64 upper bytes of RAM
                      27425             ; Initialize VDD monitor
000DAC                27426             orl     VDM0CN, #080h           ; Enable the VDD monitor
*** ____________________________________________^
*** ERROR #A45 IN 27426 (BLHeli_S.asm, LINE 3808): UNDEFINED SYMBOL
                      27427             
000DAF                27428             mov     RSTSRC, #06h    ; Set missing clock and VDD monitor as a reset source if
                                not 1S capable
*** ____________________________________________^
*** ERROR #A45 IN 27428 (BLHeli_S.asm, LINE 3810): UNDEFINED SYMBOL
                      27429     
                      27430             ; Set clock frequency
000DB2                27431             mov     CLKSEL, #00h            ; Set clock divider to 1
*** ____________________________________________^
*** ERROR #A45 IN 27431 (BLHeli_S.asm, LINE 3813): UNDEFINED SYMBOL
                      27432             ; Switch power off
000DB5 1100       F   27433             call    switch_power_off
                      27434             ; Ports initialization
000DB7                27435             mov     P0, #P0_INIT
*** ____________________________________________^
*** _________________________________________________^
*** ERROR #A45 IN 27435 (BLHeli_S.asm, LINE 3817): UNDEFINED SYMBOL
*** ERROR #A45 IN 27435 (BLHeli_S.asm, LINE 3817): UNDEFINED SYMBOL
000DBA                27436             mov     P0MDIN, #P0_DIGITAL
*** ____________________________________________^
*** _____________________________________________________^
*** ERROR #A45 IN 27436 (BLHeli_S.asm, LINE 3818): UNDEFINED SYMBOL
*** ERROR #A45 IN 27436 (BLHeli_S.asm, LINE 3818): UNDEFINED SYMBOL
000DBD                27437             mov     P0MDOUT, #P0_PUSHPULL
*** ____________________________________________^
*** ______________________________________________________^
*** ERROR #A45 IN 27437 (BLHeli_S.asm, LINE 3819): UNDEFINED SYMBOL
*** ERROR #A45 IN 27437 (BLHeli_S.asm, LINE 3819): UNDEFINED SYMBOL
000DC0                27438             mov     P0, #P0_INIT
*** ____________________________________________^
*** _________________________________________________^
*** ERROR #A45 IN 27438 (BLHeli_S.asm, LINE 3820): UNDEFINED SYMBOL
*** ERROR #A45 IN 27438 (BLHeli_S.asm, LINE 3820): UNDEFINED SYMBOL
000DC3                27439             mov     P0SKIP, #P0_SKIP                                
*** ____________________________________________^
*** _____________________________________________________^
*** ERROR #A45 IN 27439 (BLHeli_S.asm, LINE 3821): UNDEFINED SYMBOL
*** ERROR #A45 IN 27439 (BLHeli_S.asm, LINE 3821): UNDEFINED SYMBOL
000DC6                27440             mov     P1, #P1_INIT
*** ____________________________________________^
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   457

*** _________________________________________________^
*** ERROR #A45 IN 27440 (BLHeli_S.asm, LINE 3822): UNDEFINED SYMBOL
*** ERROR #A45 IN 27440 (BLHeli_S.asm, LINE 3822): UNDEFINED SYMBOL
000DC9                27441             mov     P1MDIN, #P1_DIGITAL
*** ____________________________________________^
*** _____________________________________________________^
*** ERROR #A45 IN 27441 (BLHeli_S.asm, LINE 3823): UNDEFINED SYMBOL
*** ERROR #A45 IN 27441 (BLHeli_S.asm, LINE 3823): UNDEFINED SYMBOL
000DCC                27442             mov     P1MDOUT, #P1_PUSHPULL
*** ____________________________________________^
*** ______________________________________________________^
*** ERROR #A45 IN 27442 (BLHeli_S.asm, LINE 3824): UNDEFINED SYMBOL
*** ERROR #A45 IN 27442 (BLHeli_S.asm, LINE 3824): UNDEFINED SYMBOL
000DCF                27443             mov     P1, #P1_INIT
*** ____________________________________________^
*** _________________________________________________^
*** ERROR #A45 IN 27443 (BLHeli_S.asm, LINE 3825): UNDEFINED SYMBOL
*** ERROR #A45 IN 27443 (BLHeli_S.asm, LINE 3825): UNDEFINED SYMBOL
000DD2                27444             mov     P1SKIP, #P1_SKIP                                
*** ____________________________________________^
*** _____________________________________________________^
*** ERROR #A45 IN 27444 (BLHeli_S.asm, LINE 3826): UNDEFINED SYMBOL
*** ERROR #A45 IN 27444 (BLHeli_S.asm, LINE 3826): UNDEFINED SYMBOL
000DD5                27445             mov     P2MDOUT, #P2_PUSHPULL                           
*** ____________________________________________^
*** ______________________________________________________^
*** ERROR #A45 IN 27445 (BLHeli_S.asm, LINE 3827): UNDEFINED SYMBOL
*** ERROR #A45 IN 27445 (BLHeli_S.asm, LINE 3827): UNDEFINED SYMBOL
                      27446             ; Initialize the XBAR and related functionality
                      27447             Initialize_Xbar
*** ____________________________________^
*** ERROR #A9 IN 27447 (BLHeli_S.asm, LINE 3829): SYNTAX ERROR
                      27448             ; Switch power off again, after initializing ports
000DD8 1100       F   27449             call    switch_power_off
                      27450             ; Clear RAM
000DDA E4             27451             clr     A                               ; Clear accumulator
000DDB F8             27452             mov     Temp1, A                        ; Clear Temp1
000DDC                27453             clear_ram:      
000DDC F6             27454             mov     @Temp1, A                       ; Clear RAM
000DDD D8FD           27455             djnz Temp1, clear_ram   ; Is A not zero? - jump
                      27456             ; Set default programmed parameters
000DDF 1100       F   27457             call    set_default_parameters
                      27458             ; Read all programmed parameters
000DE1 120000     F   27459             call read_all_eeprom_parameters
                      27460             ; Set beep strength
000DE4 7800       F   27461             mov     Temp1, #Pgm_Beep_Strength
000DE6 8600       F   27462             mov     Beep_Strength, @Temp1
                      27463             ; Set initial arm variable
000DE8 750001     F   27464             mov     Initial_Arm, #1
                      27465             ; Initializing beep
000DEB                27466             clr     IE_EA                   ; Disable interrupts explicitly
*** ____________________________________________^
*** ERROR #A45 IN 27466 (BLHeli_S.asm, LINE 3848): UNDEFINED SYMBOL
000DED 120000     F   27467             call wait200ms  
000DF0 1100       F   27468             call led_control
000DF2 120000     F   27469             call wait200ms
000DF5 120000     F   27470             call wait200ms
                      27471             
                      27472     ; ESC startup tone              
                      27473     ;-------------------------------------------------------                
                      27474     ;                       Tone Decision Logic             
                      27475     ;               
                      27476     ; Choose Music Routine based on Beacon Delay Setting            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   458

                      27477     ; --------------------          
                      27478     ; 1) OEM Tones          
                      27479     ; 2) CZ Tones           
                      27480     ; 3) Game of Thrones Startup Tone               
                      27481     ; 4) Imperial March Startup Tone                
                      27482     ; 5) Harrison Gale              
                      27483             
000DF8 E500       F   27484             mov     A, Beep_Strength                                                
000DFA 14             27485             dec A           
000DFB 7005           27486             jnz     Tone_Selection
000DFD D200       F   27487             setb Flags3.MUTE                
000DFF 020000     F   27488             ljmp startup_end                
                      27489                             
000E02                27490     Tone_Selection:
                      27491             Set_LED_0
*** ____________________________________^
*** ERROR #A9 IN 27491 (BLHeli_S.asm, LINE 3873): SYNTAX ERROR
000E02 C200       F   27492             clr Flags3.MUTE
000E04 9459           27493             subb A, #89
000E06 14             27494             dec A           
000E07 603A           27495             jz Startup_IM           
000E09 14             27496             dec A           
000E0A 600C           27497             jz Startup_CZ                                                           
000E0C 14             27498             dec A           
000E0D 6059           27499             jz Startup_GoT                                                                  
                                       
000E0F 14             27500             dec A           
000E10 6003           27501             jz HG_Bounce            
000E12 020000     F   27502             ljmp OEM_Tones
                      27503     
000E15                27504     HG_Bounce:
000E15 020000     F   27505             ljmp Startup_HG 
                      27506                                                                                             
                                       
000E18                27507     Startup_CZ:             
000E18 120000     F   27508             call wait30ms   
000E1B 1100       F   27509             call music_e
000E1D 120000     F   27510             call wait30ms   
000E20 1100       F   27511             call music_e    
000E22 120000     F   27512             call wait100ms  
000E25 120000     F   27513             call wait30ms
000E28 1100       F   27514             call music_e    
000E2A 120000     F   27515             call wait100ms  
000E2D 1100       F   27516             call music_c    
000E2F 120000     F   27517             call wait30ms                   
000E32 1100       F   27518             call music_e
000E34 120000     F   27519             call wait100ms  
000E37 1100       F   27520             call music_g_custom
000E39 120000     F   27521             call wait200ms  
000E3C 120000     F   27522             call wait200ms  
000E3F 1100       F   27523             call music_g4_custom
000E41 0100       F   27524             jmp startup_end                         
                      27525                             
000E43                27526     Startup_IM:             
000E43 120000     F   27527             call wait200ms          
000E46 1100       F   27528             call music_f1           
000E48 120000     F   27529             call wait100ms          
000E4B 1100       F   27530             call music_f1           
000E4D 120000     F   27531             call wait100ms          
000E50 1100       F   27532             call music_f1           
000E52 120000     F   27533             call wait100ms          
000E55 1100       F   27534             call music_f2           
000E57 1100       F   27535             call music_f3           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   459

000E59 1100       F   27536             call music_f1           
000E5B 120000     F   27537             call wait100ms          
000E5E 1100       F   27538             call music_f2           
000E60 1100       F   27539             call music_f3           
000E62 1100       F   27540             call music_f1           
000E64 1100       F   27541             call music_f1           
000E66 0100       F   27542             jmp startup_end
                      27543                             
000E68                27544     Startup_GoT:            
000E68 120000     F   27545             call wait200ms                  
000E6B 1100       F   27546             call music_g            
000E6D 120000     F   27547             call wait10ms           
000E70 1100       F   27548             call music_c            
000E72 1100       F   27549             call music_c            
000E74 120000     F   27550             call wait10ms           
000E77 1100       F   27551             call music_ds           
000E79 120000     F   27552             call wait10ms           
000E7C 1100       F   27553             call music_f            
000E7E 120000     F   27554             call wait10ms           
000E81 1100       F   27555             call music_g            
000E83 120000     F   27556             call wait10ms           
000E86 1100       F   27557             call music_c            
000E88 1100       F   27558             call music_c            
000E8A 120000     F   27559             call wait10ms           
000E8D 1100       F   27560             call music_ds           
000E8F 120000     F   27561             call wait10ms           
000E92 1100       F   27562             call music_f            
000E94 120000     F   27563             call wait10ms           
000E97 1100       F   27564             call music_g            
000E99 120000     F   27565             call wait10ms           
000E9C 1100       F   27566             call music_c            
000E9E 1100       F   27567             call music_c            
000EA0 120000     F   27568             call wait10ms           
000EA3 1100       F   27569             call music_ds           
000EA5 120000     F   27570             call wait10ms           
000EA8 1100       F   27571             call music_f            
000EAA 120000     F   27572             call wait10ms           
000EAD 1100       F   27573             call music_g            
000EAF 120000     F   27574             call wait10ms           
000EB2 1100       F   27575             call music_c            
000EB4 1100       F   27576             call music_c            
000EB6 120000     F   27577             call wait10ms           
000EB9 1100       F   27578             call music_ds           
000EBB 120000     F   27579             call wait10ms           
000EBE 1100       F   27580             call music_f            
000EC0 120000     F   27581             call wait10ms           
000EC3 1100       F   27582             call music_d2           
000EC5 120000     F   27583             call wait10ms           
000EC8 1100       F   27584             call music_g4           
000ECA 120000     F   27585             call wait10ms           
000ECD 1100       F   27586             call music_as4          
000ECF 120000     F   27587             call wait10ms           
000ED2 1100       F   27588             call music_c            
000ED4 120000     F   27589             call wait10ms           
000ED7 1100       F   27590             call music_d2           
000ED9 120000     F   27591             call wait10ms           
000EDC 1100       F   27592             call music_g4           
000EDE 120000     F   27593             call wait10ms           
000EE1 1100       F   27594             call music_as4          
000EE3 120000     F   27595             call wait10ms           
000EE6 1100       F   27596             call music_c            
000EE8 120000     F   27597             call wait10ms           
000EEB 1100       F   27598             call music_d2           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   460

000EED 120000     F   27599             call wait10ms           
000EF0 1100       F   27600             call music_g4           
000EF2 120000     F   27601             call wait10ms           
000EF5 1100       F   27602             call music_as4          
000EF7 120000     F   27603             call wait10ms           
000EFA 1100       F   27604             call music_c            
000EFC 120000     F   27605             call wait10ms           
000EFF 1100       F   27606             call music_d2           
000F01 120000     F   27607             call wait10ms           
000F04 1100       F   27608             call music_g4           
000F06 120000     F   27609             call wait10ms           
000F09 1100       F   27610             call music_as4          
000F0B 120000     F   27611             call wait10ms           
000F0E 1100       F   27612             call music_c            
000F10 120000     F   27613             call wait10ms           
000F13 1100       F   27614             call music_f            
000F15 1100       F   27615             call music_f            
000F17 120000     F   27616             call wait10ms           
000F1A 1100       F   27617             call music_f4                   
000F1C 0100       F   27618             jmp startup_end
                      27619                             
000F1E                27620     Startup_HG:                     
000F1E 1100       F   27621             call music_e            
000F20 1100       F   27622             call music_d                    
000F22 1100       F   27623             call music_fs4          
000F24 1100       F   27624             call music_gs4  
000F26 1100       F   27625             call music_cs
000F28 1100       F   27626             call music_b4   
000F2A 1100       F   27627             call music_dl           
000F2C 1100       F   27628             call music_e4n
000F2E 1100       F   27629             call music_b4           
000F30 1100       F   27630             call music_a4_custom    
000F32 1100       F   27631             call music_csl          
000F34 1100       F   27632             call music_e4n          
000F36 1100       F   27633             call music_a4_custom            
000F38 1100       F   27634             call music_a4_custom
000F3A 1100       F   27635             call music_a4_custom
000F3C 1100       F   27636             call music_a4_custom    
000F3E 0100       F   27637             jmp startup_end                         
                      27638     
000F40                27639     OEM_Tones:              
000F40 1100       F   27640             call beep_f1
000F42 120000     F   27641             call wait30ms           
000F45 1100       F   27642             call beep_f2                            
000F47 120000     F   27643             call wait30ms
000F4A 1100       F   27644             call beep_f3            
                      27645     
000F4C                27646     startup_end:                    ; end esc startup tone          
000F4C 120000     F   27647             call wait30ms                           
                      27648     
                      27649     
                      27650     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27651     ;
                      27652     ; No signal entry point
                      27653     ;
                      27654     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000F4F                27655     init_no_signal:
                      27656             ; Disable interrupts explicitly
000F4F                27657             clr     IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 27657 (BLHeli_S.asm, LINE 4039): UNDEFINED SYMBOL
                      27658             ; Initialize flash keys to invalid values
000F51 750000     F   27659             mov     Flash_Key_1, #0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   461

000F54 750000     F   27660             mov     Flash_Key_2, #0
                      27661             ; Check if input signal is high for more than 15ms
000F57 78FA           27662             mov     Temp1, #250
000F59                27663     input_high_check_1:
000F59 79FA           27664             mov     Temp2, #250
000F5B                27665     input_high_check_2:
000F5B                27666             jnb     RTX_PORT.RTX_PIN, bootloader_done       ; Look for low
*** _____________________________________________________^
*** ERROR #A18 IN 27666 (BLHeli_S.asm, LINE 4048): OUT OF RANGE OR TYPELESS BIT-OFFSET REQUIRED
000F5D D9FC           27667             djnz    Temp2, input_high_check_2
000F5F D8F8           27668             djnz    Temp1, input_high_check_1
                      27669     
000F61 021C00         27670             ljmp    1C00h                   ; Jump to bootloader
                      27671     
000F62                27672     bootloader_done:
                      27673             ; Decode settings
000F64 1100       F   27674             call    decode_settings
                      27675             ; Find throttle gain from stored min and max settings
000F66 1100       F   27676             call    find_throttle_gains
                      27677             ; Set beep strength
000F68 7800       F   27678             mov     Temp1, #Pgm_Beep_Strength
000F6A 8600       F   27679             mov     Beep_Strength, @Temp1
                      27680             ; Switch power off
000F6C 1100       F   27681             call    switch_power_off
                      27682             ; Set clock frequency
                      27683     IF 1 == 1
                      27684             Set_MCU_Clk_24MHz
*** ____________________________________^
*** ERROR #A9 IN 27684 (BLHeli_S.asm, LINE 4066): SYNTAX ERROR
                      27685     ENDIF
                      27686             ; Setup timers for pwm input
000F6E                27687             mov     IT01CF, #RTX_PIN        ; Route RCP input to INT0
*** ____________________________________________^
*** _____________________________________________________^
*** ERROR #A45 IN 27687 (BLHeli_S.asm, LINE 4069): UNDEFINED SYMBOL
*** ERROR #A45 IN 27687 (BLHeli_S.asm, LINE 4069): UNDEFINED SYMBOL
000F71                27688             mov     TCON, #11h              ; Timer 0 run and INT0 edge triggered
*** ____________________________________________^
*** ERROR #A45 IN 27688 (BLHeli_S.asm, LINE 4070): UNDEFINED SYMBOL
000F74                27689             mov     CKCON0, #04h            ; Timer 0 clock is system clock
*** ____________________________________________^
*** ERROR #A45 IN 27689 (BLHeli_S.asm, LINE 4071): UNDEFINED SYMBOL
000F77                27690             mov     TMOD, #09h              ; Timer 0 set to 16bits and gated by INT0
*** ____________________________________________^
*** ERROR #A45 IN 27690 (BLHeli_S.asm, LINE 4072): UNDEFINED SYMBOL
000F7A                27691             mov     TMR2CN0, #04h           ; Timer 2 enabled
*** ____________________________________________^
*** ERROR #A45 IN 27691 (BLHeli_S.asm, LINE 4073): UNDEFINED SYMBOL
000F7D                27692             mov     TMR3CN0, #04h           ; Timer 3 enabled
*** ____________________________________________^
*** ERROR #A45 IN 27692 (BLHeli_S.asm, LINE 4074): UNDEFINED SYMBOL
                      27693             Initialize_PCA                  ; Initialize PCA
*** ____________________________________^
*** ERROR #A9 IN 27693 (BLHeli_S.asm, LINE 4075): SYNTAX ERROR
                      27694             Set_Pwm_Polarity                ; Set pwm polarity
*** ____________________________________^
*** ERROR #A9 IN 27694 (BLHeli_S.asm, LINE 4076): SYNTAX ERROR
                      27695             Enable_Power_Pwm_Module ; Enable power pwm module
*** ____________________________________^
*** ERROR #A9 IN 27695 (BLHeli_S.asm, LINE 4077): SYNTAX ERROR
                      27696             Enable_Damp_Pwm_Module  ; Enable damping pwm module
*** ____________________________________^
*** ERROR #A9 IN 27696 (BLHeli_S.asm, LINE 4078): SYNTAX ERROR
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   462

                      27697             ; Enable interrupts
                      27698     IF 1 == 0
                                        mov     IE, #21h                        ; Enable timer 2 interrupts and INT0 int
                               errupts
                                ELSE
000F80                27701             mov     IE, #23h                        ; Enable timer 0, timer 2 interrupts and
                                INT0 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 27701 (BLHeli_S.asm, LINE 4083): UNDEFINED SYMBOL
                      27702     ENDIF
000F83                27703             mov     EIE1, #90h              ; Enable timer 3 and PCA0 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 27703 (BLHeli_S.asm, LINE 4085): UNDEFINED SYMBOL
000F86                27704             mov     IP, #01h                        ; High priority to INT0 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 27704 (BLHeli_S.asm, LINE 4086): UNDEFINED SYMBOL
                      27705             ; Initialize comparator
                      27706             Initialize_Comparator   ; Initialize comparator
*** ____________________________________^
*** ERROR #A9 IN 27706 (BLHeli_S.asm, LINE 4088): SYNTAX ERROR
                      27707             ; Initialize ADC
                      27708             Initialize_Adc                  ; Initialize ADC operation
*** ____________________________________^
*** ERROR #A9 IN 27708 (BLHeli_S.asm, LINE 4090): SYNTAX ERROR
000F89 120000     F   27709             call    wait1ms
000F8C                27710             setb    IE_EA                   ; Enable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 27710 (BLHeli_S.asm, LINE 4092): UNDEFINED SYMBOL
                      27711             ; Reset stall count
000F8E 750000     F   27712             mov     Stall_Cnt, #0
                      27713             ; Initialize RC pulse
000F91 C200       F   27714             clr     Flags2.RCP_UPDATED                      ; Clear updated flag
000F93 120000     F   27715             call wait200ms
                      27716             ; Clear all shot flags
000F96 C200       F   27717             clr     Flags2.RCP_ONESHOT125                   ; Clear OneShot125 flag
000F98 C200       F   27718             clr     Flags2.RCP_ONESHOT42                    ; Clear OneShot42 flag
000F9A C200       F   27719             clr     Flags2.RCP_MULTISHOT                    ; Clear Multishot flag
000F9C C200       F   27720             clr     Flags2.RCP_DSHOT                                ; Clear DShot flag
                      27721             ; Test whether signal is regular pwm
000F9E 750000     F   27722             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
000FA1 120000     F   27723             call wait100ms                                          ; Wait for new RC pulse
000FA4 C3             27724             clr     C
000FA5 E500       F   27725             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses 
                               were outside normal range ("900-2235us")
000FA7 940A           27726             subb    A, #10                                          
000FA9 5002           27727             jnc     ($+4)
000FAB 0100       F   27728             ajmp    validate_rcp_start
                      27729     
                      27730             ; Test whether signal is OneShot125
000FAD D200       F   27731             setb    Flags2.RCP_ONESHOT125                   ; Set OneShot125 flag
000FAF 750000     F   27732             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
000FB2 120000     F   27733             call wait100ms                                          ; Wait for new RC pulse
000FB5 C3             27734             clr     C
000FB6 E500       F   27735             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses 
                               were outside normal range ("900-2235us")
000FB8 940A           27736             subb    A, #10
000FBA 5002           27737             jnc     ($+4)
000FBC 0100       F   27738             ajmp    validate_rcp_start
                      27739     
                      27740             ; Test whether signal is OneShot42
000FBE C200       F   27741             clr     Flags2.RCP_ONESHOT125
000FC0 D200       F   27742             setb    Flags2.RCP_ONESHOT42                    ; Set OneShot42 flag
000FC2 750000     F   27743             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   463

000FC5 120000     F   27744             call wait100ms                                          ; Wait for new RC pulse
000FC8 C3             27745             clr     C
000FC9 E500       F   27746             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses 
                               were outside normal range ("900-2235us")
000FCB 940A           27747             subb    A, #10
000FCD 5002           27748             jnc     ($+4)
000FCF 0100       F   27749             ajmp    validate_rcp_start
                      27750     
                      27751             ; Setup timers for DShot
000FD1                27752             mov     IT01CF, #(80h+(RTX_PIN SHL 4)+(RTX_PIN))        ; Route RCP input to INT
                               0/1, with INT1 inverted
*** ____________________________________________^
*** ___________________________________________________________________________^
*** ERROR #A45 IN 27752 (BLHeli_S.asm, LINE 4134): UNDEFINED SYMBOL
*** ERROR #A45 IN 27752 (BLHeli_S.asm, LINE 4134): UNDEFINED SYMBOL
000FD4                27753             mov     TCON, #51h              ; Timer 0/1 run and INT0 edge triggered
*** ____________________________________________^
*** ERROR #A45 IN 27753 (BLHeli_S.asm, LINE 4135): UNDEFINED SYMBOL
000FD7                27754             mov     CKCON0, #01h            ; Timer 0/1 clock is system clock divided by 4 (
                               for DShot150)
*** ____________________________________________^
*** ERROR #A45 IN 27754 (BLHeli_S.asm, LINE 4136): UNDEFINED SYMBOL
000FDA                27755             mov     TMOD, #0AAh             ; Timer 0/1 set to 8bits auto reload and gated b
                               y INT0
*** ____________________________________________^
*** ERROR #A45 IN 27755 (BLHeli_S.asm, LINE 4137): UNDEFINED SYMBOL
000FDD                27756             mov     TH0, #0                 ; Auto reload value zero
*** ____________________________________________^
*** ERROR #A45 IN 27756 (BLHeli_S.asm, LINE 4138): UNDEFINED SYMBOL
000FE0                27757             mov     TH1, #0
*** ____________________________________________^
*** ERROR #A45 IN 27757 (BLHeli_S.asm, LINE 4139): UNDEFINED SYMBOL
                      27758             ; Setup interrupts for DShot
000FE3                27759             clr     IE_ET0                  ; Disable timer 0 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 27759 (BLHeli_S.asm, LINE 4141): UNDEFINED SYMBOL
000FE5                27760             setb    IE_ET1                  ; Enable timer 1 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 27760 (BLHeli_S.asm, LINE 4142): UNDEFINED SYMBOL
000FE7                27761             setb    IE_EX1                  ; Enable int1 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 27761 (BLHeli_S.asm, LINE 4143): UNDEFINED SYMBOL
                      27762             ; Setup variables for DSshot150
                      27763     IF 1 == 1
000FE9 750080     F   27764             mov     DShot_Timer_Preset, #128                        ; Load DShot sync timer 
                               preset (for DShot150)
                      27765     ELSE
                                        mov     DShot_Timer_Preset, #192
                                ENDIF
000FEC 750014     F   27768             mov     DShot_Pwm_Thr, #20                              ; Load DShot qualificati
                               on pwm threshold (for DShot150)
000FEF 750050     F   27769             mov     DShot_Frame_Length_Thr, #80             ; Load DShot frame length criter
                               ia
                      27770             ; Test whether signal is DShot150
000FF2 C200       F   27771             clr     Flags2.RCP_ONESHOT42
000FF4 D200       F   27772             setb    Flags2.RCP_DSHOT
000FF6 75000A     F   27773             mov     Rcp_Outside_Range_Cnt, #10              ; set out of range counter
000FF9 120000     F   27774             call wait100ms                                          ; Wait for new RC pulse
000FFC 750010     F   27775             mov     DShot_Pwm_Thr, #16                              ; Load DShot regular pwm
                                threshold
000FFF C3             27776             clr     C
001000 E500       F   27777             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were a
                               ccepted
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   464

001002 940A           27778             subb    A, #10
001004 405B           27779             jc      validate_rcp_start
                      27780     
                      27781             ; Setup variables for DShot300
001006                27782             mov     CKCON0, #0Ch                                    ; Timer 0/1 clock is sys
                               tem clock (for DShot300)
*** ____________________________________________^
*** ERROR #A45 IN 27782 (BLHeli_S.asm, LINE 4164): UNDEFINED SYMBOL
                      27783     IF 1 == 1
001009 750000     F   27784             mov     DShot_Timer_Preset, #0                  ; Load DShot sync timer preset (
                               for DShot300)
                      27785     ELSE
                                        mov     DShot_Timer_Preset, #128
                                ENDIF
00100C 750028     F   27788             mov     DShot_Pwm_Thr, #40                              ; Load DShot qualificati
                               on pwm threshold (for DShot300)
00100F 750028     F   27789             mov     DShot_Frame_Length_Thr, #40             ; Load DShot frame length criter
                               ia
                      27790             ; Test whether signal is DShot300
001012 75000A     F   27791             mov     Rcp_Outside_Range_Cnt, #10              ; set out of range counter
001015 120000     F   27792             call wait100ms                                          ; Wait for new RC pulse
001018 750020     F   27793             mov     DShot_Pwm_Thr, #32                              ; Load DShot regular pwm
                                threshold
00101B C3             27794             clr     C
00101C E500       F   27795             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were a
                               ccepted
00101E 940A           27796             subb    A, #10
001020 403F           27797             jc      validate_rcp_start
                      27798     
                      27799             ; Setup variables for DShot600
001022                27800             mov     CKCON0, #0Ch                                    ; Timer 0/1 clock is sys
                               tem clock (for DShot600)
*** ____________________________________________^
*** ERROR #A45 IN 27800 (BLHeli_S.asm, LINE 4182): UNDEFINED SYMBOL
                      27801     IF 1 == 1
001025 750050     F   27802             mov     DShot_Timer_Preset, #80                 ; Load DShot sync timer preset (
                               for DShot600)
                      27803     ELSE
                                        mov     DShot_Timer_Preset, #192
                                ENDIF
001028 750016     F   27806             mov     DShot_Pwm_Thr, #22                              ; Load DShot qualificati
                               on pwm threshold (for DShot600)
00102B 750017     F   27807             mov     DShot_Frame_Length_Thr, #23             ; Load DShot frame length criter
                               ia
                      27808             ; Test whether signal is DShot600
00102E 75000A     F   27809             mov     Rcp_Outside_Range_Cnt, #10              ; set out of range counter
001031 120000     F   27810             call wait100ms                                          ; Wait for new RC pulse
001034 750017     F   27811             mov     DShot_Pwm_Thr, #23                              ; Load DShot regular pwm
                                threshold
001037 C3             27812             clr     C
001038 E500       F   27813             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were a
                               ccepted
00103A 940A           27814             subb    A, #10
00103C 4023           27815             jc      validate_rcp_start
                      27816     
                      27817             ; Setup timers for Multishot
00103E                27818             mov     IT01CF, #RTX_PIN        ; Route RCP input to INT0
*** ____________________________________________^
*** _____________________________________________________^
*** ERROR #A45 IN 27818 (BLHeli_S.asm, LINE 4200): UNDEFINED SYMBOL
*** ERROR #A45 IN 27818 (BLHeli_S.asm, LINE 4200): UNDEFINED SYMBOL
001041                27819             mov     TCON, #11h              ; Timer 0 run and INT0 edge triggered
*** ____________________________________________^
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   465

*** ERROR #A45 IN 27819 (BLHeli_S.asm, LINE 4201): UNDEFINED SYMBOL
001044                27820             mov     CKCON0, #04h            ; Timer 0 clock is system clock
*** ____________________________________________^
*** ERROR #A45 IN 27820 (BLHeli_S.asm, LINE 4202): UNDEFINED SYMBOL
001047                27821             mov     TMOD, #09h              ; Timer 0 set to 16bits and gated by INT0
*** ____________________________________________^
*** ERROR #A45 IN 27821 (BLHeli_S.asm, LINE 4203): UNDEFINED SYMBOL
                      27822             ; Setup interrupts for Multishot
00104A                27823             setb    IE_ET0                  ; Enable timer 0 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 27823 (BLHeli_S.asm, LINE 4205): UNDEFINED SYMBOL
00104C                27824             clr     IE_ET1                  ; Disable timer 1 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 27824 (BLHeli_S.asm, LINE 4206): UNDEFINED SYMBOL
00104E                27825             clr     IE_EX1                  ; Disable int1 interrupts
*** ____________________________________________^
*** ERROR #A45 IN 27825 (BLHeli_S.asm, LINE 4207): UNDEFINED SYMBOL
                      27826             ; Test whether signal is Multishot
001050 C200       F   27827             clr     Flags2.RCP_DSHOT
001052 D200       F   27828             setb    Flags2.RCP_MULTISHOT                    ; Set Multishot flag
001054 750000     F   27829             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
001057 120000     F   27830             call wait100ms                                          ; Wait for new RC pulse
00105A C3             27831             clr     C
00105B E500       F   27832             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses 
                               were outside normal range ("900-2235us")
00105D 940A           27833             subb    A, #10
00105F 4000           27834             jc      validate_rcp_start
                      27835     
001061 0100       F   27836             ajmp    init_no_signal
                      27837     
001061                27838     validate_rcp_start:
                      27839             ; Validate RC pulse
001063 120000     F   27840             call wait3ms                                            ; Wait for new RC pulse
001066 200003         27841             jb      Flags2.RCP_UPDATED, ($+6)               ; Is there an updated RC pulse a
                               vailable - proceed
001069 020000     F   27842             ljmp    init_no_signal                                  ; Go back to detect inpu
                               t signal
                      27843     
                      27844             ; Beep arm sequence start signal
00106C                27845             clr     IE_EA                                           ; Disable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 27845 (BLHeli_S.asm, LINE 4227): UNDEFINED SYMBOL
00106E 120000     F   27846             call Protocol_ID
                      27847     ;       call beep_f1                                            ; Signal that RC pulse i
                               s ready
                      27848     ;       call beep_f1
                      27849     ;       call beep_f1
001071                27850             setb    IE_EA                                           ; Enable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 27850 (BLHeli_S.asm, LINE 4232): UNDEFINED SYMBOL
001073 120000     F   27851             call wait200ms  
                      27852     
                      27853             ; Arming sequence start
001074                27854     arming_start:
001076 200003         27855             jb      Flags2.RCP_DSHOT, ($+6) ; Disable tx programming for DShot
001079 300003         27856             jnb     Flags3.PGM_BIDIR, ($+6)
                      27857     
00107C 020000     F   27858             ljmp    program_by_tx_checked   ; Disable tx programming if bidirectional operat
                               ion
                      27859     
00107F 120000     F   27860             call wait3ms
001082 7800       F   27861             mov     Temp1, #Pgm_Enable_TX_Program; Start programming mode entry if enabled
001084 E6             27862             mov     A, @Temp1                               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   466

001085 C3             27863             clr     C
001086 9401           27864             subb    A, #1                           ; Is TX programming enabled?
001088 5000           27865             jnc     arming_initial_arm_check        ; Yes - proceed
                      27866     
00108A 0100       F   27867             jmp     program_by_tx_checked   ; No - branch
                      27868     
00108A                27869     arming_initial_arm_check:
00108C E500       F   27870             mov     A, Initial_Arm                  ; Yes - check if it is initial arm seque
                               nce
00108E C3             27871             clr     C
00108F 9401           27872             subb    A, #1                           ; Is it the initial arm sequence?
001091 5000           27873             jnc     arming_check                    ; Yes - proceed
                      27874     
001093 0100       F   27875             jmp     program_by_tx_checked   ; No - branch
                      27876     
001093                27877     arming_check:
                      27878             ; Initialize flash keys to valid values
001095 7500A5     F   27879             mov     Flash_Key_1, #0A5h
001098 7500F1     F   27880             mov     Flash_Key_2, #0F1h
                      27881             ; Throttle calibration and tx program entry
00109B 7F02           27882             mov     Temp8, #2                               ; Set 1 seconds wait time
00109B                27883     throttle_high_cal:                      
00109D D200       F   27884             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
00109F 120000     F   27885             call    find_throttle_gains             ; Set throttle gains
0010A2 120000     F   27886             call wait100ms                          ; Wait for new throttle value
0010A5                27887             clr     IE_EA                           ; Disable interrupts (freeze New_Rcp val
                               ue)
*** ____________________________________________^
*** ERROR #A45 IN 27887 (BLHeli_S.asm, LINE 4269): UNDEFINED SYMBOL
0010A7 C200       F   27888             clr     Flags2.RCP_FULL_RANGE   ; Set programmed range
0010A9 120000     F   27889             call    find_throttle_gains             ; Set throttle gains
0010AC C3             27890             clr     C
0010AD E500       F   27891             mov     A, New_Rcp                      ; Load new RC pulse value
0010AF 947F           27892             subb    A, #(255/2)                     ; Is RC pulse above midstick?
0010B1                27893             setb    IE_EA                           ; Enable interrupts
*** ____________________________________________^
*** ERROR #A45 IN 27893 (BLHeli_S.asm, LINE 4275): UNDEFINED SYMBOL
0010B3 406E           27894             jc      program_by_tx_checked   ; No - branch
                      27895     
0010B5 120000     F   27896             call wait1ms            
0010B8                27897             clr     IE_EA                           ; Disable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 27897 (BLHeli_S.asm, LINE 4279): UNDEFINED SYMBOL
0010BA 120000     F   27898             call beep_f4
0010BD                27899             setb    IE_EA                           ; Enable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 27899 (BLHeli_S.asm, LINE 4281): UNDEFINED SYMBOL
0010BF DFDA           27900             djnz    Temp8, throttle_high_cal        ; Continue to wait
                      27901     
0010C1 120000     F   27902             call    average_throttle
0010C4 C3             27903             clr     C
0010C5 EF             27904             mov     A, Temp8
0010C6 7800       F   27905             mov     Temp1, #Pgm_Max_Throttle        ; Store
0010C8 F6             27906             mov     @Temp1, A                       
0010C9 120000     F   27907             call wait200ms                          
0010CC 1100       F   27908             call    success_beep
                      27909     
0010CC                27910     throttle_low_cal_start:
0010CE 7F0A           27911             mov     Temp8, #10                      ; Set 3 seconds wait time
0010CE                27912     throttle_low_cal:                       
0010D0 D200       F   27913             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
0010D2 120000     F   27914             call    find_throttle_gains             ; Set throttle gains
0010D5 120000     F   27915             call wait100ms
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   467

0010D8                27916             clr     IE_EA                           ; Disable interrupts (freeze New_Rcp val
                               ue)
*** ____________________________________________^
*** ERROR #A45 IN 27916 (BLHeli_S.asm, LINE 4298): UNDEFINED SYMBOL
0010DA C200       F   27917             clr     Flags2.RCP_FULL_RANGE   ; Set programmed range
0010DC 120000     F   27918             call    find_throttle_gains             ; Set throttle gains
0010DF C3             27919             clr     C
0010E0 E500       F   27920             mov     A, New_Rcp                      ; Load new RC pulse value
0010E2 947F           27921             subb    A, #(255/2)                     ; Below midstick?
0010E4                27922             setb    IE_EA                           ; Enable interrupts
*** ____________________________________________^
*** ERROR #A45 IN 27922 (BLHeli_S.asm, LINE 4304): UNDEFINED SYMBOL
0010E6 50E4           27923             jnc     throttle_low_cal_start  ; No - start over
                      27924     
0010E8 120000     F   27925             call wait1ms            
0010EB                27926             clr     IE_EA                           ; Disable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 27926 (BLHeli_S.asm, LINE 4308): UNDEFINED SYMBOL
0010ED 120000     F   27927             call beep_f1
0010F0 120000     F   27928             call wait10ms
0010F3 120000     F   27929             call beep_f1
0010F6                27930             setb    IE_EA                           ; Enable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 27930 (BLHeli_S.asm, LINE 4312): UNDEFINED SYMBOL
0010F8 DFD4           27931             djnz    Temp8, throttle_low_cal ; Continue to wait
                      27932     
0010FA 120000     F   27933             call    average_throttle
0010FD EF             27934             mov     A, Temp8
0010FE 2403           27935             add     A, #3                           ; Add about 1%
001100 7800       F   27936             mov     Temp1, #Pgm_Min_Throttle        ; Store
001102 F6             27937             mov     @Temp1, A                       
001103 F8             27938             mov     Temp1, A                                ; Min throttle in Temp1
001104 7900       F   27939             mov     Temp2, #Pgm_Max_Throttle
001106 E7             27940             mov     A, @Temp2
001107 C3             27941             clr     C
001108 9423           27942             subb    A, #35                          ; Subtract 35 (140us) from max throttle
00110A 4001           27943             jc      program_by_tx_entry_limit
00110C 98             27944             subb    A, Temp1                                ; Subtract min from max
00110D 5004           27945             jnc     program_by_tx_entry_store
                      27946     
00110D                27947     program_by_tx_entry_limit:
00110F E8             27948             mov     A, Temp1                                ; Load min
001110 2423           27949             add     A, #35                          ; Make max 140us higher than min
001112 7800       F   27950             mov     Temp1, #Pgm_Max_Throttle        ; Store new max
001114 F6             27951             mov     @Temp1, A
                      27952     
001113                27953     program_by_tx_entry_store:
001115 120000     F   27954             call wait200ms                          
001118 1100       F   27955             call erase_and_store_all_in_eeprom      
00111A 1100       F   27956             call    success_beep_inverted
                      27957     
00111A                27958     program_by_tx_entry_wait:
00111C 120000     F   27959             call wait100ms
00111F 120000     F   27960             call    find_throttle_gains             ; Set throttle gains
001122 020000     F   27961             ljmp    init_no_signal                  ; Go back
                      27962     
001123                27963     program_by_tx_checked:
                      27964             ; Initialize flash keys to invalid values
001125 750000     F   27965             mov     Flash_Key_1, #0
001128 750000     F   27966             mov     Flash_Key_2, #0
00112B 120000     F   27967             call wait100ms                          ; Wait for new throttle value
00112E C3             27968             clr     C
00112F E500       F   27969             mov     A, New_Rcp                      ; Load new RC pulse value
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   468

001131 9401           27970             subb    A, #1                           ; Below stop?
001133 4000           27971             jc      arm_end_beep                    ; Yes - proceed
                      27972     
001135 0100       F   27973             jmp     arming_start                    ; No - start over
                      27974     
001135                27975     arm_end_beep:
                      27976             ; Beep arm sequence end signal
001137                27977             clr     IE_EA                           ; Disable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 27977 (BLHeli_S.asm, LINE 4359): UNDEFINED SYMBOL
                      27978             Clear_LED_1
*** ____________________________________^
*** ERROR #A9 IN 27978 (BLHeli_S.asm, LINE 4360): SYNTAX ERROR
001139 120000     F   27979             call wait100ms  
00113C 120000     F   27980             call Arm_beep
                      27981     ;       call beep_f4                            ; Signal that rcpulse is ready
                      27982     ;       call beep_f4
                      27983             Set_LED_2
*** ____________________________________^
*** ERROR #A9 IN 27983 (BLHeli_S.asm, LINE 4365): SYNTAX ERROR
00113F                27984             setb    IE_EA                           ; Enable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 27984 (BLHeli_S.asm, LINE 4366): UNDEFINED SYMBOL
001141 120000     F   27985             call wait200ms
                      27986     
                      27987             ; Clear initial arm variable
001144 750000     F   27988             mov     Initial_Arm, #0
                      27989     
                      27990             ; Armed and waiting for power on
001145                27991     wait_for_power_on:
001147 E4             27992             clr     A
001148 F500       F   27993             mov     Power_On_Wait_Cnt_L, A  ; Clear wait counter
00114A F500       F   27994             mov     Power_On_Wait_Cnt_H, A  
00114A                27995     wait_for_power_on_loop:
00114C 0500       F   27996             inc     Power_On_Wait_Cnt_L             ; Increment low wait counter
00114E E500       F   27997             mov     A, Power_On_Wait_Cnt_L
001150 F4             27998             cpl     A
001151 703D           27999             jnz     wait_for_power_on_no_beep; Counter wrapping (about 3 sec)
                      28000     
001153 0500       F   28001             inc     Power_On_Wait_Cnt_H             ; Increment high wait counter
001155 7800       F   28002             mov     Temp1, #Pgm_Beacon_Delay
001157 E6             28003             mov     A, @Temp1
001158 7819           28004             mov     Temp1, #25              ; Approximately 1 min
00115A 14             28005             dec     A
00115B 6010           28006             jz      beep_delay_set
                      28007     
00115D 7832           28008             mov     Temp1, #50              ; Approximately 2 min
00115F 14             28009             dec     A
001160 600B           28010             jz      beep_delay_set
                      28011     
001162 787D           28012             mov     Temp1, #125             ; Approximately 5 min
001164 14             28013             dec     A
001165 6006           28014             jz      beep_delay_set
                      28015     
001167 78FA           28016             mov     Temp1, #250             ; Approximately 10 min
001169 14             28017             dec     A
00116A 6001           28018             jz      beep_delay_set
                      28019     
00116C 750000     F   28020             mov     Power_On_Wait_Cnt_H, #0         ; Reset counter for infinite delay
                      28021     
00116D                28022     beep_delay_set:
00116F C3             28023             clr     C
001170 E500       F   28024             mov     A, Power_On_Wait_Cnt_H
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   469

001172 98             28025             subb    A, Temp1                                ; Check against chosen delay
001173 401B           28026             jc      wait_for_power_on_no_beep; Has delay elapsed?
                      28027     
001175 120000     F   28028             call    switch_power_off                ; Switch power off in case braking is se
                               t
001178 120000     F   28029             call    wait1ms
00117B 1500       F   28030             dec     Power_On_Wait_Cnt_H             ; Decrement high wait counter
00117D 750000     F   28031             mov     Power_On_Wait_Cnt_L, #0 ; Set low wait counter
001180 7800       F   28032             mov     Temp1, #Pgm_Beacon_Strength
001182 8600       F   28033             mov     Beep_Strength, @Temp1
001184                28034             clr     IE_EA                           ; Disable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 28034 (BLHeli_S.asm, LINE 4416): UNDEFINED SYMBOL
001186 120000     F   28035             call beep_beacon        ; Signal that there is no signal
001189                28036             setb    IE_EA                           ; Enable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 28036 (BLHeli_S.asm, LINE 4418): UNDEFINED SYMBOL
00118B 7800       F   28037             mov     Temp1, #Pgm_Beep_Strength
00118D 8600       F   28038             mov     Beep_Strength, @Temp1
00118F 120000     F   28039             call wait100ms                          ; Wait for new RC pulse to be measured
                      28040     
001190                28041     wait_for_power_on_no_beep:
001192 120000     F   28042             call wait10ms
001195 E500       F   28043             mov     A, Rcp_Timeout_Cntd                     ; Load RC pulse timeout counter 
                               value
001197 7001           28044             jnz     wait_for_power_on_not_missing   ; If it is not zero - proceed
                      28045     
001199 020000     F   28046             jmp     init_no_signal                          ; If pulses missing - go back to
                                detect input signal
                      28047     
00119A                28048     wait_for_power_on_not_missing:
00119C C3             28049             clr     C
00119D E500       F   28050             mov     A, New_Rcp                      ; Load new RC pulse value
00119F 9401           28051             subb    A, #1                           ; Higher than stop
0011A1 40A7           28052             jc      wait_for_power_on_loop  ; No - start over
                      28053     
0011A3 120000     F   28054             lcall wait100ms                 ; Wait to see if start pulse was only a glitch
0011A6 E500       F   28055             mov     A, Rcp_Timeout_Cntd             ; Load RC pulse timeout counter value
0011A8 7003           28056             jnz     ($+5)                           ; If it is not zero - proceed
                      28057     
0011AA 020000     F   28058             ljmp    init_no_signal                  ; If it is zero (pulses missing) - go ba
                               ck to detect input signal
                      28059     
                      28060     
                      28061     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      28062     ;
                      28063     ; Start entry point
                      28064     ;
                      28065     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0011AB                28066     init_start:
0011AD                28067             clr     IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 28067 (BLHeli_S.asm, LINE 4449): UNDEFINED SYMBOL
0011AF 120000     F   28068             call switch_power_off
0011B2 E4             28069             clr     A
0011B3                28070             setb    IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 28070 (BLHeli_S.asm, LINE 4452): UNDEFINED SYMBOL
0011B5 E4             28071             clr     A
0011B6 F500       F   28072             mov     Adc_Conversion_Cnt, A
0011B8 F500       F   28073             mov     Flags0, A                               ; Clear flags0
0011BA F500       F   28074             mov     Flags1, A                               ; Clear flags1
0011BC F500       F   28075             mov     Demag_Detected_Metric, A        ; Clear demag metric
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   470

                      28076             ;**** **** **** **** ****
                      28077             ; Motor start beginning
                      28078             ;**** **** **** **** **** 
0011BE 750008     F   28079             mov     Adc_Conversion_Cnt, #8                          ; Make sure a temp readi
                               ng is done
0011C1 120000     F   28080             call wait1ms
0011C4 120000     F   28081             call start_adc_conversion
0011C5                28082     read_initial_temp:
0011C7                28083             jnb     ADC0CN0_ADINT, read_initial_temp
*** ____________________________________________^
*** ERROR #A45 IN 28083 (BLHeli_S.asm, LINE 4465): UNDEFINED SYMBOL
                      28084             Read_Adc_Result                                         ; Read initial temperatu
                               re
*** ____________________________________^
*** ERROR #A9 IN 28084 (BLHeli_S.asm, LINE 4466): SYNTAX ERROR
0011CA E9             28085             mov     A, Temp2
0011CB 7001           28086             jnz     ($+3)                                                   ; Is reading bel
                               ow 256?
                      28087     
0011CD F8             28088             mov     Temp1, A                                                        ; Yes - 
                               set average temperature value to zero
                      28089     
0011CE 8800       F   28090             mov     Current_Average_Temp, Temp1                     ; Set initial average te
                               mperature
0011D0 120000     F   28091             call check_temp_voltage_and_limit_power
0011D3 750008     F   28092             mov     Adc_Conversion_Cnt, #8                          ; Make sure a temp readi
                               ng is done next time
                      28093             ; Set up start operating conditions
0011D6                28094             clr     IE_EA                           ; Disable interrupts
*** ____________________________________________^
*** ERROR #A45 IN 28094 (BLHeli_S.asm, LINE 4476): UNDEFINED SYMBOL
0011D8 7500FF     F   28095             mov     Pwm_Limit, #0FFh                ; Set pwm limit to max
0011DB 120000     F   28096             call set_startup_pwm
0011DE 850000     F   28097             mov     Pwm_Limit, Pwm_Limit_Beg
0011E1 850000     F   28098             mov     Pwm_Limit_By_Rpm, Pwm_Limit_Beg
0011E4                28099             setb    IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 28099 (BLHeli_S.asm, LINE 4481): UNDEFINED SYMBOL
                      28100             ; Begin startup sequence
                      28101     IF 1 == 1
                      28102             Set_MCU_Clk_48MHz
*** ____________________________________^
*** ERROR #A9 IN 28102 (BLHeli_S.asm, LINE 4484): SYNTAX ERROR
                      28103     ENDIF
0011E6 300005         28104             jnb     Flags3.PGM_BIDIR, init_start_bidir_done ; Check if bidirectional operati
                               on
                      28105     
0011E9 C200       F   28106             clr     Flags3.PGM_DIR_REV                      ; Set spinning direction. Defaul
                               t fwd
0011EB 300002         28107             jnb     Flags2.RCP_DIR_REV, ($+5)       ; Check force direction
0011EE D200       F   28108             setb    Flags3.PGM_DIR_REV                      ; Set spinning direction
                      28109     
0011EE                28110     init_start_bidir_done:
0011F0 D200       F   28111             setb    Flags1.STARTUP_PHASE            ; Set startup phase flag
0011F2 750000     F   28112             mov     Startup_Cnt, #0                 ; Reset counter
0011F5 120000     F   28113             call comm5comm6                         ; Initialize commutation
0011F8 120000     F   28114             call comm6comm1                         
0011FB 120000     F   28115             call initialize_timing                  ; Initialize timing
0011FE 120000     F   28116             call    calc_next_comm_timing           ; Set virtual commutation point
001201 120000     F   28117             call initialize_timing                  ; Initialize timing
001204 120000     F   28118             call    calc_next_comm_timing           
001207 120000     F   28119             call    initialize_timing                       ; Initialize timing
                      28120     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   471

                      28121     
                      28122     
                      28123     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      28124     ;
                      28125     ; Run entry point
                      28126     ;
                      28127     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      28128     
                      28129     ; Run 1 = B(p-on) + C(n-pwm) - comparator A evaluated
                      28130     ; Out_cA changes from low to high
001208                28131     run1:
00120A 120000     F   28132             call wait_for_comp_out_high     ; Wait for high
                      28133     ;               setup_comm_wait         ; Setup wait time from zero cross to commutation
                      28134     ;               evaluate_comparator_integrity   ; Check whether comparator reading has b
                               een normal
00120D 120000     F   28135             call wait_for_comm                      ; Wait from zero cross to commutation
001210 120000     F   28136             call comm1comm2                 ; Commutate
001213 120000     F   28137             call calc_next_comm_timing      ; Calculate next timing and wait advance timing 
                               wait
                      28138     ;               wait_advance_timing             ; Wait advance timing and start zero cro
                               ss wait
                      28139     ;               calc_new_wait_times
                      28140     ;               wait_before_zc_scan             ; Wait zero cross wait and start zero cr
                               oss timeout
                      28141     
                      28142     ; Run 2 = A(p-on) + C(n-pwm) - comparator B evaluated
                      28143     ; Out_cB changes from high to low
001214                28144     run2:
001216 120000     F   28145             call wait_for_comp_out_low
                      28146     ;               setup_comm_wait
                      28147     ;               evaluate_comparator_integrity
001219 200003         28148             jb      Flags1.HIGH_RPM, ($+6)  ; Skip if high rpm
00121C 120000     F   28149             lcall set_pwm_limit_low_rpm
00121F 300003         28150             jnb     Flags1.HIGH_RPM, ($+6)  ; Do if high rpm
001222 120000     F   28151             lcall set_pwm_limit_high_rpm
001225 120000     F   28152             call wait_for_comm
001228 120000     F   28153             call comm2comm3
00122B 120000     F   28154             call calc_next_comm_timing
                      28155     ;               wait_advance_timing
                      28156     ;               calc_new_wait_times
                      28157     ;               wait_before_zc_scan
                      28158     
                      28159     ; Run 3 = A(p-on) + B(n-pwm) - comparator C evaluated
                      28160     ; Out_cC changes from low to high
00122C                28161     run3:
00122E 120000     F   28162             call wait_for_comp_out_high
                      28163     ;               setup_comm_wait
                      28164     ;               evaluate_comparator_integrity
001231 120000     F   28165             call wait_for_comm
001234 120000     F   28166             call comm3comm4
001237 120000     F   28167             call calc_next_comm_timing
                      28168     ;               wait_advance_timing
                      28169     ;               calc_new_wait_times
                      28170     ;               wait_before_zc_scan
                      28171     
                      28172     ; Run 4 = C(p-on) + B(n-pwm) - comparator A evaluated
                      28173     ; Out_cA changes from high to low
001238                28174     run4:
00123A 120000     F   28175             call wait_for_comp_out_low
                      28176     ;               setup_comm_wait
                      28177     ;               evaluate_comparator_integrity
00123D 120000     F   28178             call wait_for_comm
001240 120000     F   28179             call comm4comm5
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   472

001243 120000     F   28180             call calc_next_comm_timing
                      28181     ;               wait_advance_timing
                      28182     ;               calc_new_wait_times
                      28183     ;               wait_before_zc_scan
                      28184     
                      28185     ; Run 5 = C(p-on) + A(n-pwm) - comparator B evaluated
                      28186     ; Out_cB changes from low to high
001244                28187     run5:
001246 120000     F   28188             call wait_for_comp_out_high
                      28189     ;               setup_comm_wait
                      28190     ;               evaluate_comparator_integrity
001249 120000     F   28191             call wait_for_comm
00124C 120000     F   28192             call comm5comm6
00124F 120000     F   28193             call calc_next_comm_timing
                      28194     ;               wait_advance_timing
                      28195     ;               calc_new_wait_times
                      28196     ;               wait_before_zc_scan
                      28197     
                      28198     ; Run 6 = B(p-on) + A(n-pwm) - comparator C evaluated
                      28199     ; Out_cC changes from high to low
001250                28200     run6:
001252 120000     F   28201             call start_adc_conversion
001255 120000     F   28202             call wait_for_comp_out_low
                      28203     ;               setup_comm_wait
                      28204     ;               evaluate_comparator_integrity
001258 120000     F   28205             call wait_for_comm
00125B 120000     F   28206             call comm6comm1
00125E 120000     F   28207             call check_temp_voltage_and_limit_power
001261 120000     F   28208             call calc_next_comm_timing
                      28209     ;               wait_advance_timing
                      28210     ;               calc_new_wait_times
                      28211     ;               wait_before_zc_scan
                      28212     
                      28213             ; Check if it is direct startup
001264 300025         28214             jnb     Flags1.STARTUP_PHASE, normal_run_checks
                      28215     
                      28216             ; Set spoolup power variables
001267 850000     F   28217             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set initial max power
                      28218             ; Check startup counter
00126A 7918           28219             mov     Temp2, #24                              ; Set nominal startup parameters
00126C 7A0C           28220             mov     Temp3, #12
00126E C3             28221             clr     C
00126F E500       F   28222             mov     A, Startup_Cnt                          ; Load counter
001271 99             28223             subb    A, Temp2                                        ; Is counter above requi
                               rement?
001272 400C           28224             jc      direct_start_check_rcp          ; No - proceed
                      28225     
001274 C200       F   28226             clr     Flags1.STARTUP_PHASE            ; Clear startup phase flag
001276 D200       F   28227             setb    Flags1.INITIAL_RUN_PHASE                ; Set initial run phase flag
001278 8A00       F   28228             mov     Initial_Run_Rot_Cntd, Temp3     ; Set initial run rotation count
00127A 850000     F   28229             mov     Pwm_Limit, Pwm_Limit_Beg
00127D 850000     F   28230             mov     Pwm_Limit_By_Rpm, Pwm_Limit_Beg
001280 0100       F   28231             jmp     normal_run_checks
                      28232     
001280                28233     direct_start_check_rcp:
001282 C3             28234             clr     C
001283 E500       F   28235             mov     A, New_Rcp                              ; Load new pulse value
001285 9401           28236             subb    A, #1                                   ; Check if pulse is below stop v
                               alue
001287 4003           28237             jc      ($+5)
                      28238     
001289 020000     F   28239             ljmp    run1                                            ; Continue to run 
                      28240     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   473

00128C 0100       F   28241             jmp     run_to_wait_for_power_on
                      28242     
                      28243     
00128C                28244     normal_run_checks:
                      28245             ; Check if it is initial run phase
00128E 30001D         28246             jnb     Flags1.INITIAL_RUN_PHASE, initial_run_phase_done        ; If not initial
                                run phase - branch
001291 20001A         28247             jb      Flags1.DIR_CHANGE_BRAKE, initial_run_phase_done ; If a direction change 
                               - branch
                      28248     
                      28249             ; Decrement startup rotaton count
001294 E500       F   28250             mov     A, Initial_Run_Rot_Cntd
001296 14             28251             dec     A
                      28252             ; Check number of initial rotations
001297 7004           28253             jnz     normal_run_check_startup_rot    ; Branch if counter is not zero
                      28254     
001299 C200       F   28255             clr     Flags1.INITIAL_RUN_PHASE                ; Clear initial run phase flag
00129B D200       F   28256             setb    Flags1.MOTOR_STARTED            ; Set motor started
00129D 0100       F   28257             jmp run1                                                ; Continue with normal r
                               un
                      28258     
00129D                28259     normal_run_check_startup_rot:
00129F F500       F   28260             mov     Initial_Run_Rot_Cntd, A         ; Not zero - store counter
                      28261     
0012A1 C3             28262             clr     C
0012A2 E500       F   28263             mov     A, New_Rcp                              ; Load new pulse value
0012A4 9401           28264             subb    A, #1                                   ; Check if pulse is below stop v
                               alue
0012A6 4003           28265             jc      ($+5)
                      28266     
0012A8 020000     F   28267             ljmp    run1                                            ; Continue to run 
0012AB 200000         28268             jb      Flags3.PGM_BIDIR, initial_run_phase_done        ; Check if bidirectional
                                operation
0012AE 0100       F   28269             jmp     run_to_wait_for_power_on
                      28270     
0012AE                28271     initial_run_phase_done:
                      28272             ; Reset stall count
0012B0 750000     F   28273             mov     Stall_Cnt, #0
                      28274             ; Exit run loop after a given time
0012B3 78FA           28275             mov     Temp1, #250
0012B5 7900       F   28276             mov     Temp2, #Pgm_Brake_On_Stop
0012B7 E7             28277             mov     A, @Temp2
0012B8 6002           28278             jz      ($+4)
                      28279     
0012BA 7803           28280             mov     Temp1, #3                                       ; About 100ms before sto
                               pping when brake is set
                      28281     
0012BC C3             28282             clr     C
0012BD E500       F   28283             mov     A, Rcp_Stop_Cnt                 ; Load stop RC pulse counter low byte va
                               lue
0012BF 98             28284             subb    A, Temp1                                        ; Is number of stop RC p
                               ulses above limit?
0012C0 504D           28285             jnc     run_to_wait_for_power_on                ; Yes, go back to wait for power
                               on
                      28286     
0012C2 E500       F   28287             mov     A, Rcp_Timeout_Cntd                     ; Load RC pulse timeout counter 
                               value
0012C4 6049           28288             jz      run_to_wait_for_power_on                ; If it is zero - go back to wai
                               t for poweron
                      28289     
0012C4                28290     run6_check_dir:
0012C6 300015         28291             jnb     Flags3.PGM_BIDIR, run6_check_speed              ; Check if bidirectional
                                operation
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   474

                      28292     
0012C9 200003         28293             jb      Flags3.PGM_DIR_REV, run6_check_dir_rev          ; Check if actual rotati
                               on direction
0012CC 200005         28294             jb      Flags2.RCP_DIR_REV, run6_check_dir_change       ; Matches force directio
                               n
0012CF 0100       F   28295             jmp     run6_check_speed
                      28296     
0012CF                28297     run6_check_dir_rev:
0012D1 300000         28298             jnb     Flags2.RCP_DIR_REV, run6_check_dir_change
0012D4 0100       F   28299             jmp     run6_check_speed
                      28300     
0012D4                28301     run6_check_dir_change:
0012D6 200005         28302             jb      Flags1.DIR_CHANGE_BRAKE, run6_check_speed
                      28303     
0012D9 D200       F   28304             setb    Flags1.DIR_CHANGE_BRAKE         ; Set brake flag
0012DB 850000     F   28305             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set max power while braking
0012DE 0100       F   28306             jmp     run4                                            ; Go back to run 4, ther
                               eby changing force direction
                      28307     
0012DE                28308     run6_check_speed:
0012E0 78F0           28309             mov     Temp1, #0F0h                            ; Default minimum speed
0012E2 300003         28310             jnb     Flags1.DIR_CHANGE_BRAKE, run6_brake_done; Is it a direction change?
                      28311     
0012E5 850000     F   28312             mov     Pwm_Limit, Pwm_Limit_Beg        ; Set max power while braking
0012E8 7820           28313             mov     Temp1, #20h                             ; Bidirectional braking terminat
                               ion speed
                      28314     
0012E8                28315     run6_brake_done:
0012EA C3             28316             clr     C
0012EB E500       F   28317             mov     A, Comm_Period4x_H                      ; Is Comm_Period4x more than 32m
                               s (~1220 eRPM)?
0012ED 98             28318             subb    A, Temp1
0012EE 5003           28319             jnc     ($+5)                                   ; Yes - stop or turn direction 
0012F0 020000     F   28320             ljmp    run1                                            ; No - go back to run 1
                      28321     
0012F3 300019         28322             jnb     Flags1.DIR_CHANGE_BRAKE, run_to_wait_for_power_on       ; If it is not a
                                direction change - stop
                      28323     
0012F6 C200       F   28324             clr     Flags1.DIR_CHANGE_BRAKE         ; Clear brake flag
0012F8 C200       F   28325             clr     Flags3.PGM_DIR_REV                      ; Set spinning direction. Defaul
                               t fwd
0012FA 300002         28326             jnb     Flags2.RCP_DIR_REV, ($+5)       ; Check force direction
0012FD D200       F   28327             setb    Flags3.PGM_DIR_REV                      ; Set spinning direction
0012FF D200       F   28328             setb    Flags1.INITIAL_RUN_PHASE
001301 750012     F   28329             mov     Initial_Run_Rot_Cntd, #18
001304 850000     F   28330             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set initial max power
001307 0100       F   28331             jmp     run1                                            ; Go back to run 1 
                      28332     
001307                28333     run_to_wait_for_power_on_fail:  
001309 0500       F   28334             inc     Stall_Cnt                                       ; Increment stall count
00130B E500       F   28335             mov     A, New_Rcp                              ; Check if RCP is zero, then it 
                               is a normal stop                        
00130D 6000           28336             jz      run_to_wait_for_power_on
00130F 0100       F   28337             ajmp    run_to_wait_for_power_on_stall_done
                      28338     
00130F                28339     run_to_wait_for_power_on:       
001311 750000     F   28340             mov     Stall_Cnt, #0
                      28341     
001312                28342     run_to_wait_for_power_on_stall_done:
001314                28343             clr     IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 28343 (BLHeli_S.asm, LINE 4725): UNDEFINED SYMBOL
001316 120000     F   28344             call switch_power_off
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   475

001319 750000     F   28345             mov     Flags0, #0                              ; Clear flags0
00131C 750000     F   28346             mov     Flags1, #0                              ; Clear flags1
                      28347     IF 1 == 1
                      28348             Set_MCU_Clk_24MHz
*** ____________________________________^
*** ERROR #A9 IN 28348 (BLHeli_S.asm, LINE 4730): SYNTAX ERROR
                      28349     ENDIF
00131F                28350             setb    IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 28350 (BLHeli_S.asm, LINE 4732): UNDEFINED SYMBOL
001321 120000     F   28351             call    wait100ms                                       ; Wait for pwm to be sto
                               pped
001324 120000     F   28352             call switch_power_off
001327 7800       F   28353             mov     Temp1, #Pgm_Brake_On_Stop
001329 E6             28354             mov     A, @Temp1
00132A 60FE           28355             jz      run_to_wait_for_power_on_brake_done
                      28356     
                      28357             AcomFET_on
*** ____________________________________^
*** ERROR #A9 IN 28357 (BLHeli_S.asm, LINE 4739): SYNTAX ERROR
                      28358             BcomFET_on
*** ____________________________________^
*** ERROR #A9 IN 28358 (BLHeli_S.asm, LINE 4740): SYNTAX ERROR
                      28359             CcomFET_on
*** ____________________________________^
*** ERROR #A9 IN 28359 (BLHeli_S.asm, LINE 4741): SYNTAX ERROR
                      28360     
00132A                28361     run_to_wait_for_power_on_brake_done:
00132C C3             28362             clr     C
00132D E500       F   28363             mov     A, Stall_Cnt
00132F 9404           28364             subb    A, #4
001331 4001           28365             jc      jmp_wait_for_power_on
001333 020000     F   28366             jmp     init_no_signal
                      28367     
001334                28368     jmp_wait_for_power_on:
001336 0100       F   28369             jmp     wait_for_power_on                       ; Go back to wait for power on
                      28370     
                      28371     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      28372     
                      28373     ;$include (BLHeliPgm.inc) ; Include source code for programming the ESC
                    +128374     ;**** **** **** **** ****
                    +128375     ;
                    +128376     ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +128377     ;
                    +128378     ; Copyright 2011, 2012 Steffen Skaug
                    +128379     ; This program is distributed under the terms of the GNU General Public License
                    +128380     ;
                    +128381     ; This file is part of BLHeli.
                    +128382     ;
                    +128383     ; BLHeli is free software: you can redistribute it and/or modify
                    +128384     ; it under the terms of the GNU General Public License as published by
                    +128385     ; the Free Software Foundation, either version 3 of the License, or
                    +128386     ; (at your option) any later version.
                    +128387     ;
                    +128388     ; BLHeli is distributed in the hope that it will be useful,
                    +128389     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +128390     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +128391     ; GNU General Public License for more details.
                    +128392     ;
                    +128393     ; You should have received a copy of the GNU General Public License
                    +128394     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +128395     ;
                    +128396     ;**** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   476

                    +128397     ;
                    +128398     ; BLHeliTxPgm SiLabs                                      
                    +128399     ;                                                         
                    +128400     ; EEPROM is not available in SiLabs MCUs                  
                    +128401     ; Therefore a segment of the flash is used as "EEPROM"    
                    +128402     ;                                                         
                    +128403     ;**** **** **** **** ****
                    +128404     
                    +128405     
                    +128406     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +128407     ;
                    +128408     ; Read all eeprom parameters routine
                    +128409     ;
                    +128410     ; No assumptions
                    +128411     ;
                    +128412     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001336              +128413     read_all_eeprom_parameters:     
                    +128414             ; Check initialized signature
001338 900000     F +128415             mov     DPTR, #Eep_Initialized_L
00133B 7800       F +128416             mov     Temp1, #Bit_Access
00133D 1100       F +128417             call read_eeprom_byte
00133F E500       F +128418             mov     A, Bit_Access
001341 B45508       +128419             cjne    A, #055h, read_eeprom_store_defaults
001344 A3           +128420             inc     DPTR                            ; Now Eep_Initialized_H
001345 1100       F +128421             call read_eeprom_byte
001347 E500       F +128422             mov     A, Bit_Access
001349 B4AA00       +128423             cjne    A, #0AAh, read_eeprom_store_defaults
00134C 0100       F +128424             jmp     read_eeprom_read
                    +128425     
                    +128426     
00134C              +128427     read_eeprom_store_defaults:
00134E 7500A5     F +128428             mov     Flash_Key_1, #0A5h
001351 7500F1     F +128429             mov     Flash_Key_2, #0F1h
001354 120000     F +128430             call set_default_parameters     
001357 1100       F +128431             call erase_and_store_all_in_eeprom      
001359 750000     F +128432             mov     Flash_Key_1, #0
00135C 750000     F +128433             mov     Flash_Key_2, #0
00135F 0100       F +128434             jmp     read_eeprom_exit
                    +128435     
00135F              +128436     read_eeprom_read:
                    +128437             ; Read eeprom
001361 900000     F +128438             mov     DPTR, #_Eep_Pgm_Gov_P_Gain
001364 7800       F +128439             mov     Temp1, #_Pgm_Gov_P_Gain 
001366 7B0A         +128440             mov     Temp4, #10
001366              +128441     read_eeprom_block1:
001368 1100       F +128442             call read_eeprom_byte
00136A A3           +128443             inc     DPTR                            
00136B 08           +128444             inc     Temp1                   
00136C DBF8         +128445             djnz    Temp4, read_eeprom_block1
                    +128446     
00136E 900000     F +128447             mov     DPTR, #Eep_Enable_TX_Program
001371 7800       F +128448             mov     Temp1, #Pgm_Enable_TX_Program   
001373 7B1A         +128449             mov     Temp4, #26      ; 26 parameters
001373              +128450     read_eeprom_block2:
001375 1100       F +128451             call read_eeprom_byte
001377 A3           +128452             inc     DPTR                            
001378 08           +128453             inc     Temp1           
001379 DBF8         +128454             djnz    Temp4, read_eeprom_block2
                    +128455     
00137B 900000     F +128456             mov     DPTR, #Eep_Dummy                        ; Set pointer to uncritical area
                    +128457     
00137C              +128458     read_eeprom_exit:
00137E 22           +128459             ret
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   477

                    +128460     
                    +128461     
                    +128462     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +128463     ;
                    +128464     ; Erase flash and store all parameter value in EEPROM routine
                    +128465     ;
                    +128466     ; No assumptions
                    +128467     ;
                    +128468     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00137D              +128469     erase_and_store_all_in_eeprom:
00137F              +128470             clr     IE_EA                                   ; Disable interrupts
*** ____________________________________________^
*** ERROR #A45 IN 28470 (BLHeliPgm.inc, LINE 97): UNDEFINED SYMBOL
001381 1100       F +128471             call    read_tags
001383 1100       F +128472             call    erase_flash                             ; Erase flash
                    +128473     
001385 900000     F +128474             mov     DPTR, #Eep_FW_Main_Revision     ; Store firmware main revision
001388 7410         +128475             mov     A, #EEPROM_FW_MAIN_REVISION
00138A 1100       F +128476             call write_eeprom_byte_from_acc
                    +128477     
00138C A3           +128478             inc     DPTR                                            ; Now firmware sub revis
                               ion
00138D 7444         +128479             mov     A, #EEPROM_FW_SUB_REVISION
00138F 1100       F +128480             call write_eeprom_byte_from_acc
                    +128481     
001391 A3           +128482             inc     DPTR                                            ; Now layout revision
001392 7421         +128483             mov     A, #EEPROM_LAYOUT_REVISION
001394 1100       F +128484             call write_eeprom_byte_from_acc
                    +128485     
                    +128486             ; Write eeprom
001396 900000     F +128487             mov     DPTR, #_Eep_Pgm_Gov_P_Gain
001399 7800       F +128488             mov     Temp1, #_Pgm_Gov_P_Gain
00139B 7B0A         +128489             mov     Temp4, #10
00139B              +128490     write_eeprom_block1:
00139D 1100       F +128491             call write_eeprom_byte
00139F A3           +128492             inc     DPTR                                            
0013A0 08           +128493             inc     Temp1                                   
0013A1 DBF8         +128494             djnz    Temp4, write_eeprom_block1
                    +128495     
0013A3 900000     F +128496             mov     DPTR, #Eep_Enable_TX_Program
0013A6 7800       F +128497             mov     Temp1, #Pgm_Enable_TX_Program   
0013A8 7B1A         +128498             mov     Temp4, #26      ; 26 parameters
0013A8              +128499     write_eeprom_block2:
0013AA 1100       F +128500             call write_eeprom_byte
0013AC A3           +128501             inc     DPTR                                            
0013AD 08           +128502             inc     Temp1                                   
0013AE DBF8         +128503             djnz    Temp4, write_eeprom_block2
                    +128504     
0013B0 1100       F +128505             call    write_tags
0013B2 1100       F +128506             call write_eeprom_signature
0013B4 900000     F +128507             mov     DPTR, #Eep_Dummy                        ; Set pointer to uncritical area
0013B7 22           +128508             ret     
                    +128509     
                    +128510     
                    +128511     
                    +128512     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +128513     ;
                    +128514     ; Read eeprom byte routine
                    +128515     ;
                    +128516     ; Gives data in A and in address given by Temp1. Assumes address in DPTR 
                    +128517     ; Also assumes address high byte to be zero
                    +128518     ;
                    +128519     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   478

0013B6              +128520     read_eeprom_byte:
0013B8 E4           +128521             clr     A
0013B9 93           +128522             movc    A, @A+DPTR                      ; Read from flash
0013BA F6           +128523             mov     @Temp1, A
0013BB 22           +128524             ret
                    +128525     
                    +128526     
                    +128527     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +128528     ;
                    +128529     ; Write eeprom byte routine
                    +128530     ;
                    +128531     ; Assumes data in address given by Temp1, or in accumulator. Assumes address in DPTR 
                    +128532     ; Also assumes address high byte to be zero
                    +128533     ;
                    +128534     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0013BA              +128535     write_eeprom_byte:
0013BC E6           +128536             mov     A, @Temp1
0013BB              +128537     write_eeprom_byte_from_acc:
0013BD              +128538             orl     PSCTL, #01h                     ; Set the PSWE bit
*** ____________________________________________^
*** ERROR #A45 IN 28538 (BLHeliPgm.inc, LINE 165): UNDEFINED SYMBOL
0013C0              +128539             anl     PSCTL, #0FDh                    ; Clear the PSEE bit
*** ____________________________________________^
*** ERROR #A45 IN 28539 (BLHeliPgm.inc, LINE 166): UNDEFINED SYMBOL
0013C3 FF           +128540             mov     Temp8, A
0013C4 C3           +128541             clr     C
0013C5 E583         +128542             mov     A, DPH                          ; Check that address is not in bootloade
                               r area
0013C7 941C         +128543             subb    A, #1Ch
0013C9 4001         +128544             jc      ($+3)
                    +128545     
0013CB 22           +128546             ret
                    +128547     
0013CC EF           +128548             mov     A, Temp8
0013CD              +128549             mov     FLKEY, Flash_Key_1              ; First key code
*** ____________________________________________^
*** ERROR #A45 IN 28549 (BLHeliPgm.inc, LINE 176): UNDEFINED SYMBOL
0013D0              +128550             mov     FLKEY, Flash_Key_2              ; Second key code
*** ____________________________________________^
*** ERROR #A45 IN 28550 (BLHeliPgm.inc, LINE 177): UNDEFINED SYMBOL
0013D3 F0           +128551             movx    @DPTR, A                                ; Write to flash
0013D4              +128552             anl     PSCTL, #0FEh                    ; Clear the PSWE bit
*** ____________________________________________^
*** ERROR #A45 IN 28552 (BLHeliPgm.inc, LINE 179): UNDEFINED SYMBOL
0013D7 22           +128553             ret
                    +128554     
                    +128555     
                    +128556     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +128557     ;
                    +128558     ; Erase flash routine (erases the flash segment used for "eeprom" variables)
                    +128559     ;
                    +128560     ; No assumptions
                    +128561     ;
                    +128562     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0013D6              +128563     erase_flash:    
0013D8              +128564             orl     PSCTL, #02h                     ; Set the PSEE bit
*** ____________________________________________^
*** ERROR #A45 IN 28564 (BLHeliPgm.inc, LINE 191): UNDEFINED SYMBOL
0013DB              +128565             orl     PSCTL, #01h                     ; Set the PSWE bit
*** ____________________________________________^
*** ERROR #A45 IN 28565 (BLHeliPgm.inc, LINE 192): UNDEFINED SYMBOL
0013DE              +128566             mov     FLKEY, Flash_Key_1              ; First key code
*** ____________________________________________^
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   479

*** ERROR #A45 IN 28566 (BLHeliPgm.inc, LINE 193): UNDEFINED SYMBOL
0013E1              +128567             mov     FLKEY, Flash_Key_2              ; Second key code
*** ____________________________________________^
*** ERROR #A45 IN 28567 (BLHeliPgm.inc, LINE 194): UNDEFINED SYMBOL
0013E4 900000     F +128568             mov     DPTR, #Eep_Initialized_L        
0013E7 F0           +128569             movx    @DPTR, A
0013E8              +128570             anl     PSCTL, #0FCh                    ; Clear the PSEE and PSWE bits
*** ____________________________________________^
*** ERROR #A45 IN 28570 (BLHeliPgm.inc, LINE 197): UNDEFINED SYMBOL
0013EB 22           +128571             ret
                    +128572     
                    +128573     
                    +128574     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +128575     ;
                    +128576     ; Write eeprom signature routine
                    +128577     ;
                    +128578     ; No assumptions
                    +128579     ;
                    +128580     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0013EA              +128581     write_eeprom_signature: 
0013EC 900000     F +128582             mov     DPTR, #Eep_Initialized_L
0013EF 7455         +128583             mov     A, #055h
0013F1 1100       F +128584             call write_eeprom_byte_from_acc
                    +128585     
0013F3 900000     F +128586             mov     DPTR, #Eep_Initialized_H
0013F6 74AA         +128587             mov     A, #0AAh
0013F8 1100       F +128588             call write_eeprom_byte_from_acc
0013FA 22           +128589             ret
                    +128590     
                    +128591     
                    +128592     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +128593     ;
                    +128594     ; Read all tags from flash and store in temporary storage
                    +128595     ;
                    +128596     ; No assumptions
                    +128597     ;
                    +128598     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0013F9              +128599     read_tags:
0013FB 7A30         +128600             mov     Temp3, #48                              ; Number of tags
0013FD 7900       F +128601             mov     Temp2, #Temp_Storage            ; Set RAM address
0013FF 7800       F +128602             mov     Temp1, #Bit_Access
001401              +128603             mov     DPTR, #Eep_ESC_Layout           ; Set flash address
*** ___________________________________________________^
*** ERROR #A45 IN 28603 (BLHeliPgm.inc, LINE 230): UNDEFINED SYMBOL
001402              +128604     read_tag:       
001404 1100       F +128605             call read_eeprom_byte
001406 E500       F +128606             mov     A, Bit_Access
001408 F7           +128607             mov     @Temp2, A                       ; Write to RAM
001409 09           +128608             inc     Temp2
00140A A3           +128609             inc     DPTR
00140B DAF5         +128610             djnz Temp3, read_tag    
00140D 22           +128611             ret
                    +128612     
                    +128613     
                    +128614     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +128615     ;
                    +128616     ; Write all tags from temporary storage and store in flash
                    +128617     ;
                    +128618     ; No assumptions
                    +128619     ;
                    +128620     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00140C              +128621     write_tags:
00140E 7A30         +128622             mov     Temp3, #48                              ; Number of tags
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   480

001410 7900       F +128623             mov     Temp2, #Temp_Storage            ; Set RAM address
001412              +128624             mov     DPTR, #Eep_ESC_Layout           ; Set flash address
*** ___________________________________________________^
*** ERROR #A45 IN 28624 (BLHeliPgm.inc, LINE 251): UNDEFINED SYMBOL
001413              +128625     write_tag:      
001415 E7           +128626             mov     A, @Temp2                       ; Read from RAM
001416 1100       F +128627             call write_eeprom_byte_from_acc
001418 09           +128628             inc     Temp2
001419 A3           +128629             inc     DPTR
00141A DAF7         +128630             djnz Temp3, write_tag   
00141C 22           +128631             ret
                    +128632     
                    +128633     
                    +128634     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +128635     ;
                    +128636     ; Wait 1 second routine
                    +128637     ;
                    +128638     ; No assumptions
                    +128639     ;
                    +128640     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00141B              +128641     wait1s:
00141D 7C05         +128642             mov     Temp5, #5
00141D              +128643     wait1s_loop:
00141F 120000     F +128644             call wait200ms
001422 DCF9         +128645             djnz    Temp5, wait1s_loop
001424 22           +128646             ret
                    +128647     
                    +128648     
                    +128649     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +128650     ;
                    +128651     ; Success beep routine
                    +128652     ;
                    +128653     ; No assumptions
                    +128654     ;
                    +128655     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001423              +128656     success_beep:
001425              +128657             clr     IE_EA                           ; Disable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 28657 (BLHeliPgm.inc, LINE 284): UNDEFINED SYMBOL
001427 120000     F +128658             call beep_f1
00142A 120000     F +128659             call beep_f2
00142D 120000     F +128660             call beep_f3
001430 120000     F +128661             call beep_f4
001433 120000     F +128662             call wait10ms
001436 120000     F +128663             call beep_f1
001439 120000     F +128664             call beep_f2
00143C 120000     F +128665             call beep_f3
00143F 120000     F +128666             call beep_f4
001442 120000     F +128667             call wait10ms
001445 120000     F +128668             call beep_f1
001448 120000     F +128669             call beep_f2
00144B 120000     F +128670             call beep_f3
00144E 120000     F +128671             call beep_f4
001451              +128672             setb    IE_EA                           ; Enable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 28672 (BLHeliPgm.inc, LINE 299): UNDEFINED SYMBOL
001453 22           +128673             ret
                    +128674     
                    +128675     
                    +128676     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +128677     ;
                    +128678     ; Success beep inverted routine
                    +128679     ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   481

                    +128680     ; No assumptions
                    +128681     ;
                    +128682     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001452              +128683     success_beep_inverted:
001454              +128684             clr     IE_EA                           ; Disable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 28684 (BLHeliPgm.inc, LINE 311): UNDEFINED SYMBOL
001456 120000     F +128685             call beep_f4
001459 120000     F +128686             call beep_f3
00145C 120000     F +128687             call beep_f2
00145F 120000     F +128688             call beep_f1
001462 120000     F +128689             call wait10ms
001465 120000     F +128690             call beep_f4
001468 120000     F +128691             call beep_f3
00146B 120000     F +128692             call beep_f2
00146E 120000     F +128693             call beep_f1
001471 120000     F +128694             call wait10ms
001474 120000     F +128695             call beep_f4
001477 120000     F +128696             call beep_f3
00147A 120000     F +128697             call beep_f2
00147D 120000     F +128698             call beep_f1
001480              +128699             setb    IE_EA                           ; Enable all interrupts
*** ____________________________________________^
*** ERROR #A45 IN 28699 (BLHeliPgm.inc, LINE 326): UNDEFINED SYMBOL
001482 22           +128700             ret
                    +128701     
                    +128702     
                      28703     ;$include (BLHeliBootLoad.inc) ; Include source code for bootloader
                    +128704     ; BLHeli bootloader for SiLabs MCUs. Based upon AVRootloader (copyright HR)
                    +128705     
 017D7840           +128706     XTAL                                    EQU     25000000        
                    +128707     
 1C00               +128708     BOOT_START                      EQU     1C00h   ; Bootloader segment address
 005F5E10           +128709     BOOT_DELAY                      EQU     XTAL/4  ; About 250ms (don't set to fast to avoi
                               d connection problems)
 4B00               +128710     BOOT_BAUDRATE                   EQU     19200   ; Only used if no baudrate detection act
                               ivated, XTAL is than important
 0006               +128711     BOOT_VERSION                    EQU     6               ; Version 6 (must be not changed
                               )
 0001               +128712     BOOT_PAGES                      EQU     1               ; Number of flash segments for b
                               ootloader
                    +128713     
 001A               +128714     UART_LOOP                               EQU     26              ; Depends upon timing of
                                putc, getc 
 0198               +128715     BAUDTIME                                EQU     ((XTAL/BOOT_BAUDRATE)/3)-UART_LOOP
                    +128716     
 0030               +128717     SUCCESS                         EQU     030h
 00C0               +128718     ERRORVERIFY                     EQU     0C0h
 00C1               +128719     ERRORCOMMAND                    EQU     0C1h
 00C2               +128720     ERRORCRC                                EQU     0C2h
 00C5               +128721     ERRORPROG                               EQU     0C5h
                    +128722     
 A001               +128723     POLYNOM                         EQU     0A001h          ; CRC Polynom
                    +128724     
  REG               +128725     Xl                                      EQU     R0                      ; Temporary X
  REG               +128726     Xh                                      EQU     R1
  REG               +128727     Paral                           EQU     R2                      ; Params for UART
  REG               +128728     Parah                           EQU     R3      
  REG               +128729     Cmdl                                    EQU     R4                      ; Commands
  REG               +128730     Cmdh                                    EQU     R5      
  REG               +128731     Cntl                                    EQU     R6                      ; Baudtime
  REG               +128732     Cnth                                    EQU     R7
                    +128733     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   482

000020              +128734     DSEG AT 20h                                     
000020              +128735     Bit_Reg:                                DS      1                       ; Bit storage re
                               gister
000021              +128736     Byte_Reg:                               DS      1                       ; Byte storage r
                               egister
000022              +128737     Crcl:                           DS      1                       ; CRC 16Bit
000023              +128738     Crch:                           DS      1
000024              +128739     Baudl:                          DS      1                       ; Baudtime
000025              +128740     Baudh:                          DS      1
000026              +128741     Bit_Cnt:                                DS      1                       ; Counter in UAR
                               T loops
000027              +128742     Byte_Cntl:                      DS      1                       ; Generic counter
000028              +128743     Byte_Cnth:                      DS      1                       
000029              +128744     BL_Flash_Key_1:         DS      1                       ; Flash keys
00002A              +128745     BL_Flash_Key_2:         DS      1
                    +128746     
001C00              +128747     CSEG AT BOOT_START              ; Bootloader start
001C00              +128748     init:clr        IE_EA
*** ____________________________________________^
*** ERROR #A45 IN 28748 (BLHeliBootLoad.inc, LINE 45): UNDEFINED SYMBOL
                    +128749             ; Select register bank 0 for main program routines
001C02 C2D3         +128750             clr     PSW.3                           ; Select register bank 0 for main progra
                               m routines      
                    +128751             ; Disable the WDT.
001C04              +128752             mov     WDTCN, #0DEh                    ; Disable watchdog
*** ____________________________________________^
*** ERROR #A45 IN 28752 (BLHeliBootLoad.inc, LINE 49): UNDEFINED SYMBOL
001C07              +128753             mov     WDTCN, #0ADh            
*** ____________________________________________^
*** ERROR #A45 IN 28753 (BLHeliBootLoad.inc, LINE 50): UNDEFINED SYMBOL
                    +128754             ; Initialize stack
001C0A 7581C0       +128755             mov     SP, #0c0h                               ; Stack = 64 upper bytes of RAM
                    +128756             ; Initialize clock
001C0D              +128757             mov     CLKSEL, #00h                    ; Set clock divider to 1
*** ____________________________________________^
*** ERROR #A45 IN 28757 (BLHeliBootLoad.inc, LINE 54): UNDEFINED SYMBOL
                    +128758             ; Initialize VDD monitor
001C10              +128759             orl     VDM0CN, #080h                   ; Enable the VDD monitor
*** ____________________________________________^
*** ERROR #A45 IN 28759 (BLHeliBootLoad.inc, LINE 56): UNDEFINED SYMBOL
001C13 750038     F +128760             mov     Baudl, #38h                     ; Wait 100us
001C16 750003     F +128761             mov     Baudh, #03h
001C19 1100       F +128762             acall waitf
                    +128763             ; Initialize flash keys
001C1B 7500A5     F +128764             mov     BL_Flash_Key_1, #0A5h   ; First key code
001C1E 7500F1     F +128765             mov     BL_Flash_Key_2, #0F1h   ; Second key code
                    +128766             ; Initialize ports
001C21              +128767             orl     RTX_MDIN, #(1 SHL RTX_PIN)              ; Set digital
*** ____________________________________________^
*** ______________________________________________________________^
*** ERROR #A45 IN 28767 (BLHeliBootLoad.inc, LINE 64): UNDEFINED SYMBOL
*** ERROR #A45 IN 28767 (BLHeliBootLoad.inc, LINE 64): UNDEFINED SYMBOL
001C24              +128768             anl     RTX_MDOUT, #NOT(1 SHL RTX_PIN)  ; Disable pushpull
*** ____________________________________________^
*** __________________________________________________________________^
*** ERROR #A45 IN 28768 (BLHeliBootLoad.inc, LINE 65): UNDEFINED SYMBOL
*** ERROR #A45 IN 28768 (BLHeliBootLoad.inc, LINE 65): UNDEFINED SYMBOL
001C27              +128769             setb    RTX_PORT.RTX_PIN                                ; Set data high
*** _____________________________________________________^
*** ERROR #A18 IN 28769 (BLHeliBootLoad.inc, LINE 66): OUT OF RANGE OR TYPELESS BIT-OFFSET REQUIRED
001C2A              +128770             mov     RTX_SKIP, #0FFh
*** ____________________________________________^
*** ERROR #A45 IN 28770 (BLHeliBootLoad.inc, LINE 67): UNDEFINED SYMBOL
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   483

001C2D              +128771             mov     XBR2, #40h;                                     ; Enable crossbar
*** ____________________________________________^
*** ERROR #A45 IN 28771 (BLHeliBootLoad.inc, LINE 68): UNDEFINED SYMBOL
                    +128772             ; Set number of connect attempts before exiting bootloader
001C30 7DFA         +128773             mov     Cmdh, #250
                    +128774     
                    +128775             ; Identifier scanning
001C32 7803         +128776     abd:    mov     Xl, #(low(BOOT_DELAY / 6)+1)
001C34 79E6         +128777             mov     Xh, #(high(BOOT_DELAY / 6)+1)
001C36 7C10         +128778             mov     Cmdl, #(high((BOOT_DELAY / 6) SHR 8)+1)
001C38 750000     F +128779             mov     Crcl, #0
001C3B 750000     F +128780             mov     Crch, #0
001C3E 900000     F +128781             mov     DPTR, #BOOT_SIGN
001C41 7B06         +128782             mov     Parah, #(BOOT_MSG - BOOT_SIGN)
001C43 750098     F +128783             mov     Baudl, #low(BAUDTIME)
001C46 750001     F +128784             mov     Baudh, #high(BAUDTIME)
                    +128785     
001C46              +128786     wait_for_low:
001C49              +128787             jnb     RTX_PORT.RTX_PIN, ($+5)
*** _____________________________________________________^
*** ERROR #A18 IN 28787 (BLHeliBootLoad.inc, LINE 84): OUT OF RANGE OR TYPELESS BIT-OFFSET REQUIRED
001C4C 0100       F +128788             ajmp wait_for_low
                    +128789     
                    +128790             ; Identifier (BOOT_SIGN) scanning with timeout and checksum
001C4E              +128791     id1:    jb      RTX_PORT.RTX_PIN, id3   ; Look for high
*** _____________________________________________________^
*** ERROR #A18 IN 28791 (BLHeliBootLoad.inc, LINE 88): OUT OF RANGE OR TYPELESS BIT-OFFSET REQUIRED
001C50 D8F6         +128792             djnz    Xl, id1                         ; Subtract 1 from X (BOOT_DELAY)
001C52 D9F4         +128793             djnz    Xh, id1
001C54 DCF2         +128794             djnz    Cmdl, id1 
                    +128795     
001C56 0100       F +128796             ajmp    exit
                    +128797     
001C58              +128798     id3:    jnb     RTX_PORT.RTX_PIN, id4   ; Look for low
*** _____________________________________________________^
*** ERROR #A18 IN 28798 (BLHeliBootLoad.inc, LINE 95): OUT OF RANGE OR TYPELESS BIT-OFFSET REQUIRED
001C5A D8F4         +128799             djnz    Xl, id3                         ; Subtract 1 from X (BOOT_DELAY)
001C5C D9F2         +128800             djnz    Xh, id3
001C5E DCF0         +128801             djnz    Cmdl, id3
                    +128802     
001C60 0100       F +128803             ajmp    exit
                    +128804     
001C62 1100       F +128805     id4:    acall getx                              ; Read character
001C64 E4           +128806             clr     A                       
001C65 93           +128807             movc A, @A+DPTR                 ; Load BOOT_SIGN character
001C66 A3           +128808             inc     DPTR
001C67 C3           +128809             clr     C
001C68 9A           +128810             subb    A, Paral                                ; Compare with read character
001C69 60FA         +128811             jz      id5
001C6B DDC2         +128812             djnz    Cmdh, abd                               ; Retry if not last connect atte
                               mpt
001C6D 0100       F +128813             ajmp    exit
                    +128814     
001C65              +128815     id5:
001C6F DBD7         +128816             djnz    Parah, id1
                    +128817     
001C71 1100       F +128818             acall getw                              ; Read CRC
001C73 6002         +128819             jz      ($+4)                           ; Check CRC
001C75 0100       F +128820             ajmp    abd
                    +128821             
                    +128822             ; Send info about chip/bootloader (BOOT_MSG + BOOT_INFO)
001C77 7B08         +128823             mov     Parah, #((BOOT_INFO - BOOT_MSG) + 4)
001C79 E4           +128824     in1:    clr     A                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   484

001C7A 93           +128825             movc A, @A+DPTR                 ; Load character
001C7B FA           +128826             mov     Paral, A
001C7C A3           +128827             inc     DPTR
001C7D 1100       F +128828             acall putc
001C7F DBEE         +128829             djnz    Parah, in1
                    +128830     
                    +128831     
                    +128832             ; Main commandloop
                    +128833             ; 0=Run/restart 
                    +128834             ; 1=Program flash, 2=Erase flash, 3=Read flash
                    +128835             ; 0xFF=Set address, 0xFE=Set buffer, 0xFD=Keep alive 
001C81 7A30         +128836     main:mov        Paral, #SUCCESS
001C83 1100       F +128837     mai1:acall putc
001C85 750000     F +128838             mov     Crcl, #0                                ; Reset CRC
001C88 750000     F +128839             mov     Crch, #0
001C8B 1100       F +128840             acall getw                              ; Get command
001C8D EA           +128841             mov     A, Paral
001C8E FC           +128842             mov     Cmdl, A
001C8F EB           +128843             mov     A, Parah
001C90 FD           +128844             mov     Cmdh, A
001C91 C3           +128845             clr     C
001C92 ED           +128846             mov     A, Cmdh
001C93 94FE         +128847             subb    A, #0FEh
001C95 4004         +128848             jc      mai2                                    ; Jump if not set address or set
                                buffer 
                    +128849     
001C97 1100       F +128850             acall getw                              ; Address or number of bytes
001C99 8A00       F +128851             mov     Byte_Cntl, Paral                ; Store number of bytes for set buffer
001C9B 8B00       F +128852             mov     Byte_Cnth, Parah        
001C9D ED           +128853             mov     A, Cmdh
001C9E 30E0FA       +128854             jnb     ACC.0, mai2                     ; Jump if set buffer
                    +128855     
001CA1 8A82         +128856             mov     DPL, Paral                      ; Store flash address (for set address)
001CA3 8B83         +128857             mov     DPH, Parah
                    +128858     
001CA5 1100       F +128859     mai2:acall getw                         ; Get CRC
001CA7 7AC2         +128860             mov     Paral, #ERRORCRC
001CA9 70CE         +128861             jnz     mai1
001CAB C3           +128862             clr     C
001CAC ED           +128863             mov     A, Cmdh
001CAD 94FE         +128864             subb    A, #0FEh
001CAF 600F         +128865             jz      setbuf                          ; If command is set buffer, receive data
001CB1 50C4         +128866             jnc     main
                    +128867     
001CB3 BD001F       +128868             cjne    Cmdh, #0, mai4                  ; Jump if command != 0 (and not set buff
                               er)
                    +128869     
                    +128870             ; Run application/restart bootloader
001CB6 EC           +128871             mov     A, Cmdl
001CB7 6005         +128872             jz      rst
001CB9 750000     F +128873     exit:mov        Bit_Access, #0                  ; Clear variable used by flash lock dete
                               ct
001CBC 7500FF     F +128874             mov     Bit_Access_Int, #0FFh   ; Set variable to indicate that program executio
                               n came from bootloader
001CBF 750000     F +128875             mov     BL_Flash_Key_1, #0              ; Set flash keys to invalid values
001CC2 750000     F +128876             mov     BL_Flash_Key_2, #0
001CC5 020000       +128877             ljmp    0000h
001CC8 0100       F +128878     rst:    ajmp    init
                    +128879     
                    +128880             ; Set buffer
001CCA A800       F +128881     setbuf:mov Xl, Byte_Cntl                        ; Set number of bytes 
001CCC A900       F +128882             mov     Xh, Byte_Cnth
001CCE 08           +128883             inc     Xl      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   485

001CCF 09           +128884             inc     Xh      
001CD0 D8FA         +128885     set4:djnz       Xl, set5
001CD2 D9F8         +128886             djnz    Xh, set5
001CD4 0100       F +128887             ajmp    set6
                    +128888     
001CD6 1100       F +128889     set5:acall getc                         ; Receive data
001CD8 EA           +128890             mov     A, Paral
001CD9 F2           +128891             movx    @Xl, A                          ; Store data in XRAM
001CDA 0100       F +128892             ajmp    set4
                    +128893     
001CDC 0D           +128894     set6:inc        Cmdh    
001CDD 0100       F +128895             ajmp    mai2
                    +128896     
001CDF C3           +128897     mai4:clr        C
001CE0 ED           +128898             mov     A, Cmdh
001CE1 9403         +128899             subb    A, #3
001CE3 5047         +128900             jnc     mai5                                    ; Jump if command >= 3
                    +128901     
                    +128902             ; Program/erase
001CE5 ED           +128903             mov     A, Cmdh
001CE6 A2E0         +128904             mov     C, ACC.0
001CE8 9200       F +128905             mov     Bit_Reg.0, C    
001CEA 7AC5         +128906             mov     Paral, #ERRORPROG
001CEC C3           +128907             clr     C
001CED E582         +128908             mov     A, DPL
001CEF 9400         +128909             subb    A, #low(BOOT_START)
001CF1 E583         +128910             mov     A, DPH
001CF3 941C         +128911             subb    A, #high(BOOT_START)
001CF5 5082         +128912             jnc     mai1                                    ; Jump if in bootloader segment
001CF7 200006       +128913             jb      Bit_Reg.0, pro3         ; Jump if program command
                    +128914     
                    +128915             ; Erase flash
001CFA              +128916             orl     PSCTL, #02h                     ; Set the PSEE bit
*** ____________________________________________^
*** ERROR #A45 IN 28916 (BLHeliBootLoad.inc, LINE 213): UNDEFINED SYMBOL
001CFD              +128917             orl     PSCTL, #01h                     ; Set the PSWE bit
*** ____________________________________________^
*** ERROR #A45 IN 28917 (BLHeliBootLoad.inc, LINE 214): UNDEFINED SYMBOL
001D00              +128918             mov     FLKEY, BL_Flash_Key_1   ; First key code
*** ____________________________________________^
*** ERROR #A45 IN 28918 (BLHeliBootLoad.inc, LINE 215): UNDEFINED SYMBOL
001D03              +128919             mov     FLKEY, BL_Flash_Key_2   ; Second key code
*** ____________________________________________^
*** ERROR #A45 IN 28919 (BLHeliBootLoad.inc, LINE 216): UNDEFINED SYMBOL
001D06 F0           +128920             movx    @DPTR, A
001D07 30001D       +128921             jnb     Bit_Reg.0, pro6         ; Jump if erase command
                    +128922     
                    +128923             ; Program flash
001D0A A800       F +128924     pro3:mov        Xl, Byte_Cntl                   ; Set number of bytes 
001D0C A900       F +128925             mov     Xh, Byte_Cnth
001D0E 08           +128926             inc     Xl      
001D0F 09           +128927             inc     Xh      
001D10              +128928             orl     PSCTL, #01h                     ; Set the PSWE bit
*** ____________________________________________^
*** ERROR #A45 IN 28928 (BLHeliBootLoad.inc, LINE 225): UNDEFINED SYMBOL
001D13              +128929             anl     PSCTL, #0FDh                    ; Clear the PSEE bit
*** ____________________________________________^
*** ERROR #A45 IN 28929 (BLHeliBootLoad.inc, LINE 226): UNDEFINED SYMBOL
001D16 D8FA         +128930     pro4:djnz       Xl, pro5
001D18 D9F8         +128931             djnz    Xh, pro5
001D1A 0100       F +128932             ajmp    pro6
                    +128933     
001D12              +128934     pro5:
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   486

001D1C C3           +128935             clr     C
001D1D E583         +128936             mov     A, DPH                          ; Check that address is not in bootloade
                               r area
001D1F 941C         +128937             subb    A, #1Ch
001D21 4003         +128938             jc      ($+5)
                    +128939     
001D23 A3           +128940             inc     DPTR                                    ; Increment flash address
001D24 0100       F +128941             ajmp    pro4
                    +128942     
001D26 E2           +128943             movx    A, @Xl                          ; Read from XRAM                
001D27              +128944             mov     FLKEY, BL_Flash_Key_1   ; First key code
*** ____________________________________________^
*** ERROR #A45 IN 28944 (BLHeliBootLoad.inc, LINE 241): UNDEFINED SYMBOL
001D2A              +128945             mov     FLKEY, BL_Flash_Key_2   ; Second key code
*** ____________________________________________^
*** ERROR #A45 IN 28945 (BLHeliBootLoad.inc, LINE 242): UNDEFINED SYMBOL
001D2D F0           +128946             movx    @DPTR, A                                ; Write to flash
001D2E A3           +128947             inc     DPTR                                    ; Increment flash address
001D2F 0100       F +128948             ajmp    pro4
                    +128949     
001D31              +128950     pro6:anl        PSCTL, #0FCh                    ; Clear the PSEE and PSWE bits
*** ____________________________________________^
*** ERROR #A45 IN 28950 (BLHeliBootLoad.inc, LINE 247): UNDEFINED SYMBOL
001D34 0100       F +128951             ajmp    main                                    ; Successfully done erase or pro
                               gram
                    +128952     
                    +128953             ; Read flash
001D36 7AC1         +128954     mai5:mov        Paral, #ERRORCOMMAND    ; Illegal command
001D38 BD0302       +128955             cjne    Cmdh, #3, mai6                  ; Jump if not read flash command
                    +128956     
001D3B E4           +128957     rd1:    clr     A
001D3C 93           +128958             movc    A, @A+DPTR                      ; Read from flash
001D3D A3           +128959             inc     DPTR                                    ; Increment flash address
001D3E FA           +128960             mov     Paral, A
001D3F 1100       F +128961             acall putp
001D41 DCEE         +128962             djnz    Cmdl, rd1                       ; Decrement bytes to read       
                    +128963     
001D43 1100       F +128964             acall putw                              ; CRC
001D45 0100       F +128965             ajmp    main
                    +128966     
001D47 0100       F +128967     mai6:ajmp       mai1
                    +128968     
                    +128969     
                    +128970     
                    +128971     
                    +128972             ; Send char with crc
001D49 AA00       F +128973     putw:mov        Paral, Crcl
001D4B AB00       F +128974             mov     Parah, Crch
001D4D 1100       F +128975             acall putc
001D4F EB           +128976             mov     A, Parah
001D50 FA           +128977             mov     Paral, A
001D51 EA           +128978     putp:mov        A, Paral
001D52 6200       F +128979             xrl     Crcl, A
001D54 750008     F +128980             mov     Bit_Cnt, #8
001D57 C3           +128981     put1:clr        C
001D58 E500       F +128982             mov     A, Crch
001D5A 13           +128983             rrc     A
001D5B F500       F +128984             mov     Crch, A
001D5D E500       F +128985             mov     A, Crcl
001D5F 13           +128986             rrc     A
001D60 F500       F +128987             mov     Crcl, A
001D62 50FC         +128988             jnc     put2
                    +128989     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   487

001D64 6300A0     F +128990             xrl     Crch, #high(POLYNOM)
001D67 630001     F +128991             xrl     Crcl, #low(POLYNOM)
                    +128992     
001D6A D500E0       +128993     put2:djnz       Bit_Cnt, put1
                    +128994     
                    +128995     
                    +128996             ; Send char
001D6D 1100       F +128997     putc:acall waitf
001D6F 1100       F +128998             acall waitf
001D71 75000A     F +128999             mov     Bit_Cnt, #10
001D74 EA           +129000             mov     A, Paral
001D75 F4           +129001             cpl     A
001D76 200002       +129002     put3:jb Bit_Reg.1, ($+5)
001D79              +129003             setb    RTX_PORT.RTX_PIN                ; Set pin high
*** _____________________________________________________^
*** ERROR #A18 IN 29003 (BLHeliBootLoad.inc, LINE 300): OUT OF RANGE OR TYPELESS BIT-OFFSET REQUIRED
001D7A 300002       +129004             jnb     Bit_Reg.1, ($+5)
001D7D              +129005             clr     RTX_PORT.RTX_PIN                ; Set pin low
*** _____________________________________________________^
*** ERROR #A18 IN 29005 (BLHeliBootLoad.inc, LINE 302): OUT OF RANGE OR TYPELESS BIT-OFFSET REQUIRED
001D80 1100       F +129006             acall waitf                                                     
001D82 C3           +129007             clr     C
001D83 13           +129008             rrc     A
001D84 40F4         +129009             jc      put4            
                    +129010                                                     
001D86 C200       F +129011             clr     Bit_Reg.1
                    +129012     
001D88 D500E1       +129013     put4:djnz       Bit_Cnt, put3
                    +129014     
001D8B 22           +129015             ret
                    +129016     
                    +129017     
                    +129018             ; Receive char/word
001D8C 1100       F +129019     getw:acall getc
001D8E EA           +129020             mov     A, Paral
001D8F FB           +129021             mov     Parah, A
001D90              +129022     getc:jb RTX_PORT.RTX_PIN, ($+5) ; Wait for high
*** _____________________________________________^
*** ERROR #A18 IN 29022 (BLHeliBootLoad.inc, LINE 319): OUT OF RANGE OR TYPELESS BIT-OFFSET REQUIRED
001D92 0100       F +129023             ajmp    getc
                    +129024     
001D94              +129025     get1:jnb        RTX_PORT.RTX_PIN, ($+5) ; Wait for low
*** _____________________________________________________^
*** ERROR #A18 IN 29025 (BLHeliBootLoad.inc, LINE 322): OUT OF RANGE OR TYPELESS BIT-OFFSET REQUIRED
001D96 0100       F +129026             ajmp    get1
                    +129027     
001D98 750008     F +129028     getx:mov        Bit_Cnt, #8
001D9B AE00       F +129029             mov     Cntl, Baudl
001D9D AF00       F +129030             mov     Cnth, Baudh
001D9F C3           +129031             clr     C
001DA0 EF           +129032             mov     A, Cnth                         ; Wait half a baud
001DA1 13           +129033             rrc     A
001DA2 FF           +129034             mov     Cnth, A
001DA3 EE           +129035             mov     A, Cntl
001DA4 13           +129036             rrc     A
001DA5 FE           +129037             mov     Cntl, A
001DA6 1100       F +129038             acall waith
001DA8 1100       F +129039     get2:acall waitf                                ; Wait one baud                         
                                                       
001DAA C3           +129040             clr     C
001DAB EA           +129041             mov     A, Paral
001DAC 13           +129042             rrc     A
001DAD              +129043             jnb     RTX_PORT.RTX_PIN, ($+5)                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   488

*** _____________________________________________________^
*** ERROR #A18 IN 29043 (BLHeliBootLoad.inc, LINE 340): OUT OF RANGE OR TYPELESS BIT-OFFSET REQUIRED
001DAE 4480         +129044             orl     A, #080h
                    +129045     
001DB0 FA           +129046             mov     Paral, A
001DB1 30E703       +129047             jnb     ACC.7, ($+6) 
001DB4 630001     F +129048             xrl     Crcl, #low(POLYNOM)
                    +129049     
001DB7 C3           +129050             clr     C
001DB8 E500       F +129051             mov     A, Crch
001DBA 13           +129052             rrc     A
001DBB F500       F +129053             mov     Crch, A
001DBD E500       F +129054             mov     A, Crcl
001DBF 13           +129055             rrc     A
001DC0 F500       F +129056             mov     Crcl, A
001DC2 50F3         +129057             jnc     get3                            
                    +129058     
001DC4 6300A0     F +129059             xrl     Crch, #high(POLYNOM)
001DC7 630001     F +129060             xrl     Crcl, #low(POLYNOM)
                    +129061     
001DCA D500C9       +129062     get3:djnz       Bit_Cnt, get2
                    +129063     
001DCD E500       F +129064             mov     A, Crcl 
001DCF 6500       F +129065             xrl     A, Crch 
001DD1 6500       F +129066             xrl     A, Crch 
001DD3 F500       F +129067             mov     Crcl, A
001DD5 22           +129068             ret
                    +129069     
                    +129070     
                    +129071             ; UART delays                                                                   
                                       
001DD6 AE00       F +129072     waitf:mov       Cntl, Baudl     
001DD8 AF00       F +129073             mov     Cnth, Baudh
001DDA 0E           +129074     waith:inc Cntl
001DDB 0F           +129075             inc     Cnth
001DDC DEEB         +129076     wait1:djnz Cntl, wait1
001DDE DFE9         +129077             djnz Cnth, wait1
                    +129078     
001DE0 D200       F +129079             setb    Bit_Reg.1
001DE2 22           +129080             ret                                                                     
                    +129081     
                    +129082     
001DE3 424C4865     +129083     BOOT_SIGN:      DB      "BLHeli"        
001DE7 6C69                     
                    +129084     
001DE9 34373164     +129085     BOOT_MSG:               DB      "471d"          ; Interface-MCU_BootlaoderRevision
                    +129086     
001DED 00000601     +129087     BOOT_INFO:      DB      SIGNATURE_001, SIGNATURE_002, BOOT_VERSION, BOOT_PAGES
*** ____________________________________________________^
*** ___________________________________________________________________^
*** ERROR #A45 IN 29087 (BLHeliBootLoad.inc, LINE 384): UNDEFINED SYMBOL
*** ERROR #A45 IN 29087 (BLHeliBootLoad.inc, LINE 384): UNDEFINED SYMBOL
                    +129088     
                      29089     
                      29090     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      29091     
                      29092     
                      29093     
0019FD                29094     CSEG AT 19FDh
0019FD                29095     reset:
0019FD 020000     F   29096     ljmp    pgm_start
                      29097     
                      29098     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   489

                      29099     
                      29100     END
                      29101     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   490

SYMBOL TABLE LISTING
------ ----- -------


N A M E                              T Y P E  V A L U E     ATTRIBUTES

_EEP_MAIN_REARM_START . . . . . . .  C  ADDR  1A10H     R   SEG=?CO?BLHELI_S?5
_EEP_PGM_BEC_VOLTAGE_HIGH . . . . .  C  ADDR  1A20H     R   SEG=?CO?BLHELI_S?5
_EEP_PGM_DAMPING_FORCE. . . . . . .  C  ADDR  1A16H     R   SEG=?CO?BLHELI_S?5
_EEP_PGM_ENABLE_PWM_INPUT . . . . .  C  ADDR  1A25H     R   SEG=?CO?BLHELI_S?5
_EEP_PGM_GOV_I_GAIN . . . . . . . .  C  ADDR  1A04H     R   SEG=?CO?BLHELI_S?5
_EEP_PGM_GOV_MODE . . . . . . . . .  C  ADDR  1A05H     R   SEG=?CO?BLHELI_S?5
_EEP_PGM_GOV_P_GAIN . . . . . . . .  C  ADDR  1A03H     R   SEG=?CO?BLHELI_S?5
_EEP_PGM_GOV_RANGE. . . . . . . . .  C  ADDR  1A17H     R   SEG=?CO?BLHELI_S?5
_EEP_PGM_GOV_SETUP_TARGET . . . . .  C  ADDR  1A11H     R   SEG=?CO?BLHELI_S?5
_EEP_PGM_INPUT_POL. . . . . . . . .  C  ADDR  1A0CH     R   SEG=?CO?BLHELI_S?5
_EEP_PGM_LOW_VOLTAGE_LIM. . . . . .  C  ADDR  1A06H     R   SEG=?CO?BLHELI_S?5
_EEP_PGM_MAIN_SPOOLUP_TIME. . . . .  C  ADDR  1A22H     R   SEG=?CO?BLHELI_S?5
_EEP_PGM_MOTOR_GAIN . . . . . . . .  C  ADDR  1A07H     R   SEG=?CO?BLHELI_S?5
_EEP_PGM_MOTOR_IDLE . . . . . . . .  C  ADDR  1A08H     R   SEG=?CO?BLHELI_S?5
_EEP_PGM_PWM_DITHER . . . . . . . .  C  ADDR  1A26H     R   SEG=?CO?BLHELI_S?5
_EEP_PGM_PWM_FREQ . . . . . . . . .  C  ADDR  1A0AH     R   SEG=?CO?BLHELI_S?5
_EEP_PGM_STARTUP_ACCEL. . . . . . .  C  ADDR  1A13H     R   SEG=?CO?BLHELI_S?5
_EEP_PGM_STARTUP_METHOD . . . . . .  C  ADDR  1A18H     R   SEG=?CO?BLHELI_S?5
_EEP_PGM_STARTUP_RPM. . . . . . . .  C  ADDR  1A12H     R   SEG=?CO?BLHELI_S?5
_EEP_PGM_THROTTLE_RATE. . . . . . .  C  ADDR  1A1EH     R   SEG=?CO?BLHELI_S?5
_EEP_PGM_VOLT_COMP. . . . . . . . .  C  ADDR  1A14H     R   SEG=?CO?BLHELI_S?5
_PGM_BEC_VOLTAGE_HIGH . . . . . . .  I  ADDR  009DH     R   SEG=?ID?BLHELI_S?3
_PGM_DAMPING_FORCE. . . . . . . . .  I  ADDR  0093H     R   SEG=?ID?BLHELI_S?3
_PGM_ENABLE_PWM_INPUT . . . . . . .  I  ADDR  00A2H     R   SEG=?ID?BLHELI_S?3
_PGM_GOV_I_GAIN . . . . . . . . . .  I  ADDR  0081H     R   SEG=?ID?BLHELI_S?3
_PGM_GOV_MODE . . . . . . . . . . .  I  ADDR  0082H     R   SEG=?ID?BLHELI_S?3
_PGM_GOV_P_GAIN . . . . . . . . . .  I  ADDR  0080H     R   SEG=?ID?BLHELI_S?3
_PGM_GOV_RANGE. . . . . . . . . . .  I  ADDR  0094H     R   SEG=?ID?BLHELI_S?3
_PGM_GOV_SETUP_TARGET . . . . . . .  I  ADDR  008EH     R   SEG=?ID?BLHELI_S?3
_PGM_LOW_VOLTAGE_LIM. . . . . . . .  I  ADDR  0083H     R   SEG=?ID?BLHELI_S?3
_PGM_MAIN_REARM_START . . . . . . .  I  ADDR  008DH     R   SEG=?ID?BLHELI_S?3
_PGM_MAIN_SPOOLUP_TIME. . . . . . .  I  ADDR  009FH     R   SEG=?ID?BLHELI_S?3
_PGM_MOTOR_GAIN . . . . . . . . . .  I  ADDR  0084H     R   SEG=?ID?BLHELI_S?3
_PGM_MOTOR_IDLE . . . . . . . . . .  I  ADDR  0085H     R   SEG=?ID?BLHELI_S?3
_PGM_PWM_DITHER . . . . . . . . . .  I  ADDR  00A3H     R   SEG=?ID?BLHELI_S?3
_PGM_PWM_FREQ . . . . . . . . . . .  I  ADDR  0087H     R   SEG=?ID?BLHELI_S?3
_PGM_STARTUP_ACCEL. . . . . . . . .  I  ADDR  0090H     R   SEG=?ID?BLHELI_S?3
_PGM_STARTUP_METHOD . . . . . . . .  I  ADDR  0095H     R   SEG=?ID?BLHELI_S?3
_PGM_STARTUP_RPM. . . . . . . . . .  I  ADDR  008FH     R   SEG=?ID?BLHELI_S?3
_PGM_THROTTLE_RATE. . . . . . . . .  I  ADDR  009BH     R   SEG=?ID?BLHELI_S?3
_PGM_VOLT_COMP. . . . . . . . . . .  I  ADDR  0091H     R   SEG=?ID?BLHELI_S?3
A_. . . . . . . . . . . . . . . . .  N  NUMB  0001H     A   
ABD . . . . . . . . . . . . . . . .  C  ADDR  1C2FH     R   SEG=?CO?BLHELI_S?9
ACC . . . . . . . . . . . . . . . .  D  ADDR  00E0H     A   
ACOMFET_OFF . . . . . . . . . . . .  -- ----  -------       
ACOMFET_ON. . . . . . . . . . . . .  -- ----  -------       
ADC0CN0_ADINT . . . . . . . . . . .  -- ----  -------       
ADC_CONVERSION_CNT. . . . . . . . .  D  ADDR  005CH     R   SEG=?DT?BLHELI_S?2
ADJUST_TIMING_TWO_STEPS . . . . . .  C  ADDR  06F0H     R   SEG=?CO?BLHELI_S?7
ADJUST_TIMING_TWO_STEPS_FAST. . . .  C  ADDR  0755H     R   SEG=?CO?BLHELI_S?7
ALL_COMFETS_OFF . . . . . . . . . .  -- ----  -------       
ALL_PWMFETS_OFF . . . . . . . . . .  -- ----  -------       
APWMFET_OFF . . . . . . . . . . . .  -- ----  -------       
APWMFET_ON. . . . . . . . . . . . .  -- ----  -------       
ARM_BEEP. . . . . . . . . . . . . .  C  ADDR  0D74H     R   SEG=?CO?BLHELI_S?7
ARM_END_BEEP. . . . . . . . . . . .  C  ADDR  1135H     R   SEG=?CO?BLHELI_S?7
ARMED_BEEP. . . . . . . . . . . . .  C  ADDR  0D95H     R   SEG=?CO?BLHELI_S?7
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   491

ARMING_CHECK. . . . . . . . . . . .  C  ADDR  1093H     R   SEG=?CO?BLHELI_S?7
ARMING_INITIAL_ARM_CHECK. . . . . .  C  ADDR  108AH     R   SEG=?CO?BLHELI_S?7
ARMING_START. . . . . . . . . . . .  C  ADDR  1074H     R   SEG=?CO?BLHELI_S?7
AVERAGE_THROTTLE. . . . . . . . . .  C  ADDR  0C14H     R   SEG=?CO?BLHELI_S?7
AVERAGE_THROTTLE_DIV. . . . . . . .  C  ADDR  0C33H     R   SEG=?CO?BLHELI_S?7
AVERAGE_THROTTLE_MEAS . . . . . . .  C  ADDR  0C24H     R   SEG=?CO?BLHELI_S?7
B . . . . . . . . . . . . . . . . .  D  ADDR  00F0H     A   
B_. . . . . . . . . . . . . . . . .  N  NUMB  0002H     A   
BAUDH . . . . . . . . . . . . . . .  D  ADDR  0025H     R   SEG=?DT?BLHELI_S?8
BAUDL . . . . . . . . . . . . . . .  D  ADDR  0024H     R   SEG=?DT?BLHELI_S?8
BAUDTIME. . . . . . . . . . . . . .  N  NUMB  0198H     A   
BCOMFET_OFF . . . . . . . . . . . .  -- ----  -------       
BCOMFET_ON. . . . . . . . . . . . .  -- ----  -------       
BEEP. . . . . . . . . . . . . . . .  C  ADDR  097CH     R   SEG=?CO?BLHELI_S?7
BEEP_APWMFET_OFF. . . . . . . . . .  C  ADDR  099FH     R   SEG=?CO?BLHELI_S?7
BEEP_APWMFET_ON . . . . . . . . . .  C  ADDR  0993H     R   SEG=?CO?BLHELI_S?7
BEEP_BEACON . . . . . . . . . . . .  C  ADDR  09DBH     R   SEG=?CO?BLHELI_S?7
BEEP_CPWMFET_OFF. . . . . . . . . .  C  ADDR  09A2H     R   SEG=?CO?BLHELI_S?7
BEEP_CPWMFET_ON . . . . . . . . . .  C  ADDR  0996H     R   SEG=?CO?BLHELI_S?7
BEEP_CZ1. . . . . . . . . . . . . .  C  ADDR  09B3H     R   SEG=?CO?BLHELI_S?7
BEEP_CZ2. . . . . . . . . . . . . .  C  ADDR  09BDH     R   SEG=?CO?BLHELI_S?7
BEEP_CZ3. . . . . . . . . . . . . .  C  ADDR  09C7H     R   SEG=?CO?BLHELI_S?7
BEEP_CZ4. . . . . . . . . . . . . .  C  ADDR  09D1H     R   SEG=?CO?BLHELI_S?7
BEEP_DELAY_SET. . . . . . . . . . .  C  ADDR  116DH     R   SEG=?CO?BLHELI_S?7
BEEP_F1 . . . . . . . . . . . . . .  C  ADDR  095AH     R   SEG=?CO?BLHELI_S?7
BEEP_F2 . . . . . . . . . . . . . .  C  ADDR  0963H     R   SEG=?CO?BLHELI_S?7
BEEP_F3 . . . . . . . . . . . . . .  C  ADDR  096CH     R   SEG=?CO?BLHELI_S?7
BEEP_F4 . . . . . . . . . . . . . .  C  ADDR  0975H     R   SEG=?CO?BLHELI_S?7
BEEP_OFF. . . . . . . . . . . . . .  C  ADDR  09ABH     R   SEG=?CO?BLHELI_S?7
BEEP_ONOFF. . . . . . . . . . . . .  C  ADDR  0982H     R   SEG=?CO?BLHELI_S?7
BEEP_START. . . . . . . . . . . . .  C  ADDR  0980H     R   SEG=?CO?BLHELI_S?7
BEEP_STRENGTH . . . . . . . . . . .  D  ADDR  0062H     R   SEG=?DT?BLHELI_S?2
BIT_ACCESS. . . . . . . . . . . . .  D  ADDR  0020H     R   SEG=?DT?BLHELI_S?1
BIT_ACCESS_INT. . . . . . . . . . .  D  ADDR  0021H     R   SEG=?DT?BLHELI_S?1
BIT_CNT . . . . . . . . . . . . . .  D  ADDR  0026H     R   SEG=?DT?BLHELI_S?8
BIT_REG . . . . . . . . . . . . . .  D  ADDR  0020H     R   SEG=?DT?BLHELI_S?8
BL_FLASH_KEY_1. . . . . . . . . . .  D  ADDR  0029H     R   SEG=?DT?BLHELI_S?8
BL_FLASH_KEY_2. . . . . . . . . . .  D  ADDR  002AH     R   SEG=?DT?BLHELI_S?8
BOOT_BAUDRATE . . . . . . . . . . .  N  NUMB  4B00H     A   
BOOT_DELAY. . . . . . . . . . . . .  N  NUMB  005F5E10H A   
BOOT_INFO . . . . . . . . . . . . .  C  ADDR  1DDAH     R   SEG=?CO?BLHELI_S?9
BOOT_MSG. . . . . . . . . . . . . .  C  ADDR  1DD6H     R   SEG=?CO?BLHELI_S?9
BOOT_PAGES. . . . . . . . . . . . .  N  NUMB  0001H     A   
BOOT_SIGN . . . . . . . . . . . . .  C  ADDR  1DD0H     R   SEG=?CO?BLHELI_S?9
BOOT_START. . . . . . . . . . . . .  N  NUMB  1C00H     A   
BOOT_VERSION. . . . . . . . . . . .  N  NUMB  0006H     A   
BOOTLOADER_DONE . . . . . . . . . .  C  ADDR  0F62H     R   SEG=?CO?BLHELI_S?7
BPWMFET_OFF . . . . . . . . . . . .  -- ----  -------       
BPWMFET_ON. . . . . . . . . . . . .  -- ----  -------       
BYTE_CNTH . . . . . . . . . . . . .  D  ADDR  0028H     R   SEG=?DT?BLHELI_S?8
BYTE_CNTL . . . . . . . . . . . . .  D  ADDR  0027H     R   SEG=?DT?BLHELI_S?8
BYTE_REG. . . . . . . . . . . . . .  D  ADDR  0021H     R   SEG=?DT?BLHELI_S?8
C_. . . . . . . . . . . . . . . . .  N  NUMB  0003H     A   
CALC_NEW_WAIT_PER_DEMAG_DONE. . . .  C  ADDR  062CH     R   SEG=?CO?BLHELI_S?7
CALC_NEW_WAIT_PER_STARTUP_DONE. . .  C  ADDR  0610H     R   SEG=?CO?BLHELI_S?7
CALC_NEW_WAIT_TIMES . . . . . . . .  C  ADDR  06B7H     R   SEG=?CO?BLHELI_S?7
CALC_NEW_WAIT_TIMES_EXIT. . . . . .  C  ADDR  0658H     R   SEG=?CO?BLHELI_S?7
CALC_NEW_WAIT_TIMES_FAST. . . . . .  C  ADDR  073CH     R   SEG=?CO?BLHELI_S?7
CALC_NEW_WAIT_TIMES_FAST_DONE . . .  C  ADDR  06A3H     R   SEG=?CO?BLHELI_S?7
CALC_NEW_WAIT_TIMES_SETUP . . . . .  C  ADDR  0601H     R   SEG=?CO?BLHELI_S?7
CALC_NEXT_COMM_AVG_PERIOD_DIV . . .  C  ADDR  05D3H     R   SEG=?CO?BLHELI_S?7
CALC_NEXT_COMM_NEW_PERIOD_DIV . . .  C  ADDR  05E6H     R   SEG=?CO?BLHELI_S?7
CALC_NEXT_COMM_NEW_PERIOD_DIV_DONE.  C  ADDR  05EFH     R   SEG=?CO?BLHELI_S?7
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   492

CALC_NEXT_COMM_NORMAL . . . . . . .  C  ADDR  05B4H     R   SEG=?CO?BLHELI_S?7
CALC_NEXT_COMM_STARTUP. . . . . . .  C  ADDR  0574H     R   SEG=?CO?BLHELI_S?7
CALC_NEXT_COMM_STARTUP_AVERAGE. . .  C  ADDR  0599H     R   SEG=?CO?BLHELI_S?7
CALC_NEXT_COMM_STARTUP_NO_X . . . .  C  ADDR  0586H     R   SEG=?CO?BLHELI_S?7
CALC_NEXT_COMM_TIMING . . . . . . .  C  ADDR  053DH     R   SEG=?CO?BLHELI_S?7
CALC_NEXT_COMM_TIMING_FAST. . . . .  C  ADDR  065BH     R   SEG=?CO?BLHELI_S?7
CCOMFET_OFF . . . . . . . . . . . .  -- ----  -------       
CCOMFET_ON. . . . . . . . . . . . .  -- ----  -------       
CENTER_THROTTLE_H . . . . . . . . .  D  ADDR  0034H     R   SEG=?DT?BLHELI_S?2
CENTER_THROTTLE_L . . . . . . . . .  D  ADDR  0033H     R   SEG=?DT?BLHELI_S?2
CHECK_TEMP_VOLTAGE_AND_LIMIT_POWER.  C  ADDR  04BBH     R   SEG=?CO?BLHELI_S?7
CHECK_VOLTAGE_START . . . . . . . .  C  ADDR  0513H     R   SEG=?CO?BLHELI_S?7
CKCON0. . . . . . . . . . . . . . .  -- ----  -------       
CLEAR_COVF_INTERRUPT. . . . . . . .  -- ----  -------       
CLEAR_LED_0 . . . . . . . . . . . .  -- ----  -------       
CLEAR_LED_1 . . . . . . . . . . . .  -- ----  -------       
CLEAR_LED_2 . . . . . . . . . . . .  -- ----  -------       
CLEAR_LED_3 . . . . . . . . . . . .  -- ----  -------       
CLEAR_RAM . . . . . . . . . . . . .  C  ADDR  0DDCH     R   SEG=?CO?BLHELI_S?7
CLEAR_RPM_OUT . . . . . . . . . . .  -- ----  -------       
CLKSEL. . . . . . . . . . . . . . .  -- ----  -------       
CLOCK_SET_AT_48MHZ. . . . . . . . .  D  ADDR  0064H     R   SEG=?DT?BLHELI_S?2
CMDH. . . . . . . . . . . . . . . .     REG   R            
CMDL. . . . . . . . . . . . . . . .     REG   R            
CNTH. . . . . . . . . . . . . . . .     REG   R            
CNTL. . . . . . . . . . . . . . . .     REG   R            
COMM12_REV. . . . . . . . . . . . .  C  ADDR  0908H     R   SEG=?CO?BLHELI_S?7
COMM1COMM2. . . . . . . . . . . . .  C  ADDR  08FFH     R   SEG=?CO?BLHELI_S?7
COMM23_REV. . . . . . . . . . . . .  C  ADDR  0917H     R   SEG=?CO?BLHELI_S?7
COMM2COMM3. . . . . . . . . . . . .  C  ADDR  090EH     R   SEG=?CO?BLHELI_S?7
COMM34_REV. . . . . . . . . . . . .  C  ADDR  0926H     R   SEG=?CO?BLHELI_S?7
COMM3COMM4. . . . . . . . . . . . .  C  ADDR  091DH     R   SEG=?CO?BLHELI_S?7
COMM45_REV. . . . . . . . . . . . .  C  ADDR  0935H     R   SEG=?CO?BLHELI_S?7
COMM4COMM5. . . . . . . . . . . . .  C  ADDR  092CH     R   SEG=?CO?BLHELI_S?7
COMM56_REV. . . . . . . . . . . . .  C  ADDR  0944H     R   SEG=?CO?BLHELI_S?7
COMM5COMM6. . . . . . . . . . . . .  C  ADDR  093BH     R   SEG=?CO?BLHELI_S?7
COMM61_REV. . . . . . . . . . . . .  C  ADDR  0953H     R   SEG=?CO?BLHELI_S?7
COMM6COMM1. . . . . . . . . . . . .  C  ADDR  094AH     R   SEG=?CO?BLHELI_S?7
COMM_EXIT . . . . . . . . . . . . .  C  ADDR  0957H     R   SEG=?CO?BLHELI_S?7
COMM_PERIOD4X_H . . . . . . . . . .  D  ADDR  0048H     R   SEG=?DT?BLHELI_S?2
COMM_PERIOD4X_L . . . . . . . . . .  D  ADDR  0047H     R   SEG=?DT?BLHELI_S?2
COMP_CHECK_TIMEOUT. . . . . . . . .  C  ADDR  07FFH     R   SEG=?CO?BLHELI_S?7
COMP_CHECK_TIMEOUT_EXTEND_TIMEOUT .  C  ADDR  0810H     R   SEG=?CO?BLHELI_S?7
COMP_CHECK_TIMEOUT_NOT_TIMED_OUT. .  C  ADDR  0813H     R   SEG=?CO?BLHELI_S?7
COMP_CHECK_TIMEOUT_TIMEOUT_EXTENDED  C  ADDR  080CH     R   SEG=?CO?BLHELI_S?7
COMP_READ_OK. . . . . . . . . . . .  C  ADDR  086CH     R   SEG=?CO?BLHELI_S?7
COMP_READ_OK_JMP. . . . . . . . . .  C  ADDR  087EH     R   SEG=?CO?BLHELI_S?7
COMP_READ_WRONG . . . . . . . . . .  C  ADDR  081CH     R   SEG=?CO?BLHELI_S?7
COMP_READ_WRONG_EXTEND_TIMEOUT. . .  C  ADDR  0835H     R   SEG=?CO?BLHELI_S?7
COMP_READ_WRONG_LOAD_TIMEOUT. . . .  C  ADDR  0862H     R   SEG=?CO?BLHELI_S?7
COMP_READ_WRONG_LOW_RPM . . . . . .  C  ADDR  0851H     R   SEG=?CO?BLHELI_S?7
COMP_READ_WRONG_NOT_STARTUP . . . .  C  ADDR  0828H     R   SEG=?CO?BLHELI_S?7
COMP_READ_WRONG_TIMEOUT_SET . . . .  C  ADDR  0846H     R   SEG=?CO?BLHELI_S?7
COMP_SCALE_SAMPLES. . . . . . . . .  C  ADDR  07F7H     R   SEG=?CO?BLHELI_S?7
COMP_TIMED_OUT. . . . . . . . . . .  N  NUMB  0003H     A   
COMPARATOR_READ_CNT . . . . . . . .  D  ADDR  0049H     R   SEG=?DT?BLHELI_S?2
CPWMFET_OFF . . . . . . . . . . . .  -- ----  -------       
CPWMFET_ON. . . . . . . . . . . . .  -- ----  -------       
CRCH. . . . . . . . . . . . . . . .  D  ADDR  0023H     R   SEG=?DT?BLHELI_S?8
CRCL. . . . . . . . . . . . . . . .  D  ADDR  0022H     R   SEG=?DT?BLHELI_S?8
CURRENT_AVERAGE_TEMP. . . . . . . .  D  ADDR  005DH     R   SEG=?DT?BLHELI_S?2
CURRENT_POWER_PWM_REG_H . . . . . .  D  ADDR  0058H     R   SEG=?DT?BLHELI_S?2
CZ_TONES. . . . . . . . . . . . . .  N  NUMB  0006H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   493

D_. . . . . . . . . . . . . . . . .  N  NUMB  0004H     A   
DAMP_PWM_REG_H. . . . . . . . . . .  D  ADDR  0057H     R   SEG=?DT?BLHELI_S?2
DAMP_PWM_REG_L. . . . . . . . . . .  D  ADDR  0056H     R   SEG=?DT?BLHELI_S?2
DEC_AGAIN . . . . . . . . . . . . .  C  ADDR  0A5BH     R   SEG=?CO?BLHELI_S?7
DECODE_DEMAG_DONE . . . . . . . . .  C  ADDR  0B33H     R   SEG=?CO?BLHELI_S?7
DECODE_DEMAG_HIGH . . . . . . . . .  C  ADDR  0B2DH     R   SEG=?CO?BLHELI_S?7
DECODE_DSHOT_2LSB . . . . . . . . .  -- ----  -------       
DECODE_DSHOT_2MSB . . . . . . . . .  -- ----  -------       
DECODE_SETTINGS . . . . . . . . . .  C  ADDR  0AF1H     R   SEG=?CO?BLHELI_S?7
DECODE_TEMP_DONE. . . . . . . . . .  C  ADDR  0B3FH     R   SEG=?CO?BLHELI_S?7
DECODE_TEMP_STEP. . . . . . . . . .  C  ADDR  0B3BH     R   SEG=?CO?BLHELI_S?7
DEFAULT_PGM_BEACON_DELAY. . . . . .  N  NUMB  0003H     A   
DEFAULT_PGM_BEACON_STRENGTH . . . .  N  NUMB  0050H     A   
DEFAULT_PGM_BEEP_STRENGTH . . . . .  N  NUMB  005BH     A   
DEFAULT_PGM_BRAKE_ON_STOP . . . . .  N  NUMB  0001H     A   
DEFAULT_PGM_CENTER_THROTTLE . . . .  N  NUMB  007DH     A   
DEFAULT_PGM_COMM_TIMING . . . . . .  N  NUMB  0003H     A   
DEFAULT_PGM_DEMAG_COMP. . . . . . .  N  NUMB  0003H     A   
DEFAULT_PGM_DIRECTION . . . . . . .  N  NUMB  0001H     A   
DEFAULT_PGM_ENABLE_POWER_PROT . . .  N  NUMB  0001H     A   
DEFAULT_PGM_ENABLE_TEMP_PROT. . . .  N  NUMB  0006H     A   
DEFAULT_PGM_ENABLE_TX_PROGRAM . . .  N  NUMB  0001H     A   
DEFAULT_PGM_LED_CONTROL . . . . . .  N  NUMB  0001H     A   
DEFAULT_PGM_MAX_THROTTLE. . . . . .  N  NUMB  00F0H     A   
DEFAULT_PGM_MIN_THROTTLE. . . . . .  N  NUMB  000AH     A   
DEFAULT_PGM_STARTUP_PWR . . . . . .  N  NUMB  0005H     A   
DEMAG_CUT_POWER . . . . . . . . . .  N  NUMB  0002H     A   
DEMAG_DETECTED. . . . . . . . . . .  N  NUMB  0001H     A   
DEMAG_DETECTED_METRIC . . . . . . .  D  ADDR  003DH     R   SEG=?DT?BLHELI_S?2
DEMAG_PWR_OFF_THRESH. . . . . . . .  D  ADDR  003EH     R   SEG=?DT?BLHELI_S?2
DIR_CHANGE_BRAKE. . . . . . . . . .  N  NUMB  0003H     A   
DIRECT_START_CHECK_RCP. . . . . . .  C  ADDR  1280H     R   SEG=?CO?BLHELI_S?7
DISABLE_COVF_INTERRUPT. . . . . . .  -- ----  -------       
DPH . . . . . . . . . . . . . . . .  D  ADDR  0083H     A   
DPL . . . . . . . . . . . . . . . .  D  ADDR  0082H     A   
DSHOT_FRAME_LENGTH_THR. . . . . . .  D  ADDR  006CH     R   SEG=?DT?BLHELI_S?2
DSHOT_FRAME_START_H . . . . . . . .  D  ADDR  006BH     R   SEG=?DT?BLHELI_S?2
DSHOT_FRAME_START_L . . . . . . . .  D  ADDR  006AH     R   SEG=?DT?BLHELI_S?2
DSHOT_PWM_THR . . . . . . . . . . .  D  ADDR  0068H     R   SEG=?DT?BLHELI_S?2
DSHOT_TIMER_PRESET. . . . . . . . .  D  ADDR  0069H     R   SEG=?DT?BLHELI_S?2
E_. . . . . . . . . . . . . . . . .  N  NUMB  0005H     A   
EEP_DUMMY . . . . . . . . . . . . .  C  ADDR  1A29H     R   SEG=?CO?BLHELI_S?5
EEP_ENABLE_TX_PROGRAM . . . . . . .  C  ADDR  1A0FH     R   SEG=?CO?BLHELI_S?5
EEP_ESC_LAYOUT. . . . . . . . . . .  -- ----  -------       
EEP_FW_MAIN_REVISION. . . . . . . .  C  ADDR  1A00H     R   SEG=?CO?BLHELI_S?5
EEP_FW_SUB_REVISION . . . . . . . .  C  ADDR  1A01H     R   SEG=?CO?BLHELI_S?5
EEP_INITIALIZED_H . . . . . . . . .  C  ADDR  1A0EH     R   SEG=?CO?BLHELI_S?5
EEP_INITIALIZED_L . . . . . . . . .  C  ADDR  1A0DH     R   SEG=?CO?BLHELI_S?5
EEP_LAYOUT_REVISION . . . . . . . .  C  ADDR  1A02H     R   SEG=?CO?BLHELI_S?5
EEP_NAME. . . . . . . . . . . . . .  C  ADDR  1A60H     R   SEG=?CO?BLHELI_S?6
EEP_PGM_BEACON_DELAY. . . . . . . .  C  ADDR  1A1DH     R   SEG=?CO?BLHELI_S?5
EEP_PGM_BEACON_STRENGTH . . . . . .  C  ADDR  1A1CH     R   SEG=?CO?BLHELI_S?5
EEP_PGM_BEEP_STRENGTH . . . . . . .  C  ADDR  1A1BH     R   SEG=?CO?BLHELI_S?5
EEP_PGM_BRAKE_ON_STOP . . . . . . .  C  ADDR  1A27H     R   SEG=?CO?BLHELI_S?5
EEP_PGM_CENTER_THROTTLE . . . . . .  C  ADDR  1A21H     R   SEG=?CO?BLHELI_S?5
EEP_PGM_COMM_TIMING . . . . . . . .  C  ADDR  1A15H     R   SEG=?CO?BLHELI_S?5
EEP_PGM_DEMAG_COMP. . . . . . . . .  C  ADDR  1A1FH     R   SEG=?CO?BLHELI_S?5
EEP_PGM_DIRECTION . . . . . . . . .  C  ADDR  1A0BH     R   SEG=?CO?BLHELI_S?5
EEP_PGM_ENABLE_POWER_PROT . . . . .  C  ADDR  1A24H     R   SEG=?CO?BLHELI_S?5
EEP_PGM_LED_CONTROL . . . . . . . .  C  ADDR  1A28H     R   SEG=?CO?BLHELI_S?5
EEP_PGM_MAX_THROTTLE. . . . . . . .  C  ADDR  1A1AH     R   SEG=?CO?BLHELI_S?5
EEP_PGM_MIN_THROTTLE. . . . . . . .  C  ADDR  1A19H     R   SEG=?CO?BLHELI_S?5
EEP_PGM_STARTUP_PWR . . . . . . . .  C  ADDR  1A09H     R   SEG=?CO?BLHELI_S?5
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   494

EEP_PGM_TEMP_PROT_ENABLE. . . . . .  C  ADDR  1A23H     R   SEG=?CO?BLHELI_S?5
EEPROM_FW_MAIN_REVISION . . . . . .  N  NUMB  0010H     A   
EEPROM_FW_SUB_REVISION. . . . . . .  N  NUMB  0044H     A   
EEPROM_LAYOUT_REVISION. . . . . . .  N  NUMB  0021H     A   
EIE1. . . . . . . . . . . . . . . .  -- ----  -------       
ENABLE_COVF_INTERRUPT . . . . . . .  -- ----  -------       
ENABLE_DAMP_PWM_MODULE. . . . . . .  -- ----  -------       
ENABLE_POWER_PWM_MODULE . . . . . .  -- ----  -------       
ERASE_AND_STORE_ALL_IN_EEPROM . . .  C  ADDR  137DH     R   SEG=?CO?BLHELI_S?7
ERASE_FLASH . . . . . . . . . . . .  C  ADDR  13D6H     R   SEG=?CO?BLHELI_S?7
ERRORCOMMAND. . . . . . . . . . . .  N  NUMB  00C1H     A   
ERRORCRC. . . . . . . . . . . . . .  N  NUMB  00C2H     A   
ERRORPROG . . . . . . . . . . . . .  N  NUMB  00C5H     A   
ERRORVERIFY . . . . . . . . . . . .  N  NUMB  00C0H     A   
EVAL_COMP_CHECK_TIMEOUT . . . . . .  C  ADDR  08ADH     R   SEG=?CO?BLHELI_S?7
EVAL_COMP_EXIT. . . . . . . . . . .  C  ADDR  08BDH     R   SEG=?CO?BLHELI_S?7
EVALUATE_COMPARATOR_INTEGRITY . . .  C  ADDR  08A0H     R   SEG=?CO?BLHELI_S?7
EXIT. . . . . . . . . . . . . . . .  C  ADDR  1CAFH     R   SEG=?CO?BLHELI_S?9
F_. . . . . . . . . . . . . . . . .  N  NUMB  0006H     A   
FET_SWAP. . . . . . . . . . . . . .  N  NUMB  0003H     A   
FIND_THROTTLE_GAIN. . . . . . . . .  C  ADDR  0BC5H     R   SEG=?CO?BLHELI_S?7
FIND_THROTTLE_GAIN_FWD. . . . . . .  C  ADDR  0BBEH     R   SEG=?CO?BLHELI_S?7
FIND_THROTTLE_GAIN_LOOP . . . . . .  C  ADDR  0BF0H     R   SEG=?CO?BLHELI_S?7
FIND_THROTTLE_GAINS . . . . . . . .  C  ADDR  0B5FH     R   SEG=?CO?BLHELI_S?7
FIND_THROTTLE_GAINS_BIDIR_DONE. . .  C  ADDR  0B98H     R   SEG=?CO?BLHELI_S?7
FIND_THROTTLE_GAINS_NORMAL. . . . .  C  ADDR  0B73H     R   SEG=?CO?BLHELI_S?7
FLAGS0. . . . . . . . . . . . . . .  D  ADDR  0024H     R   SEG=?DT?BLHELI_S?1
FLAGS1. . . . . . . . . . . . . . .  D  ADDR  0025H     R   SEG=?DT?BLHELI_S?1
FLAGS2. . . . . . . . . . . . . . .  D  ADDR  0026H     R   SEG=?DT?BLHELI_S?1
FLAGS3. . . . . . . . . . . . . . .  D  ADDR  0027H     R   SEG=?DT?BLHELI_S?1
FLASH_KEY_1 . . . . . . . . . . . .  D  ADDR  0065H     R   SEG=?DT?BLHELI_S?2
FLASH_KEY_2 . . . . . . . . . . . .  D  ADDR  0066H     R   SEG=?DT?BLHELI_S?2
FLKEY . . . . . . . . . . . . . . .  -- ----  -------       
G_. . . . . . . . . . . . . . . . .  N  NUMB  0007H     A   
GET1. . . . . . . . . . . . . . . .  C  ADDR  1D84H     R   SEG=?CO?BLHELI_S?9
GET2. . . . . . . . . . . . . . . .  C  ADDR  1D96H     R   SEG=?CO?BLHELI_S?9
GET3. . . . . . . . . . . . . . . .  C  ADDR  1DB7H     R   SEG=?CO?BLHELI_S?9
GET_RCP_CAPTURE_VALUES. . . . . . .  -- ----  -------       
GETC. . . . . . . . . . . . . . . .  C  ADDR  1D82H     R   SEG=?CO?BLHELI_S?9
GETW. . . . . . . . . . . . . . . .  C  ADDR  1D7EH     R   SEG=?CO?BLHELI_S?9
GETX. . . . . . . . . . . . . . . .  C  ADDR  1D86H     R   SEG=?CO?BLHELI_S?9
H_. . . . . . . . . . . . . . . . .  N  NUMB  0008H     A   
HG_BOUNCE . . . . . . . . . . . . .  C  ADDR  0E15H     R   SEG=?CO?BLHELI_S?7
HIGH_RPM. . . . . . . . . . . . . .  N  NUMB  0004H     A   
I_. . . . . . . . . . . . . . . . .  N  NUMB  0009H     A   
ID1 . . . . . . . . . . . . . . . .  C  ADDR  1C48H     R   SEG=?CO?BLHELI_S?9
ID3 . . . . . . . . . . . . . . . .  C  ADDR  1C50H     R   SEG=?CO?BLHELI_S?9
ID4 . . . . . . . . . . . . . . . .  C  ADDR  1C58H     R   SEG=?CO?BLHELI_S?9
ID5 . . . . . . . . . . . . . . . .  C  ADDR  1C65H     R   SEG=?CO?BLHELI_S?9
ID_DSHOT300 . . . . . . . . . . . .  C  ADDR  0D84H     R   SEG=?CO?BLHELI_S?7
ID_DSHOT600 . . . . . . . . . . . .  C  ADDR  0D8AH     R   SEG=?CO?BLHELI_S?7
IDBEEP_LOOP . . . . . . . . . . . .  C  ADDR  0D67H     R   SEG=?CO?BLHELI_S?7
IE. . . . . . . . . . . . . . . . .  -- ----  -------       
IE_EA . . . . . . . . . . . . . . .  -- ----  -------       
IE_ET0. . . . . . . . . . . . . . .  -- ----  -------       
IE_ET1. . . . . . . . . . . . . . .  -- ----  -------       
IE_EX0. . . . . . . . . . . . . . .  -- ----  -------       
IE_EX1. . . . . . . . . . . . . . .  -- ----  -------       
IN1 . . . . . . . . . . . . . . . .  C  ADDR  1C6FH     R   SEG=?CO?BLHELI_S?9
INC_TONE. . . . . . . . . . . . . .  C  ADDR  0A12H     R   SEG=?CO?BLHELI_S?7
INIT. . . . . . . . . . . . . . . .  C  ADDR  1C00H     R   SEG=?CO?BLHELI_S?9
INIT_NO_SIGNAL. . . . . . . . . . .  C  ADDR  0F4FH     R   SEG=?CO?BLHELI_S?7
INIT_START. . . . . . . . . . . . .  C  ADDR  11ABH     R   SEG=?CO?BLHELI_S?7
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   495

INIT_START_BIDIR_DONE . . . . . . .  C  ADDR  11EEH     R   SEG=?CO?BLHELI_S?7
INITIAL_ARM . . . . . . . . . . . .  D  ADDR  0030H     R   SEG=?DT?BLHELI_S?2
INITIAL_RUN_PHASE . . . . . . . . .  N  NUMB  0001H     A   
INITIAL_RUN_PHASE_DONE. . . . . . .  C  ADDR  12AEH     R   SEG=?CO?BLHELI_S?7
INITIAL_RUN_ROT_CNTD. . . . . . . .  D  ADDR  003BH     R   SEG=?DT?BLHELI_S?2
INITIALIZE_ADC. . . . . . . . . . .  -- ----  -------       
INITIALIZE_COMPARATOR . . . . . . .  -- ----  -------       
INITIALIZE_PCA. . . . . . . . . . .  -- ----  -------       
INITIALIZE_TIMING . . . . . . . . .  C  ADDR  0536H     R   SEG=?CO?BLHELI_S?7
INITIALIZE_XBAR . . . . . . . . . .  -- ----  -------       
INITIALIZED_H_DUMMY . . . . . . . .  I  ADDR  008BH     R   SEG=?ID?BLHELI_S?3
INITIALIZED_L_DUMMY . . . . . . . .  I  ADDR  008AH     R   SEG=?ID?BLHELI_S?3
INPUT_HIGH_CHECK_1. . . . . . . . .  C  ADDR  0F59H     R   SEG=?CO?BLHELI_S?7
INPUT_HIGH_CHECK_2. . . . . . . . .  C  ADDR  0F5BH     R   SEG=?CO?BLHELI_S?7
INT0_INT. . . . . . . . . . . . . .  C  ADDR  0221H     R   SEG=?CO?BLHELI_S?7
INT0_INT_BIDIR_DO_DEADBAND. . . . .  C  ADDR  0334H     R   SEG=?CO?BLHELI_S?7
INT0_INT_BIDIR_FWD. . . . . . . . .  C  ADDR  030EH     R   SEG=?CO?BLHELI_S?7
INT0_INT_BIDIR_REV_CHK. . . . . . .  C  ADDR  0313H     R   SEG=?CO?BLHELI_S?7
INT0_INT_CALCULATE. . . . . . . . .  C  ADDR  02F5H     R   SEG=?CO?BLHELI_S?7
INT0_INT_CHECK_FULL_RANGE . . . . .  C  ADDR  02DBH     R   SEG=?CO?BLHELI_S?7
INT0_INT_DO_THROTTLE_GAIN . . . . .  C  ADDR  0353H     R   SEG=?CO?BLHELI_S?7
INT0_INT_EXIT . . . . . . . . . . .  C  ADDR  0403H     R   SEG=?CO?BLHELI_S?7
INT0_INT_FALL_GAIN_DONE . . . . . .  C  ADDR  02B6H     R   SEG=?CO?BLHELI_S?7
INT0_INT_FALL_NOT_MULTISHOT . . . .  C  ADDR  0263H     R   SEG=?CO?BLHELI_S?7
INT0_INT_FALL_NOT_ONESHOT_125 . . .  C  ADDR  028DH     R   SEG=?CO?BLHELI_S?7
INT0_INT_FALL_NOT_ONESHOT_42. . . .  C  ADDR  0275H     R   SEG=?CO?BLHELI_S?7
INT0_INT_GAIN_LOOP. . . . . . . . .  C  ADDR  0395H     R   SEG=?CO?BLHELI_S?7
INT0_INT_GAIN_RCP_DONE. . . . . . .  C  ADDR  039DH     R   SEG=?CO?BLHELI_S?7
INT0_INT_NOT_BIDIR. . . . . . . . .  C  ADDR  0347H     R   SEG=?CO?BLHELI_S?7
INT0_INT_NOT_DSHOT. . . . . . . . .  C  ADDR  0230H     R   SEG=?CO?BLHELI_S?7
INT0_INT_OUTSIDE_RANGE. . . . . . .  C  ADDR  02C5H     R   SEG=?CO?BLHELI_S?7
INT0_INT_PULSE_READY. . . . . . . .  C  ADDR  03B2H     R   SEG=?CO?BLHELI_S?7
INT0_INT_SET_MIN. . . . . . . . . .  C  ADDR  02EAH     R   SEG=?CO?BLHELI_S?7
INT0_INT_SET_PWM_DAMP_SET . . . . .  C  ADDR  03EBH     R   SEG=?CO?BLHELI_S?7
INT0_INT_SET_PWM_REGISTERS. . . . .  C  ADDR  03D4H     R   SEG=?CO?BLHELI_S?7
INT0_INT_SET_TIMEOUT. . . . . . . .  C  ADDR  0400H     R   SEG=?CO?BLHELI_S?7
INT0_INT_STARTUP_BOOST_STALL. . . .  C  ADDR  036AH     R   SEG=?CO?BLHELI_S?7
INT0_INT_STARTUP_BOOSTED. . . . . .  C  ADDR  0374H     R   SEG=?CO?BLHELI_S?7
INT0_INT_UNIDIR_NEG . . . . . . . .  C  ADDR  034BH     R   SEG=?CO?BLHELI_S?7
INT1_INT. . . . . . . . . . . . . .  C  ADDR  040DH     R   SEG=?CO?BLHELI_S?7
INTERRUPT_TABLE_DEFINITION. . . . .  -- ----  -------       
IP. . . . . . . . . . . . . . . . .  -- ----  -------       
IT01CF. . . . . . . . . . . . . . .  -- ----  -------       
J_. . . . . . . . . . . . . . . . .  N  NUMB  000AH     A   
JMP_WAIT_FOR_POWER_ON . . . . . . .  C  ADDR  1334H     R   SEG=?CO?BLHELI_S?7
K_. . . . . . . . . . . . . . . . .  N  NUMB  000BH     A   
L_. . . . . . . . . . . . . . . . .  N  NUMB  000CH     A   
LED_0_DONE. . . . . . . . . . . . .  C  ADDR  0C4FH     R   SEG=?CO?BLHELI_S?7
LED_1_DONE. . . . . . . . . . . . .  C  ADDR  0C54H     R   SEG=?CO?BLHELI_S?7
LED_2_DONE. . . . . . . . . . . . .  C  ADDR  0C59H     R   SEG=?CO?BLHELI_S?7
LED_3_DONE. . . . . . . . . . . . .  C  ADDR  0C5EH     R   SEG=?CO?BLHELI_S?7
LED_CONTROL . . . . . . . . . . . .  C  ADDR  0C47H     R   SEG=?CO?BLHELI_S?7
LOAD_MIN_TIME . . . . . . . . . . .  C  ADDR  0654H     R   SEG=?CO?BLHELI_S?7
LOAD_MIN_TIME_FAST. . . . . . . . .  C  ADDR  06A1H     R   SEG=?CO?BLHELI_S?7
LOW_RPM_PWR_SLOPE . . . . . . . . .  D  ADDR  003FH     R   SEG=?DT?BLHELI_S?2
M_. . . . . . . . . . . . . . . . .  N  NUMB  000DH     A   
MAI1. . . . . . . . . . . . . . . .  C  ADDR  1C79H     R   SEG=?CO?BLHELI_S?9
MAI2. . . . . . . . . . . . . . . .  C  ADDR  1C9BH     R   SEG=?CO?BLHELI_S?9
MAI4. . . . . . . . . . . . . . . .  C  ADDR  1CD5H     R   SEG=?CO?BLHELI_S?9
MAI5. . . . . . . . . . . . . . . .  C  ADDR  1D2CH     R   SEG=?CO?BLHELI_S?9
MAI6. . . . . . . . . . . . . . . .  C  ADDR  1D3DH     R   SEG=?CO?BLHELI_S?9
MAIN. . . . . . . . . . . . . . . .  C  ADDR  1C77H     R   SEG=?CO?BLHELI_S?9
MAX_THROTTLE_H. . . . . . . . . . .  D  ADDR  0036H     R   SEG=?DT?BLHELI_S?2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   496

MAX_THROTTLE_L. . . . . . . . . . .  D  ADDR  0035H     R   SEG=?DT?BLHELI_S?2
MIN_THROTTLE_H. . . . . . . . . . .  D  ADDR  0032H     R   SEG=?DT?BLHELI_S?2
MIN_THROTTLE_L. . . . . . . . . . .  D  ADDR  0031H     R   SEG=?DT?BLHELI_S?2
MOTOR_STARTED . . . . . . . . . . .  N  NUMB  0002H     A   
MUSIC . . . . . . . . . . . . . . .  C  ADDR  0D2FH     R   SEG=?CO?BLHELI_S?7
MUSIC_A4. . . . . . . . . . . . . .  C  ADDR  0C5FH     R   SEG=?CO?BLHELI_S?7
MUSIC_A4_CUSTOM . . . . . . . . . .  C  ADDR  0C67H     R   SEG=?CO?BLHELI_S?7
MUSIC_AS4 . . . . . . . . . . . . .  C  ADDR  0C77H     R   SEG=?CO?BLHELI_S?7
MUSIC_B4. . . . . . . . . . . . . .  C  ADDR  0C7FH     R   SEG=?CO?BLHELI_S?7
MUSIC_BASE_DELAY. . . . . . . . . .  C  ADDR  0A45H     R   SEG=?CO?BLHELI_S?7
MUSIC_C . . . . . . . . . . . . . .  C  ADDR  0CD7H     R   SEG=?CO?BLHELI_S?7
MUSIC_CS. . . . . . . . . . . . . .  C  ADDR  0CE7H     R   SEG=?CO?BLHELI_S?7
MUSIC_CSL . . . . . . . . . . . . .  C  ADDR  0CDFH     R   SEG=?CO?BLHELI_S?7
MUSIC_D . . . . . . . . . . . . . .  C  ADDR  0CEFH     R   SEG=?CO?BLHELI_S?7
MUSIC_D2. . . . . . . . . . . . . .  C  ADDR  0CF7H     R   SEG=?CO?BLHELI_S?7
MUSIC_DL. . . . . . . . . . . . . .  C  ADDR  0C8FH     R   SEG=?CO?BLHELI_S?7
MUSIC_DS. . . . . . . . . . . . . .  C  ADDR  0CFFH     R   SEG=?CO?BLHELI_S?7
MUSIC_E . . . . . . . . . . . . . .  C  ADDR  0D07H     R   SEG=?CO?BLHELI_S?7
MUSIC_E2. . . . . . . . . . . . . .  C  ADDR  0D0FH     R   SEG=?CO?BLHELI_S?7
MUSIC_E4. . . . . . . . . . . . . .  C  ADDR  0C87H     R   SEG=?CO?BLHELI_S?7
MUSIC_E4N . . . . . . . . . . . . .  C  ADDR  0CB7H     R   SEG=?CO?BLHELI_S?7
MUSIC_F . . . . . . . . . . . . . .  C  ADDR  0D17H     R   SEG=?CO?BLHELI_S?7
MUSIC_F1. . . . . . . . . . . . . .  C  ADDR  0C97H     R   SEG=?CO?BLHELI_S?7
MUSIC_F2. . . . . . . . . . . . . .  C  ADDR  0C9FH     R   SEG=?CO?BLHELI_S?7
MUSIC_F3. . . . . . . . . . . . . .  C  ADDR  0CA7H     R   SEG=?CO?BLHELI_S?7
MUSIC_F4. . . . . . . . . . . . . .  C  ADDR  0CAFH     R   SEG=?CO?BLHELI_S?7
MUSIC_FS4 . . . . . . . . . . . . .  C  ADDR  0CCFH     R   SEG=?CO?BLHELI_S?7
MUSIC_G . . . . . . . . . . . . . .  C  ADDR  0D1FH     R   SEG=?CO?BLHELI_S?7
MUSIC_G4. . . . . . . . . . . . . .  C  ADDR  0CBFH     R   SEG=?CO?BLHELI_S?7
MUSIC_G4_CUSTOM . . . . . . . . . .  C  ADDR  0CC7H     R   SEG=?CO?BLHELI_S?7
MUSIC_G_CUSTOM. . . . . . . . . . .  C  ADDR  0D27H     R   SEG=?CO?BLHELI_S?7
MUSIC_GS4 . . . . . . . . . . . . .  C  ADDR  0C6FH     R   SEG=?CO?BLHELI_S?7
MUSIC_INNER_LOOP. . . . . . . . . .  C  ADDR  0A20H     R   SEG=?CO?BLHELI_S?7
MUSIC_M_LOOP. . . . . . . . . . . .  C  ADDR  0D3FH     R   SEG=?CO?BLHELI_S?7
MUSIC_O_LOOP. . . . . . . . . . . .  C  ADDR  0D3DH     R   SEG=?CO?BLHELI_S?7
MUSIC_OUTER_LOOP. . . . . . . . . .  C  ADDR  0A01H     R   SEG=?CO?BLHELI_S?7
MUSIC_VARIABLE_DELAY. . . . . . . .  C  ADDR  0A4CH     R   SEG=?CO?BLHELI_S?7
MUTE. . . . . . . . . . . . . . . .  N  NUMB  0007H     A   
MUTE_CHECK. . . . . . . . . . . . .  C  ADDR  09FDH     R   SEG=?CO?BLHELI_S?7
N_. . . . . . . . . . . . . . . . .  N  NUMB  000EH     A   
NEW_RCP . . . . . . . . . . . . . .  D  ADDR  0052H     R   SEG=?DT?BLHELI_S?2
NO_WAVE . . . . . . . . . . . . . .  C  ADDR  0A1BH     R   SEG=?CO?BLHELI_S?7
NORMAL_RUN_CHECK_STARTUP_ROT. . . .  C  ADDR  129DH     R   SEG=?CO?BLHELI_S?7
NORMAL_RUN_CHECKS . . . . . . . . .  C  ADDR  128CH     R   SEG=?CO?BLHELI_S?7
O_. . . . . . . . . . . . . . . . .  N  NUMB  000FH     A   
OEM_TONES . . . . . . . . . . . . .  C  ADDR  0F40H     R   SEG=?CO?BLHELI_S?7
P0. . . . . . . . . . . . . . . . .  -- ----  -------       
P0_DIGITAL. . . . . . . . . . . . .  -- ----  -------       
P0_INIT . . . . . . . . . . . . . .  -- ----  -------       
P0_PUSHPULL . . . . . . . . . . . .  -- ----  -------       
P0_SKIP . . . . . . . . . . . . . .  -- ----  -------       
P0MDIN. . . . . . . . . . . . . . .  -- ----  -------       
P0MDOUT . . . . . . . . . . . . . .  -- ----  -------       
P0SKIP. . . . . . . . . . . . . . .  -- ----  -------       
P1. . . . . . . . . . . . . . . . .  -- ----  -------       
P1_DIGITAL. . . . . . . . . . . . .  -- ----  -------       
P1_INIT . . . . . . . . . . . . . .  -- ----  -------       
P1_PUSHPULL . . . . . . . . . . . .  -- ----  -------       
P1_SKIP . . . . . . . . . . . . . .  -- ----  -------       
P1MDIN. . . . . . . . . . . . . . .  -- ----  -------       
P1MDOUT . . . . . . . . . . . . . .  -- ----  -------       
P1SKIP. . . . . . . . . . . . . . .  -- ----  -------       
P2_PUSHPULL . . . . . . . . . . . .  -- ----  -------       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   497

P2MDOUT . . . . . . . . . . . . . .  -- ----  -------       
P_. . . . . . . . . . . . . . . . .  N  NUMB  0010H     A   
PARAH . . . . . . . . . . . . . . .     REG   R            
PARAL . . . . . . . . . . . . . . .     REG   R            
PCA0H . . . . . . . . . . . . . . .  -- ----  -------       
PCA0L . . . . . . . . . . . . . . .  -- ----  -------       
PCA_INT . . . . . . . . . . . . . .  C  ADDR  041CH     R   SEG=?CO?BLHELI_S?7
PCA_INT_EXIT. . . . . . . . . . . .  C  ADDR  044AH     R   SEG=?CO?BLHELI_S?7
PCA_INT_HI_PWM. . . . . . . . . . .  C  ADDR  0435H     R   SEG=?CO?BLHELI_S?7
PCA_INT_SET_PWM . . . . . . . . . .  C  ADDR  043DH     R   SEG=?CO?BLHELI_S?7
PGM_BEACON_DELAY. . . . . . . . . .  I  ADDR  009AH     R   SEG=?ID?BLHELI_S?3
PGM_BEACON_STRENGTH . . . . . . . .  I  ADDR  0099H     R   SEG=?ID?BLHELI_S?3
PGM_BEEP_STRENGTH . . . . . . . . .  I  ADDR  0098H     R   SEG=?ID?BLHELI_S?3
PGM_BIDIR . . . . . . . . . . . . .  N  NUMB  0002H     A   
PGM_BIDIR_REV . . . . . . . . . . .  N  NUMB  0001H     A   
PGM_BRAKE_ON_STOP . . . . . . . . .  I  ADDR  00A4H     R   SEG=?ID?BLHELI_S?3
PGM_CENTER_THROTTLE . . . . . . . .  I  ADDR  009EH     R   SEG=?ID?BLHELI_S?3
PGM_COMM_TIMING . . . . . . . . . .  I  ADDR  0092H     R   SEG=?ID?BLHELI_S?3
PGM_DEMAG_COMP. . . . . . . . . . .  I  ADDR  009CH     R   SEG=?ID?BLHELI_S?3
PGM_DIR_REV . . . . . . . . . . . .  N  NUMB  0000H     A   
PGM_DIRECTION . . . . . . . . . . .  I  ADDR  0088H     R   SEG=?ID?BLHELI_S?3
PGM_ENABLE_POWER_PROT . . . . . . .  I  ADDR  00A1H     R   SEG=?ID?BLHELI_S?3
PGM_ENABLE_TEMP_PROT. . . . . . . .  I  ADDR  00A0H     R   SEG=?ID?BLHELI_S?3
PGM_ENABLE_TX_PROGRAM . . . . . . .  I  ADDR  008CH     R   SEG=?ID?BLHELI_S?3
PGM_INPUT_POL . . . . . . . . . . .  I  ADDR  0089H     R   SEG=?ID?BLHELI_S?3
PGM_LED_CONTROL . . . . . . . . . .  I  ADDR  00A5H     R   SEG=?ID?BLHELI_S?3
PGM_MAX_THROTTLE. . . . . . . . . .  I  ADDR  0097H     R   SEG=?ID?BLHELI_S?3
PGM_MIN_THROTTLE. . . . . . . . . .  I  ADDR  0096H     R   SEG=?ID?BLHELI_S?3
PGM_START . . . . . . . . . . . . .  C  ADDR  0D9DH     R   SEG=?CO?BLHELI_S?7
PGM_STARTUP_PWR . . . . . . . . . .  I  ADDR  0086H     R   SEG=?ID?BLHELI_S?3
PGM_STARTUP_PWR_DECODED . . . . . .  I  ADDR  00A6H     R   SEG=?ID?BLHELI_S?3
POLYNOM . . . . . . . . . . . . . .  N  NUMB  A001H     A   
POWER_ON_WAIT_CNT_H . . . . . . . .  D  ADDR  0038H     R   SEG=?DT?BLHELI_S?2
POWER_ON_WAIT_CNT_L . . . . . . . .  D  ADDR  0037H     R   SEG=?DT?BLHELI_S?2
POWER_PWM_REG_H . . . . . . . . . .  D  ADDR  0055H     R   SEG=?DT?BLHELI_S?2
POWER_PWM_REG_L . . . . . . . . . .  D  ADDR  0054H     R   SEG=?DT?BLHELI_S?2
PREV_COMM_H . . . . . . . . . . . .  D  ADDR  0043H     R   SEG=?DT?BLHELI_S?2
PREV_COMM_L . . . . . . . . . . . .  D  ADDR  0042H     R   SEG=?DT?BLHELI_S?2
PREV_COMM_X . . . . . . . . . . . .  D  ADDR  0044H     R   SEG=?DT?BLHELI_S?2
PREV_PREV_COMM_H. . . . . . . . . .  D  ADDR  0046H     R   SEG=?DT?BLHELI_S?2
PREV_PREV_COMM_L. . . . . . . . . .  D  ADDR  0045H     R   SEG=?DT?BLHELI_S?2
PRO3. . . . . . . . . . . . . . . .  C  ADDR  1D00H     R   SEG=?CO?BLHELI_S?9
PRO4. . . . . . . . . . . . . . . .  C  ADDR  1D0CH     R   SEG=?CO?BLHELI_S?9
PRO5. . . . . . . . . . . . . . . .  C  ADDR  1D12H     R   SEG=?CO?BLHELI_S?9
PRO6. . . . . . . . . . . . . . . .  C  ADDR  1D27H     R   SEG=?CO?BLHELI_S?9
PROGRAM_BY_TX_CHECKED . . . . . . .  C  ADDR  1123H     R   SEG=?CO?BLHELI_S?7
PROGRAM_BY_TX_ENTRY_LIMIT . . . . .  C  ADDR  110DH     R   SEG=?CO?BLHELI_S?7
PROGRAM_BY_TX_ENTRY_STORE . . . . .  C  ADDR  1113H     R   SEG=?CO?BLHELI_S?7
PROGRAM_BY_TX_ENTRY_WAIT. . . . . .  C  ADDR  111AH     R   SEG=?CO?BLHELI_S?7
PROTOCOL_ID . . . . . . . . . . . .  C  ADDR  0D51H     R   SEG=?CO?BLHELI_S?7
PSCTL . . . . . . . . . . . . . . .  -- ----  -------       
PSW . . . . . . . . . . . . . . . .  D  ADDR  00D0H     A   
PUT1. . . . . . . . . . . . . . . .  C  ADDR  1D4DH     R   SEG=?CO?BLHELI_S?9
PUT2. . . . . . . . . . . . . . . .  C  ADDR  1D60H     R   SEG=?CO?BLHELI_S?9
PUT3. . . . . . . . . . . . . . . .  C  ADDR  1D6CH     R   SEG=?CO?BLHELI_S?9
PUT4. . . . . . . . . . . . . . . .  C  ADDR  1D7AH     R   SEG=?CO?BLHELI_S?9
PUTC. . . . . . . . . . . . . . . .  C  ADDR  1D63H     R   SEG=?CO?BLHELI_S?9
PUTP. . . . . . . . . . . . . . . .  C  ADDR  1D47H     R   SEG=?CO?BLHELI_S?9
PUTW. . . . . . . . . . . . . . . .  C  ADDR  1D3FH     R   SEG=?CO?BLHELI_S?9
PWM_LIMIT . . . . . . . . . . . . .  D  ADDR  0059H     R   SEG=?DT?BLHELI_S?2
PWM_LIMIT_BEG . . . . . . . . . . .  D  ADDR  005BH     R   SEG=?DT?BLHELI_S?2
PWM_LIMIT_BY_RPM. . . . . . . . . .  D  ADDR  005AH     R   SEG=?DT?BLHELI_S?2
Q_. . . . . . . . . . . . . . . . .  N  NUMB  0011H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   498

R_. . . . . . . . . . . . . . . . .  N  NUMB  0012H     A   
RCP_DIR_REV . . . . . . . . . . . .  N  NUMB  0005H     A   
RCP_DSHOT . . . . . . . . . . . . .  N  NUMB  0004H     A   
RCP_FULL_RANGE. . . . . . . . . . .  N  NUMB  0006H     A   
RCP_MULTISHOT . . . . . . . . . . .  N  NUMB  0003H     A   
RCP_ONESHOT125. . . . . . . . . . .  N  NUMB  0001H     A   
RCP_ONESHOT42 . . . . . . . . . . .  N  NUMB  0002H     A   
RCP_OUTSIDE_RANGE_CNT . . . . . . .  D  ADDR  0022H     R   SEG=?DT?BLHELI_S?1
RCP_STOP_CNT. . . . . . . . . . . .  D  ADDR  0053H     R   SEG=?DT?BLHELI_S?2
RCP_TIMEOUT_CNTD. . . . . . . . . .  D  ADDR  0023H     R   SEG=?DT?BLHELI_S?1
RCP_UPDATED . . . . . . . . . . . .  N  NUMB  0000H     A   
RD1 . . . . . . . . . . . . . . . .  C  ADDR  1D31H     R   SEG=?CO?BLHELI_S?9
READ_ADC_RESULT . . . . . . . . . .  -- ----  -------       
READ_ALL_EEPROM_PARAMETERS. . . . .  C  ADDR  1336H     R   SEG=?CO?BLHELI_S?7
READ_COMP_OUT . . . . . . . . . . .  -- ----  -------       
READ_EEPROM_BLOCK1. . . . . . . . .  C  ADDR  1366H     R   SEG=?CO?BLHELI_S?7
READ_EEPROM_BLOCK2. . . . . . . . .  C  ADDR  1373H     R   SEG=?CO?BLHELI_S?7
READ_EEPROM_BYTE. . . . . . . . . .  C  ADDR  13B6H     R   SEG=?CO?BLHELI_S?7
READ_EEPROM_EXIT. . . . . . . . . .  C  ADDR  137CH     R   SEG=?CO?BLHELI_S?7
READ_EEPROM_READ. . . . . . . . . .  C  ADDR  135FH     R   SEG=?CO?BLHELI_S?7
READ_EEPROM_STORE_DEFAULTS. . . . .  C  ADDR  134CH     R   SEG=?CO?BLHELI_S?7
READ_INITIAL_TEMP . . . . . . . . .  C  ADDR  11C5H     R   SEG=?CO?BLHELI_S?7
READ_TAG. . . . . . . . . . . . . .  C  ADDR  1402H     R   SEG=?CO?BLHELI_S?7
READ_TAGS . . . . . . . . . . . . .  C  ADDR  13F9H     R   SEG=?CO?BLHELI_S?7
RESET . . . . . . . . . . . . . . .  C  ADDR  19FDH     R   SEG=?CO?BLHELI_S?10
RST . . . . . . . . . . . . . . . .  C  ADDR  1CBEH     R   SEG=?CO?BLHELI_S?9
RSTSRC. . . . . . . . . . . . . . .  -- ----  -------       
RTX_MDIN. . . . . . . . . . . . . .  -- ----  -------       
RTX_MDOUT . . . . . . . . . . . . .  -- ----  -------       
RTX_PIN . . . . . . . . . . . . . .  -- ----  -------       
RTX_PORT. . . . . . . . . . . . . .  -- ----  -------       
RTX_SKIP. . . . . . . . . . . . . .  -- ----  -------       
RUN1. . . . . . . . . . . . . . . .  C  ADDR  1208H     R   SEG=?CO?BLHELI_S?7
RUN2. . . . . . . . . . . . . . . .  C  ADDR  1214H     R   SEG=?CO?BLHELI_S?7
RUN3. . . . . . . . . . . . . . . .  C  ADDR  122CH     R   SEG=?CO?BLHELI_S?7
RUN4. . . . . . . . . . . . . . . .  C  ADDR  1238H     R   SEG=?CO?BLHELI_S?7
RUN5. . . . . . . . . . . . . . . .  C  ADDR  1244H     R   SEG=?CO?BLHELI_S?7
RUN6. . . . . . . . . . . . . . . .  C  ADDR  1250H     R   SEG=?CO?BLHELI_S?7
RUN6_BRAKE_DONE . . . . . . . . . .  C  ADDR  12E8H     R   SEG=?CO?BLHELI_S?7
RUN6_CHECK_DIR. . . . . . . . . . .  C  ADDR  12C4H     R   SEG=?CO?BLHELI_S?7
RUN6_CHECK_DIR_CHANGE . . . . . . .  C  ADDR  12D4H     R   SEG=?CO?BLHELI_S?7
RUN6_CHECK_DIR_REV. . . . . . . . .  C  ADDR  12CFH     R   SEG=?CO?BLHELI_S?7
RUN6_CHECK_SPEED. . . . . . . . . .  C  ADDR  12DEH     R   SEG=?CO?BLHELI_S?7
RUN_TO_WAIT_FOR_POWER_ON. . . . . .  C  ADDR  130FH     R   SEG=?CO?BLHELI_S?7
RUN_TO_WAIT_FOR_POWER_ON_BRAKE_DONE  C  ADDR  132AH     R   SEG=?CO?BLHELI_S?7
RUN_TO_WAIT_FOR_POWER_ON_FAIL . . .  C  ADDR  1307H     R   SEG=?CO?BLHELI_S?7
RUN_TO_WAIT_FOR_POWER_ON_STALL_DONE  C  ADDR  1312H     R   SEG=?CO?BLHELI_S?7
SCALE_THROTTLE_CAL. . . . . . . . .  C  ADDR  0ACBH     R   SEG=?CO?BLHELI_S?7
SET4. . . . . . . . . . . . . . . .  C  ADDR  1CC6H     R   SEG=?CO?BLHELI_S?9
SET5. . . . . . . . . . . . . . . .  C  ADDR  1CCCH     R   SEG=?CO?BLHELI_S?9
SET6. . . . . . . . . . . . . . . .  C  ADDR  1CD2H     R   SEG=?CO?BLHELI_S?9
SET_COMP_PHASE_A. . . . . . . . . .  -- ----  -------       
SET_COMP_PHASE_B. . . . . . . . . .  -- ----  -------       
SET_COMP_PHASE_C. . . . . . . . . .  -- ----  -------       
SET_DAMP_PWM_REGS . . . . . . . . .  -- ----  -------       
SET_DEFAULT_PARAMETERS. . . . . . .  C  ADDR  0A5FH     R   SEG=?CO?BLHELI_S?7
SET_LED_0 . . . . . . . . . . . . .  -- ----  -------       
SET_LED_1 . . . . . . . . . . . . .  -- ----  -------       
SET_LED_2 . . . . . . . . . . . . .  -- ----  -------       
SET_LED_3 . . . . . . . . . . . . .  -- ----  -------       
SET_MCU_CLK_24MHZ . . . . . . . . .  -- ----  -------       
SET_MCU_CLK_48MHZ . . . . . . . . .  -- ----  -------       
SET_POWER_PWM_REGS. . . . . . . . .  -- ----  -------       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   499

SET_PWM_A . . . . . . . . . . . . .  -- ----  -------       
SET_PWM_B . . . . . . . . . . . . .  -- ----  -------       
SET_PWM_C . . . . . . . . . . . . .  -- ----  -------       
SET_PWM_LIMIT_HIGH_RPM. . . . . . .  C  ADDR  04A4H     R   SEG=?CO?BLHELI_S?7
SET_PWM_LIMIT_HIGH_RPM_INC_LIMIT. .  C  ADDR  04B4H     R   SEG=?CO?BLHELI_S?7
SET_PWM_LIMIT_HIGH_RPM_STORE. . . .  C  ADDR  04B5H     R   SEG=?CO?BLHELI_S?7
SET_PWM_LIMIT_LOW_RPM . . . . . . .  C  ADDR  0474H     R   SEG=?CO?BLHELI_S?7
SET_PWM_LIMIT_LOW_RPM_EXIT. . . . .  C  ADDR  04A1H     R   SEG=?CO?BLHELI_S?7
SET_PWM_POLARITY. . . . . . . . . .  -- ----  -------       
SET_PWMS_OFF. . . . . . . . . . . .  -- ----  -------       
SET_RPM_OUT . . . . . . . . . . . .  -- ----  -------       
SET_STARTUP_PWM . . . . . . . . . .  C  ADDR  051EH     R   SEG=?CO?BLHELI_S?7
SETBUF. . . . . . . . . . . . . . .  C  ADDR  1CC0H     R   SEG=?CO?BLHELI_S?9
SETUP_COMM_WAIT . . . . . . . . . .  C  ADDR  0882H     R   SEG=?CO?BLHELI_S?7
SETUP_ZC_SCAN_TIMEOUT . . . . . . .  C  ADDR  0779H     R   SEG=?CO?BLHELI_S?7
SETUP_ZC_SCAN_TIMEOUT_STARTUP_DONE.  C  ADDR  0796H     R   SEG=?CO?BLHELI_S?7
SIGNATURE_001 . . . . . . . . . . .  -- ----  -------       
SIGNATURE_002 . . . . . . . . . . .  -- ----  -------       
SKIP_T2_INT . . . . . . . . . . . .  D  ADDR  0063H     R   SEG=?DT?BLHELI_S?2
SP. . . . . . . . . . . . . . . . .  D  ADDR  0081H     A   
STALL_CNT . . . . . . . . . . . . .  D  ADDR  003CH     R   SEG=?DT?BLHELI_S?2
START_ADC . . . . . . . . . . . . .  -- ----  -------       
START_ADC_CONVERSION. . . . . . . .  C  ADDR  04BAH     R   SEG=?CO?BLHELI_S?7
STARTUP_CNT . . . . . . . . . . . .  D  ADDR  0039H     R   SEG=?DT?BLHELI_S?2
STARTUP_CZ. . . . . . . . . . . . .  C  ADDR  0E18H     R   SEG=?CO?BLHELI_S?7
STARTUP_END . . . . . . . . . . . .  C  ADDR  0F4CH     R   SEG=?CO?BLHELI_S?7
STARTUP_GOT . . . . . . . . . . . .  C  ADDR  0E68H     R   SEG=?CO?BLHELI_S?7
STARTUP_HG. . . . . . . . . . . . .  C  ADDR  0F1EH     R   SEG=?CO?BLHELI_S?7
STARTUP_IM. . . . . . . . . . . . .  C  ADDR  0E43H     R   SEG=?CO?BLHELI_S?7
STARTUP_PHASE . . . . . . . . . . .  N  NUMB  0000H     A   
STARTUP_POWER_TABLE . . . . . . . .  C  ADDR  0080H     R   SEG=?CO?BLHELI_S?7
STARTUP_PWM_SET_PWM . . . . . . . .  C  ADDR  0533H     R   SEG=?CO?BLHELI_S?7
STARTUP_WAVE1 . . . . . . . . . . .  C  ADDR  09E5H     R   SEG=?CO?BLHELI_S?7
STARTUP_WAVE2 . . . . . . . . . . .  C  ADDR  09F5H     R   SEG=?CO?BLHELI_S?7
STARTUP_ZC_TIMEOUT_CNTD . . . . . .  D  ADDR  003AH     R   SEG=?DT?BLHELI_S?2
STOP_ADC. . . . . . . . . . . . . .  -- ----  -------       
STORE_TIMES_DECREASE. . . . . . . .  C  ADDR  0718H     R   SEG=?CO?BLHELI_S?7
STORE_TIMES_DECREASE_FAST . . . . .  C  ADDR  076BH     R   SEG=?CO?BLHELI_S?7
STORE_TIMES_EXIT. . . . . . . . . .  C  ADDR  0739H     R   SEG=?CO?BLHELI_S?7
STORE_TIMES_INCREASE. . . . . . . .  C  ADDR  0709H     R   SEG=?CO?BLHELI_S?7
STORE_TIMES_INCREASE_FAST . . . . .  C  ADDR  0762H     R   SEG=?CO?BLHELI_S?7
STORE_TIMES_UP_OR_DOWN. . . . . . .  C  ADDR  0703H     R   SEG=?CO?BLHELI_S?7
STORE_TIMES_UP_OR_DOWN_FAST . . . .  C  ADDR  075CH     R   SEG=?CO?BLHELI_S?7
SUCCESS . . . . . . . . . . . . . .  N  NUMB  0030H     A   
SUCCESS_BEEP. . . . . . . . . . . .  C  ADDR  1423H     R   SEG=?CO?BLHELI_S?7
SUCCESS_BEEP_INVERTED . . . . . . .  C  ADDR  1452H     R   SEG=?CO?BLHELI_S?7
SWITCH_POWER_OFF. . . . . . . . . .  C  ADDR  0A5EH     R   SEG=?CO?BLHELI_S?7
T0_INT. . . . . . . . . . . . . . .  C  ADDR  008DH     R   SEG=?CO?BLHELI_S?7
T1_INT. . . . . . . . . . . . . . .  C  ADDR  0090H     R   SEG=?CO?BLHELI_S?7
T1_INT_BIDIR_FWD. . . . . . . . . .  C  ADDR  015DH     R   SEG=?CO?BLHELI_S?7
T1_INT_BIDIR_REV_CHK. . . . . . . .  C  ADDR  0162H     R   SEG=?CO?BLHELI_S?7
T1_INT_DECODE . . . . . . . . . . .  C  ADDR  00F2H     R   SEG=?CO?BLHELI_S?7
T1_INT_DECODE_LSB . . . . . . . . .  C  ADDR  0108H     R   SEG=?CO?BLHELI_S?7
T1_INT_DECODE_MSB . . . . . . . . .  C  ADDR  00FDH     R   SEG=?CO?BLHELI_S?7
T1_INT_FRAME_FAIL . . . . . . . . .  C  ADDR  01CDH     R   SEG=?CO?BLHELI_S?7
T1_INT_FRAME_TIME_SCALED. . . . . .  C  ADDR  00CCH     R   SEG=?CO?BLHELI_S?7
T1_INT_LSB_FAIL . . . . . . . . . .  C  ADDR  00FFH     R   SEG=?CO?BLHELI_S?7
T1_INT_MSB_FAIL . . . . . . . . . .  C  ADDR  00F4H     R   SEG=?CO?BLHELI_S?7
T1_INT_NOT_BIDIR. . . . . . . . . .  C  ADDR  016EH     R   SEG=?CO?BLHELI_S?7
T1_INT_STARTUP_BOOST_STALL. . . . .  C  ADDR  019FH     R   SEG=?CO?BLHELI_S?7
T1_INT_STARTUP_BOOSTED. . . . . . .  C  ADDR  01A9H     R   SEG=?CO?BLHELI_S?7
T1_INT_XOR_OK . . . . . . . . . . .  C  ADDR  0120H     R   SEG=?CO?BLHELI_S?7
T1_INT_ZERO_RCP_CHECKED . . . . . .  C  ADDR  01BEH     R   SEG=?CO?BLHELI_S?7
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   500

T2_INT. . . . . . . . . . . . . . .  C  ADDR  01D6H     R   SEG=?CO?BLHELI_S?7
T2_INT_EXIT . . . . . . . . . . . .  C  ADDR  0209H     R   SEG=?CO?BLHELI_S?7
T2_INT_RCP_STOP . . . . . . . . . .  C  ADDR  01FEH     R   SEG=?CO?BLHELI_S?7
T2_INT_START. . . . . . . . . . . .  C  ADDR  01EBH     R   SEG=?CO?BLHELI_S?7
T3_INT. . . . . . . . . . . . . . .  C  ADDR  020EH     R   SEG=?CO?BLHELI_S?7
T3_PENDING. . . . . . . . . . . . .  N  NUMB  0000H     A   
TCON. . . . . . . . . . . . . . . .  -- ----  -------       
TCON_TR1. . . . . . . . . . . . . .  -- ----  -------       
TEMP1 . . . . . . . . . . . . . . .     REG   R            
TEMP2 . . . . . . . . . . . . . . .     REG   R            
TEMP3 . . . . . . . . . . . . . . .     REG   R            
TEMP4 . . . . . . . . . . . . . . .     REG   R            
TEMP5 . . . . . . . . . . . . . . .     REG   R            
TEMP6 . . . . . . . . . . . . . . .     REG   R            
TEMP7 . . . . . . . . . . . . . . .     REG   R            
TEMP8 . . . . . . . . . . . . . . .     REG   R            
TEMP_AVERAGE_DEC. . . . . . . . . .  C  ADDR  04E6H     R   SEG=?CO?BLHELI_S?7
TEMP_AVERAGE_INC. . . . . . . . . .  C  ADDR  04E9H     R   SEG=?CO?BLHELI_S?7
TEMP_AVERAGE_INC_DEC. . . . . . . .  C  ADDR  04DAH     R   SEG=?CO?BLHELI_S?7
TEMP_AVERAGE_UPDATED. . . . . . . .  C  ADDR  04F0H     R   SEG=?CO?BLHELI_S?7
TEMP_AVERAGE_UPDATED_LOAD_ACC . . .  C  ADDR  04EEH     R   SEG=?CO?BLHELI_S?7
TEMP_CHECK_EXIT . . . . . . . . . .  C  ADDR  0512H     R   SEG=?CO?BLHELI_S?7
TEMP_LIMIT. . . . . . . . . . . . .  -- ----  -------       
TEMP_LIMIT_STEP . . . . . . . . . .  -- ----  -------       
TEMP_PROT_LIMIT . . . . . . . . . .  D  ADDR  0067H     R   SEG=?DT?BLHELI_S?2
TEMP_STORAGE. . . . . . . . . . . .  I  ADDR  00D0H     R   SEG=?ID?BLHELI_S?4
TEST_THROTTLE_GAIN. . . . . . . . .  C  ADDR  0BF3H     R   SEG=?CO?BLHELI_S?7
TEST_THROTTLE_GAIN_MULT . . . . . .  C  ADDR  0C00H     R   SEG=?CO?BLHELI_S?7
TH0 . . . . . . . . . . . . . . . .  -- ----  -------       
TH1 . . . . . . . . . . . . . . . .  -- ----  -------       
THROTTLE_GAIN . . . . . . . . . . .  D  ADDR  005EH     R   SEG=?DT?BLHELI_S?2
THROTTLE_GAIN_BD_REV. . . . . . . .  D  ADDR  0060H     R   SEG=?DT?BLHELI_S?2
THROTTLE_GAIN_BD_REV_M. . . . . . .  D  ADDR  0061H     R   SEG=?DT?BLHELI_S?2
THROTTLE_GAIN_M . . . . . . . . . .  D  ADDR  005FH     R   SEG=?DT?BLHELI_S?2
THROTTLE_HIGH_CAL . . . . . . . . .  C  ADDR  109BH     R   SEG=?CO?BLHELI_S?7
THROTTLE_LOW_CAL. . . . . . . . . .  C  ADDR  10CEH     R   SEG=?CO?BLHELI_S?7
THROTTLE_LOW_CAL_START. . . . . . .  C  ADDR  10CCH     R   SEG=?CO?BLHELI_S?7
TIMER0_X. . . . . . . . . . . . . .  D  ADDR  0040H     R   SEG=?DT?BLHELI_S?2
TIMER2_X. . . . . . . . . . . . . .  D  ADDR  0041H     R   SEG=?DT?BLHELI_S?2
TL0 . . . . . . . . . . . . . . . .  -- ----  -------       
TL1 . . . . . . . . . . . . . . . .  -- ----  -------       
TMOD. . . . . . . . . . . . . . . .  -- ----  -------       
TMR2CN0 . . . . . . . . . . . . . .  -- ----  -------       
TMR2CN0_TF2H. . . . . . . . . . . .  -- ----  -------       
TMR2CN0_TR2 . . . . . . . . . . . .  -- ----  -------       
TMR2H . . . . . . . . . . . . . . .  -- ----  -------       
TMR2L . . . . . . . . . . . . . . .  -- ----  -------       
TMR3CN0 . . . . . . . . . . . . . .  -- ----  -------       
TMR3H . . . . . . . . . . . . . . .  -- ----  -------       
TMR3L . . . . . . . . . . . . . . .  -- ----  -------       
TMR3RLH . . . . . . . . . . . . . .  -- ----  -------       
TMR3RLL . . . . . . . . . . . . . .  -- ----  -------       
TONE_AB . . . . . . . . . . . . . .  C  ADDR  0A38H     R   SEG=?CO?BLHELI_S?7
TONE_BC . . . . . . . . . . . . . .  C  ADDR  0A33H     R   SEG=?CO?BLHELI_S?7
TONE_DIR. . . . . . . . . . . . . .  N  NUMB  0005H     A   
TONE_SELECTION. . . . . . . . . . .  C  ADDR  0E02H     R   SEG=?CO?BLHELI_S?7
TONE_WAVE . . . . . . . . . . . . .  N  NUMB  0004H     A   
UART_LOOP . . . . . . . . . . . . .  N  NUMB  001AH     A   
VALIDATE_RCP_START. . . . . . . . .  C  ADDR  1061H     R   SEG=?CO?BLHELI_S?7
VDM0CN. . . . . . . . . . . . . . .  -- ----  -------       
WAIT1 . . . . . . . . . . . . . . .  C  ADDR  1DC9H     R   SEG=?CO?BLHELI_S?9
WAIT100MS . . . . . . . . . . . . .  C  ADDR  0461H     R   SEG=?CO?BLHELI_S?7
WAIT10MS. . . . . . . . . . . . . .  C  ADDR  0459H     R   SEG=?CO?BLHELI_S?7
AX51 MACRO ASSEMBLER  BLHELI_S                                                              04/07/17 11:49:58 PAGE   501

WAIT1MS . . . . . . . . . . . . . .  C  ADDR  0451H     R   SEG=?CO?BLHELI_S?7
WAIT1S. . . . . . . . . . . . . . .  C  ADDR  141BH     R   SEG=?CO?BLHELI_S?7
WAIT1S_LOOP . . . . . . . . . . . .  C  ADDR  141DH     R   SEG=?CO?BLHELI_S?7
WAIT200MS . . . . . . . . . . . . .  C  ADDR  0465H     R   SEG=?CO?BLHELI_S?7
WAIT30MS. . . . . . . . . . . . . .  C  ADDR  045DH     R   SEG=?CO?BLHELI_S?7
WAIT3MS . . . . . . . . . . . . . .  C  ADDR  0455H     R   SEG=?CO?BLHELI_S?7
WAIT_150US. . . . . . . . . . . . .  C  ADDR  0D47H     R   SEG=?CO?BLHELI_S?7
WAIT_ADVANCE_TIMING . . . . . . . .  C  ADDR  06A7H     R   SEG=?CO?BLHELI_S?7
WAIT_BEFORE_ZC_SCAN . . . . . . . .  C  ADDR  0771H     R   SEG=?CO?BLHELI_S?7
WAIT_BEFORE_ZC_SCAN_EXIT. . . . . .  C  ADDR  07B1H     R   SEG=?CO?BLHELI_S?7
WAIT_FOR_COMM . . . . . . . . . . .  C  ADDR  08BEH     R   SEG=?CO?BLHELI_S?7
WAIT_FOR_COMM_WAIT. . . . . . . . .  C  ADDR  08EEH     R   SEG=?CO?BLHELI_S?7
WAIT_FOR_COMP_OUT_HIGH. . . . . . .  C  ADDR  07C2H     R   SEG=?CO?BLHELI_S?7
WAIT_FOR_COMP_OUT_LOW . . . . . . .  C  ADDR  07B2H     R   SEG=?CO?BLHELI_S?7
WAIT_FOR_COMP_OUT_START . . . . . .  C  ADDR  07D0H     R   SEG=?CO?BLHELI_S?7
WAIT_FOR_LOW. . . . . . . . . . . .  C  ADDR  1C46H     R   SEG=?CO?BLHELI_S?9
WAIT_FOR_POWER_ON . . . . . . . . .  C  ADDR  1145H     R   SEG=?CO?BLHELI_S?7
WAIT_FOR_POWER_ON_LOOP. . . . . . .  C  ADDR  114AH     R   SEG=?CO?BLHELI_S?7
WAIT_FOR_POWER_ON_NO_BEEP . . . . .  C  ADDR  1190H     R   SEG=?CO?BLHELI_S?7
WAIT_FOR_POWER_ON_NOT_MISSING . . .  C  ADDR  119AH     R   SEG=?CO?BLHELI_S?7
WAITF . . . . . . . . . . . . . . .  C  ADDR  1DC3H     R   SEG=?CO?BLHELI_S?9
WAITH . . . . . . . . . . . . . . .  C  ADDR  1DC7H     R   SEG=?CO?BLHELI_S?9
WAITXMS_M . . . . . . . . . . . . .  C  ADDR  046BH     R   SEG=?CO?BLHELI_S?7
WAITXMS_O . . . . . . . . . . . . .  C  ADDR  0469H     R   SEG=?CO?BLHELI_S?7
WDTCN . . . . . . . . . . . . . . .  -- ----  -------       
WRITE_EEPROM_BLOCK1 . . . . . . . .  C  ADDR  139BH     R   SEG=?CO?BLHELI_S?7
WRITE_EEPROM_BLOCK2 . . . . . . . .  C  ADDR  13A8H     R   SEG=?CO?BLHELI_S?7
WRITE_EEPROM_BYTE . . . . . . . . .  C  ADDR  13BAH     R   SEG=?CO?BLHELI_S?7
WRITE_EEPROM_BYTE_FROM_ACC. . . . .  C  ADDR  13BBH     R   SEG=?CO?BLHELI_S?7
WRITE_EEPROM_SIGNATURE. . . . . . .  C  ADDR  13EAH     R   SEG=?CO?BLHELI_S?7
WRITE_TAG . . . . . . . . . . . . .  C  ADDR  1413H     R   SEG=?CO?BLHELI_S?7
WRITE_TAGS. . . . . . . . . . . . .  C  ADDR  140CH     R   SEG=?CO?BLHELI_S?7
WT_ADV_START_H. . . . . . . . . . .  D  ADDR  004BH     R   SEG=?DT?BLHELI_S?2
WT_ADV_START_L. . . . . . . . . . .  D  ADDR  004AH     R   SEG=?DT?BLHELI_S?2
WT_COMM_START_H . . . . . . . . . .  D  ADDR  0051H     R   SEG=?DT?BLHELI_S?2
WT_COMM_START_L . . . . . . . . . .  D  ADDR  0050H     R   SEG=?DT?BLHELI_S?2
WT_ZC_SCAN_START_H. . . . . . . . .  D  ADDR  004DH     R   SEG=?DT?BLHELI_S?2
WT_ZC_SCAN_START_L. . . . . . . . .  D  ADDR  004CH     R   SEG=?DT?BLHELI_S?2
WT_ZC_TOUT_START_H. . . . . . . . .  D  ADDR  004FH     R   SEG=?DT?BLHELI_S?2
WT_ZC_TOUT_START_L. . . . . . . . .  D  ADDR  004EH     R   SEG=?DT?BLHELI_S?2
XBR2. . . . . . . . . . . . . . . .  -- ----  -------       
XH. . . . . . . . . . . . . . . . .     REG   R            
XL. . . . . . . . . . . . . . . . .     REG   R            
XTAL. . . . . . . . . . . . . . . .  N  NUMB  017D7840H A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 376 ERROR(S).
